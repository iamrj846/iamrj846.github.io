
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            
            <title>[Dynamic Programming] Range Sum Query 2D (DP Variant) - Medium</title>
            <meta name="description" content="Learn how to solve the Range Sum Query 2D problem using dynamic programming techniques. Optimize your algorithms effectively!">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">[Dynamic Programming] Range Sum Query 2D (DP Variant) - Medium</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>Dynamic Programming (DP) is a strong method to solve hard problems.
We do this by breaking the problems into easier parts. The Range Sum
Query 2D problem is a good example. We can find the sum of numbers in a
certain rectangle in a 2D grid quickly. By using dynamic programming and
prefix sums, we can prepare the grid first. This way, we can answer many
sum questions very fast. This is much better than using simple
methods.</p>
<p>In this article, we will look into the Range Sum Query 2D problem. We
will focus on the dynamic programming way and the prefix sum method. We
will give a clear tutorial to help understand the problem. Then, we will
show how to implement it in Java, Python, and C++. We will also talk
about how to make space use better and how to test and check our
solutions. By the end, we hope you will know how to handle the Range Sum
Query 2D problem well using dynamic programming.</p>
<ul>
<li>[Dynamic Programming] Range Sum Query 2D DP Variant - Medium
Tutorial</li>
<li>Understanding the Problem Statement for Range Sum Query 2D</li>
<li>Dynamic Programming Approach to Range Sum Query 2D</li>
<li>Prefix Sum Technique for 2D Range Queries</li>
<li>Java Implementation of Range Sum Query 2D</li>
<li>Python Implementation of Range Sum Query 2D</li>
<li>C++ Implementation of Range Sum Query 2D</li>
<li>Optimizing Space Complexity in Range Sum Query 2D</li>
<li>Testing and Validating the Range Sum Query Solutions</li>
<li>Frequently Asked Questions</li>
</ul>
<p>For more ideas on dynamic programming, you can read the article on <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-fibonacci-number-easy.html">Dynamic
Programming: Fibonacci Number</a>. It can help you too.</p>
<h2
id="understanding-the-problem-statement-for-range-sum-query-2d">Understanding
the Problem Statement for Range Sum Query 2D</h2>
<p>We have a problem called Range Sum Query 2D. It asks us to find the
sum of values in a rectangle part of a 2D matrix. The matrix is
<code>matrix</code> and it has a size of <code>m x n</code>. Our goal is
to prepare the matrix so we can quickly calculate the sum of numbers in
any submatrix. We define this submatrix by its top-left and bottom-right
corners.</p>
<h3 id="problem-definition">Problem Definition</h3>
<ul>
<li><strong>Input</strong>: A 2D matrix with integers and some queries.
Each query has two corners: <code>(row1, col1)</code> and
<code>(row2, col2)</code>.</li>
<li><strong>Output</strong>: For each query, we give the sum of the
numbers in the specified submatrix.</li>
</ul>
<h3 id="example">Example</h3>
<p>Letâ€™s look at this matrix:</p>
<pre><code>[
  [3, 0, 1, 4, 2],
  [5, 6, 3, 2, 1],
  [1, 2, 0, 1, 5],
  [4, 1, 0, 1, 7],
  [1, 0, 3, 0, 5]
]</code></pre>
<p>If we ask for <code>sumRegion(2, 1, 4, 3)</code>, we want the sum
from <code>(2, 1)</code> to <code>(4, 3)</code>. The answer will be
<code>8</code> because <code>2 + 0 + 1 + 1 + 0 + 3 = 8</code>.</p>
<h3 id="constraints">Constraints</h3>
<ul>
<li>The matrix can have negative numbers.</li>
<li>We can have many queries. So, simple summation is not a good
idea.</li>
</ul>
<p>To solve the Range Sum Query 2D problem well, we must use data
structures. For example, we can use prefix sums or dynamic programming.
This helps us prepare the matrix first. After that, we can quickly find
sums for each query. The first step takes linear time. After that, we
can get answers in constant time.</p>
<h2 id="dynamic-programming-approach-to-range-sum-query-2d">Dynamic
Programming Approach to Range Sum Query 2D</h2>
<p>The Range Sum Query 2D problem helps us quickly find the sum of
numbers in a certain rectangle area of a 2D array. We can make this
faster by using a dynamic programming method that calculates cumulative
sums in advance.</p>
<h3 id="dynamic-programming-solution">Dynamic Programming Solution</h3>
<ol type="1">
<li><p><strong>Define the 2D Prefix Sum Array</strong>: We will create a
prefix sum array called <code>dp</code>. Here, <code>dp[i][j]</code>
shows the total of elements from the top-left corner <code>(0, 0)</code>
to <code>(i, j)</code> in the original matrix.</p>
<p>The formula to find the prefix sum is:</p>
<pre><code>dp[i][j] = matrix[i][j] + dp[i-1][j] + dp[i][j-1] - dp[i-1][j-1]</code></pre></li>
<li><p><strong>Calculate the Range Sum</strong>: If we have a query with
two points <code>(row1, col1)</code> and <code>(row2, col2)</code>, we
can find the sum of elements in this area like this:</p>
<pre><code>sum = dp[row2][col2] - (dp[row1-1][col2] if row1 &gt; 0 else 0) - (dp[row2][col1-1] if col1 &gt; 0 else 0) + (dp[row1-1][col1-1] if row1 &gt; 0 and col1 &gt; 0 else 0)</code></pre></li>
</ol>
<h3 id="implementation">Implementation</h3>
<p><strong>Java Implementation</strong>:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NumMatrix <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span><span class="op">[][]</span> dp<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">NumMatrix</span><span class="op">(</span><span class="dt">int</span><span class="op">[][]</span> matrix<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> m <span class="op">=</span> matrix<span class="op">.</span><span class="fu">length</span><span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> n <span class="op">=</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">length</span><span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        dp <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[</span>m<span class="op">][</span>n<span class="op">];</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> m<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> n<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                dp<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> matrix<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">+</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                           <span class="op">(</span>i <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> dp<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j<span class="op">]</span> <span class="op">:</span> <span class="dv">0</span><span class="op">)</span> <span class="op">+</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                           <span class="op">(</span>j <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> dp<span class="op">[</span>i<span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">:</span> <span class="dv">0</span><span class="op">)</span> <span class="op">-</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                           <span class="op">(</span>i <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> j <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> dp<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">:</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">sumRegion</span><span class="op">(</span><span class="dt">int</span> row1<span class="op">,</span> <span class="dt">int</span> col1<span class="op">,</span> <span class="dt">int</span> row2<span class="op">,</span> <span class="dt">int</span> col2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> dp<span class="op">[</span>row2<span class="op">][</span>col2<span class="op">]</span> <span class="op">-</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>               <span class="op">(</span>row1 <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> dp<span class="op">[</span>row1 <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>col2<span class="op">]</span> <span class="op">:</span> <span class="dv">0</span><span class="op">)</span> <span class="op">-</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>               <span class="op">(</span>col1 <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> dp<span class="op">[</span>row2<span class="op">][</span>col1 <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">:</span> <span class="dv">0</span><span class="op">)</span> <span class="op">+</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>               <span class="op">(</span>row1 <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> col1 <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> dp<span class="op">[</span>row1 <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>col1 <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">:</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Python Implementation</strong>:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NumMatrix:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, matrix: List[List[<span class="bu">int</span>]]):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dp <span class="op">=</span> [[<span class="dv">0</span>] <span class="op">*</span> <span class="bu">len</span>(matrix[<span class="dv">0</span>]) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(matrix))]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(matrix)):</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(matrix[<span class="dv">0</span>])):</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.dp[i][j] <span class="op">=</span> matrix[i][j] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                                (<span class="va">self</span>.dp[i<span class="op">-</span><span class="dv">1</span>][j] <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>) <span class="op">+</span> <span class="op">\</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                                (<span class="va">self</span>.dp[i][j<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> j <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>) <span class="op">-</span> <span class="op">\</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                                (<span class="va">self</span>.dp[i<span class="op">-</span><span class="dv">1</span>][j<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> j <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sumRegion(<span class="va">self</span>, row1: <span class="bu">int</span>, col1: <span class="bu">int</span>, row2: <span class="bu">int</span>, col2: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.dp[row2][col2] <span class="op">-</span> <span class="op">\</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>               (<span class="va">self</span>.dp[row1<span class="op">-</span><span class="dv">1</span>][col2] <span class="cf">if</span> row1 <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>) <span class="op">-</span> <span class="op">\</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>               (<span class="va">self</span>.dp[row2][col1<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> col1 <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>) <span class="op">+</span> <span class="op">\</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>               (<span class="va">self</span>.dp[row1<span class="op">-</span><span class="dv">1</span>][col1<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> row1 <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> col1 <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>)</span></code></pre></div>
<p><strong>C++ Implementation</strong>:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NumMatrix <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">&lt;</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;</span> dp<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    NumMatrix<span class="op">(</span>vector<span class="op">&lt;</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;&amp;</span> matrix<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> m <span class="op">=</span> matrix<span class="op">.</span>size<span class="op">(),</span> n <span class="op">=</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span>size<span class="op">();</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        dp<span class="op">.</span>resize<span class="op">(</span>m<span class="op">,</span> vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;(</span>n<span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> m<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> n<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                dp<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> matrix<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                           <span class="op">(</span>i <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> dp<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j<span class="op">]</span> <span class="op">:</span> <span class="dv">0</span><span class="op">)</span> <span class="op">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                           <span class="op">(</span>j <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> dp<span class="op">[</span>i<span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">:</span> <span class="dv">0</span><span class="op">)</span> <span class="op">-</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                           <span class="op">(</span>i <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> j <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> dp<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">:</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sumRegion<span class="op">(</span><span class="dt">int</span> row1<span class="op">,</span> <span class="dt">int</span> col1<span class="op">,</span> <span class="dt">int</span> row2<span class="op">,</span> <span class="dt">int</span> col2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> dp<span class="op">[</span>row2<span class="op">][</span>col2<span class="op">]</span> <span class="op">-</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>               <span class="op">(</span>row1 <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> dp<span class="op">[</span>row1 <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>col2<span class="op">]</span> <span class="op">:</span> <span class="dv">0</span><span class="op">)</span> <span class="op">-</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>               <span class="op">(</span>col1 <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> dp<span class="op">[</span>row2<span class="op">][</span>col1 <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">:</span> <span class="dv">0</span><span class="op">)</span> <span class="op">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>               <span class="op">(</span>row1 <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> col1 <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> dp<span class="op">[</span>row1 <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>col1 <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">:</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 id="complexity-analysis">Complexity Analysis</h3>
<ul>
<li><strong>Time Complexity</strong>: O(1) for every query after O(m *
n) time to fill the prefix sum array</li>
<li><strong>Space Complexity</strong>: O(m * n) for the prefix sum
array</li>
</ul>
<p>This dynamic programming method gives us a quick way to solve the
Range Sum Query 2D problem. We use precomputed sums to answer queries
fast. For more articles about dynamic programming, we can check out <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-fibonacci-number-easy.html">Dynamic
Programming: Fibonacci Number</a> and <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-unique-paths-in-a-grid-easy.html">Dynamic
Programming: Unique Paths in a Grid</a>.</p>
<h2 id="prefix-sum-technique-for-2d-range-queries">Prefix Sum Technique
for 2D Range Queries</h2>
<p>We can use the Prefix Sum technique to quickly find sums over
submatrices in a 2D array. This method helps us prepare the matrix.
After that, we can answer any range sum question in constant time.</p>
<h3 id="prefix-sum-array-construction">Prefix Sum Array
Construction</h3>
<p>First, we need to make a 2D prefix sum array called
<code>prefix</code>. In this array, <code>prefix[i][j]</code> will store
the sum of elements from the top-left corner <code>(0,0)</code> to the
position <code>(i,j)</code>. We can build this array using the formula
below:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_prefix_sum(matrix):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    rows, cols <span class="op">=</span> <span class="bu">len</span>(matrix), <span class="bu">len</span>(matrix[<span class="dv">0</span>])</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    prefix <span class="op">=</span> [[<span class="dv">0</span>] <span class="op">*</span> (cols <span class="op">+</span> <span class="dv">1</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(rows <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, rows <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, cols <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            prefix[i][j] <span class="op">=</span> (matrix[i <span class="op">-</span> <span class="dv">1</span>][j <span class="op">-</span> <span class="dv">1</span>] </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                            <span class="op">+</span> prefix[i <span class="op">-</span> <span class="dv">1</span>][j] </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                            <span class="op">+</span> prefix[i][j <span class="op">-</span> <span class="dv">1</span>] </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                            <span class="op">-</span> prefix[i <span class="op">-</span> <span class="dv">1</span>][j <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prefix</span></code></pre></div>
<h3 id="querying-the-sum-of-a-submatrix">Querying the Sum of a
Submatrix</h3>
<p>After we make the prefix sum array, we can find the sum of any
submatrix. We just need to define corners <code>(row1, col1)</code> and
<code>(row2, col2)</code> and use the formula below:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> range_sum_query(prefix, row1, col1, row2, col2):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (prefix[row2 <span class="op">+</span> <span class="dv">1</span>][col2 <span class="op">+</span> <span class="dv">1</span>] </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span> prefix[row1][col2 <span class="op">+</span> <span class="dv">1</span>] </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span> prefix[row2 <span class="op">+</span> <span class="dv">1</span>][col1] </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> prefix[row1][col1])</span></code></pre></div>
<h3 id="example-1">Example</h3>
<p>Letâ€™s look at a matrix:</p>
<pre><code>[
    [1, 2, 3],
    [4, 5, 6],
    [7, 8, 9]
]</code></pre>
<p>After we call <code>compute_prefix_sum(matrix)</code>, our prefix sum
array will look like this:</p>
<pre><code>[
    [0, 0, 0, 0],
    [0, 1, 3, 6],
    [0, 5, 12, 21],
    [0, 12, 27, 45]
]</code></pre>
<p>If we want to find the sum of the submatrix from <code>(1, 1)</code>
to <code>(2, 2)</code>, we would call:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sum_result <span class="op">=</span> range_sum_query(prefix, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)  <span class="co"># Output: 28</span></span></code></pre></div>
<p>This method lets us quickly sum any submatrix after we prepare it. It
is very efficient for many questions. The time to prepare the matrix is
(O(m n)) and each question takes (O(1)).</p>
<p>For more about dynamic programming techniques, you can check the
article on <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-unique-paths-in-a-grid-easy.html">Dynamic
Programming - Unique Paths in a Grid</a>.</p>
<h2 id="java-implementation-of-range-sum-query-2d">Java Implementation
of Range Sum Query 2D</h2>
<p>We will show how to implement the Range Sum Query 2D in Java. We use
a prefix sum array. This array helps us to quickly find the sum of
elements in a specific rectangular area of a 2D matrix. The big benefit
of using a prefix sum array is that we can calculate the sum of any
submatrix in constant time after we set it up.</p>
<h3 id="step-1-build-the-prefix-sum-array">Step 1: Build the Prefix Sum
Array</h3>
<p>We start by making a 2D prefix sum array. Here,
<code>prefix[i][j]</code> will hold the sum of the elements from the
top-left corner (0, 0) to the bottom-right corner (i, j).</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> NumMatrix <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span><span class="op">[][]</span> prefix<span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">NumMatrix</span><span class="op">(</span><span class="dt">int</span><span class="op">[][]</span> matrix<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>matrix <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> matrix<span class="op">.</span><span class="fu">length</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">||</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">length</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> rows <span class="op">=</span> matrix<span class="op">.</span><span class="fu">length</span><span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> cols <span class="op">=</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">length</span><span class="op">;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        prefix <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[</span>rows <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>cols <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> rows<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;=</span> cols<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                prefix<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> matrix<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                             <span class="op">+</span> prefix<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j<span class="op">]</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                             <span class="op">+</span> prefix<span class="op">[</span>i<span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                             <span class="op">-</span> prefix<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="step-2-get-the-sum-of-a-submatrix">Step 2: Get the Sum of a
Submatrix</h3>
<p>When we want to get the sum of a submatrix, we define it by its
corners <code>(row1, col1)</code> and <code>(row2, col2)</code>. We can
use this formula:</p>
<pre><code>sum = prefix[row2 + 1][col2 + 1] 
    - prefix[row1][col2 + 1] 
    - prefix[row2 + 1][col1] 
    + prefix[row1][col1];</code></pre>
<p>Here is the method to do the sum query:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">int</span> <span class="fu">sumRegion</span><span class="op">(</span><span class="dt">int</span> row1<span class="op">,</span> <span class="dt">int</span> col1<span class="op">,</span> <span class="dt">int</span> row2<span class="op">,</span> <span class="dt">int</span> col2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prefix<span class="op">[</span>row2 <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>col2 <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>         <span class="op">-</span> prefix<span class="op">[</span>row1<span class="op">][</span>col2 <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>         <span class="op">-</span> prefix<span class="op">[</span>row2 <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>col1<span class="op">]</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>         <span class="op">+</span> prefix<span class="op">[</span>row1<span class="op">][</span>col1<span class="op">];</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="full-implementation">Full Implementation</h3>
<p>Now we put everything together. Here is the complete implementation
of the Range Sum Query 2D in Java:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> NumMatrix <span class="op">{</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span><span class="op">[][]</span> prefix<span class="op">;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">NumMatrix</span><span class="op">(</span><span class="dt">int</span><span class="op">[][]</span> matrix<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>matrix <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> matrix<span class="op">.</span><span class="fu">length</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">||</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">length</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> rows <span class="op">=</span> matrix<span class="op">.</span><span class="fu">length</span><span class="op">;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> cols <span class="op">=</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">length</span><span class="op">;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        prefix <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[</span>rows <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>cols <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> rows<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;=</span> cols<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                prefix<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> matrix<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                             <span class="op">+</span> prefix<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j<span class="op">]</span> </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                             <span class="op">+</span> prefix<span class="op">[</span>i<span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                             <span class="op">-</span> prefix<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">sumRegion</span><span class="op">(</span><span class="dt">int</span> row1<span class="op">,</span> <span class="dt">int</span> col1<span class="op">,</span> <span class="dt">int</span> row2<span class="op">,</span> <span class="dt">int</span> col2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> prefix<span class="op">[</span>row2 <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>col2 <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>             <span class="op">-</span> prefix<span class="op">[</span>row1<span class="op">][</span>col2 <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>             <span class="op">-</span> prefix<span class="op">[</span>row2 <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>col1<span class="op">]</span> </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>             <span class="op">+</span> prefix<span class="op">[</span>row1<span class="op">][</span>col1<span class="op">];</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="example-usage">Example Usage</h3>
<p>Here is how we can use our class:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span><span class="op">[][]</span> matrix <span class="op">=</span> <span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">},</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">},</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">7</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span><span class="op">}</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    NumMatrix numMatrix <span class="op">=</span> <span class="kw">new</span> <span class="fu">NumMatrix</span><span class="op">(</span>matrix<span class="op">);</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>numMatrix<span class="op">.</span><span class="fu">sumRegion</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">));</span> <span class="co">// Output: 12</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>numMatrix<span class="op">.</span><span class="fu">sumRegion</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">));</span> <span class="co">// Output: 28</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>numMatrix<span class="op">.</span><span class="fu">sumRegion</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">));</span> <span class="co">// Output: 21</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This way of doing it is good for speed and space. It lets us quickly
get sum queries after we set it up first. The prefix sum method can be
used in many different situations when we deal with 2D range
queries.</p>
<h2 id="python-implementation-of-range-sum-query-2d">Python
Implementation of Range Sum Query 2D</h2>
<p>We can use the Prefix Sum technique to implement the Range Sum Query
for a 2D matrix in Python. This method helps us prepare the matrix. Then
we can answer sum queries very quickly.</p>
<p>Here is how we can do it:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NumMatrix:</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, matrix: List[List[<span class="bu">int</span>]]):</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> matrix <span class="kw">or</span> <span class="kw">not</span> matrix[<span class="dv">0</span>]:</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.matrix <span class="op">=</span> []</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.prefix_sum <span class="op">=</span> []</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.rows, <span class="va">self</span>.cols <span class="op">=</span> <span class="bu">len</span>(matrix), <span class="bu">len</span>(matrix[<span class="dv">0</span>])</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.matrix <span class="op">=</span> matrix</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.prefix_sum <span class="op">=</span> [[<span class="dv">0</span>] <span class="op">*</span> (<span class="va">self</span>.cols <span class="op">+</span> <span class="dv">1</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.rows <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> r <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="va">self</span>.rows <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> c <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="va">self</span>.cols <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.prefix_sum[r][c] <span class="op">=</span> (matrix[r <span class="op">-</span> <span class="dv">1</span>][c <span class="op">-</span> <span class="dv">1</span>] <span class="op">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>                                         <span class="va">self</span>.prefix_sum[r <span class="op">-</span> <span class="dv">1</span>][c] <span class="op">+</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>                                         <span class="va">self</span>.prefix_sum[r][c <span class="op">-</span> <span class="dv">1</span>] <span class="op">-</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                                         <span class="va">self</span>.prefix_sum[r <span class="op">-</span> <span class="dv">1</span>][c <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sumRegion(<span class="va">self</span>, row1: <span class="bu">int</span>, col1: <span class="bu">int</span>, row2: <span class="bu">int</span>, col2: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="va">self</span>.prefix_sum[row2 <span class="op">+</span> <span class="dv">1</span>][col2 <span class="op">+</span> <span class="dv">1</span>] <span class="op">-</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.prefix_sum[row1][col2 <span class="op">+</span> <span class="dv">1</span>] <span class="op">-</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.prefix_sum[row2 <span class="op">+</span> <span class="dv">1</span>][col1] <span class="op">+</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.prefix_sum[row1][col1])</span></code></pre></div>
<h3 id="explanation-of-the-code">Explanation of the Code</h3>
<ul>
<li><strong>Initialization (<code>__init__</code> method)</strong>:
<ul>
<li>The constructor takes a 2D list <code>matrix</code> as input.</li>
<li>It makes a <code>prefix_sum</code> matrix that has size
<code>(rows + 1) x (cols + 1)</code>. This matrix stores the total
sums.</li>
<li>We calculate the prefix sums using this formula: [ [r][c] =
[r-1][c-1] + [r-1][c] + [r][c-1] - [r-1][c-1] ]</li>
</ul></li>
<li><strong>Querying (<code>sumRegion</code> method)</strong>:
<ul>
<li>The <code>sumRegion</code> method finds the sum of elements in the
rectangle from <code>(row1, col1)</code> to
<code>(row2, col2)</code>.</li>
<li>It uses the prefix sums we calculated before to give the answer
quickly.</li>
</ul></li>
</ul>
<p>This code lets us do range sum queries fast after we prepare the
data. It works well when we have many queries on the same matrix.</p>
<p>For more information on dynamic programming, we can read this <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-fibonacci-number-easy.html">dynamic
programming Fibonacci number</a> article.</p>
<h2 id="c-implementation-of-range-sum-query-2d">C++ Implementation of
Range Sum Query 2D</h2>
<p>We can implement the Range Sum Query 2D using C++. We use a prefix
sum array to quickly find the sum of elements in a specific rectangle
area of a 2D matrix. This way, we can prepare the data in O(m * n) time.
Here, m and n are the size of the matrix. After that, we can answer sum
queries in O(1) time.</p>
<h3 id="c-code-implementation">C++ Code Implementation</h3>
<div class="sourceCode" id="cb18"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NumMatrix <span class="op">{</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;</span> prefixSum<span class="op">;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    NumMatrix<span class="op">(</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;&amp;</span> matrix<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> m <span class="op">=</span> matrix<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>m <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span> <span class="co">// Handle empty matrix</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> n <span class="op">=</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span>size<span class="op">();</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        prefixSum <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;(</span>m <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Build the prefix sum matrix</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> m<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>                prefixSum<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> matrix<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>                                <span class="op">+</span> prefixSum<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j<span class="op">]</span> </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>                                <span class="op">+</span> prefixSum<span class="op">[</span>i<span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>                                <span class="op">-</span> prefixSum<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sumRegion<span class="op">(</span><span class="dt">int</span> row1<span class="op">,</span> <span class="dt">int</span> col1<span class="op">,</span> <span class="dt">int</span> row2<span class="op">,</span> <span class="dt">int</span> col2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> prefixSum<span class="op">[</span>row2 <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>col2 <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>             <span class="op">-</span> prefixSum<span class="op">[</span>row1<span class="op">][</span>col2 <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>             <span class="op">-</span> prefixSum<span class="op">[</span>row2 <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>col1<span class="op">]</span> </span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>             <span class="op">+</span> prefixSum<span class="op">[</span>row1<span class="op">][</span>col1<span class="op">];</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;</span> matrix <span class="op">=</span> <span class="op">{</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">},</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">},</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">7</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span><span class="op">}</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    NumMatrix numMatrix<span class="op">(</span>matrix<span class="op">);</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">&quot;Sum of region (1, 1) to (2, 2): &quot;</span> <span class="op">&lt;&lt;</span> numMatrix<span class="op">.</span>sumRegion<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span> <span class="co">// Output: 28</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">&quot;Sum of region (0, 0) to (1, 1): &quot;</span> <span class="op">&lt;&lt;</span> numMatrix<span class="op">.</span>sumRegion<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span> <span class="co">// Output: 12</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="explanation-of-c-code">Explanation of C++ Code</h3>
<ul>
<li><strong>Class Definition</strong>: The <code>NumMatrix</code> class
has a 2D vector called <code>prefixSum</code>. It saves the prefix
sums.</li>
<li><strong>Constructor</strong>: The constructor sets up the
<code>prefixSum</code> matrix:
<ul>
<li>It goes through each element in the input matrix and finds the
prefix sum using:
<ul>
<li><code>prefixSum[i][j] = matrix[i-1][j-1] + prefixSum[i-1][j] + prefixSum[i][j-1] - prefixSum[i-1][j-1]</code></li>
</ul></li>
</ul></li>
<li><strong>sumRegion Method</strong>: This method finds the sum of the
rectangle area defined by <code>(row1, col1)</code> and
<code>(row2, col2)</code>:
<ul>
<li>It uses the inclusion-exclusion rule to get the sum in constant time
from the <code>prefixSum</code> array.</li>
</ul></li>
</ul>
<p>This C++ code for Range Sum Query 2D helps us to handle sum queries
easily. It shows how we can use dynamic programming to make our
solutions faster. For more on dynamic programming, we can look at <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-unique-paths-in-a-grid-easy.html">Dynamic
Programming - Unique Paths in a Grid</a>.</p>
<h2 id="optimizing-space-complexity-in-range-sum-query-2d">Optimizing
Space Complexity in Range Sum Query 2D</h2>
<p>In the Range Sum Query 2D problem, we often use a 2D array to keep
prefix sums. This can use a lot of space, especially when we have big
matrices. We can make space usage better by lowering the extra space we
need for the prefix sums.</p>
<h3 id="techniques-for-space-optimization">Techniques for Space
Optimization</h3>
<ol type="1">
<li><p><strong>In-place Updates</strong>: Instead of using a separate 2D
array for prefix sums, we can change the original matrix to keep
cumulative sums. This way, we can use the same data instead of creating
a new one when we do range queries.</p></li>
<li><p><strong>Single Array Usage</strong>: If the problem allows it, we
can turn the 2D prefix sum array into a 1D array to save space. By going
through the matrix row by row or column by column, we can find the
cumulative sum without needing a full 2D array.</p></li>
</ol>
<h3 id="implementation-example">Implementation Example</h3>
<p>Here is a Java code that shows how we can make space usage better
while calculating 2D range sums using in-place updates.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NumMatrix <span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span><span class="op">[][]</span> matrix<span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span><span class="op">[][]</span> sumMatrix<span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">NumMatrix</span><span class="op">(</span><span class="dt">int</span><span class="op">[][]</span> matrix<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">matrix</span> <span class="op">=</span> matrix<span class="op">;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>matrix<span class="op">.</span><span class="fu">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">length</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> rows <span class="op">=</span> matrix<span class="op">.</span><span class="fu">length</span><span class="op">;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> cols <span class="op">=</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">length</span><span class="op">;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>            sumMatrix <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[</span>rows <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>cols <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> rows<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;=</span> cols<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                    sumMatrix<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> matrix<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                                     <span class="op">+</span> sumMatrix<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j<span class="op">]</span> </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                                     <span class="op">+</span> sumMatrix<span class="op">[</span>i<span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                                     <span class="op">-</span> sumMatrix<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">sumRegion</span><span class="op">(</span><span class="dt">int</span> row1<span class="op">,</span> <span class="dt">int</span> col1<span class="op">,</span> <span class="dt">int</span> row2<span class="op">,</span> <span class="dt">int</span> col2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sumMatrix<span class="op">[</span>row2 <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>col2 <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>             <span class="op">-</span> sumMatrix<span class="op">[</span>row1<span class="op">][</span>col2 <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>             <span class="op">-</span> sumMatrix<span class="op">[</span>row2 <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>col1<span class="op">]</span> </span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>             <span class="op">+</span> sumMatrix<span class="op">[</span>row1<span class="op">][</span>col1<span class="op">];</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="key-points">Key Points</h3>
<ul>
<li>We create the <code>sumMatrix</code> with an extra row and column.
This makes range sum calculations easier.</li>
<li>We use this cumulative sum method to lower the space usage. This
allows us to get sum queries in constant time after we set everything
up.</li>
<li>This method keeps the ability of the 2D range sum query and also
cuts down the space we need.</li>
</ul>
<p>This better way to handle the Range Sum Query 2D problem makes the
algorithm faster. It also helps us work with bigger data without using
too much memory. If you want to learn more about dynamic programming
methods, you can check out <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-unique-paths-in-a-grid-easy.html">Dynamic
Programming: Unique Paths in a Grid</a>.</p>
<h2 id="testing-and-validating-the-range-sum-query-solutions">Testing
and Validating the Range Sum Query Solutions</h2>
<p>We need to make sure the Range Sum Query 2D solutions are correct. To
do this, we should have a good testing plan. In this section, we will
talk about important testing methods like unit tests and checking
against expected results.</p>
<h3 id="testing-methodology">Testing Methodology</h3>
<ol type="1">
<li><strong>Unit Testing</strong>: We create unit tests for each version
(Java, Python, C++) to check if they work well.</li>
<li><strong>Boundary Conditions</strong>: We test special cases like:
<ul>
<li>Empty matrices</li>
<li>Matrices with only one element</li>
<li>Queries that cover the whole matrix</li>
</ul></li>
<li><strong>Randomized Testing</strong>: We make random matrices and
queries. Then we compare the results with a brute-force method to make
sure they are right.</li>
</ol>
<h3 id="example-test-cases">Example Test Cases</h3>
<p>Letâ€™s look at an example. We have a 2D matrix and some queries.</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample Matrix</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>matrix <span class="op">=</span> [</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>],</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Queries</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>queries <span class="op">=</span> [</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),  <span class="co"># Sum of submatrix from (0,0) to (1,1) =&gt; 1+2+4+5 = 12</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),  <span class="co"># Sum of submatrix from (1,1) to (2,2) =&gt; 5+6+8+9 = 28</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>)   <span class="co"># Sum of the entire matrix =&gt; 1+2+3+4+5+6+7+8+9 = 45</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected Results</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>expected_results <span class="op">=</span> [<span class="dv">12</span>, <span class="dv">28</span>, <span class="dv">45</span>]</span></code></pre></div>
<h3 id="validation-function">Validation Function</h3>
<p>We write a validation function to check results from the DP method
with the expected results.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> validate_range_sum_query(matrix, queries, expected_results):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, query <span class="kw">in</span> <span class="bu">enumerate</span>(queries):</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        x1, y1, x2, y2 <span class="op">=</span> query</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> range_sum_query_2D(matrix, x1, y1, x2, y2)  <span class="co"># Call your DP function here</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> result <span class="op">==</span> expected_results[index], <span class="ss">f&quot;Test failed for query </span><span class="sc">{</span>query<span class="sc">}</span><span class="ss">: expected </span><span class="sc">{</span>expected_results[index]<span class="sc">}</span><span class="ss">, got </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;All tests passed!&quot;</span>)</span></code></pre></div>
<h3 id="running-tests">Running Tests</h3>
<p>We should put the validation function in our testing system and run
it. This will help us make sure all queries give the expected
results.</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>validate_range_sum_query(matrix, queries, expected_results)</span></code></pre></div>
<p>By using these testing and validation methods, we can check that our
Range Sum Query 2D solutions work well in different situations and edge
cases. If you want to learn more about dynamic programming tests, you
can read <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-fibonacci-number-easy.html">Dynamic
Programming Basics</a>. This will help us understand the basics that are
useful for testing.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3
id="what-is-the-range-sum-query-2d-problem-in-dynamic-programming">What
is the Range Sum Query 2D problem in dynamic programming?</h3>
<p>The Range Sum Query 2D problem is about finding the sum of numbers in
a specific rectangular area of a 2D matrix. We can solve this problem
well using dynamic programming. We create a prefix sum matrix first.
This lets us get the sum quickly after we do some initial work.</p>
<h3 id="how-is-dynamic-programming-used-in-range-sum-query-2d">How is
dynamic programming used in Range Sum Query 2D?</h3>
<p>Dynamic programming helps us with Range Sum Query 2D by dividing the
problem into smaller parts. We make a prefix sum array. This array holds
the total sums of numbers. With this, we can find the sum of any
submatrix very fast, much better than the simple way.</p>
<h3
id="can-you-explain-the-prefix-sum-technique-in-2d-range-queries">Can
you explain the prefix sum technique in 2D range queries?</h3>
<p>The prefix sum technique for 2D range queries means we build a 2D
array. In this array, each spot (i, j) has the sum of all numbers from
the top-left corner (0, 0) to (i, j) in the original matrix. This makes
it easy to find submatrix sums using the inclusion-exclusion principle.
This way, Range Sum Query 2D becomes much quicker.</p>
<h3
id="what-are-the-common-implementations-of-range-sum-query-2d-in-java-python-and-c">What
are the common implementations of Range Sum Query 2D in Java, Python,
and C++?</h3>
<p>We can find Range Sum Query 2D implementations in many programming
languages. Java, Python, and C++ are the most popular. Each of these
usually builds a prefix sum array and has a way to get the sum of any
submatrix. For more examples, check the <a
href="https://bestonlinetutorial.com/dynamic_programming/range-sum-query-2d-dp-variant-medium.html">Java
Implementation of Range Sum Query 2D</a>, <a
href="https://bestonlinetutorial.com/dynamic_programming/range-sum-query-2d-dp-variant-medium.html">Python
Implementation</a>, and <a
href="https://bestonlinetutorial.com/dynamic_programming/range-sum-query-2d-dp-variant-medium.html">C++
Implementation</a>.</p>
<h3 id="how-can-i-optimize-space-complexity-in-range-sum-query-2d">How
can I optimize space complexity in Range Sum Query 2D?</h3>
<p>To make space better in Range Sum Query 2D, we can use one 2D array
for prefix sums instead of many arrays for queries. By using the prefix
sums well, we can save space and still get sums quickly. For more tips,
you can check related articles on dynamic programming.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            