
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            
            <title>[Dynamic Programming] Maximum Sum of Rectangle No Larger Than K - Hard</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Common CSS & Icons -->
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
<link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
<link rel="stylesheet" href="/assets/css/post.css">
            <meta name="description" content="Explore dynamic programming techniques to solve the Maximum Sum of Rectangle No Larger Than K problem. Master complex algorithms today!">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">[Dynamic Programming] Maximum Sum of Rectangle No Larger Than K - Hard</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>Dynamic Programming is a strong method we use to solve tough
optimization problems. In the problem of finding the Maximum Sum of a
Rectangle No Larger Than K, we want to find a rectangular subarray in a
2D array. This subarray should have the highest sum possible but not go
over a certain value K. This problem is hard because we need good
algorithms to handle many possible subarray sums.</p>
<p>In this article, we will look closely at the Maximum Sum of Rectangle
No Larger Than K. We will explain the problem and its limits. We will
also share a simple view of a dynamic programming method and show code
examples in Java, Python, and C++. Also, we will talk about ways to make
this method better, other ways to solve the problem, common mistakes,
and answer questions we often hear.</p>
<ul>
<li>[Dynamic Programming] Maximum Sum of Rectangle No Larger Than K -
Hard Explained</li>
<li>Understanding the Problem Statement and Constraints</li>
<li>Dynamic Programming Approach Overview</li>
<li>Java Implementation of Maximum Sum of Rectangle No Larger Than
K</li>
<li>Python Code Solution for Maximum Sum of Rectangle No Larger Than
K</li>
<li>C++ Solution for Maximum Sum of Rectangle No Larger Than K</li>
<li>Optimizing the Dynamic Programming Approach</li>
<li>Alternative Approaches to the Problem</li>
<li>Common Pitfalls and Misunderstandings</li>
<li>Frequently Asked Questions</li>
</ul>
<p>For more on dynamic programming methods, we can check out other
articles like <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-fibonacci-number-easy.html">Dynamic
Programming: Fibonacci Number</a> and <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-climbing-stairs-easy.html">Dynamic
Programming: Climbing Stairs</a>.</p>
<h2
id="understanding-the-problem-statement-and-constraints">Understanding
the Problem Statement and Constraints</h2>
<p>We have a problem where we need to find the biggest sum of a
rectangle in a 2D matrix. This rectangle should not be bigger than
<code>K</code>. This is a classic problem in dynamic programming. We get
a matrix with numbers, and we have to find a rectangular area where the
sum of the numbers does not go over <code>K</code>. We also want this
sum to be as big as possible.</p>
<h3 id="problem-statement">Problem Statement</h3>
<ul>
<li>We get a 2D matrix called <code>matrix</code> that has size
<code>m x n</code>.</li>
<li>Each number in the matrix can be positive, negative, or zero.</li>
<li>Our job is to find the biggest sum of a rectangular area in the
matrix that is less than or equal to <code>K</code>.</li>
</ul>
<h3 id="constraints">Constraints</h3>
<ul>
<li>The size of the matrix follows
<code>1 &lt;= m, n &lt;= 100</code>.</li>
<li>The numbers in the matrix are between <code>-10^4</code> and
<code>10^4</code>.</li>
<li>The value of <code>K</code> is between <code>-10^9</code> and
<code>10^9</code>.</li>
</ul>
<h3 id="example">Example</h3>
<p>For example, let us look at this input:</p>
<pre><code>matrix = [[1, 0, 1], 
          [0, -2, 3], 
          [2, -1, 4]]
K = 2</code></pre>
<p>The biggest sum of a rectangle that is no larger than <code>K</code>
is <code>2</code>. This comes from the rectangle made by the numbers
<code>[0, -2]</code> in the second row.</p>
<p>This problem needs us to use smart algorithms to check possible
rectangles. A simple method would check all rectangles, which would take
too long. So, we need to use a better dynamic programming method to
solve it faster.</p>
<h2 id="dynamic-programming-approach-overview">Dynamic Programming
Approach Overview</h2>
<p>The “Maximum Sum of Rectangle No Larger Than K” problem is about
finding the biggest sum of a rectangular subarray in a 2D array. The sum
should not be more than a given value ( K ). We can solve this problem
well using dynamic programming and a data structure to keep track of
prefix sums.</p>
<h3 id="approach">Approach</h3>
<ol type="1">
<li><p><strong>Prefix Sum Calculation</strong>: First, we find the
prefix sums for each row in the matrix. This step helps us quickly find
the sum of any subarray.</p></li>
<li><p><strong>Iterating Over Rows</strong>: We go through all pairs of
rows. We define the top and bottom of the rectangle. For each pair of
rows, we will try to find the maximum sum subarray that we can create
using the columns between these two rows.</p></li>
<li><p><strong>Using a Sorted Data Structure</strong>: To keep the sum
of possible rectangles while we check through the columns, we can use a
balanced binary search tree or a sorted list:</p>
<ul>
<li>We keep a running sum of the columns between the two rows.</li>
<li>For each new column, we find the current sum and check if there is a
previous sum we can subtract to keep the total sum within ( K ). We can
do this check quickly with binary search.</li>
</ul></li>
<li><p><strong>Result Update</strong>: As we go through the rows, we
keep track of the maximum sum that stays within ( K ).</p></li>
</ol>
<h3 id="complexity">Complexity</h3>
<ul>
<li><strong>Time Complexity</strong>: This method usually runs in (
O(n^2 m m) ) for a matrix of size ( n m ). Here ( n ) is the number of
rows and ( m ) is the number of columns.</li>
<li><strong>Space Complexity</strong>: The space needed is ( O(m) ) for
storing the current sums.</li>
</ul>
<h3 id="example-1">Example</h3>
<p>Let’s look at a matrix:</p>
<pre><code>[
 [1, 0, 1],
 [0, -2, 3],
 [2, -1, 4]
]</code></pre>
<p>If ( K = 2 ), the algorithm checks different rectangles. It
calculates their sums and filters out those that go over ( K ) to find
the best valid sum.</p>
<p>Here is a simpler version of the code:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> maxSumSubmatrix(matrix, K):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> matrix <span class="kw">or</span> <span class="kw">not</span> matrix[<span class="dv">0</span>]:</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    rows, cols <span class="op">=</span> <span class="bu">len</span>(matrix), <span class="bu">len</span>(matrix[<span class="dv">0</span>])</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    max_sum <span class="op">=</span> <span class="bu">float</span>(<span class="st">&#39;-inf&#39;</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> top <span class="kw">in</span> <span class="bu">range</span>(rows):</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        sums <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> cols</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bottom <span class="kw">in</span> <span class="bu">range</span>(top, rows):</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> col <span class="kw">in</span> <span class="bu">range</span>(cols):</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                sums[col] <span class="op">+=</span> matrix[bottom][col]</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            sorted_sums <span class="op">=</span> [<span class="dv">0</span>]</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>            current_sum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="bu">sum</span> <span class="kw">in</span> sums:</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                current_sum <span class="op">+=</span> <span class="bu">sum</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                target <span class="op">=</span> current_sum <span class="op">-</span> K</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                left, right <span class="op">=</span> <span class="dv">0</span>, <span class="bu">len</span>(sorted_sums) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> left <span class="op">&lt;=</span> right:</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                    mid <span class="op">=</span> (left <span class="op">+</span> right) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> sorted_sums[mid] <span class="op">&lt;=</span> target:</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>                        left <span class="op">=</span> mid <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>                        right <span class="op">=</span> mid <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> right <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>                    max_sum <span class="op">=</span> <span class="bu">max</span>(max_sum, current_sum <span class="op">-</span> sorted_sums[right])</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>                sorted_sums.append(current_sum)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> max_sum</span></code></pre></div>
<p>This code helps us find the maximum sum rectangle while making sure
the sum does not go over ( K ). For more about dynamic programming,
check <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-fibonacci-number-easy.html">this
article on Fibonacci numbers</a>.</p>
<h2
id="java-implementation-of-maximum-sum-of-rectangle-no-larger-than-k">Java
Implementation of Maximum Sum of Rectangle No Larger Than K</h2>
<p>To find the maximum sum of a rectangle no larger than K in a 2D
matrix using Java, we will use a simple dynamic programming method with
prefix sum.</p>
<h3 id="java-code-implementation">Java Code Implementation</h3>
<p>Here is a simple Java code for the algorithm:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">TreeSet</span><span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MaxSumRectangleNoLargerThanK <span class="op">{</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">maxSumSubmatrix</span><span class="op">(</span><span class="dt">int</span><span class="op">[][]</span> matrix<span class="op">,</span> <span class="dt">int</span> k<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>matrix<span class="op">.</span><span class="fu">length</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">||</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">length</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> maxSum <span class="op">=</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">MIN_VALUE</span><span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> rows <span class="op">=</span> matrix<span class="op">.</span><span class="fu">length</span><span class="op">,</span> cols <span class="op">=</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">length</span><span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> left <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> left <span class="op">&lt;</span> cols<span class="op">;</span> left<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span><span class="op">[]</span> sums <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[</span>rows<span class="op">];</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> right <span class="op">=</span> left<span class="op">;</span> right <span class="op">&lt;</span> cols<span class="op">;</span> right<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> rows<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                    sums<span class="op">[</span>i<span class="op">]</span> <span class="op">+=</span> matrix<span class="op">[</span>i<span class="op">][</span>right<span class="op">];</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                maxSum <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span><span class="op">(</span>maxSum<span class="op">,</span> <span class="fu">maxSumNoLargerThanK</span><span class="op">(</span>sums<span class="op">,</span> k<span class="op">));</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> maxSum<span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span> <span class="fu">maxSumNoLargerThanK</span><span class="op">(</span><span class="dt">int</span><span class="op">[]</span> sums<span class="op">,</span> <span class="dt">int</span> k<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">TreeSet</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">&gt;</span> set <span class="op">=</span> <span class="kw">new</span> <span class="bu">TreeSet</span><span class="op">&lt;&gt;();</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        set<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> maxSum <span class="op">=</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">MIN_VALUE</span><span class="op">,</span> runningSum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> sum <span class="op">:</span> sums<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            runningSum <span class="op">+=</span> sum<span class="op">;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Integer</span> target <span class="op">=</span> set<span class="op">.</span><span class="fu">ceiling</span><span class="op">(</span>runningSum <span class="op">-</span> k<span class="op">);</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>target <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                maxSum <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span><span class="op">(</span>maxSum<span class="op">,</span> runningSum <span class="op">-</span> target<span class="op">);</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>            set<span class="op">.</span><span class="fu">add</span><span class="op">(</span>runningSum<span class="op">);</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> maxSum<span class="op">;</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        MaxSumRectangleNoLargerThanK solution <span class="op">=</span> <span class="kw">new</span> <span class="fu">MaxSumRectangleNoLargerThanK</span><span class="op">();</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span><span class="op">[][]</span> matrix <span class="op">=</span> <span class="op">{</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">},</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">},</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">4</span><span class="op">}</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> k <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>solution<span class="op">.</span><span class="fu">maxSumSubmatrix</span><span class="op">(</span>matrix<span class="op">,</span> k<span class="op">));</span> <span class="co">// Output: 2</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="explanation-of-code">Explanation of Code</h3>
<ul>
<li><strong>maxSumSubmatrix</strong>: This function goes through every
pair of columns (<code>left</code> and <code>right</code>). For each
pair, it calculates the sums for the rows and sends them to
<code>maxSumNoLargerThanK</code>.</li>
<li><strong>maxSumNoLargerThanK</strong>: This function uses a
<code>TreeSet</code> to quickly find the maximum sum of a subarray that
does not go over <code>k</code>. It keeps track of the running sum and
looks for the closest sum in the set that is less than or equal to
<code>runningSum - k</code>.</li>
<li><strong>Complexity</strong>: The time complexity is O(N^2 * log(N)).
Here, N is the number of rows. This is because of the log-time
operations for the TreeSet.</li>
</ul>
<p>This code helps us calculate the maximum sum of a rectangle in a 2D
matrix that does not go over a certain value K. We use dynamic
programming methods and data structures to do this efficiently.</p>
<h2
id="python-code-solution-for-maximum-sum-of-rectangle-no-larger-than-k">Python
Code Solution for Maximum Sum of Rectangle No Larger Than K</h2>
<p>To find the maximum sum of a rectangle in a 2D matrix that does not
go over a value ( K ), we can use a simple way with dynamic programming.
We also use a sorted data structure to keep sums in order.</p>
<p>The main idea is to look at all pairs of rows. We use a hash map or a
sorted list to track the sums between these rows. For each rectangle
formed by two rows, we calculate the sums of the columns. Then, we use
binary search to find the biggest sum that is less than or equal to ( K
).</p>
<p>Here is a Python code for this:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bisect</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> maxSumSubmatrix(matrix, k):</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> matrix <span class="kw">or</span> <span class="kw">not</span> matrix[<span class="dv">0</span>]:</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    rows, cols <span class="op">=</span> <span class="bu">len</span>(matrix), <span class="bu">len</span>(matrix[<span class="dv">0</span>])</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    max_sum <span class="op">=</span> <span class="bu">float</span>(<span class="st">&#39;-inf&#39;</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> left <span class="kw">in</span> <span class="bu">range</span>(cols):</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Make a temporary array to store the row sums</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> rows</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> right <span class="kw">in</span> <span class="bu">range</span>(left, cols):</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get the sum for every row between the left and right columns</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> r <span class="kw">in</span> <span class="bu">range</span>(rows):</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                temp[r] <span class="op">+=</span> matrix[r][right]</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Use a sorted list to find the maximum sum &lt;= k</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            sorted_sums <span class="op">=</span> [<span class="dv">0</span>]</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>            current_sum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> sum_val <span class="kw">in</span> temp:</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                current_sum <span class="op">+=</span> sum_val</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Binary search for the best sum &lt;= k</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                idx <span class="op">=</span> bisect.bisect_left(sorted_sums, current_sum <span class="op">-</span> k)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">&lt;</span> <span class="bu">len</span>(sorted_sums):</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                    max_sum <span class="op">=</span> <span class="bu">max</span>(max_sum, current_sum <span class="op">-</span> sorted_sums[idx])</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                bisect.insort(sorted_sums, current_sum)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> max_sum <span class="cf">if</span> max_sum <span class="op">!=</span> <span class="bu">float</span>(<span class="st">&#39;-inf&#39;</span>) <span class="cf">else</span> <span class="dv">0</span></span></code></pre></div>
<h3 id="explanation">Explanation:</h3>
<ul>
<li>We look at all pairs of columns (left and right).</li>
<li>For each pair, we calculate the sum of elements in each row between
these columns.</li>
<li>We keep a sorted list of cumulative sums. This helps us find the
maximum subarray sum that is less than or equal to ( K ) fast with the
<code>bisect</code> module.</li>
</ul>
<h3 id="complexity-1">Complexity:</h3>
<ul>
<li>Time complexity is ( O(n^2 m m) ). Here ( n ) is the number of rows
and ( m ) is the number of columns.</li>
<li>Space complexity is ( O(n) ) for the temporary array and the sorted
sums.</li>
</ul>
<p>This code finds the maximum sum of a rectangle in a matrix while
staying under ( K ). If you want to read more about dynamic programming,
you can check out topics like <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-maximum-subarray-kadanes-algorithm-easy.html">Dynamic
Programming: Maximum Subarray Kadanes Algorithm</a>.</p>
<h2 id="c-solution-for-maximum-sum-of-rectangle-no-larger-than-k">C++
Solution for Maximum Sum of Rectangle No Larger Than K</h2>
<p>We can solve the problem of finding the maximum sum of a rectangle no
larger than ( K ) in a 2D matrix using C++. We will use a dynamic
programming method with a data structure. This helps us keep track of
sums easily. The main idea is to go through all pairs of rows and use a
hashmap (or set) to find subarrays that meet the sum condition.</p>
<h3 id="c-implementation">C++ Implementation</h3>
<div class="sourceCode" id="cb6"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;set&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> maxSumSubmatrix<span class="op">(</span>vector<span class="op">&lt;</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;&amp;</span> matrix<span class="op">,</span> <span class="dt">int</span> K<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>matrix<span class="op">.</span>empty<span class="op">()</span> <span class="op">||</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span>empty<span class="op">())</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> maxSum <span class="op">=</span> INT_MIN<span class="op">;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> rows <span class="op">=</span> matrix<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cols <span class="op">=</span> matrix<span class="op">[</span><span class="dv">0</span><span class="op">].</span>size<span class="op">();</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> left <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> left <span class="op">&lt;</span> cols<span class="op">;</span> <span class="op">++</span>left<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> sums<span class="op">(</span>rows<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> right <span class="op">=</span> left<span class="op">;</span> right <span class="op">&lt;</span> cols<span class="op">;</span> <span class="op">++</span>right<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> r <span class="op">&lt;</span> rows<span class="op">;</span> <span class="op">++</span>r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                sums<span class="op">[</span>r<span class="op">]</span> <span class="op">+=</span> matrix<span class="op">[</span>r<span class="op">][</span>right<span class="op">];</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>            set<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> setSums<span class="op">;</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>            setSums<span class="op">.</span>insert<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> currSum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> sum <span class="op">:</span> sums<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>                currSum <span class="op">+=</span> sum<span class="op">;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>                <span class="kw">auto</span> it <span class="op">=</span> setSums<span class="op">.</span>lower_bound<span class="op">(</span>currSum <span class="op">-</span> K<span class="op">);</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>it <span class="op">!=</span> setSums<span class="op">.</span>end<span class="op">())</span> <span class="op">{</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>                    maxSum <span class="op">=</span> max<span class="op">(</span>maxSum<span class="op">,</span> currSum <span class="op">-</span> <span class="op">*</span>it<span class="op">);</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>                setSums<span class="op">.</span>insert<span class="op">(</span>currSum<span class="op">);</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> maxSum<span class="op">;</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">&lt;</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;</span> matrix <span class="op">=</span> <span class="op">{</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">},</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">},</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">4</span><span class="op">}</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> K <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Maximum sum of rectangle no larger than K: &quot;</span> <span class="op">&lt;&lt;</span> maxSumSubmatrix<span class="op">(</span>matrix<span class="op">,</span> K<span class="op">)</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="explanation-of-the-code">Explanation of the Code</h3>
<ol type="1">
<li><strong>Outer Loop</strong>: We go through each pair of columns
called <code>left</code> and <code>right</code>.</li>
<li><strong>Row Sums Calculation</strong>: For each pair of columns, we
get the sums for each row.</li>
<li><strong>Using a Set</strong>: We keep a set of the sums and use
binary search. This helps us find the largest sum that, when we take it
from the current sum, does not go over ( K ).</li>
<li><strong>Update Maximum</strong>: If we find such a sum, we change
our <code>maxSum</code> value.</li>
</ol>
<p>This method helps us narrow down the rectangles we need to check. We
use the properties of cumulative sums with a set for quick searches.
This gives us a good solution for the problem.</p>
<p>By using this C++ solution, we can solve the problem of finding the
maximum sum of a rectangle no larger than ( K ) in a matrix.</p>
<h2 id="optimizing-the-dynamic-programming-approach">Optimizing the
Dynamic Programming Approach</h2>
<p>We can make the dynamic programming approach for the “Maximum Sum of
Rectangle No Larger Than K” problem better. This can help with both time
and space use. Here are some simple strategies we can think about:</p>
<ol type="1">
<li><p><strong>Use Prefix Sums</strong>: Instead of finding sums for
every subarray again, we can use a prefix sum array. This helps us get
the sums fast.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_prefix_sum(matrix):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    rows, cols <span class="op">=</span> <span class="bu">len</span>(matrix), <span class="bu">len</span>(matrix[<span class="dv">0</span>])</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    prefix_sum <span class="op">=</span> [[<span class="dv">0</span>] <span class="op">*</span> (cols <span class="op">+</span> <span class="dv">1</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(rows <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, rows <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, cols <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            prefix_sum[r][c] <span class="op">=</span> matrix[r<span class="op">-</span><span class="dv">1</span>][c<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> prefix_sum[r<span class="op">-</span><span class="dv">1</span>][c] <span class="op">+</span> prefix_sum[r][c<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> prefix_sum[r<span class="op">-</span><span class="dv">1</span>][c<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prefix_sum</span></code></pre></div></li>
<li><p><strong>Fast Range Queries</strong>: We can use a balanced binary
search tree or a sorted list. This helps us keep the sums of rectangles
as we go through the rows. We can get the largest sum no bigger than K
quickly.</p></li>
<li><p><strong>Sliding Window Technique</strong>: For rectangles with a
fixed width, we can use a sliding window. This helps us do less work
when we change the size of the rectangle.</p></li>
<li><p><strong>Reduce Space</strong>: Instead of using a 2D DP table, we
can just use a 1D array. This will help us keep track of the current
sums and lower space use from O(N^2) to O(N).</p></li>
<li><p><strong>Coordinate Compression</strong>: If the matrix values are
very different, we can compress the coordinates of the sums. This limits
the range of values. It can make data structures like segment trees or
binary indexed trees work better.</p></li>
<li><p><strong>Dynamic Programming with Binary Search</strong>: When we
look for the biggest rectangle sum that is no larger than K, we can use
binary search with a sorted list. This helps us find the best choice
fast.</p></li>
<li><p><strong>Go Through Rows</strong>: We can fix the top and bottom
rows and then find the 1D array of sums for columns. After this, we can
use the above methods to find the max sum for rectangles between these
two rows.</p></li>
</ol>
<p>By using these methods, we can improve the performance of our dynamic
programming solution for the “Maximum Sum of Rectangle No Larger Than K”
problem. This makes it easier to work with larger inputs. If we want to
learn more about dynamic programming optimizations, we can check out <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-fibonacci-number-easy.html">dynamic
programming techniques</a> and <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-maximum-subarray-kadanes-algorithm-easy.html">space
optimization strategies</a>.</p>
<h2 id="alternative-approaches-to-the-problem">Alternative Approaches to
the Problem</h2>
<p>We can use different methods to solve the “Maximum Sum of Rectangle
No Larger Than K” problem. The dynamic programming approach is good, but
here are some other ways we can try:</p>
<ol type="1">
<li><strong>Brute Force Approach</strong>:
<ul>
<li>We can make all possible rectangles in the matrix.</li>
<li>For each rectangle, we calculate the sum and check if it is less
than or equal to K.</li>
<li>We keep track of the maximum sum we find.</li>
<li>This method takes a lot of time. Its time complexity is O(N^3 *
M^3). Here, N is the number of rows and M is the number of columns.</li>
</ul>
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> maxSumSubmatrix(matrix, K):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    max_sum <span class="op">=</span> <span class="bu">float</span>(<span class="st">&#39;-inf&#39;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    rows, cols <span class="op">=</span> <span class="bu">len</span>(matrix), <span class="bu">len</span>(matrix[<span class="dv">0</span>])</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r1 <span class="kw">in</span> <span class="bu">range</span>(rows):</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> r2 <span class="kw">in</span> <span class="bu">range</span>(r1, rows):</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate the sum of columns between r1 and r2</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            sums <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> cols</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> r <span class="kw">in</span> <span class="bu">range</span>(r1, r2 <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> <span class="bu">range</span>(cols):</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                    sums[c] <span class="op">+=</span> matrix[r][c]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Find the maximum sum no larger than K using a sorted array</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            max_sum <span class="op">=</span> <span class="bu">max</span>(max_sum, findMaxNoLargerThanK(sums, K))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> max_sum</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> findMaxNoLargerThanK(sums, K):</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> sortedcontainers <span class="im">import</span> SortedList</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    sortedList <span class="op">=</span> SortedList([<span class="dv">0</span>])</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    curr_sum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    max_sum <span class="op">=</span> <span class="bu">float</span>(<span class="st">&#39;-inf&#39;</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> sum_val <span class="kw">in</span> sums:</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        curr_sum <span class="op">+=</span> sum_val</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> sortedList.bisect_left(curr_sum <span class="op">-</span> K)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="op">&lt;</span> <span class="bu">len</span>(sortedList):</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>            max_sum <span class="op">=</span> <span class="bu">max</span>(max_sum, curr_sum <span class="op">-</span> sortedList[idx])</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        sortedList.add(curr_sum)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> max_sum</span></code></pre></div></li>
<li><strong>Segment Trees</strong>:
<ul>
<li>We can use a segment tree to keep sums of different column
ranges.</li>
<li>This helps us get sums quickly for certain ranges. It can make
finding the maximum sum less than or equal to K faster.</li>
<li>The time it takes mainly depends on how we build and query the
segment tree. So, it can take O(N * log M) for summations.</li>
</ul></li>
<li><strong>Binary Search</strong>:
<ul>
<li>We can use binary search on possible sums to find the maximum sum
less than or equal to K.</li>
<li>We can also use a prefix sum array to get rectangle sums
quickly.</li>
<li>This method can work better in practice, especially if we combine it
with a sorted list for prefix sums.</li>
</ul></li>
<li><strong>Matrix Reduction</strong>:
<ul>
<li>We can change the problem to 1D. We fix two rows and create a
temporary array that shows the sum of elements between these rows for
each column.</li>
<li>This changes the 2D problem into a 1D problem. Now we can use 1D
methods like binary search or a sliding window to find the maximum
sum.</li>
</ul></li>
</ol>
<p>These other methods can help us depending on the specific limits,
sizes of inputs, and how fast we need the solution. If we want to read
more about dynamic programming, we can check out <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-fibonacci-number-easy.html">Dynamic
Programming: Fibonacci Number</a> or <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-maximum-subarray-kadanes-algorithm-easy.html">Dynamic
Programming: Maximum Subarray (Kadane’s Algorithm)</a>.</p>
<h2 id="common-pitfalls-and-misunderstandings">Common Pitfalls and
Misunderstandings</h2>
<p>When we try to find the maximum sum of a rectangle no larger than K
using dynamic programming, we can face some common problems. Here are
some key issues we should be careful about:</p>
<ol type="1">
<li><p><strong>Misunderstanding the Problem Constraints</strong>:<br />
We need to understand what “no larger than K” means. The sum of the
rectangle must stay below or equal to K. We still want to make it as big
as possible.</p></li>
<li><p><strong>Incorrect Rectangle Definition</strong>:<br />
We should check that when we make rectangles in the 2D matrix, we think
about all possible top-left and bottom-right corners. We must not go out
of bounds.</p></li>
<li><p><strong>Inefficient Data Structures</strong>:<br />
If we use a basic way to store sums, it can take too much time. We
should use better data structures like prefix sums or ordered sets. This
helps us manage sums better.</p></li>
<li><p><strong>Neglecting Edge Cases</strong>:<br />
We must not forget edge cases. For example, negative numbers or
rectangles that do not exist can mess up our results. This happens when
K is smaller than the smallest number.</p></li>
<li><p><strong>Dynamic Programming Table Initialization</strong>:<br />
We have to make sure the DP table is set up right. If we do it wrong, we
can get wrong answers and poor solutions.</p></li>
<li><p><strong>Overlooking Redundant Calculations</strong>:<br />
When we look at possible rectangles, we should avoid calculating sums
again if we already did it. We can use memoization or caching to keep
the results.</p></li>
<li><p><strong>Not Considering All Possible Submatrices</strong>:<br />
Some ways of solving this problem might miss some rectangle
combinations. We should check all possible rectangle areas in the
matrix.</p></li>
<li><p><strong>Assuming Order of Elements</strong>:<br />
The order of numbers in the rectangle can change the sum. We need to
make sure our dynamic programming solution looks at all orders and does
not assume a specific one.</p></li>
<li><p><strong>Ignoring Time Complexity</strong>:<br />
When we want the best solution, we must also pay attention to how fast
our method works. A brute-force way may look easy but can be slow for
big matrices.</p></li>
<li><p><strong>Incorrect Use of Sorting</strong>:<br />
If we use sorting to handle sums, we must check that it matches the
problem rules. We don’t want to make mistakes because of
sorting.</p></li>
</ol>
<p>By being careful with these common problems, we can do better with
the Maximum Sum of Rectangle No Larger Than K problem. This helps us
find more accurate and efficient solutions.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3
id="what-is-the-maximum-sum-of-rectangle-no-larger-than-k-problem">1.
What is the Maximum Sum of Rectangle No Larger Than K problem?</h3>
<p>The Maximum Sum of Rectangle No Larger Than K problem is about
finding a rectangle in a 2D matrix. We want the sum of its numbers to
not go over a value K. This problem is important in dynamic programming.
It makes us think about how to track and calculate the biggest sum of
all rectangles while keeping the limit. Knowing this problem helps us
learn advanced dynamic programming skills.</p>
<h3 id="how-can-dynamic-programming-be-applied-to-solve-this-problem">2.
How can dynamic programming be applied to solve this problem?</h3>
<p>We can use dynamic programming to solve the Maximum Sum of Rectangle
No Larger Than K problem. We can change it into several one-dimensional
maximum subarray problems. The main idea is to fix two rows. Then we use
a hashmap to track the sums. This helps us find the maximum sum of
rectangles that do not go over K. This method is better than a simple
solution.</p>
<h3
id="what-is-the-time-complexity-of-the-dynamic-programming-solution">3.
What is the time complexity of the dynamic programming solution?</h3>
<p>The time complexity for the dynamic programming solution is O(N^2 * M
* log M). Here, N is the number of rows and M is the number of columns
in the matrix. This complexity comes from checking all row pairs and
using a sorted structure to quickly find the maximum sum of the
rectangular subarrays.</p>
<h3
id="are-there-any-common-mistakes-when-implementing-this-algorithm">4.
Are there any common mistakes when implementing this algorithm?</h3>
<p>Yes, there are common mistakes. These include not managing the
cumulative sums right and missing negative values in the matrix. Also,
forgetting to keep the sum less than or equal to K can give wrong
results. We need to debug these points for a good implementation of the
Maximum Sum of Rectangle No Larger Than K dynamic programming
solution.</p>
<h3 id="what-are-some-alternative-methods-to-solve-this-problem">5. What
are some alternative methods to solve this problem?</h3>
<p>There are other ways to solve the Maximum Sum of Rectangle No Larger
Than K problem. One way is a brute-force method that checks all
rectangles. But this is slow for big matrices. Another way is to use
advanced data structures like segment trees or binary indexed trees
(BIT). These can make things faster but can also make it harder to
implement. Looking into these different methods can help us understand
optimization better.</p>
<p>For more reading on dynamic programming, check out articles like the
<a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-maximum-subarray-kadanes-algorithm-easy.html">Maximum
Subarray - Kadane’s Algorithm</a> and <a
href="https://bestonlinetutorial.com/dynamic_programming/dynamic-programming-minimum-path-sum-in-a-grid-no-obstacles-easy.html">Minimum
Path Sum in a Grid</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            