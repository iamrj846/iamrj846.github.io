
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
            <meta property="og:title" content="How can you cancel a queued job in Laravel or Redis?" />
            <meta property="og:description" content="Learn how to easily cancel a queued job in Laravel or Redis with our step-by-step guide and expert tips for developers." />
            <meta property="og:url" content="https://www.bestonlinetutorial.com/redis/how-can-you-cancel-a-queued-job-in-laravel-or-redis.html" />
            <link rel="canonical" href="https://www.bestonlinetutorial.com/redis/how-can-you-cancel-a-queued-job-in-laravel-or-redis.html">
            <meta property="og:type" content="article" />
            <meta property="og:site_name" content=“BestOnlineTutorial” />
            <meta name="twitter:title" content="How can you cancel a queued job in Laravel or Redis?" />
            <meta name="twitter:description" content="Learn how to easily cancel a queued job in Laravel or Redis with our step-by-step guide and expert tips for developers." />
            <meta name="pinterest-rich-pin" content="true" />

            <script type="application/ld+json">
                {
                "@context": "https://schema.org",
                "@type": "WebSite",
                "name": "BestOnlineTutorial",
                "url": "https://www.bestonlinetutorial.com/"
                }
            </script>
            <!-- Common CSS & Icons -->
            <link rel="icon" href="/favicon.ico" type="image/x-icon">
            <link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
            <link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
            <link rel="stylesheet" href="/assets/css/post.css">
            <title>How can you cancel a queued job in Laravel or Redis?</title>
            <meta name="description" content="Learn how to easily cancel a queued job in Laravel or Redis with our step-by-step guide and expert tips for developers.">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How can you cancel a queued job in Laravel or Redis?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>To cancel a queued job in Laravel or Redis, we can use the tools that
Laravel gives us. We can run commands like
<code>php artisan queue:forget {id}</code> to take out a specific job
from the queue. We can also add job cancellation logic in our job
classes. Knowing how to cancel jobs in Laravel or Redis helps us keep
our application working well and manage resources better.</p>
<p>In this article, we will look at different ways to cancel queued jobs
in Laravel and Redis. We will talk about how to find jobs to cancel,
using Laravel job middleware for cancellation, and other ways to cancel
jobs in Redis. Here is a short list of what we will cover:</p>
<ul>
<li>How to Cancel a Queued Job in Laravel or Redis</li>
<li>Understanding Queued Jobs in Laravel or Redis</li>
<li>How to Identify a Job to Cancel in Laravel or Redis</li>
<li>What Methods to Use to Cancel a Job in Laravel</li>
<li>How to Use Laravel Job Middleware for Cancellation</li>
<li>How to Cancel a Job in Redis Directly</li>
<li>Frequently Asked Questions</li>
</ul>
<p>By sharing these methods, we hope you will understand job
cancellation techniques better. This can help you a lot in your
development work. If you want to learn more about Redis, you can check
this article on <a
href="https://bestonlinetutorial.com/redis/what-is-redis.html">what is
Redis</a>.</p>
<h2 id="understanding-queued-jobs-in-laravel-or-redis">Understanding
Queued Jobs in Laravel or Redis</h2>
<p>In Laravel, we can use queued jobs to delay tasks that take a long
time. This includes things like sending emails or processing uploads. By
doing this, our web application can respond faster to what users want.
Laravel’s queue system works with different queue backends, and one of
them is Redis. Redis is a quick data store that keeps things in
memory.</p>
<h3 id="key-concepts">Key Concepts</h3>
<ul>
<li><strong>Job:</strong> A job is one task that we need to process. In
Laravel, we make jobs by defining classes that follow the
<code>Illuminate\Contracts\Queue\ShouldQueue</code> rules.</li>
<li><strong>Queue:</strong> A queue is a place where jobs sit until
workers process them.</li>
<li><strong>Worker:</strong> A worker is a process that runs in the
background. It takes jobs from the queue and does them.</li>
</ul>
<h3 id="setting-up-queue-in-laravel-with-redis">Setting Up Queue in
Laravel with Redis</h3>
<ol type="1">
<li><p><strong>Install Redis:</strong> First, we need to make sure Redis
is installed and running. We can find the instructions on <a
href="https://bestonlinetutorial.com/redis/how-do-i-install-redis.html">how
do I install Redis</a>.</p></li>
<li><p><strong>Configure Laravel:</strong> Next, we go to the
<code>config/queue.php</code> file. Here, we set the default queue
driver to Redis:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;default&#39;</span> =&gt; env(<span class="st">&#39;QUEUE_CONNECTION&#39;</span><span class="ot">,</span> <span class="st">&#39;redis&#39;</span>)<span class="ot">,</span></span></code></pre></div></li>
<li><p><strong>Create a Job:</strong> Now, we can create a job using
Artisan:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">php</span> artisan make:job SendEmailJob</span></code></pre></div>
<p>We will write the job’s logic in the <code>handle</code> method:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> handle()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Logic to send an email</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p><strong>Dispatch the Job:</strong> We can send the job to the
queue like this:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cn">S</span>endEmailJob::dispatch(<span class="va">$emailData</span>)<span class="ot">;</span></span></code></pre></div></li>
</ol>
<h3 id="queue-monitoring">Queue Monitoring</h3>
<p>To check the queued jobs in Redis, we can use the Redis CLI to look
at the queue:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> LLEN <span class="ex">queues:default</span></span></code></pre></div>
<h3 id="job-cancellation">Job Cancellation</h3>
<p>Laravel does not have a built-in way to cancel queued jobs directly.
But there are some ways to manage job cancellation. We can use job
middleware or handle job records in Redis directly.</p>
<h2 id="how-can-we-identify-a-job-to-cancel-in-laravel-or-redis">How Can
We Identify a Job to Cancel in Laravel or Redis</h2>
<p>To identify a job we want to cancel in Laravel or Redis, we need to
keep track of the job’s unique identifier. This is usually the job ID.
When we dispatch a job in Laravel, we can get its ID using the
<code>dispatch</code> method. Here is how we can identify jobs:</p>
<ol type="1">
<li><p><strong>Use Job IDs</strong>: Each job in Laravel has a unique
ID. We can access this ID using the <code>getJobId</code> method. We
should store this ID for when we want to cancel the job later.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="va">$job</span> <span class="op">=</span> <span class="kw">new</span> <span class="cn">E</span>xampleJob()<span class="ot">;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="va">$jobId</span> <span class="op">=</span> dispatch(<span class="va">$job</span>)-&gt;getJobId()<span class="ot">;</span></span></code></pre></div></li>
<li><p><strong>Check the Queue</strong>: If we use Redis, we can check
the Redis queue directly. This helps us see the jobs that are currently
queued. We can use the <code>LRANGE</code> command to list the jobs in
the queue.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> LRANGE queue:default 0 <span class="at">-1</span></span></code></pre></div></li>
<li><p><strong>Use Laravel Horizon</strong>: If we use Laravel Horizon,
it gives us a dashboard to monitor our jobs. We can see the job ID,
status, and other information. This helps us identify the job we want to
cancel.</p></li>
<li><p><strong>Job Properties</strong>: When we dispatch a job, we can
add unique properties like user ID or other identifiers in the job’s
data. This helps us filter jobs based on these properties when we need
to cancel them.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="va">$jobData</span> <span class="op">=</span> [<span class="st">&#39;user_id&#39;</span> =&gt; <span class="va">$userId</span>]<span class="ot">;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="va">$job</span> <span class="op">=</span> <span class="kw">new</span> <span class="cn">E</span>xampleJob(<span class="va">$jobData</span>)<span class="ot">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>dispatch(<span class="va">$job</span>)<span class="ot">;</span></span></code></pre></div></li>
</ol>
<p>By using these methods, we can find the job we want to cancel in
Laravel or Redis easily.</p>
<h2 id="what-methods-can-we-use-to-cancel-a-job-in-laravel">What Methods
Can We Use to Cancel a Job in Laravel</h2>
<p>In Laravel, we can cancel a queued job using different methods. The
method we choose depends on what we need and how the job is set up. Here
are the main ways to cancel a job:</p>
<h3 id="using-the-delete-method">1. Using the <code>delete</code>
Method</h3>
<p>If we have access to the job instance, we can call the
<code>delete</code> method to take it off the queue:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> handle()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Job logic...</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Cancel the job</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">$this</span>-&gt;delete()<span class="ot">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="using-job-middleware">2. Using Job Middleware</h3>
<p>Laravel lets us create middleware for job cancellation. We can make
our middleware and use it to check if a job should be canceled. Here is
an example of middleware that checks if a job should be canceled:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> <span class="cn">A</span>pp\<span class="cn">J</span>obs\<span class="cn">M</span>iddleware<span class="ot">;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="bu">Closure</span><span class="ot">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">C</span>ancelIfOld</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> handle(<span class="va">$job</span><span class="ot">,</span> <span class="bu">Closure</span> <span class="va">$next</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="va">$this</span>-&gt;shouldCancel()) {</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="ot">;</span> <span class="co">// Job won&#39;t get processed</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$next</span>(<span class="va">$job</span>)<span class="ot">;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="kw">function</span> shouldCancel()</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Logic to see if the job should be canceled</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="ot">;</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We attach this middleware to our job like this:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> middleware()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="kw">new</span> <span class="cn">C</span>ancelIfOld]<span class="ot">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="manually-removing-jobs-from-the-queue">3. Manually Removing Jobs
from the Queue</h3>
<p>We can also remove jobs from the queue by using the
<code>php artisan queue:forget</code> command with the job ID:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">php</span> artisan queue:forget {job_id}</span></code></pre></div>
<h3 id="using-redis-commands">4. Using Redis Commands</h3>
<p>If we use Redis as our queue driver, we can talk directly to Redis to
remove jobs. We can use the <code>LREM</code> command to take away a
specific job from the queue:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="va">$redis</span> <span class="op">=</span> app()-&gt;make(<span class="st">&#39;redis&#39;</span>)<span class="ot">;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="va">$redis</span>-&gt;lrem(<span class="st">&#39;queues:default&#39;</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="st">&#39;job_identifier&#39;</span>)<span class="ot">;</span></span></code></pre></div>
<h3 id="job-timeout">5. Job Timeout</h3>
<p>We can set a timeout for our jobs. This way, if they take too long,
they will cancel themselves. We can set it up in our job class:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="va">$timeout</span> <span class="op">=</span> <span class="dv">120</span><span class="ot">;</span> <span class="co">// Timeout after 120 seconds</span></span></code></pre></div>
<p>When the timeout happens, the job will be marked as failed and
removed from the queue.</p>
<h3 id="listening-for-events">6. Listening for Events</h3>
<p>We can listen for job events to see if a job should be canceled. We
can make an event listener that listens for the
<code>JobProcessing</code> event:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">I</span>lluminate\<span class="cn">Q</span>ueue\<span class="cn">E</span>vents\<span class="cn">J</span>obProcessing<span class="ot">;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cn">E</span>vent::listen(<span class="cn">J</span>obProcessing::<span class="kw">class</span><span class="ot">,</span> <span class="kw">function</span> (<span class="cn">J</span>obProcessing <span class="va">$event</span>) {</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="va">$event</span>-&gt;job-&gt;payload[<span class="st">&#39;data&#39;</span>][<span class="st">&#39;commandName&#39;</span>] <span class="op">===</span> <span class="st">&#39;YourJobClass&#39;</span>) {</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Logic to cancel the job</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">$event</span>-&gt;job-&gt;delete()<span class="ot">;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>})<span class="ot">;</span></span></code></pre></div>
<p>These methods give us different ways to cancel queued jobs in
Laravel. This helps us manage our job processing based on what our
application needs. For more details on job queues, we can check the
official Laravel documentation.</p>
<h2 id="how-to-use-the-laravel-job-middleware-for-cancellation">How to
Use the Laravel Job Middleware for Cancellation</h2>
<p>In Laravel, we can use job middleware to cancel jobs. We define
middleware that checks if a job should run or stop. This is helpful when
we want to set conditions for jobs not to run.</p>
<h3 id="creating-middleware">Creating Middleware</h3>
<p>First, we need to make a middleware class that will take care of the
cancellation. We can do this using the Artisan command:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">php</span> artisan make:middleware JobCancellationMiddleware</span></code></pre></div>
<h3 id="implementing-middleware-logic">Implementing Middleware
Logic</h3>
<p>In the <code>JobCancellationMiddleware</code> class, we will add the
handle method. This method checks the conditions for cancellation:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> <span class="cn">A</span>pp\<span class="cn">H</span>ttp\<span class="cn">M</span>iddleware<span class="ot">;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="bu">Closure</span><span class="ot">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">J</span>obCancellationMiddleware</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> handle(<span class="va">$job</span><span class="ot">,</span> <span class="bu">Closure</span> <span class="va">$next</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check your conditions here</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="va">$this</span>-&gt;shouldCancel(<span class="va">$job</span>)) {</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Optionally, we can log the cancellation</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            \<span class="fu">Log</span>::info(<span class="st">&quot;Job cancelled: &quot;</span> <span class="op">.</span> <span class="fu">get_class</span>(<span class="va">$job</span>))<span class="ot">;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="ot">;</span> <span class="co">// Cancel the job</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">$next</span>(<span class="va">$job</span>)<span class="ot">;</span> <span class="co">// Continue to process the job</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="kw">function</span> shouldCancel(<span class="va">$job</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Add your logic to see if the job should be cancelled</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="ot">;</span> <span class="co">// Change this based on your needs</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="registering-middleware">Registering Middleware</h3>
<p>Next, we need to register the middleware in
<code>App\Providers\AppServiceProvider</code>. Or we can create a
special middleware group. Here is how to register it in the
<code>boot</code> method:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">function</span> boot()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    \<span class="cn">I</span>lluminate\<span class="cn">Q</span>ueue\<span class="cn">M</span>iddleware\<span class="cn">M</span>iddleware::add(<span class="st">&#39;cancellation&#39;</span><span class="ot">,</span> <span class="cn">J</span>obCancellationMiddleware::<span class="kw">class</span>)<span class="ot">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="applying-middleware-to-jobs">Applying Middleware to Jobs</h3>
<p>To use this middleware in our queued jobs, we just need to mention it
in the job class:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> <span class="cn">A</span>pp\<span class="cn">J</span>obs<span class="ot">;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">I</span>lluminate\<span class="cn">B</span>us\<span class="cn">Q</span>ueueable<span class="ot">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">I</span>lluminate\<span class="cn">C</span>ontracts\<span class="cn">Q</span>ueue\<span class="cn">S</span>houldQueue<span class="ot">;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">I</span>lluminate\<span class="cn">F</span>oundation\<span class="cn">B</span>us\<span class="cn">D</span>ispatchable<span class="ot">;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">I</span>lluminate\<span class="cn">Q</span>ueue\<span class="cn">I</span>nteractsWithQueue<span class="ot">;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">I</span>lluminate\<span class="cn">Q</span>ueue\<span class="cn">S</span>erializesModels<span class="ot">;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="cn">A</span>pp\<span class="cn">H</span>ttp\<span class="cn">M</span>iddleware\<span class="cn">J</span>obCancellationMiddleware<span class="ot">;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="cn">E</span>xampleJob <span class="kw">implements</span> <span class="cn">S</span>houldQueue</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">use</span> <span class="cn">D</span>ispatchable<span class="ot">,</span> <span class="cn">I</span>nteractsWithQueue<span class="ot">,</span> <span class="cn">Q</span>ueueable<span class="ot">,</span> <span class="cn">S</span>erializesModels<span class="ot">;</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> middleware()</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [<span class="kw">new</span> <span class="cn">J</span>obCancellationMiddleware]<span class="ot">;</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">function</span> handle()</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Job logic here</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="conclusion">Conclusion</h3>
<p>With Laravel’s job middleware, we can manage job cancellations based
on our own logic. This way, we make sure that unnecessary jobs do not
waste resources. This method gives us better control over our queued
jobs, especially when conditions can change quickly.</p>
<h2 id="how-can-we-cancel-a-job-in-redis-directly">How Can We Cancel a
Job in Redis Directly</h2>
<p>To cancel a job that is waiting in Redis, we can change the Redis
data structures that keep job information. Jobs in Redis often use lists
or sorted sets. This depends on how we set up the queue. Here is how we
can cancel a queued job.</p>
<ol type="1">
<li><p><strong>Find the Job</strong>: First, we need to get the unique
identifier of the job we want to cancel. This is usually a job ID that
we gave when we created the job.</p></li>
<li><p><strong>Take it out from the Queue</strong>: We use different
Redis commands based on whether we have a list or a sorted set.</p>
<ul>
<li><p><strong>For List-based Queues</strong>: If the job is in a list,
we can use the <code>LREM</code> command to remove it. For example:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="va">$jobId</span> <span class="op">=</span> <span class="st">&#39;your-job-id&#39;</span><span class="ot">;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="va">$queueName</span> <span class="op">=</span> <span class="st">&#39;your-queue-name&#39;</span><span class="ot">;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cn">R</span>edis::lrem(<span class="va">$queueName</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="va">$jobId</span>)<span class="ot">;</span></span></code></pre></div></li>
<li><p><strong>For Sorted Set-based Queues</strong>: If the job is in a
sorted set, we can use the <code>ZREM</code> command to take it out. For
example:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="va">$jobId</span> <span class="op">=</span> <span class="st">&#39;your-job-id&#39;</span><span class="ot">;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="va">$queueName</span> <span class="op">=</span> <span class="st">&#39;your-queue-name&#39;</span><span class="ot">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="cn">R</span>edis::zrem(<span class="va">$queueName</span><span class="ot">,</span> <span class="va">$jobId</span>)<span class="ot">;</span></span></code></pre></div></li>
</ul></li>
<li><p><strong>Check Job Status</strong>: To make sure the job is gone,
we can check the length of the queue:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="va">$queueLength</span> <span class="op">=</span> <span class="cn">R</span>edis::llen(<span class="va">$queueName</span>)<span class="ot">;</span> <span class="co">// For lists</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">// or</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="va">$queueLength</span> <span class="op">=</span> <span class="cn">R</span>edis::zcard(<span class="va">$queueName</span>)<span class="ot">;</span> <span class="co">// For sorted sets</span></span></code></pre></div></li>
<li><p><strong>Dealing with Job Failures</strong>: If the job is already
done or has failed, we might need to check job logs or status flags
separately.</p></li>
<li><p><strong>Job Middleware</strong>: If we have made middleware for
job cancellation, we need to check for cancellation requests before
handling jobs.</p></li>
</ol>
<p>With these steps, we can cancel queued jobs in Redis. This gives us
better control over job execution in our application. For more details
about Redis and what it can do, we can look at <a
href="https://bestonlinetutorial.com/redis/what-is-redis.html">What is
Redis?</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="how-do-we-cancel-a-queued-job-in-laravel">1. How do we cancel a
queued job in Laravel?</h3>
<p>To cancel a queued job in Laravel, we can use the
<code>delete()</code> method on the job instance if it is not processed
yet. If we know the job ID, we can find and remove it from the queue.
Laravel also lets us cancel jobs using middleware. This can work well
for tasks that take a long time.</p>
<h3 id="can-we-cancel-a-redis-job-directly">2. Can we cancel a Redis job
directly?</h3>
<p>Yes, we can cancel a job directly in Redis by taking it out from the
queue. We need to use the <code>LREM</code> command to remove the job
from the list where it is. We have to know the job’s unique ID or the
data it has to make sure we are removing the right job from the Redis
queue.</p>
<h3 id="what-happens-if-we-cancel-a-job-in-laravel">3. What happens if
we cancel a job in Laravel?</h3>
<p>If we cancel a job in Laravel before it starts, it will just be taken
out of the queue and will not run. But if the job has already begun, it
may keep running unless we add cancellation logic in the job itself.
This can include checking for a stop condition.</p>
<h3 id="how-can-we-find-a-job-to-cancel-in-laravel-or-redis">4. How can
we find a job to cancel in Laravel or Redis?</h3>
<p>To find a job to cancel, we can use unique IDs or payloads that are
linked to the job. In Laravel, we can check the job’s properties or use
Laravel’s tools for queue monitoring. For Redis, we can look at the
queue list and match the payloads or job IDs to find the job we want to
cancel.</p>
<h3 id="is-it-possible-to-set-a-timeout-for-jobs-in-laravel">5. Is it
possible to set a timeout for jobs in Laravel?</h3>
<p>Yes, Laravel lets us set a timeout for jobs. We can set the
<code>timeout</code> property in our job class. This will stop a job if
it takes too long to run. This is good for making sure long jobs do not
block our queue forever. To learn more about this, we can check how to
implement <a
href="https://bestonlinetutorial.com/redis/how-do-i-use-redis-for-session-management.html">job
timeouts in Laravel</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            