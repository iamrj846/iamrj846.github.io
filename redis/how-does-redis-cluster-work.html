
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            
            <title>How does Redis Cluster work?</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "BestOnlineTutorial",
      "url": "https://www.bestonlinetutorial.com/"
    }
    </script>

<!-- Common CSS & Icons -->
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
<link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
<link rel="stylesheet" href="/assets/css/post.css">
            <meta name="description" content="Discover how Redis Cluster works, its architecture, data distribution, and benefits for high availability and scalability.">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How does Redis Cluster work?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>Redis Cluster is a way to use Redis that lets us scale it easily and
keep it working well. It does this by spreading data across many Redis
nodes. This means we store data in a smart way. Even if some nodes stop
working, we can still get our data. Redis Cluster takes care of dividing
data and copying it. This helps us grow our applications without losing
speed or trust.</p>
<p>In this article, we will look into how Redis Cluster works. We will
see its main parts, how it splits data, and what master and slave nodes
do. We will also talk about how it keeps everything consistent. We will
share the main features that make Redis Cluster great for developers.
Plus, we will give a simple guide for setting up a Redis Cluster with
code samples. Also, we will explain how Redis Cluster deals with
problems and recovery. We will answer some common questions about Redis
Cluster too.</p>
<ul>
<li>What Is the Mechanism Behind Redis Cluster Working?</li>
<li>How Does Data Sharding Function in Redis Cluster?</li>
<li>What Are the Roles of Master and Slave Nodes in Redis Cluster?</li>
<li>How Is Consistency Achieved in Redis Cluster?</li>
<li>What Are the Key Features of Redis Cluster?</li>
<li>How to Set Up a Redis Cluster with Practical Code Examples?</li>
<li>How Does Redis Cluster Handle Failover and Recovery?</li>
<li>Frequently Asked Questions</li>
</ul>
<p>For more details about Redis, we can check articles on <a
href="https://bestonlinetutorial.com/redis/what-is-redis.html">What is
Redis</a> and <a
href="https://bestonlinetutorial.com/redis/how-do-i-set-up-a-redis-cluster.html">How
to Set Up a Redis Cluster</a>.</p>
<h2 id="how-does-data-sharding-function-in-redis-cluster">How Does Data
Sharding Function in Redis Cluster?</h2>
<p>Data sharding in Redis Cluster works by breaking the keyspace into
many slots. This way, we can scale horizontally. Redis uses something
called hash slots to spread the data among the nodes. The keyspace
divides into 16,384 hash slots. Each key gets a specific slot through a
hash function.</p>
<h3 id="hashing-mechanism">Hashing Mechanism</h3>
<p>When we set or get a key, Redis calculates its hash slot like
this:</p>
<pre class="plaintext"><code>slot = CRC16(key) mod 16384</code></pre>
<p>This method makes sure that each key goes to the same slot every
time. The way keys spread across the slots helps the cluster manage data
well.</p>
<h3 id="node-configuration">Node Configuration</h3>
<p>Each node in a Redis Cluster takes care of some hash slots. We can
set a node to manage certain slots when we create the cluster. For
example:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">--cluster</span> add-node <span class="op">&lt;</span>new_node_ip<span class="op">&gt;</span>:<span class="op">&lt;</span>port<span class="op">&gt;</span> <span class="op">&lt;</span>existing_node_ip<span class="op">&gt;</span>:<span class="op">&lt;</span>port<span class="op">&gt;</span> --cluster-slots <span class="op">&lt;</span>start_slot<span class="op">&gt;</span>-<span class="op">&lt;</span>end_slot<span class="op">&gt;</span></span></code></pre></div>
<h3 id="data-distribution">Data Distribution</h3>
<ul>
<li><strong>Key Assignment</strong>: When we create a key, Redis finds
its hash slot and gives it to the right node that manages that
slot.</li>
<li><strong>Automatic Balancing</strong>: Redis Cluster balances the
slots by itself. If a node fails, it can move its slots to other nodes
to keep everything running.</li>
</ul>
<h3 id="example-of-data-sharding">Example of Data Sharding</h3>
<p>Let’s see a simple example of adding keys to a Redis Cluster and how
sharding works:</p>
<ol type="1">
<li><strong>Setting Keys</strong>:</li>
</ol>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">SET</span> user:1 <span class="st">&quot;Alice&quot;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">SET</span> user:2 <span class="st">&quot;Bob&quot;</span></span></code></pre></div>
<ol start="2" type="1">
<li><strong>Getting Keys</strong>:</li>
</ol>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">GET</span> user:1  <span class="co"># This gets &quot;Alice&quot; from the right node</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">GET</span> user:2  <span class="co"># This gets &quot;Bob&quot; from the right node</span></span></code></pre></div>
<h3 id="cluster-management">Cluster Management</h3>
<p>Redis gives us commands to manage the cluster and check how the keys
are spread:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">CLUSTER</span> SLOTS</span></code></pre></div>
<p>This command shows us the slots and which nodes are in charge of
them. It helps us see how data is sharded in the cluster.</p>
<h3 id="handling-key-collisions">Handling Key Collisions</h3>
<p>If many keys hash to the same slot, they go to the same node. But
Redis manages this well. It makes sure that having the same slot does
not slow down performance since each key is unique.</p>
<p>For more details on setting up Redis Cluster, we can check out <a
href="https://bestonlinetutorial.com/redis/how-do-i-set-up-a-redis-cluster.html">How
to Set Up a Redis Cluster with Practical Code Examples</a>.</p>
<h2
id="what-are-the-roles-of-master-and-slave-nodes-in-redis-cluster">What
Are the Roles of Master and Slave Nodes in Redis Cluster?</h2>
<p>In a Redis Cluster, the system is made for growth and high
availability. It uses a master-slave replication model. We can summarize
the roles of master and slave nodes like this:</p>
<ul>
<li><strong>Master Nodes</strong>:
<ul>
<li>They handle read and write tasks.<br />
</li>
<li>Each master node has part of the data. This is based on hash
slots.</li>
<li>A cluster can have many master nodes. Each one manages a piece of
the whole data set.</li>
<li>When a client wants to write data, it talks to the right master
node. This is based on the key’s hash slot.</li>
</ul></li>
<li><strong>Slave Nodes</strong>:
<ul>
<li>They act as copies of master nodes. This gives extra support and
high availability.<br />
</li>
<li>They can handle read tasks, which helps balance the load.<br />
</li>
<li>If a master node stops working, a slave can become the new master.
This makes sure we still have data and everything keeps running.<br />
</li>
<li>Slave nodes copy data from their master. They do this in the
background. This way, they stay updated.</li>
</ul></li>
</ul>
<h3 id="code-example-node-configuration">Code Example: Node
Configuration</h3>
<p>To set up a Redis Cluster with master and slave nodes, we use the
<code>redis.conf</code> file. Here is a simple setup for a master and a
slave:</p>
<p><strong>Master Node Configuration (redis-master.conf)</strong>:</p>
<pre class="plaintext"><code>port 7000
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000</code></pre>
<p><strong>Slave Node Configuration (redis-slave.conf)</strong>:</p>
<pre class="plaintext"><code>port 7001
cluster-enabled yes
cluster-config-file nodes.conf
slaveof &lt;master-ip&gt; 7000</code></pre>
<h3 id="cluster-setup">Cluster Setup</h3>
<p>To make a Redis Cluster with master and slave nodes, we can use this
command:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">--cluster</span> create <span class="op">&lt;</span>master-ip<span class="op">&gt;</span>:7000 <span class="op">&lt;</span>slave-ip<span class="op">&gt;</span>:7001 <span class="at">--cluster-replicas</span> 1</span></code></pre></div>
<p>This command creates a Redis Cluster with one master and one slave
node. It helps with fault tolerance.</p>
<p>In short, master nodes manage data and client tasks. Slave nodes give
extra support and can take over if a master node fails. This keeps the
Redis Cluster strong. For more detailed steps on how to set up a Redis
Cluster, visit <a
href="https://bestonlinetutorial.com/redis/how-do-i-set-up-a-redis-cluster.html">How
to Set Up a Redis Cluster with Practical Code Examples</a>.</p>
<h2 id="how-is-consistency-achieved-in-redis-cluster">How Is Consistency
Achieved in Redis Cluster?</h2>
<p>We can achieve consistency in Redis Cluster using different ways.
These methods help us manage data copying and node failures. They also
make sure that we have minimal disruption. Here are the main points:</p>
<ul>
<li><p><strong>Data Partitioning</strong>: Redis Cluster uses something
called hash slots to split data. There are 16,384 hash slots. Each key
goes into one of these slots using a hash function. Each node takes care
of some of these slots. This helps us spread the data evenly.</p></li>
<li><p><strong>Master-Slave Replication</strong>: In a Redis Cluster,
each master node can have one or more replica (slave) nodes. When we
write data to a master, it gets copied to its slaves later. This setup
helps us with read scaling and fault tolerance. Slaves can handle read
requests. If a master fails, we can promote a slave to be the new
master.</p></li>
<li><p><strong>Consistency Model</strong>: Redis Cluster uses an
eventual consistency model. When we write to the master, it is available
right away. But there might be a delay before the replicas get updated.
This can make it possible that reads from replicas return old
data.</p></li>
<li><p><strong>Failover Mechanism</strong>: If a master node fails, the
cluster will automatically promote one of its replicas to be the new
master. This helps keep consistency. It makes sure that we always have a
writable master for the affected slot. The cluster will give the hash
slots from the failed master to the new master.</p></li>
<li><p><strong>Cluster Configuration</strong>: Every node in the Redis
Cluster keeps a cluster configuration. This configuration shows the
state of other nodes and the slots they manage. It is very important for
helping clients send requests correctly. It also helps keep a consistent
view of the cluster.</p></li>
<li><p><strong>Client-Side Handling</strong>: Clients that connect to a
Redis Cluster must be cluster-aware. This means they need to manage
redirections when they want to access keys that are not on the node they
first connected to. This helps clients read from the correct master or
replica. Thus, it keeps consistency.</p></li>
</ul>
<p>Here is a simple code example to show how Redis Cluster manages data
partitioning and replication:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of creating a Redis Cluster with 3 masters and 3 replicas</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">--cluster</span> create <span class="dt">\</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>192.168.1.1:7000 <span class="dt">\</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>192.168.1.1:7001 <span class="dt">\</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>192.168.1.1:7002 <span class="dt">\</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>192.168.1.2:7000 <span class="dt">\</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>192.168.1.2:7001 <span class="dt">\</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>192.168.1.2:7002 <span class="dt">\</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>--cluster-replicas 1</span></code></pre></div>
<p>In this command, we set up a Redis Cluster with 3 master nodes. Each
one has 1 replica. This helps us keep data consistency through
replication. For more details on setting up a Redis Cluster, visit <a
href="https://bestonlinetutorial.com/redis/how-do-i-set-up-a-redis-cluster.html">How
to Set Up a Redis Cluster with Practical Code Examples</a>.</p>
<h2 id="what-are-the-key-features-of-redis-cluster">What Are the Key
Features of Redis Cluster?</h2>
<p>We can say that Redis Cluster is made to give high availability and
scalability in distributed systems. Here are main features that make
Redis Cluster a strong choice for managing data across many nodes:</p>
<ul>
<li><p><strong>Data Sharding</strong>: Redis Cluster divides data across
many nodes. Each key gets a hash slot. There are 16,384 slots in total.
This helps to share data well and balance the load.</p></li>
<li><p><strong>High Availability</strong>: Redis Cluster uses
master-slave replication. This means data is copied across nodes. If a
master node stops working, a slave node can become the new master. This
keeps the system running.</p></li>
<li><p><strong>Automatic Failover</strong>: When a node fails, Redis
Cluster finds the problem. It then promotes a slave node to be the
master. This makes sure there is less downtime and keeps data
available.</p></li>
<li><p><strong>Scalability</strong>: Redis Cluster can grow easily by
adding more nodes. We can add new nodes without stopping the system.
Data can also be balanced automatically.</p></li>
<li><p><strong>No Central Coordinator</strong>: Redis Cluster does not
have a single point of failure. Each node talks to any other node. This
makes the system more stable and fault-tolerant.</p></li>
<li><p><strong>Client Awareness</strong>: Redis clients can see the
cluster layout. They can send commands directly to the right nodes based
on key hash slots. This helps to lower latency and boost
performance.</p></li>
<li><p><strong>Support for Pub/Sub</strong>: Redis Cluster allows the
Publish/Subscribe messaging method. This lets messages go to many
subscribers in the cluster.</p></li>
<li><p><strong>Cluster Configuration</strong>: We can set up Redis
Cluster using a config file or the Redis command line. Nodes can be
added, removed, or changed without stopping the cluster.</p></li>
</ul>
<p>Here is an example of how to configure a Redis Cluster with a
command:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">--cluster</span> create <span class="op">&lt;</span>node1<span class="op">&gt;</span>:<span class="op">&lt;</span>port<span class="op">&gt;</span> <span class="op">&lt;</span>node2<span class="op">&gt;</span>:<span class="op">&lt;</span>port<span class="op">&gt;</span> <span class="op">&lt;</span>node3<span class="op">&gt;</span>:<span class="op">&lt;</span>port<span class="op">&gt;</span> --cluster-replicas 1</span></code></pre></div>
<p>These features make Redis Cluster a great choice for apps that need
high performance, scalability, and resilience. For more details on how
to set up a Redis Cluster, we can check the article on <a
href="https://bestonlinetutorial.com/redis/how-do-i-set-up-a-redis-cluster.html">how
to set up a Redis Cluster</a>.</p>
<h2 id="how-to-set-up-a-redis-cluster-with-practical-code-examples">How
to Set Up a Redis Cluster with Practical Code Examples?</h2>
<p>Setting up a Redis Cluster means we configure many Redis nodes to
work together. This helps us with data sharding and keeps our data
available. Here are the steps to set up a Redis Cluster with some easy
code examples.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>We need to install Redis on our server or servers. You can check the
installation guide <a
href="https://bestonlinetutorial.com/redis/how-do-i-install-redis.html">here</a>.</li>
<li>Make sure all nodes can reach each other on the network.</li>
</ul>
<h3 id="step-1-configure-redis-nodes">Step 1: Configure Redis Nodes</h3>
<p>We need to create a configuration file for each Redis instance. Here
is an example for three nodes:</p>
<p><strong>redis-7000.conf</strong></p>
<pre class="plaintext"><code>port 7000
cluster-enabled yes
cluster-config-file nodes-7000.conf
cluster-node-timeout 5000
appendonly yes</code></pre>
<p><strong>redis-7001.conf</strong></p>
<pre class="plaintext"><code>port 7001
cluster-enabled yes
cluster-config-file nodes-7001.conf
cluster-node-timeout 5000
appendonly yes</code></pre>
<p><strong>redis-7002.conf</strong></p>
<pre class="plaintext"><code>port 7002
cluster-enabled yes
cluster-config-file nodes-7002.conf
cluster-node-timeout 5000
appendonly yes</code></pre>
<h3 id="step-2-start-redis-instances">Step 2: Start Redis Instances</h3>
<p>We start each Redis instance in separate terminal windows using the
config files we made:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-server</span> /path/to/redis-7000.conf</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-server</span> /path/to/redis-7001.conf</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-server</span> /path/to/redis-7002.conf</span></code></pre></div>
<h3 id="step-3-create-the-cluster">Step 3: Create the Cluster</h3>
<p>Now we use the <code>redis-cli</code> tool to create the cluster. We
can run this command:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">--cluster</span> create <span class="dt">\</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>127.0.0.1:7000 <span class="dt">\</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>127.0.0.1:7001 <span class="dt">\</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>127.0.0.1:7002 <span class="dt">\</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>--cluster-replicas 0</span></code></pre></div>
<h3 id="step-4-verify-the-cluster">Step 4: Verify the Cluster</h3>
<p>To check the cluster setup, we run:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">-p</span> 7000 cluster info</span></code></pre></div>
<h3 id="step-5-add-data-to-the-cluster">Step 5: Add Data to the
Cluster</h3>
<p>If we want to add data to our cluster, we can use these commands:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">-p</span> 7000 set key1 <span class="st">&quot;value1&quot;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">-p</span> 7001 set key2 <span class="st">&quot;value2&quot;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">-p</span> 7002 set key3 <span class="st">&quot;value3&quot;</span></span></code></pre></div>
<h3 id="step-6-retrieve-data-from-the-cluster">Step 6: Retrieve Data
from the Cluster</h3>
<p>To get the data, we use:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">-p</span> 7000 get key1</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">-p</span> 7001 get key2</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">-p</span> 7002 get key3</span></code></pre></div>
<h3 id="step-7-publish-and-subscribe">Step 7: Publish and Subscribe</h3>
<p>We can also use Redis Pub/Sub features:</p>
<p><strong>Publisher:</strong></p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">-p</span> 7000 publish mychannel <span class="st">&quot;Hello, Redis Cluster!&quot;</span></span></code></pre></div>
<p><strong>Subscriber:</strong></p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">-p</span> 7000 subscribe mychannel</span></code></pre></div>
<h3 id="additional-configuration">Additional Configuration</h3>
<p>For production, we should think about adding replicas for better
availability. We can change the <code>--cluster-replicas</code> flag
when we create the cluster. You can look at the setup guide on <a
href="https://bestonlinetutorial.com/redis/how-do-i-set-up-a-redis-cluster.html">how
to set up a Redis cluster</a> for more details.</p>
<p>This setup gives us a basic Redis Cluster. It helps with data
sharding and better performance across many Redis nodes.</p>
<h2 id="how-does-redis-cluster-handle-failover-and-recovery">How Does
Redis Cluster Handle Failover and Recovery?</h2>
<p>Redis Cluster is made to give us high availability and automatic
failover. When a master node fails, Redis Cluster can promote a replica
node to take its place. This helps to keep downtime and data loss very
low.</p>
<h3 id="mechanism-of-failover">Mechanism of Failover</h3>
<ul>
<li><strong>Node Monitoring</strong>: Each node in the cluster checks
the health of its neighbors using a gossip protocol. If a master node
stops responding, its replicas try to contact it to check if it really
failed.</li>
<li><strong>Quorum Requirement</strong>: We confirm a failure when most
of the nodes in the cluster agree the master is down. This step is
important to stop split-brain situations.</li>
<li><strong>Failover Process</strong>:
<ol type="1">
<li><strong>Detection</strong>: A master node is unreachable.</li>
<li><strong>Confirmation</strong>: Replicas check and confirm the master
is down.</li>
<li><strong>Promotion</strong>: One of the replicas becomes the new
master.</li>
<li><strong>Reconfiguration</strong>: The cluster updates to recognize
the new master.</li>
</ol></li>
</ul>
<h3 id="configuration-for-failover">Configuration for Failover</h3>
<p>To set up failover, we need to make sure our Redis Cluster is set up
correctly with replicas for each master:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">--cluster</span> create <span class="dt">\</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>master1-ip<span class="op">&gt;</span>:<span class="op">&lt;</span>port<span class="op">&gt;</span> <span class="op">&lt;</span>master2-ip<span class="op">&gt;</span>:<span class="op">&lt;</span>port<span class="op">&gt;</span> <span class="op">&lt;</span>master3-ip<span class="op">&gt;</span>:<span class="op">&lt;</span>port<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--replicas</span> 1</span></code></pre></div>
<p>This command creates a cluster with three masters and one replica for
each master.</p>
<h3 id="recovery-from-failover">Recovery from Failover</h3>
<ul>
<li><strong>Replica Synchronization</strong>: When the original master
node is back online, it can join the cluster again as a replica of the
new master. This helps to keep the data synchronized.</li>
<li><strong>Automatic Rejoin</strong>: The cluster will manage the
rejoining process by itself and take care of any data synchronization
needed.</li>
</ul>
<h3 id="example-of-failover-handling">Example of Failover Handling</h3>
<p>In a case where a master node at <code>192.168.1.1:7000</code>
fails:</p>
<ol type="1">
<li>The cluster sees the failure through its monitoring system.</li>
<li>One of the replicas, for example <code>192.168.1.2:7001</code>, is
chosen as the new master.</li>
<li>The cluster updates its setup, and clients are sent to the new
master.</li>
<li>The failed master can come back online and be reconfigured as a
replica.</li>
</ol>
<h3 id="key-settings-for-failover">Key Settings for Failover</h3>
<ul>
<li><strong><code>cluster-node-timeout</code></strong>: This sets the
time in milliseconds before we think a node is down.</li>
<li><strong><code>cluster-require-full-coverage</code></strong>: If we
set this to <code>yes</code>, Redis Cluster needs all slots to be
covered by master nodes. If not, the cluster will not work during a
failover.</li>
</ul>
<pre class="conf"><code>cluster-node-timeout 5000
cluster-require-full-coverage yes</code></pre>
<p>By setting these settings correctly, Redis Cluster can handle
failover and recovery well. It helps to keep high availability for our
applications. For more information on setting up a Redis Cluster, look
at <a
href="https://bestonlinetutorial.com/redis/how-do-i-set-up-a-redis-cluster.html">How
to Set Up a Redis Cluster with Practical Code Examples</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="what-is-a-redis-cluster">1. What is a Redis Cluster?</h3>
<p>We can say a Redis Cluster is a way to use Redis in a distributed
manner. It helps us store data across different nodes. This setup gives
us more scalability, high availability, and fault tolerance. Each node
in the cluster holds part of the keyspace. This way, we can manage data
better and improve performance. To know more, you can read <a
href="https://bestonlinetutorial.com/redis/what-is-redis-cluster.html">what
is Redis Cluster</a>.</p>
<h3 id="how-does-data-sharding-work-in-redis-cluster">2. How does data
sharding work in Redis Cluster?</h3>
<p>Data sharding in Redis Cluster uses something called hash slots. We
divide the keyspace into 16,384 slots. Each key goes to one of these
slots through a hashing function. Each node in the cluster takes care of
a certain range of these slots. This helps us distribute data evenly and
access it efficiently. You can learn more about data management in Redis
by reading <a
href="https://bestonlinetutorial.com/redis/how-do-i-set-up-a-redis-cluster.html">how
to set up a Redis cluster</a>.</p>
<h3 id="what-roles-do-master-and-slave-nodes-play-in-redis-cluster">3.
What roles do master and slave nodes play in Redis Cluster?</h3>
<p>In a Redis Cluster, master nodes do the write operations and keep the
main data. Slave nodes are copies that give us backup. They can take
over if a master node fails. This setup helps us keep data available and
makes the cluster more fault tolerant. For more details on replication
and data consistency, look at <a
href="https://bestonlinetutorial.com/redis/what-is-redis-replication.html">what
is Redis replication</a>.</p>
<h3 id="how-is-consistency-maintained-in-redis-cluster">4. How is
consistency maintained in Redis Cluster?</h3>
<p>Redis Cluster keeps eventual consistency with asynchronous
replication and partition tolerance. When we write data, it first goes
to the master node. Then, the master sends the change to its slaves.
There might be a little delay before all nodes get updated. But this
design helps Redis to stay responsive while giving us good data access.
To learn more about Redis persistence, check <a
href="https://bestonlinetutorial.com/redis/what-is-redis-persistence.html">what
is Redis persistence</a>.</p>
<h3 id="how-does-redis-cluster-handle-failover-and-recovery-1">5. How
does Redis Cluster handle failover and recovery?</h3>
<p>Redis Cluster uses automatic failover and recovery with a voting
system among master and slave nodes. If a master node fails, the cluster
can make one of the slave nodes a master. This way, we can keep the
service running. This process makes the Redis Cluster stronger. For how
to do this in practice, see <a
href="https://bestonlinetutorial.com/redis/how-do-i-set-up-redis-replication.html">how
do I set up Redis replication</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            