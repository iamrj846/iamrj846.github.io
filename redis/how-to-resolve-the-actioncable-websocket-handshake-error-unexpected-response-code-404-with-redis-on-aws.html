
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
            <meta property="og:title" content="How to Resolve the ActionCable WebSocket Handshake Error: Unexpected Response Code 404 with Redis on AWS?" />
            <meta property="og:description" content="Learn how to fix the ActionCable WebSocket handshake error 404 with Redis on AWS in this comprehensive guide." />
            <meta property="og:url" content="https://www.bestonlinetutorial.com/redis/how-to-resolve-the-actioncable-websocket-handshake-error-unexpected-response-code-404-with-redis-on-aws.html" />
            <link rel="canonical" href="https://www.bestonlinetutorial.com/redis/how-to-resolve-the-actioncable-websocket-handshake-error-unexpected-response-code-404-with-redis-on-aws.html">
            <meta property="og:type" content="article" />
            <meta property="og:site_name" content=“BestOnlineTutorial” />
            <meta name="twitter:title" content="How to Resolve the ActionCable WebSocket Handshake Error: Unexpected Response Code 404 with Redis on AWS?" />
            <meta name="twitter:description" content="Learn how to fix the ActionCable WebSocket handshake error 404 with Redis on AWS in this comprehensive guide." />
            <meta name="pinterest-rich-pin" content="true" />

            <script type="application/ld+json">
                {
                "@context": "https://schema.org",
                "@type": "WebSite",
                "name": "BestOnlineTutorial",
                "url": "https://www.bestonlinetutorial.com/"
                }
            </script>
            <!-- Common CSS & Icons -->
            <link rel="icon" href="/favicon.ico" type="image/x-icon">
            <link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
            <link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
            <link rel="stylesheet" href="/assets/css/post.css">
            <title>How to Resolve the ActionCable WebSocket Handshake Error: Unexpected Response Code 404 with Redis on AWS?</title>
            <meta name="description" content="Learn how to fix the ActionCable WebSocket handshake error 404 with Redis on AWS in this comprehensive guide.">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How to Resolve the ActionCable WebSocket Handshake Error: Unexpected Response Code 404 with Redis on AWS?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>To fix the ActionCable WebSocket handshake error with the unexpected
response code 404 when we use Redis on AWS, we need to make sure our
WebSocket server is set up right and our routing is done correctly. We
have to check that our Redis server is running and we can reach it. This
error usually shows problems with the endpoint setup or server
connection. So, we should verify our ActionCable settings and Redis
connection.</p>
<p>In this article, we will talk about the common reasons for the
ActionCable WebSocket handshake error and give simple solutions to fix
it. We will look into the ActionCable WebSocket handshake process, find
out why we get the unexpected response code 404, and check Redis setup
for ActionCable on AWS. We will also discuss routing issues and how to
check WebSocket server settings for a smooth connection. Here is a list
of the solutions we will cover:</p>
<ul>
<li>Understanding the ActionCable WebSocket handshake process</li>
<li>Finding the unexpected response code 404 in ActionCable</li>
<li>Setting up Redis for ActionCable on AWS</li>
<li>Making sure routing is correct for ActionCable WebSockets</li>
<li>Checking WebSocket server settings with AWS</li>
<li>Common questions about ActionCable and Redis</li>
</ul>
<h2
id="understanding-the-actioncable-websocket-handshake-process">Understanding
the ActionCable WebSocket Handshake Process</h2>
<p>ActionCable gives us a way to communicate using WebSockets in Ruby on
Rails. The handshake process is very important. It helps us to set up a
WebSocket connection between the client and the server.</p>
<ol type="1">
<li><p><strong>Initial HTTP Request</strong>: The client starts the
handshake. It sends an HTTP request to the ActionCable endpoint. This
request usually has headers like <code>Upgrade</code>,
<code>Connection</code>, and <code>Sec-WebSocket-Key</code>.</p>
<p>Example:</p>
<pre><code>GET /cable HTTP/1.1
Host: yourdomain.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Sec-WebSocket-Version: 13</code></pre></li>
<li><p><strong>Server Response</strong>: When the server gets the
request, it checks it. If the handshake is successful, the ActionCable
server sends back an HTTP 101 status code. This response has headers
like <code>Sec-WebSocket-Accept</code>, which confirms that the
handshake worked.</p>
<p>Example response:</p>
<pre><code>HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: x3JJHMbDL1EzEvnr0cL8w6z1f3s=</code></pre></li>
<li><p><strong>Connection Established</strong>: After the handshake is
done, we have a WebSocket connection. Now we can send messages back and
forth. The server can send messages to the client and the client can
reply. We do not need to make more HTTP requests for this.</p></li>
<li><p><strong>Common Issues</strong>: If the handshake does not work,
we might see an error like <code>Unexpected Response Code 404</code>.
This means that the WebSocket endpoint is not reachable or it is set up
wrong. Problems can happen because of bad routes or missing setup on the
server side.</p></li>
</ol>
<p>Understanding this handshake process is very important. It helps us
to find problems like the ActionCable WebSocket handshake error. This is
especially true when we use Redis on AWS. For more information on Redis
setups that can affect ActionCable, we can check out <a
href="https://bestonlinetutorial.com/redis/what-is-redis.html">what is
Redis</a> for basic knowledge.</p>
<h2
id="diagnosing-the-unexpected-response-code-404-in-actioncable">Diagnosing
the Unexpected Response Code 404 in ActionCable</h2>
<p>We often see a WebSocket handshake error with a 404 response in
ActionCable. This happens when we cannot set up the WebSocket
connection. It may be due to wrong settings in routing or server. To
find out what is wrong, we can follow these steps:</p>
<ol type="1">
<li><p><strong>Check WebSocket URL</strong>: First, we need to check if
the WebSocket URL is right in our JavaScript client. It must match the
ActionCable server path. For example:
<code>javascript     const cable = ActionCable.createConsumer('ws://yourdomain.com/cable');</code></p></li>
<li><p><strong>Verify Server Logs</strong>: Next, we should look at our
server logs, like Rails logs. This can help us see if there are any
errors when trying to connect to the WebSocket. It gives us clues about
what is not working.</p></li>
<li><p><strong>Inspect Network Traffic</strong>: We can use browser
developer tools to look at the network traffic. We need to find the
WebSocket connection request and check if it gets a 404 status. This
shows us if the request reaches the server.</p></li>
<li><p><strong>Check Routes</strong>: We have to make sure we have the
right routes set for ActionCable in our <code>routes.rb</code> file. It
should look something like this:
<code>ruby     mount ActionCable.server =&gt; '/cable'</code></p></li>
<li><p><strong>Redis Configuration</strong>: If we use Redis, we need to
check if the Redis server is running and can be reached. We should look
at our <code>cable.yml</code> to see if Redis is set up right:
<code>yaml     production:       adapter: redis       url: redis://localhost:6379/1       channel_prefix: your_app_production</code></p></li>
<li><p><strong>Verify Environment</strong>: We must check that we are
using the right environment, whether it is development or production
when we test the WebSocket connection. Different settings for
environments can cause unexpected results.</p></li>
<li><p><strong>Cross-Origin Issues</strong>: If our WebSocket server is
on a different domain or port, we must check that we set up CORS
(Cross-Origin Resource Sharing) correctly. This allows WebSocket
connections to work.</p></li>
</ol>
<p>By following these steps one by one, we can find out why we see the
404 error in ActionCable and fix the handshake issue. If we still have
problems, we can check the AWS settings. We should ensure that security
groups and network access control lists (NACLs) allow WebSocket
traffic.</p>
<h2 id="configuring-redis-for-actioncable-on-aws">Configuring Redis for
ActionCable on AWS</h2>
<p>To configure Redis for ActionCable on AWS, we can follow these
steps.</p>
<ol type="1">
<li><p><strong>Set Up Redis on AWS</strong>: We can use Amazon
ElastiCache for Redis. This is a managed service that makes it easy to
set up and maintain Redis.</p>
<ul>
<li>First, we log in to the AWS Management Console.</li>
<li>Next, we go to ElastiCache and choose “Redis.”</li>
<li>Then, we click “Create” and set up the Redis cluster. We need to
choose the instance type, number of nodes, and other settings we
want.</li>
</ul></li>
<li><p><strong>Security Group Configuration</strong>: We need to check
that the security groups for our ElastiCache cluster allow traffic from
our application servers.</p>
<ul>
<li>We go to the EC2 console, select “Security Groups,” and change the
inbound rules. We allow traffic on port <code>6379</code> from the IP of
our application server.</li>
</ul></li>
<li><p><strong>Configure ActionCable to Use Redis</strong>: We must
update our Rails application’s settings to use Redis with
ActionCable.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># config/cable.yml</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>production:</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="wa">adapter: </span>redis</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="wa">url: </span>redis:<span class="ss">//</span><span class="kw">&lt;</span>your<span class="kw">-</span>elasticache<span class="kw">-</span>endpoint<span class="kw">&gt;</span>:<span class="dv">6379</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="wa">channel_prefix: </span>your_app_production</span></code></pre></div></li>
<li><p><strong>Install Redis Gem</strong>: We should include the Redis
gem in our Gemfile.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>gem <span class="vs">&#39;redis&#39;</span></span></code></pre></div>
<p>After this, we run:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bundle</span> install</span></code></pre></div></li>
<li><p><strong>Set Up Redis Configuration</strong>: If we want to set up
Redis more, we can do this in an initializer file.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># config/initializers/redis.rb</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="va">$redis</span> <span class="kw">=</span> <span class="dt">Redis</span><span class="at">.new</span>(<span class="wa">url: </span><span class="cn">ENV</span><span class="kw">[</span><span class="vs">&#39;REDIS_URL&#39;</span><span class="kw">]</span> <span class="kw">||</span> <span class="vs">&#39;redis://&lt;your-elasticache-endpoint&gt;:6379&#39;</span>)</span></code></pre></div></li>
<li><p><strong>Environment Variables</strong>: It is better to keep
sensitive info like the Redis URL in environment variables. This is
safer than putting them in the code.</p></li>
<li><p><strong>Testing the Configuration</strong>: After we finish the
configuration, we should test the WebSocket connection. We want to make
sure there are no handshake errors. We can use tools like
<code>rails console</code> to check Redis and see if it connects
well.</p></li>
<li><p><strong>Monitor Redis</strong>: We can use AWS CloudWatch to keep
an eye on how our Redis cluster is doing. We can set alarms for
important things like CPU usage and memory use.</p></li>
</ol>
<p>By following these steps, we will have set up Redis for ActionCable
on AWS correctly. This will help avoid handshake errors and improve our
application’s real-time features. If we want to learn more about Redis,
we can check out <a
href="https://bestonlinetutorial.com/redis/what-is-redis.html">this
comprehensive guide on Redis</a>.</p>
<h2 id="ensuring-proper-routing-for-actioncable-websockets">Ensuring
Proper Routing for ActionCable WebSockets</h2>
<p>To make sure we set up proper routing for ActionCable WebSockets in
our Rails app, we need to configure our routes in the
<code>config/routes.rb</code> file. The ActionCable server has to
respond to WebSocket requests correctly. Here is how we can do this:</p>
<ol type="1">
<li><p><strong>Define ActionCable Routes</strong>: We must define the
ActionCable routes. It usually looks like this:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Rails</span><span class="at">.application.routes.draw</span> <span class="cf">do</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  mount <span class="dt">ActionCable</span><span class="at">.server</span> <span class="kw">=&gt;</span> <span class="vs">&#39;/cable&#39;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>This line mounts the ActionCable server at the <code>/cable</code>
endpoint. This is the default.</p></li>
<li><p><strong>Verify Cable URL</strong>: We need to check that our
JavaScript client points to the right WebSocket URL. The default URL is
often <code>ws://your-domain/cable</code> for development. For
production, it is <code>wss://your-domain/cable</code>. If we use Redis,
we must check our Redis server settings.</p></li>
<li><p><strong>Set Allowed Origins</strong>: If we run our app on a
different domain or port, we should set the allowed origins for
ActionCable in our <code>config/cable.yml</code>:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">development</span><span class="kw">:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">adapter</span><span class="kw">:</span><span class="at"> redis</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">url</span><span class="kw">:</span><span class="at"> redis://localhost:6379</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">channel_prefix</span><span class="kw">:</span><span class="at"> your_app_development</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">allowed_origins</span><span class="kw">:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> http://localhost:3000</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> https://your-production-domain.com</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">production</span><span class="kw">:</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">adapter</span><span class="kw">:</span><span class="at"> redis</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">url</span><span class="kw">:</span><span class="at"> redis://your-redis-url:6379</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">channel_prefix</span><span class="kw">:</span><span class="at"> your_app_production</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">allowed_origins</span><span class="kw">:</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> https://your-production-domain.com</span></span></code></pre></div></li>
<li><p><strong>CORS Configuration</strong>: If we have cross-origin
issues, we must configure CORS with a gem like <code>rack-cors</code>.
For example, in our <code>config/application.rb</code>:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>config<span class="at">.middleware.insert_before</span> <span class="dv">0</span>, <span class="dt">Rack</span><span class="kw">::</span><span class="dt">Cors</span> <span class="cf">do</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  allow <span class="cf">do</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    origins <span class="vs">&#39;http://your-frontend-domain.com&#39;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    resource <span class="ch">&#39;*&#39;</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      <span class="wa">headers: :any</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="wa">methods: </span><span class="kw">[</span><span class="wa">:get</span>, <span class="wa">:post</span>, <span class="wa">:options</span>, <span class="wa">:put</span>, <span class="wa">:delete</span><span class="kw">]</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div></li>
<li><p><strong>Testing WebSocket Connection</strong>: We can test our
WebSocket connection using the browser console. Use this JavaScript code
to check if the WebSocket connection works correctly:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cable <span class="op">=</span> ActionCable<span class="op">.</span><span class="fu">createConsumer</span>(<span class="st">&#39;ws://your-domain/cable&#39;</span>)<span class="op">;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>cable<span class="op">.</span><span class="at">subscriptions</span><span class="op">.</span><span class="fu">create</span>(<span class="st">&quot;ChatChannel&quot;</span><span class="op">,</span> {</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">received</span>(data) {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(data)<span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div></li>
</ol>
<p>By setting up routing correctly and making sure our WebSocket server
is accessible, we can fix issues related to the ActionCable WebSocket
handshake error. This will help us avoid the unexpected response code
404. For deeper knowledge about Redis setup, we can read this article on
<a
href="https://bestonlinetutorial.com/redis/how-do-i-use-redis-with-aws-elasticache.html">How
to Use Redis with AWS ElastiCache</a>.</p>
<h2 id="validating-websocket-server-configuration-with-aws">Validating
WebSocket Server Configuration with AWS</h2>
<p>To check the WebSocket server setup on AWS, we need to make sure some
parts are right. Here are the steps we should follow:</p>
<ol type="1">
<li><p><strong>Security Groups</strong>: We should check that the
security group linked to our AWS instance lets in traffic on the
WebSocket port. The default port is 3000. We can add a rule to allow
traffic from our client IP. Or we can let all traffic in (0.0.0.0/0) for
testing.</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of adding inbound rule using AWS CLI</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">aws</span> ec2 authorize-security-group-ingress <span class="at">--group-id</span> sg-12345678 <span class="at">--protocol</span> tcp <span class="at">--port</span> 3000 <span class="at">--cidr</span> 0.0.0.0/0</span></code></pre></div></li>
<li><p><strong>Load Balancer</strong>: If we are using an Application
Load Balancer (ALB), we must check that:</p>
<ul>
<li>WebSocket settings are on.</li>
<li>The listener sends requests to the right target group.</li>
<li>Health checks are set up correctly for the WebSocket
connection.</li>
</ul></li>
<li><p><strong>WebSocket Endpoint</strong>: We need to make sure that
our WebSocket URL is correct. It must match the endpoint in our Rails
app’s ActionCable setup. For example:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># config/cable.yml</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>production:</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="wa">adapter: </span>redis</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="wa">url: </span>redis:<span class="ss">//u</span>sername<span class="wa">:password</span><span class="ot">@your</span><span class="kw">-</span>redis<span class="kw">-</span>endpoint:<span class="dv">6379</span><span class="kw">/</span><span class="dv">0</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="wa">channel_prefix: </span>your_app_production</span></code></pre></div></li>
<li><p><strong>Redis Configuration</strong>: We must check that our
Redis server can be reached from our WebSocket server. We can test the
Redis connection with a Redis client or command line.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test Redis connection</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">redis-cli</span> <span class="at">-h</span> your-redis-endpoint <span class="at">-p</span> 6379 <span class="at">-a</span> your-password ping</span></code></pre></div></li>
<li><p><strong>Network Configuration</strong>: We should look at our VPC
and subnet settings. This is to make sure our WebSocket server can talk
to Redis and other needed services.</p></li>
<li><p><strong>Debugging Logs</strong>: We should turn on debugging logs
in our Rails app. This helps us catch any mistakes during the WebSocket
handshake.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># config/environments/production.rb</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>config<span class="at">.log_level</span> <span class="kw">=</span> <span class="wa">:debug</span></span></code></pre></div></li>
</ol>
<p>If we follow these steps, we can check our WebSocket server setup on
AWS and fix common problems like the 404 handshake error. For more
details on setting up Redis with AWS, we can look at the guide on <a
href="https://bestonlinetutorial.com/redis/how-do-i-use-redis-with-aws-elasticache.html">using
Redis with AWS ElastiCache</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3
id="what-causes-the-actioncable-websocket-handshake-error-404-with-redis-on-aws">1.
What causes the ActionCable WebSocket handshake error 404 with Redis on
AWS?</h3>
<p>The ActionCable WebSocket handshake error 404 happens when the
WebSocket connection is not set up right. This can occur if we did not
define the route for ActionCable in our Rails app or if we cannot reach
the Redis server. To fix this issue, we should check that ActionCable is
set up correctly in our Rails routes and that Redis is set up right on
AWS.</p>
<h3
id="how-do-i-configure-redis-for-actioncable-in-an-aws-environment">2.
How do I configure Redis for ActionCable in an AWS environment?</h3>
<p>To set up Redis for ActionCable on AWS, we need to make sure our
Rails app uses Redis as the ActionCable backend. We should update our
<code>cable.yml</code> file with the right Redis URL. This URL should
include the correct AWS Elasticache endpoint for Redis. For example:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">production</span><span class="kw">:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">adapter</span><span class="kw">:</span><span class="at"> redis</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">url</span><span class="kw">:</span><span class="at"> redis://your-aws-elasticache-endpoint:6379</span></span></code></pre></div>
<p>We also need to check that our AWS security groups let us access the
Redis endpoint.</p>
<h3
id="why-am-i-getting-a-404-error-when-trying-to-connect-to-actioncable">3.
Why am I getting a 404 error when trying to connect to ActionCable?</h3>
<p>A 404 error when we try to connect to ActionCable means the WebSocket
server is not reachable or we made a mistake in our routes. We should
check the routing settings in our Rails app to ensure that ActionCable
routes are defined correctly. Also, let’s make sure our server is
running and accessible.</p>
<h3 id="how-can-i-ensure-proper-routing-for-actioncable-websockets">4.
How can I ensure proper routing for ActionCable WebSockets?</h3>
<p>To make sure we have proper routing for ActionCable WebSockets in our
Rails app, we need to add the right route in our <code>routes.rb</code>
file. For example:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mount <span class="dt">ActionCable</span><span class="at">.server</span> <span class="kw">=&gt;</span> <span class="vs">&#39;/cable&#39;</span></span></code></pre></div>
<p>This will mount the ActionCable server at the <code>/cable</code>
endpoint. This allows WebSocket connections to be routed correctly.</p>
<h3
id="what-should-i-do-if-redis-is-not-connecting-from-my-rails-application">5.
What should I do if Redis is not connecting from my Rails
application?</h3>
<p>If Redis does not connect from our Rails app, we should first check
if the Redis server is running. Next, we need to look at our
<code>Gemfile</code> for the required Redis gem like
<code>gem 'redis'</code> and make sure it is installed. We should also
confirm that our app is set up correctly to connect to the Redis server.
Finally, we can test the connection using Redis CLI or a similar
tool.</p>
<p>For more info on Redis and what it can do, we can read articles like
<a
href="https://bestonlinetutorial.com/redis/how-do-i-install-redis.html">How
do I install Redis?</a> or <a
href="https://bestonlinetutorial.com/redis/what-are-redis-data-types.html">What
are Redis data types?</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            