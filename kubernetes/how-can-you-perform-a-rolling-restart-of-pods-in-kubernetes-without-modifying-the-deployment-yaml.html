
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <!-- Common CSS & Icons -->
            <link rel="icon" href="/favicon.ico" type="image/x-icon">
            <link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
            <link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
            <link rel="stylesheet" href="/assets/css/post.css">
            <title>How can you perform a rolling restart of pods in Kubernetes without modifying the deployment YAML?</title>
            <meta name="description" content="Learn how to perform a rolling restart of Kubernetes pods effortlessly without changing the deployment YAML. Enhance your workflow!">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How can you perform a rolling restart of pods in Kubernetes without modifying the deployment YAML?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>To do a rolling restart of pods in Kubernetes without changing the
deployment YAML, we can use different ways that help us update smoothly.
One easy way is to use the <code>kubectl rollout restart</code> command.
This command restarts all the pods in a deployment but keeps the current
settings. It helps us reduce downtime and uses Kubernetes’ features for
rolling updates.</p>
<p>In this article, we will look at different ways to do a rolling
restart of pods in Kubernetes without changing the deployment YAML. We
will talk about these solutions:</p>
<ul>
<li>Using <code>kubectl rollout restart</code> for a rolling restart of
pods in Kubernetes</li>
<li>Using annotations to start a rolling restart of pods in
Kubernetes</li>
<li>Doing a rolling restart of pods in Kubernetes with the patch
command</li>
<li>Doing a rolling restart of pods in Kubernetes using the scale
command</li>
<li>Using the Kubernetes API to do a rolling restart of pods without
changing the deployment YAML</li>
</ul>
<p>These methods give us options and help us manage our Kubernetes
deployments. They also make sure our applications stay available during
updates. For more details on Kubernetes concepts, check out our article
on <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-pods-and-how-do-i-work-with-them.html">what
are Kubernetes pods and how do I work with them</a>.</p>
<h2
id="using-kubectl-rollout-restart-for-a-rolling-restart-of-pods-in-kubernetes">Using
kubectl rollout restart for a rolling restart of pods in Kubernetes</h2>
<p>We can do a rolling restart of pods in Kubernetes without changing
the deployment YAML. We use the <code>kubectl rollout restart</code>
command for this. This command helps us restart the pods that a
deployment manages. It makes sure that we have no downtime.</p>
<h3 id="command-syntax">Command Syntax</h3>
<p>The basic command for the rollout restart looks like this:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout restart deployment <span class="op">&lt;</span>deployment-name<span class="op">&gt;</span></span></code></pre></div>
<h3 id="example">Example</h3>
<p>For example, if we have a deployment called <code>my-app</code>, we
would run:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout restart deployment my-app</span></code></pre></div>
<h3 id="verification">Verification</h3>
<p>To check that the pods are restarting, we can see the status of the
deployment:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">-w</span></span></code></pre></div>
<p>This command will show us the status of the pods. We will see the new
pods starting as the old ones stop. This way, the current settings of
the deployment stay the same while we refresh the pods.</p>
<p>If you want to read more about managing deployments in Kubernetes,
you can look at this <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-deployments-and-how-do-i-use-them.html">guide
on Kubernetes deployments</a>.</p>
<h2
id="leveraging-annotations-to-trigger-a-rolling-restart-of-pods-in-kubernetes">Leveraging
annotations to trigger a rolling restart of pods in Kubernetes</h2>
<p>In Kubernetes, we can use annotations to start a rolling restart of
pods. We don’t need to change the deployment YAML. When we add an
annotation to a deployment, Kubernetes sees it as a change. This will
start a new rollout of the pods.</p>
<p>To do this, we can use the <code>kubectl annotate</code> command.
Here is how we do it:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> annotate deployment <span class="op">&lt;</span>deployment-name<span class="op">&gt;</span> <span class="op">&lt;</span>annotation-key<span class="op">&gt;</span>=<span class="op">&lt;</span>annotation-value<span class="op">&gt;</span> --overwrite</span></code></pre></div>
<p>For example, we can use a timestamp as the annotation value to force
a restart:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> annotate deployment my-deployment kubernetes.io/restart=<span class="st">&quot;</span><span class="va">$(</span><span class="fu">date</span> +%s<span class="va">)</span><span class="st">&quot;</span> <span class="at">--overwrite</span></span></code></pre></div>
<p>This command adds or updates the annotation
<code>kubernetes.io/restart</code> with the current timestamp. This will
trigger a rolling restart of the pods in our deployment.</p>
<p>Another way is to use custom annotations to show a change:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> annotate deployment my-deployment my.custom/annotation=<span class="st">&quot;trigger-restart&quot;</span> <span class="at">--overwrite</span></span></code></pre></div>
<p>When we apply this annotation, Kubernetes will see the change and
restart the pods.</p>
<p>Using annotations for rolling restarts works really well. It helps us
avoid changing the deployment configuration or the YAML file directly.
This way, we can update and manage our application deployments in
Kubernetes easily.</p>
<p>For more information about Kubernetes deployments and how to manage
them, we can read about <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-deployments-and-how-do-i-use-them.html">Kubernetes
Deployments and how to use them</a>.</p>
<h2
id="executing-a-rolling-restart-of-pods-in-kubernetes-with-the-patch-command">Executing
a rolling restart of pods in Kubernetes with the patch command</h2>
<p>We can do a rolling restart of pods in Kubernetes without changing
the deployment YAML. We use the <code>kubectl patch</code> command for
this. This command helps us update the deployment’s annotations. When we
do this, Kubernetes will restart the pods one by one.</p>
<p>Here is how we can run a rolling restart using the <code>patch</code>
command:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> patch deployment <span class="op">&lt;</span>deployment-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span> -p <span class="st">&quot;{</span><span class="dt">\&quot;</span><span class="st">spec</span><span class="dt">\&quot;</span><span class="st">:{</span><span class="dt">\&quot;</span><span class="st">template</span><span class="dt">\&quot;</span><span class="st">:{</span><span class="dt">\&quot;</span><span class="st">metadata</span><span class="dt">\&quot;</span><span class="st">:{</span><span class="dt">\&quot;</span><span class="st">annotations</span><span class="dt">\&quot;</span><span class="st">:{</span><span class="dt">\&quot;</span><span class="st">kubectl.kubernetes.io/restartedAt</span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="va">$(</span><span class="fu">date</span> +%Y-%m-%dT%H:%M:%SZ<span class="va">)</span><span class="dt">\&quot;</span><span class="st">}}}}}}&quot;</span></span></code></pre></div>
<h3 id="explanation">Explanation:</h3>
<ul>
<li>We need to replace <code>&lt;deployment-name&gt;</code> with the
name of our deployment.</li>
<li>We should change <code>&lt;namespace&gt;</code> with the right
namespace. We can skip the <code>-n &lt;namespace&gt;</code> part if our
deployment is in the default namespace.</li>
<li>This command updates the
<code>kubectl.kubernetes.io/restartedAt</code> annotation with the
current time. This makes Kubernetes see the pod template as changed.
Then it starts a rolling restart.</li>
</ul>
<p>This way is easy and does not need us to change the existing
deployment YAML file. This makes it a good option for managing rolling
restarts in a Kubernetes environment. For more info on managing
deployments, we can check <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-deployments-and-how-do-i-use-them.html">Kubernetes
Deployments</a>.</p>
<h2
id="applying-a-rolling-restart-of-pods-in-kubernetes-using-the-scale-command">Applying
a rolling restart of pods in Kubernetes using the scale command</h2>
<p>We can do a rolling restart of pods in Kubernetes without changing
the deployment YAML. We use the <code>kubectl scale</code> command for
this. This command helps us change the number of replicas in a
deployment. When we do this, it triggers a rolling restart of the
pods.</p>
<h3 id="example-command">Example Command</h3>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> scale deployment <span class="op">&lt;</span>deployment-name<span class="op">&gt;</span> --replicas=<span class="op">&lt;</span>new-replica-count<span class="op">&gt;</span></span></code></pre></div>
<h3 id="steps">Steps</h3>
<ol type="1">
<li><p><strong>Identify the Deployment</strong>: First, we need to find
the name of the deployment we want to restart.</p></li>
<li><p><strong>Scale Down</strong>: Next, we set the replicas to zero.
This will stop all existing pods.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> scale deployment <span class="op">&lt;</span>deployment-name<span class="op">&gt;</span> --replicas=0</span></code></pre></div></li>
<li><p><strong>Scale Up</strong>: After that, we scale back up to the
number of replicas we want.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> scale deployment <span class="op">&lt;</span>deployment-name<span class="op">&gt;</span> --replicas=<span class="op">&lt;</span>desired-replica-count<span class="op">&gt;</span></span></code></pre></div></li>
</ol>
<h3 id="notes">Notes</h3>
<ul>
<li>This method will cause a short downtime. All pods stop before new
ones start.</li>
<li>We should make sure our application can handle this downtime.</li>
</ul>
<p>This way is a fast way to do a rolling restart of our pods in
Kubernetes. For more details on managing deployments, we can check <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-deployments-and-how-do-i-use-them.html">Kubernetes
Deployments</a>.</p>
<h2
id="using-kubernetes-api-to-do-a-rolling-restart-of-pods-without-changing-the-deployment-yaml">Using
Kubernetes API to do a rolling restart of pods without changing the
deployment YAML</h2>
<p>We can do a rolling restart of pods in Kubernetes using the
Kubernetes API. We do not need to change the deployment YAML for this.
We can update the deployment’s settings using a PATCH request. Below are
the steps to show how we can do this.</p>
<h3 id="step-1-find-the-deployment">Step 1: Find the Deployment</h3>
<p>First, we need to find the deployment we want to restart. We can use
this command to see the deployments in a specific namespace:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get deployments <span class="at">-n</span> your-namespace</span></code></pre></div>
<h3 id="step-2-use-the-patch-method">Step 2: Use the PATCH Method</h3>
<p>To start a rolling restart, we can use the <code>kubectl patch</code>
command. Or we can use a direct API call with a PATCH request to the
deployment resource. Here is how we can do it with
<code>kubectl</code>:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> patch deployment your-deployment-name <span class="at">-n</span> your-namespace <span class="at">-p</span> <span class="st">&quot;{</span><span class="dt">\&quot;</span><span class="st">spec</span><span class="dt">\&quot;</span><span class="st">:{</span><span class="dt">\&quot;</span><span class="st">template</span><span class="dt">\&quot;</span><span class="st">:{</span><span class="dt">\&quot;</span><span class="st">metadata</span><span class="dt">\&quot;</span><span class="st">:{</span><span class="dt">\&quot;</span><span class="st">annotations</span><span class="dt">\&quot;</span><span class="st">:{</span><span class="dt">\&quot;</span><span class="st">date</span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="va">$(</span><span class="fu">date</span> +%Y-%m-%dT%H:%M:%S<span class="va">)</span><span class="dt">\&quot;</span><span class="st">}}}}}}&quot;</span></span></code></pre></div>
<p>This command adds or updates an annotation with the current date and
time. This will make Kubernetes restart the pods.</p>
<h3 id="step-3-direct-api-call-optional">Step 3: Direct API Call
(Optional)</h3>
<p>If we want to use the Kubernetes API directly, we can do a PATCH
request with <code>curl</code>. We should change
<code>your-k8s-api-server</code>, <code>your-token</code>,
<code>your-namespace</code>, and <code>your-deployment-name</code> as
needed.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PATCH <span class="dt">\</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  https://your-k8s-api-server/apis/apps/v1/namespaces/your-namespace/deployments/your-deployment-name <span class="dt">\</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-H</span> <span class="st">&quot;Authorization: Bearer your-token&quot;</span> <span class="dt">\</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">-H</span> <span class="st">&quot;Content-Type: application/strategic-merge-patch+json&quot;</span> <span class="dt">\</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">-d</span> <span class="st">&#39;{</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;spec&quot;: {</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="st">          &quot;template&quot;: {</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="st">            &quot;metadata&quot;: {</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="st">              &quot;annotations&quot;: {</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="st">                &quot;date&quot;: &quot;&#39;</span><span class="va">$(</span><span class="fu">date</span> +%Y-%m-%dT%H:%M:%S<span class="va">)</span><span class="st">&#39;&quot;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="st">              }</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="st">            }</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="st">          }</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="st">      }&#39;</span></span></code></pre></div>
<h3 id="notes-1">Notes</h3>
<ul>
<li>We need to make sure we have the right permissions to do PATCH
requests on the deployment.</li>
<li>The annotation key (<code>date</code> here) can be any key that does
not clash with other annotations.</li>
<li>This way we do not need to change the deployment YAML file. It helps
to restart the pods smoothly.</li>
</ul>
<p>If we want to learn more about Kubernetes deployments, we can read
about <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-deployments-and-how-do-i-use-them.html">Kubernetes
Deployments</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="what-is-a-rolling-restart-in-kubernetes-and-why-is-it-used">What
is a rolling restart in Kubernetes, and why is it used?</h3>
<p>A rolling restart in Kubernetes helps us update or restart the pods
in a deployment one by one. This way, we keep some parts of the
application running while we restart others. It is good for making
changes or updates without stopping the whole service. So, it is a best
practice for keeping high availability.</p>
<h3
id="how-do-i-perform-a-rolling-restart-of-pods-without-modifying-the-deployment-yaml">How
do I perform a rolling restart of pods without modifying the deployment
YAML?</h3>
<p>We can do a rolling restart of pods in Kubernetes without changing
the deployment YAML. We just need to use the
<code>kubectl rollout restart</code> command. This command restarts the
pods linked with a deployment. It lets us update the application without
changing the configuration file. It is simple and effective to make sure
our application runs the latest code or settings.</p>
<h3
id="can-i-use-annotations-to-trigger-a-rolling-restart-in-kubernetes">Can
I use annotations to trigger a rolling restart in Kubernetes?</h3>
<p>Yes, we can use annotations to start a rolling restart in Kubernetes.
When we add or change an annotation on the deployment, Kubernetes will
notice it and start a rolling restart of the pods. This way, we can use
versioning or other info to trigger the restart without changing the
main deployment settings.</p>
<h3
id="what-is-the-difference-between-the-scale-command-and-the-rollout-restart-command-in-kubernetes">What
is the difference between the scale command and the rollout restart
command in Kubernetes?</h3>
<p>The <code>scale</code> command in Kubernetes changes how many copies
of a deployment we have. It can make the application bigger or smaller.
On the other hand, the <code>kubectl rollout restart</code> command
restarts the pods in a deployment but does not change how many copies we
have. Both commands have different jobs: scaling changes capacity, while
rolling restart updates the running instances.</p>
<h3
id="how-can-i-use-the-kubernetes-api-to-perform-a-rolling-restart">How
can I use the Kubernetes API to perform a rolling restart?</h3>
<p>We can use the Kubernetes API to start a rolling restart by sending a
PATCH request to the deployment resource. By changing the deployment’s
spec, like updating the annotations or images, we can trigger a rolling
restart in a program way. This is really good for automating deployments
and working with CI/CD pipelines. It helps us update applications
smoothly.</p>
<p>For more information about Kubernetes and its features, we can check
out articles like <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-deployments-and-how-do-i-use-them.html">What
are Kubernetes Deployments and How Do I Use Them?</a> and <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-perform-rolling-updates-in-kubernetes.html">How
Do I Perform Rolling Updates in Kubernetes?</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            