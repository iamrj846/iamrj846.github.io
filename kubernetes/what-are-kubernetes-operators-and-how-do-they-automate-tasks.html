
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TFCQEJR7TD');
</script>
            <title>What are Kubernetes Operators and How Do They Automate Tasks?</title>
            <meta name="description" content="Discover what Kubernetes Operators are and learn how they automate tasks to streamline your container orchestration.">

            <div id="head-placeholder"></div>
            <script src="/assets/js/blog.js" defer></script>
            <link rel="stylesheet" href="/assets/css/post.css">
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">What are Kubernetes Operators and How Do They Automate Tasks?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>Kubernetes Operators help us manage complex applications in
Kubernetes. They gather the knowledge we need to run these applications.
Operators extend the Kubernetes API. They use custom resources to manage
our applications and their parts automatically. This way, they make sure
everything runs as it should without needing much help from us.</p>
<p>In this article, we will look at different parts of Kubernetes
Operators. We will explain what they are and how they help automate
tasks in Kubernetes. We will also discuss why automation is important.
We will see how Operators work inside. We will cover the main components
involved. Plus, we will give a simple guide on how to create and deploy
an Operator. We will share real-life examples, best tips for
development, and how to fix common problems. Finally, we will answer
some questions that many people ask.</p>
<ul>
<li>What are Kubernetes Operators and How Do They Automate Tasks in
Kubernetes?</li>
<li>Why Do We Need Kubernetes Operators for Automation?</li>
<li>How Do Kubernetes Operators Work Under the Hood?</li>
<li>What Are the Key Components of a Kubernetes Operator?</li>
<li>How to Create a Simple Kubernetes Operator?</li>
<li>How to Deploy and Manage a Kubernetes Operator?</li>
<li>Real Life Use Cases of Kubernetes Operators in Production</li>
<li>Best Practices for Developing Kubernetes Operators</li>
<li>Troubleshooting Common Issues with Kubernetes Operators</li>
<li>Frequently Asked Questions</li>
</ul>
<h2 id="why-do-we-need-kubernetes-operators-for-automation">Why Do We
Need Kubernetes Operators for Automation?</h2>
<p>Kubernetes Operators are very important for automating how we manage
complex applications on Kubernetes. They help connect what we know about
operations with the Kubernetes API. This makes it easier to deploy,
scale, and manage applications. Here are the main reasons why we need
Kubernetes Operators for automation:</p>
<ul>
<li><p><strong>Custom Resource Management</strong>: Operators help us
extend what Kubernetes can do by managing custom resources. This means
we can define and manage the specific logic and settings for our
applications using Kubernetes’ simple API.</p></li>
<li><p><strong>Automation of Operational Tasks</strong>: Operators can
do routine tasks like backups, scaling, and updates on their own. This
helps reduce mistakes and the work we have to do. So, we can focus on
more important tasks instead of daily management.</p></li>
<li><p><strong>Lifecycle Management</strong>: Operators handle the whole
lifecycle of applications. This includes installation, upgrades, and
fixing failures. They keep an eye on the application’s state and make
changes when needed. This way, we can keep things running as we
want.</p></li>
<li><p><strong>Consistency and Standardization</strong>: When we put our
operations knowledge into Operators, we can make sure that applications
are deployed and managed the same way everywhere. This reduces
differences and makes our systems more reliable.</p></li>
<li><p><strong>Improved Resource Utilization</strong>: Operators can
change resources based on how much load the application has. This helps
us use resources better and save money. For example, they can increase
resources when there is a lot of work and reduce them when things are
quieter.</p></li>
<li><p><strong>Integration with Kubernetes Ecosystem</strong>: Operators
use features that already exist in Kubernetes, like controllers and CRDs
(Custom Resource Definitions). This makes them fit well into the
Kubernetes ecosystem and adds more power to it.</p></li>
<li><p><strong>Complex Application Management</strong>: For applications
that need careful state management, like databases or distributed
systems, Operators can include the needed logic to handle these
complexities. This makes sure they are deployed and run the right
way.</p></li>
</ul>
<p>In short, Kubernetes Operators are key for automating tasks in
Kubernetes. They make our work easier and help ensure that applications
run well and reliably in production. If you want to learn more about how
Kubernetes manages applications, check out <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubernetes-and-how-does-it-simplify-container-management.html">what
Kubernetes is and how it simplifies container management</a>.</p>
<h2 id="how-do-kubernetes-operators-work-under-the-hood">How Do
Kubernetes Operators Work Under the Hood?</h2>
<p>Kubernetes Operators help to make Kubernetes better by managing
complex applications and services. They work on the idea of the Operator
Pattern. This uses custom controllers and custom resources to automate
tasks for application management.</p>
<h3 id="core-concepts">Core Concepts</h3>
<ol type="1">
<li><p><strong>Custom Resource Definitions (CRDs)</strong>: Operators
use CRDs to create new resource types. These types represent the
applications or services they manage. This helps us to interact with the
application using regular Kubernetes APIs.</p>
<p>Here is an example of a CRD for a custom database resource:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apiextensions.k8s.io/v1</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> CustomResourceDefinition</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> databases.mycompany.com</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> mycompany.com</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">names</span><span class="kw">:</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> Database</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">listKind</span><span class="kw">:</span><span class="at"> DatabaseList</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">plural</span><span class="kw">:</span><span class="at"> databases</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">singular</span><span class="kw">:</span><span class="at"> database</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scope</span><span class="kw">:</span><span class="at"> Namespaced</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">versions</span><span class="kw">:</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">served</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">storage</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">schema</span><span class="kw">:</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">openAPIV3Schema</span><span class="kw">:</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">properties</span><span class="kw">:</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">properties</span><span class="kw">:</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">size</span><span class="kw">:</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">version</span><span class="kw">:</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span></code></pre></div></li>
<li><p><strong>Controllers</strong>: Each Operator has a controller.
This controller watches for changes to the custom resources from CRDs.
Controllers run the reconciliation loop. This loop makes sure that the
real state of the system matches the desired state from the custom
resource.</p>
<p>Here is a simple reconciliation loop in a controller:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>r <span class="op">*</span>DatabaseReconciler<span class="op">)</span> Reconcile<span class="op">(</span>ctx context<span class="op">.</span>Context<span class="op">,</span> req ctrl<span class="op">.</span>Request<span class="op">)</span> <span class="op">(</span>ctrl<span class="op">.</span>Result<span class="op">,</span> <span class="dt">error</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> db Database</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">:=</span> r<span class="op">.</span>Get<span class="op">(</span>ctx<span class="op">,</span> req<span class="op">.</span>NamespacedName<span class="op">,</span> <span class="op">&amp;</span>db<span class="op">);</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        log<span class="op">.</span>Error<span class="op">(</span>err<span class="op">,</span> <span class="st">&quot;unable to fetch Database&quot;</span><span class="op">)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ctrl<span class="op">.</span>Result<span class="op">{},</span> client<span class="op">.</span>IgnoreNotFound<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Logic to ensure the current state matches the desired state</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ctrl<span class="op">.</span>Result<span class="op">{},</span> <span class="ot">nil</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong>Watchers</strong>: Operators use the Kubernetes API to
watch for events about the custom resources. When an event happens, like
creation, update, or deletion, the controller gets notified. Then it can
take the right actions.</p></li>
<li><p><strong>Finalizers</strong>: Operators can use finalizers to
manage cleanup tasks before deleting a resource. This makes sure that
any necessary teardown actions are done.</p>
<p>Here is an example of adding a finalizer:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">!</span>containsString<span class="op">(</span>db<span class="op">.</span>ObjectMeta<span class="op">.</span>Finalizers<span class="op">,</span> finalizerName<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    db<span class="op">.</span>ObjectMeta<span class="op">.</span>Finalizers <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>db<span class="op">.</span>ObjectMeta<span class="op">.</span>Finalizers<span class="op">,</span> finalizerName<span class="op">)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">:=</span> r<span class="op">.</span>Update<span class="op">(</span>ctx<span class="op">,</span> <span class="op">&amp;</span>db<span class="op">);</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ctrl<span class="op">.</span>Result<span class="op">{},</span> err</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong>Status Management</strong>: Operators change the status
subresource of the custom resource. This shows the current state of the
application and gives feedback to users.</p></li>
<li><p><strong>Metrics and Health Checks</strong>: Operators can work
with monitoring tools to show metrics about the health and performance
of the applications they manage. This helps us to manage things
better.</p></li>
</ol>
<p>By using these parts, Kubernetes Operators can automate managing
complex applications well. They make sure of resilience and scalability
while also reducing manual work. To learn more about Kubernetes and its
parts, we can check out <a
href="https://bestonlinetutorial.com/kubernetes/what-are-the-key-components-of-a-kubernetes-cluster.html">what
are the key components of a Kubernetes cluster</a>.</p>
<h2 id="what-are-the-key-components-of-a-kubernetes-operator">What Are
the Key Components of a Kubernetes Operator?</h2>
<p>Kubernetes Operators help us manage complex applications. They are an
extension of the Kubernetes API. There are several key parts that help
them work well.</p>
<ol type="1">
<li><strong>Custom Resource Definitions (CRDs)</strong>:
<ul>
<li><p>CRDs let us create new resource types in Kubernetes. We use CRDs
to add application-specific resources and make Kubernetes more
powerful.</p></li>
<li><p>Here is an example of a CRD definition:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apiextensions.k8s.io/v1</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> CustomResourceDefinition</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myapp.example.com</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> example.com</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">names</span><span class="kw">:</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> MyApp</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">listKind</span><span class="kw">:</span><span class="at"> MyAppList</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">plural</span><span class="kw">:</span><span class="at"> myapps</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">singular</span><span class="kw">:</span><span class="at"> myapp</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scope</span><span class="kw">:</span><span class="at"> Namespaced</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">versions</span><span class="kw">:</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">served</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">storage</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">schema</span><span class="kw">:</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">openAPIV3Schema</span><span class="kw">:</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">properties</span><span class="kw">:</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">properties</span><span class="kw">:</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">replicas</span><span class="kw">:</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> integer</span></span></code></pre></div></li>
</ul></li>
<li><strong>Controller</strong>:
<ul>
<li><p>The controller watches our custom resources. It makes sure the
desired state matches the actual state. It reacts to changes in the
cluster and manages the application lifecycle.</p></li>
<li><p>A simple controller loop looks like this:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>c <span class="op">*</span>MyAppController<span class="op">)</span> Reconcile<span class="op">(</span>req ctrl<span class="op">.</span>Request<span class="op">)</span> <span class="op">(</span>ctrl<span class="op">.</span>Result<span class="op">,</span> <span class="dt">error</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Fetch the MyApp instance</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    myApp <span class="op">:=</span> <span class="op">&amp;</span>MyApp<span class="op">{}</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    err <span class="op">:=</span> c<span class="op">.</span>Get<span class="op">(</span>context<span class="op">.</span>Background<span class="op">(),</span> req<span class="op">.</span>NamespacedName<span class="op">,</span> myApp<span class="op">)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ctrl<span class="op">.</span>Result<span class="op">{},</span> client<span class="op">.</span>IgnoreNotFound<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add logic to manage MyApp state</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ctrl<span class="op">.</span>Result<span class="op">{},</span> <span class="ot">nil</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
</ul></li>
<li><strong>Operator SDK</strong>:
<ul>
<li><p>The Operator SDK helps us build Operators easily. It gives us
tools and libraries to start a new Operator project quickly.</p></li>
<li><p>Here is a command to create a new Operator:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">operator-sdk</span> init <span class="at">--domain</span><span class="op">=</span>mydomain.com <span class="at">--repo</span><span class="op">=</span>github.com/myorg/myapp-operator</span></code></pre></div></li>
</ul></li>
<li><strong>Webhook</strong>:
<ul>
<li><p>Webhooks help us validate and change our custom resources when
they enter the system. This helps to make sure that only valid resources
are created or changed in the cluster.</p></li>
<li><p>Here is an example of a webhook configuration:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> admissionregistration.k8s.io/v1</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ValidatingWebhookConfiguration</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myapp-validator</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">webhooks</span><span class="kw">:</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> validate.myapp.example.com</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">operations</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;CREATE&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;UPDATE&quot;</span><span class="kw">]</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">apiGroups</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;example.com&quot;</span><span class="kw">]</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">apiVersions</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;v1&quot;</span><span class="kw">]</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resources</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;myapps&quot;</span><span class="kw">]</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">clientConfig</span><span class="kw">:</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">service</span><span class="kw">:</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myapp-validator</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> default</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">path</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;/validate&quot;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">caBundle</span><span class="kw">:</span><span class="at"> &lt;CA_BUNDLE&gt;</span></span></code></pre></div></li>
</ul></li>
<li><strong>Status Management</strong>:
<ul>
<li><p>Operators usually keep a status subresource for custom resources.
This shows the current state of the application. It can include things
like the number of running instances or errors.</p></li>
<li><p>To update the status in the controller, we can do:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>myApp<span class="op">.</span>Status<span class="op">.</span>Replicas <span class="op">=</span> currentReplicas</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>err <span class="op">=</span> c<span class="op">.</span>Status<span class="op">().</span>Update<span class="op">(</span>context<span class="op">.</span>Background<span class="op">(),</span> myApp<span class="op">)</span></span></code></pre></div></li>
</ul></li>
<li><strong>Dependencies</strong>:
<ul>
<li>Operators can manage dependencies on other Kubernetes resources.
These can be Deployments, Services, or ConfigMaps. This helps the
application work as it should.</li>
</ul></li>
</ol>
<p>These components work together. They help Kubernetes Operators
automate the management of complex applications. This allows for
self-healing, scaling, and upgrades in Kubernetes clusters. For more
details about Kubernetes architecture, you can check <a
href="https://bestonlinetutorial.com/kubernetes/what-are-the-key-components-of-a-kubernetes-cluster.html">what
are the key components of a Kubernetes cluster</a>.</p>
<h2 id="how-to-create-a-simple-kubernetes-operator">How to Create a
Simple Kubernetes Operator?</h2>
<p>Creating a simple Kubernetes Operator have some steps. We need to
define a custom resource definition (CRD), write the controller code,
and then deploy it. Here is a simple guide to help us create a basic
Operator.</p>
<h3 id="step-1-define-a-custom-resource-definition-crd">Step 1: Define a
Custom Resource Definition (CRD)</h3>
<p>A CRD helps us to add new resource type to Kubernetes. Here is an
example of a CRD for a simple <code>MyApp</code> application:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apiextensions.k8s.io/v1</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> CustomResourceDefinition</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myapps.mycompany.com</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> mycompany.com</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">names</span><span class="kw">:</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> MyApp</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">listKind</span><span class="kw">:</span><span class="at"> MyAppList</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">plural</span><span class="kw">:</span><span class="at"> myapps</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">singular</span><span class="kw">:</span><span class="at"> myapp</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scope</span><span class="kw">:</span><span class="at"> Namespaced</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">versions</span><span class="kw">:</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">served</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">storage</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre></div>
<h3 id="step-2-implement-the-operator-logic">Step 2: Implement the
Operator Logic</h3>
<p>We can use the Operator SDK to start our Operator. First, we need to
install the SDK. Then we run this command to create a new Operator:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">operator-sdk</span> init <span class="at">--domain</span><span class="op">=</span>mycompany.com <span class="at">--repo</span><span class="op">=</span>github.com/myaccount/myoperator</span></code></pre></div>
<p>Next, we create an API and a controller like this:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">operator-sdk</span> create api <span class="at">--group</span><span class="op">=</span>myapp <span class="at">--version</span><span class="op">=</span>v1 <span class="at">--kind</span><span class="op">=</span>MyApp</span></code></pre></div>
<p>This command makes the necessary files in the <code>api</code> and
<code>controllers</code> folders. We can then write the reconciliation
logic in the <code>controllers/myapp_controller.go</code> file. Here is
a simple example:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> controllers</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;context&quot;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;github.com/go-logr/logr&quot;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sigs.k8s.io/controller-runtime/pkg/controller/controllerutil&quot;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sigs.k8s.io/controller-runtime/pkg/controller&quot;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sigs.k8s.io/controller-runtime/pkg/reconcile&quot;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>r <span class="op">*</span>MyAppReconciler<span class="op">)</span> Reconcile<span class="op">(</span>req ctrl<span class="op">.</span>Request<span class="op">)</span> <span class="op">(</span>ctrl<span class="op">.</span>Result<span class="op">,</span> <span class="dt">error</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    ctx <span class="op">:=</span> context<span class="op">.</span>Background<span class="op">()</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    log <span class="op">:=</span> r<span class="op">.</span>Log<span class="op">.</span>WithValues<span class="op">(</span><span class="st">&quot;myapp&quot;</span><span class="op">,</span> req<span class="op">.</span>NamespacedName<span class="op">)</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Your reconciliation logic here</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Info<span class="op">(</span><span class="st">&quot;Reconciling MyApp&quot;</span><span class="op">)</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ctrl<span class="op">.</span>Result<span class="op">{},</span> <span class="ot">nil</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="step-3-deploy-the-operator">Step 3: Deploy the Operator</h3>
<p>Next, we need to build the Operator image:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build docker-push IMG=<span class="op">&lt;</span>your-image-name<span class="op">&gt;</span></span></code></pre></div>
<p>Then we deploy the CRD and our Operator to the Kubernetes
cluster:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> deploy IMG=<span class="op">&lt;</span>your-image-name<span class="op">&gt;</span></span></code></pre></div>
<h3 id="step-4-create-a-custom-resource">Step 4: Create a Custom
Resource</h3>
<p>After we deploy the Operator, we can create a custom resource of type
<code>MyApp</code>:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> mycompany.com/v1</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> MyApp</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myapp-instance</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">  # Add your specifications here</span></span></code></pre></div>
<p>We need to apply the custom resource like this:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> myapp_instance.yaml</span></code></pre></div>
<h3 id="step-5-verify-the-operator">Step 5: Verify the Operator</h3>
<p>Finally, we check the status of our custom resource:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get myapp</span></code></pre></div>
<p>This guide gives us a simple way to create a basic Kubernetes
Operator. For more detailed info on Kubernetes Operators, we can look at
<a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-create-and-manage-helm-charts">this
article on creating and managing Helm charts</a>.</p>
<h2 id="how-to-deploy-and-manage-a-kubernetes-operator">How to Deploy
and Manage a Kubernetes Operator?</h2>
<p>To deploy and manage a Kubernetes Operator, we can follow these
simple steps.</p>
<ol type="1">
<li><p><strong>Prepare Your Environment</strong>: First, we need to have
a Kubernetes cluster. We can use Minikube for this.</p></li>
<li><p><strong>Install Operator SDK</strong>: Next, we install the
Operator SDK. We can do it using this command:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-sSL</span> https://raw.githubusercontent.com/operator-framework/operator-sdk/master/scripts/install.sh <span class="kw">|</span> <span class="fu">bash</span></span></code></pre></div></li>
<li><p><strong>Create a New Operator</strong>: Now, we will create a new
operator project. We have to replace <code>&lt;operator-name&gt;</code>
and <code>&lt;domain&gt;</code> with our own values.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">operator-sdk</span> init <span class="at">--domain</span><span class="op">=&lt;</span>domain<span class="op">&gt;</span> --repo=github.com/<span class="op">&lt;</span>username<span class="op">&gt;</span>/<span class="op">&lt;</span>operator-name<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Define the Custom Resource Definition (CRD)</strong>: We
need to create our CRD in the <code>config/crd</code> folder. For
example, we can create a file named
<code>myresource_crd.yaml</code>:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apiextensions.k8s.io/v1</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> CustomResourceDefinition</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myresources.&lt;domain&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> &lt;domain&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">versions</span><span class="kw">:</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">served</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">storage</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">schema</span><span class="kw">:</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">openAPIV3Schema</span><span class="kw">:</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scope</span><span class="kw">:</span><span class="at"> Namespaced</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">names</span><span class="kw">:</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">plural</span><span class="kw">:</span><span class="at"> myresources</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">singular</span><span class="kw">:</span><span class="at"> myresource</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> MyResource</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">shortNames</span><span class="kw">:</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mr</span></span></code></pre></div></li>
<li><p><strong>Build the Operator</strong>: Then, we build the operator
container image using Docker. We must be in the root of our operator
project.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> docker-build docker-push IMG=<span class="op">&lt;</span>your-image<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Deploy the Operator</strong>: Now, we will apply the
deployment manifest to our cluster. We can find the deployment manifests
in <code>config/manager/manager.yaml</code>.</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> config/manager/manager.yaml</span></code></pre></div></li>
<li><p><strong>Deploy the CRD</strong>: Next, we apply the CRD to our
Kubernetes cluster.</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> config/crd/myresource_crd.yaml</span></code></pre></div></li>
<li><p><strong>Create an Instance of Your Custom Resource</strong>: We
need to define a custom resource in YAML. Let’s create a file called
<code>myresource_instance.yaml</code>:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> &lt;domain&gt;/v1</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> MyResource</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-myresource</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">  # Add your spec fields here</span></span></code></pre></div>
<p>After that, we apply it to our cluster:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> myresource_instance.yaml</span></code></pre></div></li>
<li><p><strong>Monitor the Operator</strong>: We should check the logs
of our operator to make sure it works well.</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="at">-l</span> control-plane=controller-manager <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Update and Manage the Operator</strong>: If we need to
update the operator’s code, we can do it and redeploy. We can use
<code>kubectl apply</code> to apply changes to our CRD and custom
resources.</p></li>
</ol>
<p>By following these steps, we can deploy and manage a Kubernetes
Operator. This helps us automate the management of complex applications
on Kubernetes. If we want to learn more about Kubernetes Operators, we
can read more about <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-create-and-manage-helm-charts.html">Creating
and Managing Helm Charts</a>.</p>
<h2 id="real-life-use-cases-of-kubernetes-operators-in-production">Real
Life Use Cases of Kubernetes Operators in Production</h2>
<p>Kubernetes Operators are great tools. They help us manage complex
applications and automate many tasks. Here are some examples of using
Kubernetes Operators in real-life production.</p>
<ol type="1">
<li><p><strong>Database Management</strong>: We use Operators a lot for
managing databases in Kubernetes. For example, the <a
href="https://github.com/zalando/postgres-operator">PostgreSQL
Operator</a> helps us automate things like creating, scaling, and
backing up PostgreSQL clusters. The operator watches for changes in
custom resource definitions (CRDs) and takes action when needed.</p>
<p>Example CRD for PostgreSQL:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;postgresql.zalando.org/v1&quot;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> postgresql</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-postgres</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">teamId</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;team-a&quot;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">volume</span><span class="kw">:</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">size</span><span class="kw">:</span><span class="at"> 1Gi</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">numberOfInstances</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">enableMasterLoadBalancing</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre></div></li>
<li><p><strong>Monitoring and Logging</strong>: We can use Operators
like the <a
href="https://github.com/prometheus-operator/prometheus-operator">Prometheus
Operator</a> to make it easier to deploy and manage Prometheus
instances. It automates the setup for monitoring configurations and
alert rules.</p>
<p>Example Prometheus CRD:</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> monitoring.coreos.com/v1</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Prometheus</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-prometheus</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">serviceAccountName</span><span class="kw">:</span><span class="at"> prometheus-k8s</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> 400Mi</span></span></code></pre></div></li>
<li><p><strong>Application Lifecycle Management</strong>: Operators help
us manage the lifecycle of applications. The <a
href="https://strimzi.io/">Kafka Operator</a> automates the deployment,
scaling, and management of Apache Kafka clusters. This helps us handle
message streaming applications easily.</p>
<p>Example Kafka CRD:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> kafka.strimzi.io/v1beta2</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Kafka</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-kafka</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">kafka</span><span class="kw">:</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="fl">2.8.0</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">listeners</span><span class="kw">:</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">plain</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">tls</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span></span></code></pre></div></li>
<li><p><strong>Custom Resource Management</strong>: Operators help us
manage custom resources. The <a
href="https://github.com/kubernetes-sigs/custom-resource-definition-examples">K8s
Custom Resource Operator</a> allows us to create and manage these
resources. It automates some application logic and lifecycle
management.</p></li>
<li><p><strong>CI/CD Workflows</strong>: Operators make CI/CD pipelines
easier. The <a
href="https://github.com/jenkinsci/kubernetes-operator">Jenkins
Operator</a> automates deploying and managing Jenkins instances on
Kubernetes. This makes our CI/CD processes smoother.</p>
<p>Example Jenkins CRD:</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> jenkins.io/v1</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Jenkins</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-jenkins</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">master</span><span class="kw">:</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">basePlugins</span><span class="kw">:</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> git</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="fl">4.10.0</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">installPlugins</span><span class="kw">:</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> workflow-aggregator:2.6</span></span></code></pre></div></li>
<li><p><strong>Service Mesh Management</strong>: We have Operators like
the <a href="https://istio.io/latest/docs/setup/install-operator/">Istio
Operator</a> to help automate installing and managing service meshes in
Kubernetes. This makes it easier to handle complex deployments with
microservices.</p></li>
<li><p><strong>Machine Learning Workflows</strong>: Operators like the
<a
href="https://kubeflow.org/docs/components/centraldashboard/">Kubeflow
Operator</a> manage ML workflows. They automate tasks for model
training, serving, and scaling.</p></li>
</ol>
<p>These examples show how we can use Kubernetes Operators in
production. They help us automate tasks, improve efficiency, and manage
complex applications better. Their ability to enhance Kubernetes makes
them very useful in today’s cloud-native environments.</p>
<h2 id="best-practices-for-developing-kubernetes-operators">Best
Practices for Developing Kubernetes Operators</h2>
<p>When we develop Kubernetes Operators, we want to follow best
practices. This helps us make them strong, easy to maintain, and
efficient. Here are some key tips:</p>
<ol type="1">
<li><p><strong>Leverage the Operator SDK</strong>: We should use the
Operator SDK to create our Operator. It gives us a good base and cuts
down on extra code.</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">operator-sdk</span> init <span class="at">--domain</span><span class="op">=</span>mydomain.com <span class="at">--repo</span><span class="op">=</span>github.com/myrepo/myoperator</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">operator-sdk</span> create api <span class="at">--group</span><span class="op">=</span>app <span class="at">--version</span><span class="op">=</span>v1 <span class="at">--kind</span><span class="op">=</span>MyCustomResource <span class="at">--resource</span> <span class="at">--controller</span></span></code></pre></div></li>
<li><p><strong>Follow the Controller Pattern</strong>: We need to use
the controller pattern. This helps us manage the lifecycle of our custom
resources. Our controller must always check the desired state and match
it with the actual state.</p></li>
<li><p><strong>Use Custom Resource Definitions (CRDs)</strong>: We
define CRDs to show the desired state of our application. This helps
Kubernetes know how to manage the resources.</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apiextensions.k8s.io/v1</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> CustomResourceDefinition</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> mycustomresources.mydomain.com</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> app.mydomain.com</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">versions</span><span class="kw">:</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">served</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">storage</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scope</span><span class="kw">:</span><span class="at"> Namespaced</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">names</span><span class="kw">:</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">plural</span><span class="kw">:</span><span class="at"> mycustomresources</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">singular</span><span class="kw">:</span><span class="at"> mycustomresource</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> MyCustomResource</span></span></code></pre></div></li>
<li><p><strong>Implement Proper Logging</strong>: We can use structured
logging for important events and errors. This makes it easier to debug
and monitor.</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>log <span class="op">:=</span> ctrl<span class="op">.</span>Log<span class="op">.</span>WithName<span class="op">(</span><span class="st">&quot;controller&quot;</span><span class="op">).</span>WithName<span class="op">(</span><span class="st">&quot;MyCustomResource&quot;</span><span class="op">)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>log<span class="op">.</span>Info<span class="op">(</span><span class="st">&quot;Reconciling MyCustomResource&quot;</span><span class="op">,</span> <span class="st">&quot;namespace&quot;</span><span class="op">,</span> req<span class="op">.</span>Namespace<span class="op">,</span> <span class="st">&quot;name&quot;</span><span class="op">,</span> req<span class="op">.</span>Name<span class="op">)</span></span></code></pre></div></li>
<li><p><strong>Error Handling</strong>: We should have strong error
handling to deal with failures. We can use backoff strategies for
retries and make sure the controller does not loop forever.</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ctrl<span class="op">.</span>Result<span class="op">{</span>RequeueAfter<span class="op">:</span> time<span class="op">.</span>Minute<span class="op">},</span> <span class="ot">nil</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong>Use Finalizers for Cleanup</strong>: We can add
finalizers in our resources. This helps us manage cleanup before
deletion. It makes sure we free resources correctly.</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">!</span>containsString<span class="op">(</span>instance<span class="op">.</span>GetFinalizers<span class="op">(),</span> finalizerName<span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    instance<span class="op">.</span>SetFinalizers<span class="op">(</span><span class="bu">append</span><span class="op">(</span>instance<span class="op">.</span>GetFinalizers<span class="op">(),</span> finalizerName<span class="op">))</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    err <span class="op">=</span> r<span class="op">.</span>Update<span class="op">(</span>ctx<span class="op">,</span> instance<span class="op">)</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ctrl<span class="op">.</span>Result<span class="op">{},</span> err</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong>Testing and Validation</strong>: We must write unit and
integration tests for our Operator. This checks if it works well. We can
use tools like <code>controller-runtime</code> for testing our
controllers.</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> TestReconcile<span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Setup test environment and assertions</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong>Monitor and Metrics</strong>: We should connect
monitoring tools like Prometheus. This helps us see metrics from our
Operator. It is good for understanding performance and issues in
production.</p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sigs.k8s.io/controller-runtime/pkg/metrics&quot;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;github.com/prometheus/client_golang/prometheus&quot;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div></li>
<li><p><strong>Versioning and Upgrades</strong>: We need to plan for
versioning our CRDs and Operators. This makes sure they work well with
older versions and upgrades are smooth for users.</p></li>
<li><p><strong>Document Your Operator</strong>: We must write clear
documentation for users. It should explain how to deploy and use our
Operator. We can add examples and cases to help understanding.</p></li>
</ol>
<p>By following these best practices, we can make Kubernetes Operators
that are efficient, easy to maintain, and give a good experience for
users. For more info on Kubernetes Operators, we can check <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-operators-and-how-do-they-automate-tasks.html">this
article on Kubernetes Operators</a>.</p>
<h2
id="troubleshooting-common-issues-with-kubernetes-operators">Troubleshooting
Common Issues with Kubernetes Operators</h2>
<p>When we work with Kubernetes Operators, we might face some issues.
Here are some common problems and how we can fix them:</p>
<h3 id="operator-not-responding">1. Operator Not Responding</h3>
<ul>
<li><strong>Check Logs</strong>: We can use
<code>kubectl logs &lt;operator-pod-name&gt;</code> to look at logs for
errors.</li>
<li><strong>Health Checks</strong>: We need to make sure that the
operator’s health checks are passing.</li>
</ul>
<h3 id="crd-custom-resource-definition-issues">2. CRD (Custom Resource
Definition) Issues</h3>
<ul>
<li><strong>CRD Validation</strong>: We should check if the CRDs are
defined correctly. We can use <code>kubectl get crd</code> to see and
check the CRD specifications.</li>
<li><strong>Version Mismatch</strong>: We must ensure the operator and
the CRD versions work well together.</li>
</ul>
<h3 id="incorrect-resource-configuration">3. Incorrect Resource
Configuration</h3>
<ul>
<li><strong>Validation Errors</strong>: We should look for validation
errors in our custom resources. We can do this with
<code>kubectl describe &lt;custom-resource&gt;</code>.</li>
<li><strong>Default Values</strong>: We need to check if default values
are set correctly in the operator’s code when configuration is
missing.</li>
</ul>
<h3 id="operator-crash-looping">4. Operator Crash Looping</h3>
<ul>
<li><strong>Memory Limits</strong>: We should check if resource limits
(cpu/memory) are too low. This can make the operator crash.</li>
<li><strong>Code Errors</strong>: We need to look for unhandled
exceptions in the operator code. We can review logs like we did
before.</li>
</ul>
<h3 id="permissions-issues">5. Permissions Issues</h3>
<ul>
<li><strong>RBAC Configuration</strong>: We must make sure the operator
has the right permissions. We should check the Role and RoleBinding
settings.</li>
</ul>
<div class="sourceCode" id="cb38"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io/v1</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Role</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> &lt;namespace&gt;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;role-name&gt;</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">apiGroups</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">&lt;api-group&gt;</span><span class="kw">]</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resources</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">&lt;resource&gt;</span><span class="kw">]</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">verbs</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;get&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;list&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;watch&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;create&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;update&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;delete&quot;</span><span class="kw">]</span></span></code></pre></div>
<h3 id="deployment-issues">6. Deployment Issues</h3>
<ul>
<li><strong>Pod Status</strong>: We can use
<code>kubectl get pods -n &lt;namespace&gt;</code> to check the status
of the operator pod.</li>
<li><strong>Deployment Configuration</strong>: We should validate the
deployment YAML for any mistakes.</li>
</ul>
<h3 id="api-server-communication-problems">7. API Server Communication
Problems</h3>
<ul>
<li><strong>Network Policies</strong>: We need to check that network
policies are not blocking communication between the operator and the API
server.</li>
<li><strong>Service Accounts</strong>: We must verify that the
operator’s service account has the right permissions.</li>
</ul>
<h3 id="lack-of-event-handling">8. Lack of Event Handling</h3>
<ul>
<li><strong>Watch Mechanism</strong>: We need to make sure the operator
is set up to watch for changes in the resources it manages.</li>
<li><strong>Event Logs</strong>: We can check for events by using
<code>kubectl get events -n &lt;namespace&gt;</code> to see emitted
events.</li>
</ul>
<h3 id="debugging-with-tools">9. Debugging with Tools</h3>
<ul>
<li><strong>Use <code>kubectl</code> Debugging</strong>: We can use
<code>kubectl exec -it &lt;pod-name&gt; -- /bin/sh</code> to get a shell
in the operator pod for debugging in real-time.</li>
<li><strong>Kube-state-metrics</strong>: We should deploy
kube-state-metrics to keep an eye on the state of our Kubernetes
resources and operators.</li>
</ul>
<h3 id="custom-resource-status-not-updating">10. Custom Resource Status
Not Updating</h3>
<ul>
<li><strong>Reconcile Loop</strong>: We need to check if the reconcile
loop in the operator is working properly. We should see if it is
updating the status subresource correctly.</li>
<li><strong>Finalizers</strong>: We must make sure that finalizers are
not stopping the resource from updating.</li>
</ul>
<p>By following these steps, we can troubleshoot and fix common issues
we face when working with Kubernetes Operators. For more details on
Kubernetes best practices, we can read <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-security-best-practices.html">Kubernetes
Security Best Practices</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="what-is-a-kubernetes-operator">1. What is a Kubernetes
Operator?</h3>
<p>A Kubernetes Operator is a way to package, deploy, and manage a
Kubernetes application. It makes the Kubernetes API better by adding
custom resources and controllers for complex stateful apps. Operators
help us automate tasks like deployment, scaling, and backup. This gives
us a simple and repeatable way to manage apps on Kubernetes. For more
details about Kubernetes and its parts, check <a
href="https://bestonlinetutorial.com/kubernetes/what-are-the-key-components-of-a-kubernetes-cluster.html">what
are the key components of a Kubernetes cluster</a>.</p>
<h3 id="why-should-i-use-kubernetes-operators">2. Why should I use
Kubernetes Operators?</h3>
<p>Kubernetes Operators help us manage complex apps easily. They
automate regular tasks. This means we can handle lifecycle management
like installation, upgrades, and recovery from failures. This makes it
easier for our teams. We can focus more on building apps instead of
managing the infrastructure. For more on why Kubernetes is useful, visit
<a
href="https://bestonlinetutorial.com/kubernetes/why-should-i-use-kubernetes-for-my-applications.html">why
should I use Kubernetes for my applications</a>.</p>
<h3 id="how-do-i-create-a-kubernetes-operator">3. How do I create a
Kubernetes Operator?</h3>
<p>To create a Kubernetes Operator, we use the Operator SDK. This makes
the development process easier. First, we define a custom resource for
our application. Then, we write the controller logic to manage that
resource’s lifecycle. The SDK gives us tools and libraries to build,
test, and package our Operator easily. For more help, see <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-deploy-a-simple-web-application-on-kubernetes.html">how
do I deploy a simple web application on Kubernetes</a>.</p>
<h3 id="can-kubernetes-operators-be-used-for-monitoring">4. Can
Kubernetes Operators be used for monitoring?</h3>
<p>Yes, we can use Kubernetes Operators for monitoring apps. They help
us automatically deploy monitoring tools and manage their settings. They
make sure that monitoring agents are running, collecting data, and
sending alerts on problems. This helps us see how our apps perform in a
Kubernetes cluster better. For more on monitoring, check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">how
do I monitor my Kubernetes cluster</a>.</p>
<h3
id="what-are-some-best-practices-for-developing-kubernetes-operators">5.
What are some best practices for developing Kubernetes Operators?</h3>
<p>When we develop Kubernetes Operators, we should follow some best
practices. It is important to stick to the Operator pattern. We should
also keep idempotency and have good error handling. Also, we must use
proper logging and monitoring to see how the Operator works in
production. For a good guide on making efficient Operators, refer to <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-quotas-and-how-do-i-use-them.html">best
practices for developing Kubernetes Operators</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            