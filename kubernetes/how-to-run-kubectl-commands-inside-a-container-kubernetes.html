
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            
            <title>How to run kubectl commands inside a container? - kubernetes</title>
            <meta name="description" content="Learn how to run kubectl commands inside a container with our step-by-step guide. Master Kubernetes efficiently today!">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How to run kubectl commands inside a container? - kubernetes</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>Running kubectl commands inside a container in Kubernetes is
important for managing resources well. We can do this by installing the
kubectl tool in our container. This way, we can run commands just like
we do on our local machine. Using kubectl in a container helps us to
make operations easier, automate tasks, and improve our Kubernetes
management skills.</p>
<p>In this article, we will talk about different ways and best practices
to run kubectl commands inside a container. We will look at what we need
to do before running kubectl inside a container. Then, we will show how
to create a Docker container with kubectl installed. We will also
explain how to use a Kubernetes Job to run these commands. Moreover, we
will see how to access kubectl in a Kubernetes Pod and set up the
kubectl context inside a container. Finally, we will answer some common
questions about this process.</p>
<ul>
<li>How to run kubectl commands inside a container in Kubernetes</li>
<li>Prerequisites for running kubectl inside a container</li>
<li>Creating a Docker container with kubectl installed</li>
<li>Using a Kubernetes Job to run kubectl commands inside a
container</li>
<li>Accessing kubectl in a Kubernetes Pod</li>
<li>Configuring kubectl context inside a container</li>
<li>Frequently Asked Questions</li>
</ul>
<p>For more information about Kubernetes and its parts, we can read
about <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubernetes-and-how-does-it-simplify-container-management.html">what
Kubernetes is and how it simplifies container management</a> or <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-set-up-a-kubernetes-cluster-on-aws-eks.html">how
to set up a Kubernetes cluster on AWS EKS</a>.</p>
<h2
id="what-are-the-prerequisites-for-running-kubectl-inside-a-container">What
are the prerequisites for running kubectl inside a container?</h2>
<p>To run <code>kubectl</code> commands inside a container in
Kubernetes, we need to check some important things:</p>
<ol type="1">
<li><p><strong>Container Image</strong>: The container image must have
<code>kubectl</code> installed. This can be a custom image that we build
with a Dockerfile or an existing image that already includes
<code>kubectl</code>.</p></li>
<li><p><strong>Kubernetes Context</strong>: We need a valid
<code>kubeconfig</code> file. This file has the information to connect
to the Kubernetes cluster. It should be inside the container or we can
mount it as a volume.</p></li>
<li><p><strong>Network Access</strong>: The container must connect to
the Kubernetes API server. This usually means running the container
inside the same cluster. If we run it outside, we must make sure the
network is set up correctly.</p></li>
<li><p><strong>RBAC Permissions</strong>: We should check that the
service account for the pod or container has the right Role-Based Access
Control (RBAC) permissions. This permission allows us to run the
<code>kubectl</code> commands we want.</p></li>
<li><p><strong>Environment Variables</strong>: If we need to, we should
set environment variables like <code>KUBECONFIG</code>. This variable
tells where to find the kubeconfig file inside the container.</p></li>
<li><p><strong>Access to Required Tools</strong>: If the
<code>kubectl</code> commands need other Kubernetes tools, like
<code>jq</code> for JSON parsing, we need to install those tools and
make sure they work inside the container.</p></li>
</ol>
<p>Here is an example Dockerfile to create an image with
<code>kubectl</code> installed:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> alpine:3.12</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Install curl and kubectl</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apk</span> add <span class="at">--no-cache</span> curl <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">curl</span> <span class="at">-LO</span> <span class="st">&quot;https://storage.googleapis.com/kubernetes-release/release/</span><span class="va">$(</span><span class="ex">curl</span> <span class="at">-s</span> https://storage.googleapis.com/kubernetes-release/release/stable.txt<span class="va">)</span><span class="st">/bin/linux/amd64/kubectl&quot;</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">chmod</span> +x ./kubectl <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mv</span> ./kubectl /usr/local/bin/kubectl</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy kubeconfig if needed</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># COPY ./kubeconfig /root/.kube/config</span></span></code></pre></div>
<p>This Dockerfile installs <code>kubectl</code> in a container based on
Alpine. We can change it more based on what we need. For more details
about <code>kubectl</code> and how to use it, we can check <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubectl-and-how-do-i-use-it-to-manage-kubernetes.html">What
is kubectl and how do I use it to manage Kubernetes?</a>.</p>
<h2 id="how-to-create-a-docker-container-with-kubectl-installed">How to
create a Docker container with kubectl installed?</h2>
<p>To create a Docker container with <code>kubectl</code>, we need to
make a Dockerfile. This file tells Docker which base image to use and
how to install <code>kubectl</code>. Below is a simple example that uses
a Debian-based image.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use a base image</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> debian:latest</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Install curl and other dependencies</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> install <span class="at">-y</span> curl apt-transport-https <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">curl</span> <span class="at">-s</span> https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class="kw">|</span> <span class="ex">apt-key</span> add <span class="at">-</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;deb https://apt.kubernetes.io/ kubernetes-xenial main&quot;</span> <span class="op">&gt;</span> /etc/apt/sources.list.d/kubernetes.list <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> install <span class="at">-y</span> kubectl <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> clean <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="at">-rf</span> /var/lib/apt/lists/<span class="pp">*</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the entrypoint to kubectl</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="kw">ENTRYPOINT</span> [<span class="st">&quot;kubectl&quot;</span>]</span></code></pre></div>
<h3 id="build-the-docker-image">Build the Docker Image</h3>
<p>We run the next command in the folder where our Dockerfile is.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> my-kubectl-container .</span></code></pre></div>
<h3 id="run-the-docker-container">Run the Docker Container</h3>
<p>To run the container and use <code>kubectl</code>, we can use this
command:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--rm</span> my-kubectl-container /bin/bash</span></code></pre></div>
<h3 id="verify-kubectl-installation">Verify kubectl Installation</h3>
<p>After we get inside the container, we check if <code>kubectl</code>
is installed. We run:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> version <span class="at">--client</span></span></code></pre></div>
<p>This command will show us that <code>kubectl</code> is installed and
ready to use in our Docker container. Then we can set it up to work with
our Kubernetes cluster. We can do this by using our kubeconfig file or
by setting the right environment variables.</p>
<p>For more details on using <code>kubectl</code>, check out <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubectl-and-how-do-i-use-it-to-manage-kubernetes.html">What
is kubectl and how do I use it to manage Kubernetes?</a>.</p>
<h2
id="how-to-use-a-kubernetes-job-to-run-kubectl-commands-inside-a-container">How
to use a Kubernetes Job to run kubectl commands inside a container?</h2>
<p>We can run <code>kubectl</code> commands inside a container with a
Kubernetes Job. We need to define a Job resource in a YAML file. This
helps us execute commands in a pod that we create just for this task. It
makes sure that the commands run in a safe environment.</p>
<p>Here is an example of how to create a Kubernetes Job to run
<code>kubectl</code> commands inside a container:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> batch/v1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Job</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubectl-job</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubectl-container</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> bitnami/kubectl:latest</span><span class="co">  # We use an image with kubectl installed</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;kubectl&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;get&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;pods&quot;</span><span class="kw">]</span><span class="co">  # We can change this to our command</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">        # We can also set environment variables or mount a volume with kubeconfig</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> KUBECONFIG</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;/path/to/kubeconfig&quot;</span><span class="co">  # Path to kubeconfig if we need it</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">restartPolicy</span><span class="kw">:</span><span class="at"> Never</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">backoffLimit</span><span class="kw">:</span><span class="at"> </span><span class="dv">4</span></span></code></pre></div>
<h3 id="steps-to-deploy-the-job">Steps to Deploy the Job</h3>
<ol type="1">
<li><p><strong>Save the YAML</strong>: We save the above YAML to a file
called <code>kubectl-job.yaml</code>.</p></li>
<li><p><strong>Apply the Job</strong>: We run this command to create the
Job in our Kubernetes cluster:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> kubectl-job.yaml</span></code></pre></div></li>
<li><p><strong>Check Job Status</strong>: We can monitor the Job and
check the status of the pod created by it:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get jobs</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">--selector</span><span class="op">=</span>job-name=kubectl-job</span></code></pre></div></li>
<li><p><strong>View Logs</strong>: If we want to see the output of our
<code>kubectl</code> command, we fetch the logs from the pod:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="op">&lt;</span>pod-name<span class="op">&gt;</span></span></code></pre></div></li>
</ol>
<p>This setup helps us run any <code>kubectl</code> command in the safe
space of a Job. It is good for tasks like batch processing or running
one-time commands. It is important to make sure that the container image
has <code>kubectl</code> installed and set up right to connect with our
Kubernetes cluster. For more about using <code>kubectl</code>, we can
check <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubectl-and-how-do-i-use-it-to-manage-kubernetes.html">this
guide</a>.</p>
<h2 id="how-to-access-kubectl-in-a-kubernetes-pod">How to access kubectl
in a Kubernetes Pod?</h2>
<p>To access <code>kubectl</code> in a Kubernetes Pod, we need to make
sure the Pod has the right permissions and setup to run
<code>kubectl</code> commands. Letâ€™s see how we can do this.</p>
<ol type="1">
<li><p><strong>Create a Pod with kubectl Installed</strong>:<br />
We should use an image that has <code>kubectl</code>. We can use an
official Kubernetes image or make our own Docker image with
<code>kubectl</code> installed.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubectl-pod</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubectl-container</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> bitnami/kubectl:latest</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;/bin/sh&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;-c&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;sleep 3600&quot;</span><span class="kw">]</span></span></code></pre></div>
<p>Now we apply this configuration:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> kubectl-pod.yaml</span></code></pre></div></li>
<li><p><strong>Access the Pod</strong>:<br />
We will use <code>kubectl exec</code> to get into the Pod and run
commands there.</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> exec <span class="at">-it</span> kubectl-pod <span class="at">--</span> /bin/sh</span></code></pre></div></li>
<li><p><strong>Configure kubectl</strong>:<br />
Inside the Pod, we may need to set up <code>kubectl</code> to connect to
the Kubernetes API server. The default config file is at
<code>/root/.kube/config</code>. If we use a service account, we can
mount the service account token and CA certificate.</p>
<p>Here is an example of how to mount service account credentials:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubectl-pod</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubectl-container</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> bitnami/kubectl:latest</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;/bin/sh&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;-c&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;sleep 3600&quot;</span><span class="kw">]</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumeMounts</span><span class="kw">:</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kube-config</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">mountPath</span><span class="kw">:</span><span class="at"> /root/.kube</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kube-config</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">projected</span><span class="kw">:</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">sources</span><span class="kw">:</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">serviceAccountToken</span><span class="kw">:</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">path</span><span class="kw">:</span><span class="at"> token</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">configMap</span><span class="kw">:</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubeconfig</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">items</span><span class="kw">:</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">key</span><span class="kw">:</span><span class="at"> kubeconfig</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">path</span><span class="kw">:</span><span class="at"> config</span></span></code></pre></div></li>
<li><p><strong>Run kubectl Commands</strong>:<br />
After we access the Pod and check that <code>kubectl</code> is set up,
we can run <code>kubectl</code> commands like:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods</span></code></pre></div></li>
</ol>
<p>This way, we can run <code>kubectl</code> commands from inside a
Kubernetes Pod. This helps us manage and debug our Kubernetes resources
right from the Pod. For more info on managing Kubernetes resources,
check out <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubectl-and-how-do-i-use-it-to-manage-kubernetes.html">what
is kubectl and how do I use it to manage Kubernetes</a>.</p>
<h2 id="how-to-configure-kubectl-context-inside-a-container">How to
configure kubectl context inside a container?</h2>
<p>To configure <code>kubectl</code> context inside a container, we can
follow some simple steps.</p>
<ol type="1">
<li><p><strong>Install kubectl in the Container</strong>: First, we need
to make sure that <code>kubectl</code> is installed in our container. If
we are using a Dockerfile, we can add these lines to install
<code>kubectl</code>:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> alpine:latest</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apk</span> add <span class="at">--no-cache</span> curl <span class="dt">\</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="ex">curl</span> <span class="at">-LO</span> <span class="st">&quot;https://storage.googleapis.com/kubernetes-release/release/</span><span class="va">$(</span><span class="ex">curl</span> <span class="at">-s</span> https://storage.googleapis.com/kubernetes-release/release/stable.txt<span class="va">)</span><span class="st">/bin/linux/amd64/kubectl&quot;</span> <span class="dt">\</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">chmod</span> +x ./kubectl <span class="dt">\</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">mv</span> ./kubectl /usr/local/bin/kubectl</span></code></pre></div></li>
<li><p><strong>Set Up the Kubernetes Configuration</strong>: Next, we
need to provide a Kubernetes config file. This file is usually at
<code>~/.kube/config</code>. It has the needed context information. We
can copy this file into our container or mount it as a volume.</p>
<p>To copy the config file, we can use this command in our
Dockerfile:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> config /root/.kube/config</span></code></pre></div>
<p>Or, if we want to use a volume, we can run:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-v</span> <span class="va">$HOME</span>/.kube:/root/.kube your-container-image</span></code></pre></div></li>
<li><p><strong>Verify the Context</strong>: After we set up the config
file, we can check the current context inside the container by
running:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> config current-context</span></code></pre></div></li>
<li><p><strong>Switch Contexts</strong>: If we need to change contexts,
we can use:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> config use-context <span class="op">&lt;</span>context-name<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Environment Variables</strong>: If we like to set the
kubeconfig path as an environment variable, we can do this by
running:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">KUBECONFIG</span><span class="op">=</span>/path/to/your/kubeconfig</span></code></pre></div></li>
</ol>
<p>By following these steps, we will configure the <code>kubectl</code>
context inside our container. For more details on using
<code>kubectl</code>, we can check <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubectl-and-how-do-i-use-it-to-manage-kubernetes.html">this
detailed guide</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3
id="can-we-run-kubectl-commands-inside-a-running-container-in-kubernetes">1.
Can we run kubectl commands inside a running container in
Kubernetes?</h3>
<p>Yes, we can run kubectl commands inside a running container in
Kubernetes. This is helpful for doing admin tasks or fixing issues right
from a pod. To do this, we need to make sure that the container has
kubectl installed. It also needs the right permissions to work with the
Kubernetes API.</p>
<h3
id="what-are-the-best-practices-for-running-kubectl-inside-a-container">2.
What are the best practices for running kubectl inside a container?</h3>
<p>When we run kubectl inside a container, we should use a small image
but include all the tools we need. We should use a service account that
has limited permissions to keep things safe. Also, we need to set up the
kubeconfig correctly. This helps kubectl know the right cluster and
namespace to use. This way, we can run commands safely and
efficiently.</p>
<h3 id="how-do-we-install-kubectl-in-a-kubernetes-pod">3. How do we
install kubectl in a Kubernetes Pod?</h3>
<p>To install kubectl in a Kubernetes Pod, we can make a Dockerfile that
has the commands we need to install it. For example, we can start with a
base image like <code>alpine</code> and run commands to get kubectl.
This helps us create a custom image that fits our needs.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> alpine:latest</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apk</span> add <span class="at">--no-cache</span> curl <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">curl</span> <span class="at">-LO</span> <span class="st">&quot;https://storage.googleapis.com/kubernetes-release/release/</span><span class="va">$(</span><span class="ex">curl</span> <span class="at">-s</span> https://storage.googleapis.com/kubernetes-release/release/stable.txt<span class="va">)</span><span class="st">/bin/linux/amd64/kubectl&quot;</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">chmod</span> +x ./kubectl <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mv</span> ./kubectl /usr/local/bin/</span></code></pre></div>
<h3 id="how-can-we-access-the-kubeconfig-file-in-a-container">4. How can
we access the kubeconfig file in a container?</h3>
<p>To access the kubeconfig file in a container, we can mount it from
our local machine into the container when it runs. We can use a volume
mount in our Pod specification to do this. This allows kubectl to use
the kubeconfig for logging in and reaching the Kubernetes API.</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubectl-pod</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubectl-container</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my-kubectl-image</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumeMounts</span><span class="kw">:</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubeconfig-volume</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">mountPath</span><span class="kw">:</span><span class="at"> /root/.kube</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubeconfig-volume</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">hostPath</span><span class="kw">:</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /path/to/your/kubeconfig</span></span></code></pre></div>
<h3
id="what-permissions-are-needed-for-kubectl-to-work-inside-a-container">5.
What permissions are needed for kubectl to work inside a container?</h3>
<p>For kubectl to work well inside a container, the service account we
use needs to have the right permissions for the tasks we want to do. We
can do this by making a Role or ClusterRole that gives specific
permissions and linking it to the service account. This is very
important to keep things secure while allowing access to Kubernetes
resources.</p>
<p>For more information about Kubernetes and kubectl, check <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubectl-and-how-do-i-use-it-to-manage-kubernetes.html">this
guide</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            