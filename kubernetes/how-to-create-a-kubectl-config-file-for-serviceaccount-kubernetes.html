
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            
            <title>How to create a kubectl config file for serviceaccount - kubernetes</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "BestOnlineTutorial",
      "url": "https://www.bestonlinetutorial.com/"
    }
    </script>

<!-- Common CSS & Icons -->
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
<link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
<link rel="stylesheet" href="/assets/css/post.css">
            <meta name="description" content="Learn how to create a kubectl config file for a Kubernetes service account with our step-by-step guide and expert tips.">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How to create a kubectl config file for serviceaccount - kubernetes</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>To make a <code>kubectl</code> config file for a ServiceAccount in
Kubernetes, we need to do a few simple steps. First, we create a
ServiceAccount. Then, we get the token and CA certificate linked to it.
After that, we build a <code>kubectl</code> config file. This file helps
us to access the Kubernetes cluster safely with that ServiceAccount.
This is important for managing Kubernetes resources in a secure way.</p>
<p>In this article, we will explain how to create a <code>kubectl</code>
config file for a ServiceAccount in Kubernetes. We will talk about these
topics:</p>
<ul>
<li>What is Kubernetes ServiceAccount and what does it do</li>
<li>How to generate a ServiceAccount in Kubernetes</li>
<li>How to get the ServiceAccount Token and CA Certificate</li>
<li>How to create a <code>kubectl</code> Config File for
ServiceAccount</li>
<li>How to check the <code>kubectl</code> Config File for
ServiceAccount</li>
<li>Common Questions about Kubernetes ServiceAccount and
<code>kubectl</code> settings</li>
</ul>
<p>With this information, we will be ready to manage our Kubernetes
resources using ServiceAccounts. If you want to learn more about
Kubernetes basics, we can read articles like <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubernetes-and-how-does-it-simplify-container-management.html">What
is Kubernetes and How Does it Simplify Container Management?</a> and <a
href="https://bestonlinetutorial.com/kubernetes/how-does-kubernetes-differ-from-docker-swarm.html">How
Does Kubernetes Differ from Docker Swarm?</a>.</p>
<h2
id="understanding-the-kubernetes-serviceaccount-and-its-role">Understanding
the Kubernetes ServiceAccount and its Role</h2>
<p>In Kubernetes, a ServiceAccount gives an identity to processes that
run in a Pod. We can use this identity for applications to work with the
Kubernetes API. Here are some important points about
ServiceAccounts:</p>
<ul>
<li><strong>Automatic Token Creation</strong>: When we create a
ServiceAccount, Kubernetes makes a token for us. We use this token for
authentication.</li>
<li><strong>Namespace Scope</strong>: ServiceAccounts belong to a
namespace. This means they can only be used in the namespace where we
created them.</li>
<li><strong>Role-Based Access Control (RBAC)</strong>: We can give roles
and permissions to ServiceAccounts using RBAC. This helps us control who
can access resources in the cluster.</li>
<li><strong>Default ServiceAccount</strong>: Every namespace has a
default ServiceAccount. Pods that do not choose a specific one will use
this default.</li>
</ul>
<p>To create a ServiceAccount, we can use this command:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create serviceaccount <span class="op">&lt;</span>serviceaccount-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div>
<p>To see the existing ServiceAccounts in a namespace, we can run:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get serviceaccounts <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div>
<p>ServiceAccounts are very important for keeping Kubernetes
applications safe. They give a controlled way for Pods to access the
Kubernetes API. For more details on managing access with RBAC, we can
check this link: <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-implement-role-based-access-control-rbac-in-kubernetes.html">implementing
role-based access control (RBAC) in Kubernetes</a>.</p>
<h2 id="generating-a-serviceaccount-in-kubernetes">Generating a
ServiceAccount in Kubernetes</h2>
<p>We can generate a ServiceAccount in Kubernetes using the
<code>kubectl</code> command-line tool. A ServiceAccount gives an
identity to processes that run in a Pod. This helps them to talk to the
Kubernetes API.</p>
<p>Let’s see how to create a ServiceAccount step by step.</p>
<ol type="1">
<li><strong>Create a YAML file for the ServiceAccount</strong>. You can
name it <code>serviceaccount.yaml</code>:</li>
</ol>
<div class="sourceCode" id="cb3"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ServiceAccount</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-serviceaccount</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> default</span></span></code></pre></div>
<ol start="2" type="1">
<li><strong>Apply the YAML file to make the
ServiceAccount</strong>:</li>
</ol>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> serviceaccount.yaml</span></code></pre></div>
<ol start="3" type="1">
<li><strong>Check if the ServiceAccount is created</strong>:</li>
</ol>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get serviceaccounts <span class="at">-n</span> default</span></code></pre></div>
<p>This command will show a list of ServiceAccounts in the default
namespace. You will see <code>my-serviceaccount</code> in the list.</p>
<p>If you want to learn more about Kubernetes ServiceAccounts and their
roles, you can read <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-pods-and-how-do-i-work-with-them.html">this
article on Kubernetes ServiceAccounts</a>.</p>
<h2
id="extracting-the-serviceaccount-token-and-ca-certificate">Extracting
the ServiceAccount Token and CA Certificate</h2>
<p>To get the token and CA certificate from a Kubernetes ServiceAccount,
we can follow these steps.</p>
<ol type="1">
<li><p><strong>Get the ServiceAccount Name</strong>: First, we need to
find the ServiceAccount we created. For example, if we have a
ServiceAccount called <code>my-serviceaccount</code> in the
<code>default</code> namespace, we can run this command:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get serviceaccount my-serviceaccount <span class="at">-n</span> default</span></code></pre></div></li>
<li><p><strong>Get the Secret for the ServiceAccount</strong>: Each
ServiceAccount makes a Secret that has the token. We use this command to
find the Secret:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get serviceaccounts my-serviceaccount <span class="at">-o</span> jsonpath=<span class="st">&#39;{.secrets[0].name}&#39;</span> <span class="at">-n</span> default</span></code></pre></div></li>
<li><p><strong>Extract the Token</strong>: Now we use the Secret name we
got before to get the token:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get secret <span class="op">&lt;</span>secret-name<span class="op">&gt;</span> -o jsonpath=<span class="st">&#39;{.data.token}&#39;</span> <span class="at">-n</span> default <span class="kw">|</span> <span class="fu">base64</span> <span class="at">--decode</span></span></code></pre></div></li>
<li><p><strong>Extract the CA Certificate</strong>: We can also get the
CA certificate from the same Secret. We use this command:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get secret <span class="op">&lt;</span>secret-name<span class="op">&gt;</span> -o jsonpath=<span class="st">&#39;{.data.ca\.crt}&#39;</span> <span class="at">-n</span> default <span class="kw">|</span> <span class="fu">base64</span> <span class="at">--decode</span></span></code></pre></div></li>
<li><p><strong>Use the Token and CA Certificate</strong>: Now we can use
the token and CA certificate to log in to the Kubernetes API.</p></li>
</ol>
<p>This method helps us to safely access the Kubernetes API with the
ServiceAccount. It makes automation and working with our Kubernetes
cluster easier.</p>
<h2 id="creating-a-kubectl-config-file-for-serviceaccount">Creating a
kubectl Config File for ServiceAccount</h2>
<p>To make a <code>kubectl</code> config file for a ServiceAccount in
Kubernetes, we can follow these steps:</p>
<ol type="1">
<li><p><strong>Create a ServiceAccount</strong>: First, we need a
ServiceAccount. We can create one using this command:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create serviceaccount <span class="op">&lt;</span>serviceaccount-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Assign Permissions</strong>: If the ServiceAccount needs
special permissions, we create a Role and a RoleBinding. For example, to
allow the ServiceAccount to read pods:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io/v1</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Role</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> &lt;namespace&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;role-name&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">apiGroups</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;&quot;</span><span class="kw">]</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resources</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;pods&quot;</span><span class="kw">]</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">verbs</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;get&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;list&quot;</span><span class="kw">]</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> role.yaml</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create rolebinding <span class="op">&lt;</span>binding-name<span class="op">&gt;</span> --role=<span class="op">&lt;</span>role-name<span class="op">&gt;</span> --serviceaccount=<span class="op">&lt;</span>namespace<span class="op">&gt;</span>:<span class="op">&lt;</span>serviceaccount-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Extract the ServiceAccount Token</strong>: We can get the
token that belongs to the ServiceAccount with this command:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="va">SECRET_NAME</span><span class="op">=</span><span class="va">$(</span><span class="ex">kubectl</span> get serviceaccount <span class="op">&lt;</span>serviceaccount-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span> -o jsonpath=<span class="st">&#39;{.secrets[0].name}&#39;</span><span class="va">)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="va">TOKEN</span><span class="op">=</span><span class="va">$(</span><span class="ex">kubectl</span> get secret <span class="va">$SECRET_NAME</span> <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span> -o jsonpath=<span class="st">&#39;{.data.token}&#39;</span> <span class="kw">|</span> <span class="fu">base64</span> <span class="at">--decode</span><span class="va">)</span></span></code></pre></div></li>
<li><p><strong>Extract the CA Certificate</strong>: We need to get the
CA certificate:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="va">CA_CERT</span><span class="op">=</span><span class="va">$(</span><span class="ex">kubectl</span> get secret <span class="va">$SECRET_NAME</span> <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span> -o jsonpath=<span class="st">&#39;{.data.ca\.crt}&#39;</span> <span class="kw">|</span> <span class="fu">base64</span> <span class="at">--decode</span><span class="va">)</span></span></code></pre></div></li>
<li><p><strong>Get the Kubernetes API Server URL</strong>: We can find
the API server URL by running:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> config view <span class="at">--minify</span> <span class="at">-o</span> jsonpath=<span class="st">&#39;{.clusters[0].cluster.server}&#39;</span></span></code></pre></div></li>
<li><p><strong>Create the <code>kubectl</code> Config File</strong>:
Using the information we got, we can make a config file
(<code>~/.kube/config</code>) or a different file if we need:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">clusters</span><span class="kw">:</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">cluster</span><span class="kw">:</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">server</span><span class="kw">:</span><span class="at"> &lt;api-server-url&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">certificate-authority-data</span><span class="kw">:</span><span class="at"> &lt;base64-ca-cert&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;cluster-name&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">contexts</span><span class="kw">:</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">context</span><span class="kw">:</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">cluster</span><span class="kw">:</span><span class="at"> &lt;cluster-name&gt;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">user</span><span class="kw">:</span><span class="at"> &lt;serviceaccount-name&gt;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;context-name&gt;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">current-context</span><span class="kw">:</span><span class="at"> &lt;context-name&gt;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Config</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="fu">preferences</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="fu">users</span><span class="kw">:</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;serviceaccount-name&gt;</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">user</span><span class="kw">:</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">token</span><span class="kw">:</span><span class="at"> &lt;base64-token&gt;</span></span></code></pre></div>
<p>We should replace placeholders with real values.</p></li>
<li><p><strong>Verify the Config File</strong>: We can test the config
with:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> <span class="at">--kubeconfig</span><span class="op">=&lt;</span>path-to-config-file<span class="op">&gt;</span> get pods <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
</ol>
<p>This process helps us to create a <code>kubectl</code> config file
for a ServiceAccount. It allows the ServiceAccount to work with our
Kubernetes cluster safely. For more details on Kubernetes
ServiceAccounts, we can check <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubernetes-and-how-does-it-simplify-container-management.html">Kubernetes
ServiceAccount documentation</a>.</p>
<h2 id="verifying-the-kubectl-config-file-for-serviceaccount">Verifying
the kubectl Config File for ServiceAccount</h2>
<p>To check a <code>kubectl</code> config file for a ServiceAccount in
Kubernetes, we can follow some simple steps.</p>
<ol type="1">
<li><p><strong>Check the Configuration</strong>: First, we need to make
sure that the <code>kubectl</code> config file has the important parts.
These parts are: <code>apiVersion</code>, <code>clusters</code>,
<code>contexts</code>, <code>current-context</code>, and
<code>users</code>.</p>
<p>Here is an example of a good config file:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">clusters</span><span class="kw">:</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">cluster</span><span class="kw">:</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">server</span><span class="kw">:</span><span class="at"> https://&lt;KUBE_API_SERVER&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">certificate-authority-data</span><span class="kw">:</span><span class="at"> &lt;CA_CERTIFICATE_DATA&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-cluster</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">contexts</span><span class="kw">:</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">context</span><span class="kw">:</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">cluster</span><span class="kw">:</span><span class="at"> my-cluster</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">user</span><span class="kw">:</span><span class="at"> my-serviceaccount</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-context</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">current-context</span><span class="kw">:</span><span class="at"> my-context</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="fu">users</span><span class="kw">:</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-serviceaccount</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">user</span><span class="kw">:</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">token</span><span class="kw">:</span><span class="at"> &lt;SERVICE_ACCOUNT_TOKEN&gt;</span></span></code></pre></div></li>
<li><p><strong>Validate the Context</strong>: Next, we can run this
command to check if the context is set right:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> config current-context</span></code></pre></div></li>
<li><p><strong>Test Access</strong>: To see if the ServiceAccount has
the right permissions, we can run a simple command like this:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">--context</span><span class="op">=</span>my-context</span></code></pre></div>
<p>If the ServiceAccount is set up right, we should see a list of pods
or a message that fits its permissions.</p></li>
<li><p><strong>Inspect the Token</strong>: If we get errors about
access, we should check if the ServiceAccount token is still good by
running:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$TOKEN</span> <span class="kw">|</span> <span class="fu">base64</span> <span class="at">--decode</span></span></code></pre></div>
<p>We also need to make sure that the token is correctly written in our
config file.</p></li>
<li><p><strong>Check Cluster Connectivity</strong>: We should confirm
that we can connect to the Kubernetes API server by running:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> cluster-info</span></code></pre></div></li>
<li><p><strong>Debugging Errors</strong>: If we have problems, we can
make the output more detailed to understand better:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">--context</span><span class="op">=</span>my-context <span class="at">--v</span><span class="op">=</span>8</span></code></pre></div></li>
</ol>
<p>By following these steps, we can make sure that the
<code>kubectl</code> config file for the ServiceAccount is set up right
and works as we expect.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="what-is-a-kubernetes-serviceaccount-used-for">1. What is a
Kubernetes ServiceAccount used for?</h3>
<p>A Kubernetes ServiceAccount gives an identity to processes that run
in a Pod. This helps applications to talk to the Kubernetes API safely
without needing hard-coded credentials. By using ServiceAccounts, we can
manage permissions better with Role-Based Access Control. This makes our
Kubernetes setup more secure and easier to handle. For more on RBAC,
check this <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-implement-role-based-access-control-rbac-in-kubernetes.html">guide
on implementing Role-Based Access Control in Kubernetes</a>.</p>
<h3 id="how-do-i-create-a-serviceaccount-in-kubernetes">2. How do I
create a ServiceAccount in Kubernetes?</h3>
<p>Creating a ServiceAccount in Kubernetes is simple. We can use this
command to create one:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create serviceaccount <span class="op">&lt;</span>serviceaccount-name<span class="op">&gt;</span></span></code></pre></div>
<p>Just replace <code>&lt;serviceaccount-name&gt;</code> with the name
we want. We can then use this ServiceAccount in our Pods to give the app
the right permissions to work with Kubernetes resources. For more
details, we can look at the <a
href="https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/">Kubernetes
documentation</a>.</p>
<h3 id="how-can-i-extract-the-serviceaccount-token">3. How can I extract
the ServiceAccount token?</h3>
<p>To get the ServiceAccount token in Kubernetes, we can run this
command:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get secret <span class="va">$(</span><span class="ex">kubectl</span> get serviceaccount <span class="op">&lt;</span>serviceaccount-name<span class="op">&gt;</span> -o jsonpath=<span class="st">&quot;{.secrets[0].name}&quot;</span><span class="va">)</span> <span class="at">-o</span> jsonpath=<span class="st">&quot;{.data.token}&quot;</span> <span class="kw">|</span> <span class="fu">base64</span> <span class="at">--decode</span></span></code></pre></div>
<p>This command gets the token for a specific ServiceAccount. This token
helps our apps to log in to the Kubernetes API. Also, we can check the
steps in the article for getting the CA certificate.</p>
<h3 id="how-do-i-create-a-kubectl-config-file-for-a-serviceaccount">4.
How do I create a kubectl config file for a ServiceAccount?</h3>
<p>To make a <code>kubectl</code> config file for a ServiceAccount, we
need to collect the ServiceAccount token and CA certificate, and then
put them in kubeconfig format. Here is a simple example:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Config</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">clusters</span><span class="kw">:</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">cluster</span><span class="kw">:</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">server</span><span class="kw">:</span><span class="at"> https://&lt;kubernetes-api-server&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">certificate-authority-data</span><span class="kw">:</span><span class="at"> &lt;CA-Certificate-Data&gt;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;cluster-name&gt;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">contexts</span><span class="kw">:</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">context</span><span class="kw">:</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">cluster</span><span class="kw">:</span><span class="at"> &lt;cluster-name&gt;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">user</span><span class="kw">:</span><span class="at"> &lt;serviceaccount-name&gt;</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;context-name&gt;</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="fu">current-context</span><span class="kw">:</span><span class="at"> &lt;context-name&gt;</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="fu">users</span><span class="kw">:</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;serviceaccount-name&gt;</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">user</span><span class="kw">:</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">token</span><span class="kw">:</span><span class="at"> &lt;token-data&gt;</span></span></code></pre></div>
<p>Make sure to change the placeholders with the real data from our
ServiceAccount. For more on <code>kubectl</code> commands, we can check
this <a
href="https://bestonlinetutorial.com/kubernetes/what-are-essential-kubectl-commands-i-should-know.html">guide
on essential kubectl commands</a>.</p>
<h3 id="how-do-i-verify-my-kubectl-config-file-for-serviceaccount">5.
How do I verify my kubectl config file for ServiceAccount?</h3>
<p>To check our <code>kubectl</code> config file for the ServiceAccount,
we can use this command:</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> <span class="at">--kubeconfig</span><span class="op">=&lt;</span>path-to-kubeconfig-file<span class="op">&gt;</span> get pods</span></code></pre></div>
<p>If everything is set up right, this command should give us the list
of Pods in the namespace we chose. Don’t forget to change
<code>&lt;path-to-kubeconfig-file&gt;</code> with the real path to our
config file. This helps us to make sure that our ServiceAccount has the
right permissions to access the resources in our Kubernetes cluster. For
help with common problems, look at this <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-troubleshoot-issues-in-my-kubernetes-deployments.html">guide
on troubleshooting Kubernetes deployments</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            