
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            
            <title>Kubernetes how to make Deployment to update image - kubernetes</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Common CSS & Icons -->
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
<link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
<link rel="stylesheet" href="/assets/css/post.css">
            <meta name="description" content="Learn how to update your Kubernetes Deployment image effortlessly with our step-by-step guide. Optimize your container management!">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">Kubernetes how to make Deployment to update image - kubernetes</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>To update an image in a Kubernetes Deployment, we can use the
<code>kubectl set image</code> command. This command helps us to easily
choose the new image for our app. It changes the Deployment’s settings
directly. Then, it starts a rolling update of the app without any
downtime. By using this way, we make sure the new image gets deployed
well and our running app stays stable.</p>
<p>In this article, we will look at different ways to update images in
Kubernetes Deployments. We will talk about using the
<code>kubectl set image</code> command. We will also discuss the rolling
update strategy, automating with CI/CD, manual changes to Deployment
settings, and tips for image updates. Here is a short overview of what
we will learn:</p>
<ul>
<li>How to use <code>kubectl set image</code> to update Deployment in
Kubernetes</li>
<li>The rolling update strategy for Kubernetes Deployment image
updates</li>
<li>Automating image updates in Kubernetes Deployments with CI/CD</li>
<li>Manually changing a Kubernetes Deployment to update the image</li>
<li>Tips for updating images in Kubernetes Deployments</li>
<li>Common questions about Kubernetes image updates</li>
</ul>
<p>For more details, you can read related articles like <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-deployments-and-how-do-i-use-them.html">What
are Kubernetes Deployments and how do I use them?</a> and <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-perform-rolling-updates-in-kubernetes.html">How
do I perform rolling updates in Kubernetes?</a>.</p>
<h2
id="how-to-use-kubectl-set-image-to-update-deployment-in-kubernetes">How
to use kubectl set image to update Deployment in Kubernetes?</h2>
<p>To update a Kubernetes Deployment with a new image, we can use the
<code>kubectl set image</code> command. This command helps us change the
container image for the Deployment without editing YAML files by
hand.</p>
<h3 id="syntax">Syntax</h3>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> set image deployment/<span class="op">&lt;</span>deployment-name<span class="op">&gt;</span> <span class="op">&lt;</span>container-name<span class="op">&gt;</span>=<span class="op">&lt;</span>image-name<span class="op">&gt;</span>:<span class="op">&lt;</span>tag<span class="op">&gt;</span></span></code></pre></div>
<h3 id="example">Example</h3>
<p>Imagine we have a Deployment called <code>my-app</code> with a
container named <code>my-container</code>. If we want to update its
image to <code>my-image:latest</code>, we write this command:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> set image deployment/my-app my-container=my-image:latest</span></code></pre></div>
<h3 id="additional-options">Additional Options</h3>
<ul>
<li><strong>–record</strong>: This flag helps us keep track of changes
in the resource’s notes. It is good for seeing changes in the Deployment
history.</li>
</ul>
<p>Here is an example with recording:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> set image deployment/my-app my-container=my-image:latest <span class="at">--record</span></span></code></pre></div>
<p>This command will update the Deployment and we can see the change in
the history when we run
<code>kubectl rollout history deployment/my-app</code>.</p>
<h3 id="verify-the-update">Verify the Update</h3>
<p>To check how the Deployment is doing after the update, we can
use:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout status deployment/my-app</span></code></pre></div>
<p>This command gives us the status of the rollout. It tells us if the
new image has been applied successfully.</p>
<p>Using <code>kubectl set image</code>, we can manage image updates in
our Kubernetes Deployments. This way, we make sure our applications run
the latest versions with little downtime. For more information on
Deployments, check <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-deployments-and-how-do-i-use-them.html">what
are Kubernetes Deployments and how do I use them</a>.</p>
<h2
id="what-is-the-rolling-update-strategy-for-kubernetes-deployment-image-updates">What
is the rolling update strategy for Kubernetes Deployment image
updates?</h2>
<p>The rolling update strategy in Kubernetes helps us to update the
images of our Deployments without downtime. This strategy slowly
replaces old Pods with new ones. It keeps the number of Pods we want
during the update.</p>
<h3 id="key-features-of-rolling-update-strategy">Key Features of Rolling
Update Strategy:</h3>
<ul>
<li><strong>Incremental Updates</strong>: We update Pods one by one or
in small groups. It depends on the settings we choose.</li>
<li><strong>Health Checks</strong>: Kubernetes checks if the new Pods
are healthy. If a new Pod does not work, Kubernetes can go back to the
old version.</li>
<li><strong>Configuration Parameters</strong>:
<ul>
<li><code>maxUnavailable</code>: This tells us how many Pods can be
unavailable during the update.</li>
<li><code>maxSurge</code>: This tells us how many extra Pods can be
created beyond the desired number during the update.</li>
</ul></li>
</ul>
<h3 id="example-of-a-rolling-update-configuration">Example of a Rolling
Update Configuration:</h3>
<p>Here is an example of a Deployment configuration that uses rolling
updates:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> RollingUpdate</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">rollingUpdate</span><span class="kw">:</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">maxSurge</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">maxUnavailable</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app-container</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my-app:latest</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">containerPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">80</span></span></code></pre></div>
<p>In this example: - The <code>maxSurge: 1</code> allows us to create
one extra Pod for a short time. - The <code>maxUnavailable: 1</code>
means we will have at least two Pods working during the update.</p>
<h3 id="command-to-trigger-update">Command to Trigger Update:</h3>
<p>To update the image in a Deployment, we can use this command:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> set image deployment/my-app my-app-container=my-app:new-image</span></code></pre></div>
<p>This command changes the image of the container we picked. Kubernetes
will handle the rolling update using the strategy we set.</p>
<p>For more details on Kubernetes Deployment strategies, we can check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-perform-rolling-updates-in-kubernetes.html">this
article</a>.</p>
<h2
id="how-to-automate-image-updates-in-kubernetes-deployments-with-cicd">How
to automate image updates in Kubernetes Deployments with CI/CD?</h2>
<p>We can automate image updates in Kubernetes Deployments. This helps
our development process and reduces downtime. We can do this by using
Continuous Integration (CI) and Continuous Deployment (CD) tools like
Jenkins, GitHub Actions, or GitLab CI/CD. Here is a simple guide to set
it up.</p>
<h3 id="step-1-set-up-cicd-pipeline">Step 1: Set Up CI/CD Pipeline</h3>
<ol type="1">
<li><p><strong>Choose a CI/CD Tool</strong>: Pick a CI/CD tool that
works for us. Some common tools are Jenkins, GitHub Actions, and GitLab
CI/CD.</p></li>
<li><p><strong>Define Your Pipeline</strong>: Create a file for pipeline
configuration. For example, use <code>.gitlab-ci.yml</code> for GitLab,
<code>Jenkinsfile</code> for Jenkins, or
<code>.github/workflows/ci.yml</code> for GitHub Actions.</p></li>
</ol>
<h3 id="example-github-actions">Example: GitHub Actions</h3>
<p>Here is an example of a GitHub Actions workflow that builds a Docker
image and updates the Kubernetes deployment:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> CI/CD Pipeline</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> main</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout code</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v2</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v1</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Log in to Docker Hub</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/login-action@v1</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">username</span><span class="kw">:</span><span class="at"> ${{ secrets.DOCKER_USERNAME }}</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">password</span><span class="kw">:</span><span class="at"> ${{ secrets.DOCKER_PASSWORD }}</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and push Docker image</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v2</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">push</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> your-image-name:latest</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up kubectl</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> azure/setup-kubectl@v1</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;latest&#39;</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Deploy to Kubernetes</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>          kubectl set image deployment/your-deployment your-container=your-image-name:latest --record</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>          kubectl rollout status deployment/your-deployment</span></code></pre></div>
<h3 id="step-2-update-kubernetes-deployment">Step 2: Update Kubernetes
Deployment</h3>
<p>We use the <code>kubectl set image</code> command to update the image
of the existing deployment. The <code>--record</code> flag helps to
track what we change in the deployment history.</p>
<h3 id="step-3-trigger-deployments-on-image-updates">Step 3: Trigger
Deployments on Image Updates</h3>
<p>We can set our CI/CD tool to trigger deployments automatically when a
new image is built and pushed to the registry.</p>
<h3 id="best-practices">Best Practices</h3>
<ul>
<li><strong>Version Tags</strong>: It is good to use version tags
instead of <code>latest</code>. This helps us to roll back if
needed.</li>
<li><strong>Health Checks</strong>: We should add readiness and liveness
probes in our deployments. This helps to reduce downtime when we
update.</li>
<li><strong>Monitor Deployments</strong>: Use tools like Prometheus and
Grafana to watch our deployments and get alerts if there are
failures.</li>
</ul>
<p>For more information on setting up CI/CD pipelines in Kubernetes, we
can refer to the article on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-set-up-ci-cd-pipelines-for-kubernetes.html">how
do I set up CI/CD pipelines for Kubernetes</a>.</p>
<h2
id="how-to-manually-edit-a-kubernetes-deployment-to-change-the-image">How
to manually edit a Kubernetes Deployment to change the image?</h2>
<p>To change the image of a Kubernetes Deployment, we can use the
<code>kubectl edit</code> command. This command lets us change the
Deployment resource directly in our cluster.</p>
<p>Here is the way to edit a Deployment:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> edit deployment <span class="op">&lt;</span>deployment-name<span class="op">&gt;</span></span></code></pre></div>
<p>We need to replace <code>&lt;deployment-name&gt;</code> with the name
of our Deployment.</p>
<p>When we run this command, it opens our default text editor. This is
usually <code>vi</code> or <code>nano</code>. We will see the current
setup of the Deployment. We need to find the
<code>spec.template.spec.containers</code> section. This is where the
container images are listed. It looks something like this:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;container-name&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> &lt;current-image&gt;:&lt;tag&gt;</span></span></code></pre></div>
<p>Next, we change the <code>image</code> field to the new image we want
to use:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> &lt;new-image&gt;:&lt;new-tag&gt;</span></span></code></pre></div>
<p>After we make our changes, we save and close the editor. Kubernetes
will automatically apply the new setup. This will start a rolling update
of our Deployment with the new image.</p>
<p>We can check if the update was successful by looking at the status of
the Deployment:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout status deployment/<span class="op">&lt;</span>deployment-name<span class="op">&gt;</span></span></code></pre></div>
<p>This command shows us the rollout status of the Deployment. It will
tell us if the update worked.</p>
<p>For more information about managing Kubernetes Deployments, we can
look at <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-deployments-and-how-do-i-use-them.html">this
article</a>.</p>
<h2
id="what-are-best-practices-for-updating-images-in-kubernetes-deployments">What
are best practices for updating images in Kubernetes Deployments?</h2>
<p>When we update images in Kubernetes Deployments, we can follow some
best practices. These help to keep everything running well and reduce
downtime. Here are some key strategies:</p>
<ol type="1">
<li><p><strong>Use Semantic Versioning</strong>: We should tag images
with semantic versioning like <code>myapp:v1.0.0</code> instead of using
<code>latest</code>. This helps us see changes and go back if we need
to.</p></li>
<li><p><strong>Implement Rolling Updates</strong>: We can use
Kubernetes’ rolling update strategy. This means we replace old pods with
new ones gradually. It reduces downtime and makes rollbacks easy. We can
set up the Deployment like this:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> RollingUpdate</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">rollingUpdate</span><span class="kw">:</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">maxUnavailable</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">maxSurge</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span></code></pre></div></li>
<li><p><strong>Set Resource Limits</strong>: We need to define resource
requests and limits for each container. This makes sure the new image
does not use too many resources. This can help avoid problems:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;128Mi&quot;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;500m&quot;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;256Mi&quot;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;1&quot;</span></span></code></pre></div></li>
<li><p><strong>Health Checks</strong>: We should use readiness and
liveness probes. This checks if the new pods are working well before we
send traffic to them:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">readinessProbe</span><span class="kw">:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">httpGet</span><span class="kw">:</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /health</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">8080</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">initialDelaySeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span></code></pre></div></li>
<li><p><strong>Automate Image Updates</strong>: We can use CI/CD
pipelines to automate building, testing, and deploying images. Tools
like Jenkins or GitHub Actions help us with this.</p></li>
<li><p><strong>Use Canary Deployments</strong>: We can first deploy the
new image to a small group of users. This lets us monitor and check the
new version. We can do this with a different Deployment and service for
the canary version.</p></li>
<li><p><strong>Monitor Deployments</strong>: We should use monitoring
tools like Prometheus and Grafana. These tools help us watch the
performance of new images after deployment. This way, we can find
problems early.</p></li>
<li><p><strong>Use Annotations for Versioning</strong>: We can add
annotations to our deployments with the image version. This helps us
track changes:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image.version</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;v1.0.0&quot;</span></span></code></pre></div></li>
<li><p><strong>Rollback Procedures</strong>: We should know how to roll
back if the new deployment does not work. We can use this command:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout undo deployment/my-deployment</span></code></pre></div></li>
<li><p><strong>Testing Before Production</strong>: We should test new
images in a staging environment that is like production. This helps us
find issues before we deploy.</p></li>
</ol>
<p>By following these best practices, we can make updating images in
Kubernetes Deployments more reliable and efficient. For more details on
managing Kubernetes deployments, we can check out <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-deployments-and-how-do-i-use-them.html">what
are Kubernetes deployments and how do I use them</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3
id="how-do-we-update-a-kubernetes-deployment-image-using-the-command-line">1.
How do we update a Kubernetes Deployment image using the command
line?</h3>
<p>We can update a Kubernetes Deployment image using the
<code>kubectl set image</code> command. For example, if our Deployment
is called <code>my-deployment</code>, we can run this command:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> set image deployment/my-deployment my-container=my-image:latest</span></code></pre></div>
<p>This command will change the specified container in the Deployment to
use the new image. For more steps, check our guide on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-use-kubectl-set-image-to-update-deployment-in-kubernetes.html">how
to use kubectl set image to update Deployment in Kubernetes</a>.</p>
<h3 id="what-is-the-rolling-update-strategy-in-kubernetes">2. What is
the rolling update strategy in Kubernetes?</h3>
<p>The rolling update strategy in Kubernetes helps us update our
application without any downtime. It does this by slowly replacing the
old Pods with new ones. This way, we can keep a certain number of Pods
running during the update. For more details on rolling updates, read our
article on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-perform-rolling-updates-in-kubernetes.html">how
do I perform rolling updates in Kubernetes</a>.</p>
<h3 id="how-can-we-automate-image-updates-in-kubernetes-deployments">3.
How can we automate image updates in Kubernetes Deployments?</h3>
<p>We can automate image updates in Kubernetes by using CI/CD pipelines.
Tools like Jenkins or GitHub Actions can start deployments automatically
when we push a new image to our container registry. This makes it easier
to keep our application updated. For more information on setting up
CI/CD for Kubernetes, see our guide on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-set-up-ci-cd-pipelines-for-kubernetes.html">how
do I set up CI/CD pipelines for Kubernetes</a>.</p>
<h3
id="what-are-the-best-practices-for-updating-images-in-kubernetes">4.
What are the best practices for updating images in Kubernetes?</h3>
<p>The best practices for updating images in Kubernetes are tagging
images with version numbers, using rolling updates to keep downtime low,
and testing updates in a staging area before going to production. Also,
we should use health checks to make sure new Pods work well before we
remove the old ones. More about this is in our article on best practices
for <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-deployments-and-how-do-i-use-them.html">Kubernetes
Deployments</a>.</p>
<h3
id="how-can-we-manually-edit-a-kubernetes-deployment-to-change-the-image">5.
How can we manually edit a Kubernetes Deployment to change the
image?</h3>
<p>To manually change a Kubernetes Deployment, we can use the
<code>kubectl edit</code> command. This opens the Deployment in our text
editor. We find the <code>image</code> field under the
<code>containers</code> section. Then we update it with the new image
tag, save our changes, and exit the editor. This method changes the Live
Kubernetes configuration. For more info on editing resources, check our
article on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-the-lifecycle-of-a-kubernetes-pod.html">how
do I manage the lifecycle of a Kubernetes Pod</a>.</p>
<p>By knowing and using these methods, we can make sure our deployments
and updates for applications in Kubernetes go smooth and effective.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            