
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
            <meta property="og:title" content="How Can You Avoid Overwriting Randomly Generated Secrets in Helm Templates for Kubernetes?" />
            <meta property="og:description" content="Learn how to prevent overwriting randomly generated secrets in Helm templates for Kubernetes with effective strategies and tips." />
            <meta property="og:url" content="https://www.bestonlinetutorial.com/kubernetes/how-can-you-avoid-overwriting-randomly-generated-secrets-in-helm-templates-for-kubernetes.html" />
            <link rel="canonical" href="https://www.bestonlinetutorial.com/kubernetes/how-can-you-avoid-overwriting-randomly-generated-secrets-in-helm-templates-for-kubernetes.html">
            <meta property="og:type" content="article" />
            <meta property="og:site_name" content=“BestOnlineTutorial” />
            <meta name="twitter:title" content="How Can You Avoid Overwriting Randomly Generated Secrets in Helm Templates for Kubernetes?" />
            <meta name="twitter:description" content="Learn how to prevent overwriting randomly generated secrets in Helm templates for Kubernetes with effective strategies and tips." />
            <meta name="pinterest-rich-pin" content="true" />

            <script type="application/ld+json">
                {
                "@context": "https://schema.org",
                "@type": "WebSite",
                "name": "BestOnlineTutorial",
                "url": "https://www.bestonlinetutorial.com/"
                }
            </script>
            <!-- Common CSS & Icons -->
            <link rel="icon" href="/favicon.ico" type="image/x-icon">
            <link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
            <link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
            <link rel="stylesheet" href="/assets/css/post.css">
            <title>How Can You Avoid Overwriting Randomly Generated Secrets in Helm Templates for Kubernetes?</title>
            <meta name="description" content="Learn how to prevent overwriting randomly generated secrets in Helm templates for Kubernetes with effective strategies and tips.">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How Can You Avoid Overwriting Randomly Generated Secrets in Helm Templates for Kubernetes?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>To stop overwriting secrets that we create randomly in Helm templates
for Kubernetes, we can use some simple strategies. These include using
Helm hooks, adding conditional logic, and using tools for secret
management. These methods help us keep our secrets safe and not change
them by mistake during deployments. By following these best practices,
we can protect our important information and make our Kubernetes
deployments smoother.</p>
<p>In this article, we will look at different ways to stop accidentally
overwriting secrets in Helm templates. We will learn how to manage
secrets with template functions, use Helm hooks to keep secrets safe,
apply conditional logic, use external secret management tools, and
control versions of secrets with Helm releases. We will talk about these
topics:</p>
<ul>
<li>How to Avoid Overwriting Randomly Generated Secrets in Helm
Templates for Kubernetes</li>
<li>How to Use Template Functions to Manage Secrets in Helm</li>
<li>How to Leverage Helm Hooks to Preserve Secrets</li>
<li>How to Implement Conditional Logic in Helm Templates for
Secrets</li>
<li>How to Use External Secret Management Solutions with Helm</li>
<li>How to Version Control Secrets with Helm Releases</li>
</ul>
<p>For more information about Kubernetes and its parts, you can check
these articles: <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubernetes-and-how-does-it-simplify-container-management.html">What
is Kubernetes and How Does It Simplify Container Management?</a> and <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">How
Do I Manage Secrets in Kubernetes Securely?</a>.</p>
<h2 id="how-to-use-template-functions-to-manage-secrets-in-helm">How to
Use Template Functions to Manage Secrets in Helm</h2>
<p>Helm gives us many template functions. We can use these functions to
manage secrets in our Kubernetes deployments. These functions let us
create and change secret data easily. This helps us avoid accidentally
overwriting secrets.</p>
<h3 id="using-lookup-function">Using <code>lookup</code> Function</h3>
<p>The <code>lookup</code> function helps us get Kubernetes resources,
like secrets. We just need to say the resource type, name, and
namespace. This way, we can refer to existing secrets without putting
hardcoded values.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span><span class="at">{- $secret := lookup </span><span class="st">&quot;v1&quot;</span><span class="at"> </span><span class="st">&quot;Secret&quot;</span><span class="at"> .Release.Namespace </span><span class="st">&quot;my-secret&quot;</span><span class="at"> </span><span class="kw">}</span><span class="at">}</span></span></code></pre></div>
<h3 id="generating-random-values">Generating Random Values</h3>
<p>We can use the built-in <code>randAlphaNum</code> function to create
random values for secret data. This makes sure our secrets are unique
and hard to guess.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-random-secret</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.password | default (randAlphaNum 16 | b64enc) </span><span class="kw">}</span><span class="at">}</span></span></code></pre></div>
<h3 id="conditional-logic-with-if-statement">Conditional Logic with
<code>if</code> Statement</h3>
<p>Using <code>if</code> statements in our templates helps us manage
secrets based on certain conditions. For example, we can choose to
create a new secret or use an existing one.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span><span class="at">{- if .Values.createNewSecret </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> new-secret</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.password | b64enc </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span><span class="at">{- else </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> existing-secret</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ lookup </span><span class="st">&quot;v1&quot;</span><span class="at"> </span><span class="st">&quot;Secret&quot;</span><span class="at"> .Release.Namespace </span><span class="st">&quot;existing-secret&quot;</span><span class="at"> | .data.password </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span><span class="at">{- end </span><span class="kw">}</span><span class="at">}</span></span></code></pre></div>
<h3 id="using-tpl-function">Using <code>tpl</code> Function</h3>
<p>We can use the <code>tpl</code> function to create secret data
dynamically. This helps us make more complex secret setups based on
values from <code>values.yaml</code>.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> dynamic-secret</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">config</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.config | tpl . </span><span class="kw">}</span><span class="at">}</span></span></code></pre></div>
<h3 id="implementing-toyaml-for-structured-data">Implementing
<code>toYaml</code> for Structured Data</h3>
<p>If our secret data has structure, we can use the <code>toYaml</code>
function. It changes complex data types into YAML format. This way, our
secrets stay organized and easy to handle.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> structured-secret</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">config.yaml</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.config | toYaml | b64enc </span><span class="kw">}</span><span class="at">}</span></span></code></pre></div>
<p>By using these template functions in Helm, we can manage secrets
well. This reduces the chance of overwriting them and makes our
Kubernetes apps safer. We should check out the <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">Kubernetes
secrets management best practices</a> for more tips.</p>
<h2 id="how-to-leverage-helm-hooks-to-preserve-secrets">How to Leverage
Helm Hooks to Preserve Secrets</h2>
<p>Helm hooks are really useful. They help us do things at certain times
during the release process. We can use Helm hooks to stop random secrets
from being overwritten in our Helm templates.</p>
<h3 id="using-pre-install-and-pre-upgrade-hooks">Using Pre-install and
Pre-upgrade Hooks</h3>
<p>We can set up hooks that create and save secrets before the main
template runs. For instance, we can use a <code>pre-install</code> or
<code>pre-upgrade</code> hook to generate secrets and put them in a
Kubernetes secret store.</p>
<p>Here is an example of a pre-install hook that makes a secret:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ConfigMap</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> generate-secret</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">&quot;helm.sh/hook&quot;</span><span class="kw">:</span><span class="at"> pre-install</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">secret-value</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.secretValue | quote </span><span class="kw">}</span><span class="at">}</span></span></code></pre></div>
<h3 id="using-post-install-hooks-for-secret-validation">Using
Post-install Hooks for Secret Validation</h3>
<p>We can use post-install hooks to check if the secrets exist and are
correct after we create the main resources. This way, we make sure that
the secrets are still safe.</p>
<p>Here is an example of a post-install hook for validation:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> batch/v1</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Job</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> validate-secret</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">&quot;helm.sh/hook&quot;</span><span class="kw">:</span><span class="at"> post-install</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> validate</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">image</span><span class="kw">:</span><span class="at"> busybox</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&#39;sh&#39;</span><span class="kw">,</span><span class="at"> </span><span class="st">&#39;-c&#39;</span><span class="kw">,</span><span class="at"> </span><span class="st">&#39;kubectl get secret my-secret -o json&#39;</span><span class="kw">]</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">restartPolicy</span><span class="kw">:</span><span class="at"> Never</span></span></code></pre></div>
<h3 id="managing-secrets-with-helm-hooks">Managing Secrets with Helm
Hooks</h3>
<ul>
<li><p><strong>Pre-delete Hooks</strong>: We can use a
<code>pre-delete</code> hook to back up or keep secrets safe before we
delete the release.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Job</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> backup-secret</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">&quot;helm.sh/hook&quot;</span><span class="kw">:</span><span class="at"> pre-delete</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> backup</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">image</span><span class="kw">:</span><span class="at"> busybox</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&#39;sh&#39;</span><span class="kw">,</span><span class="at"> </span><span class="st">&#39;-c&#39;</span><span class="kw">,</span><span class="at"> </span><span class="st">&#39;kubectl get secret my-secret -o yaml &gt; backup.yaml&#39;</span><span class="kw">]</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">restartPolicy</span><span class="kw">:</span><span class="at"> Never</span></span></code></pre></div></li>
<li><p><strong>Pre-upgrade Hooks</strong>: We can use
<code>pre-upgrade</code> hooks to change or recreate secrets with new
settings before we upgrade.</p></li>
</ul>
<h3 id="best-practices-for-using-helm-hooks-with-secrets">Best Practices
for Using Helm Hooks with Secrets</h3>
<ul>
<li>Give unique names to secrets made by hooks. This stops name
conflicts.</li>
<li>Make sure hooks have the right annotations to run at the needed
times.</li>
<li>Test hooks often to make sure they work well during deployment.</li>
</ul>
<p>By using Helm hooks the right way, we can control and keep our
Kubernetes secrets safe. This helps us avoid mistakes during Helm
releases. For more tips on managing secrets securely in Kubernetes, you
can read this article on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">how
to manage secrets in Kubernetes securely</a>.</p>
<h2
id="how-to-implement-conditional-logic-in-helm-templates-for-secrets">How
to Implement Conditional Logic in Helm Templates for Secrets</h2>
<p>We want to avoid overwriting randomly generated secrets in Helm
templates. To do this, we can use conditional logic with Helm’s
templating. This helps us decide if we should create a new secret or use
an existing one based on certain conditions.</p>
<p>We can use the <code>if</code> statement in our Helm templates to
apply this logic. For example, we can check if a secret already exists
before we create a new one. Here is a simple way to do it:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span><span class="at">{- if .Values.useExistingSecret </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.existingSecretName </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">username</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.existingUsername | b64enc | quote </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.existingPassword | b64enc | quote </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span><span class="at">{- else </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Release.Name </span><span class="kw">}</span><span class="at">}-generated-secret</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">username</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.newUsername | b64enc | quote </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.newPassword | b64enc | quote </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span><span class="at">{- end </span><span class="kw">}</span><span class="at">}</span></span></code></pre></div>
<p>In this example, the template checks the value of
<code>useExistingSecret</code>. If it is true, we use the existing
secret’s name and data. If it is false, we create a new secret with the
given username and password.</p>
<p>We can also do more complex checks with Helm template functions. For
instance, we can use the <code>default</code> function to set fallback
values. This makes sure our Helm chart works well even when some values
are missing:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Release.Name </span><span class="kw">}</span><span class="at">}-secret</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">username</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.username | default </span><span class="st">&quot;defaultUser&quot;</span><span class="at"> | b64enc | quote </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.password | default </span><span class="st">&quot;defaultPass&quot;</span><span class="at"> | b64enc | quote </span><span class="kw">}</span><span class="at">}</span></span></code></pre></div>
<p>This method helps us manage secrets better. It also stops us from
accidentally overwriting important data. For more advanced ways to
manage secrets, we can think about using external secret management
tools or Helm hooks to improve our workflow.</p>
<p>For more info about managing secrets safely in Kubernetes, we can
look at <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">this
article</a>.</p>
<h2 id="how-to-use-external-secret-management-solutions-with-helm">How
to Use External Secret Management Solutions with Helm</h2>
<p>Using external secret management solutions with Helm can make our
sensitive data safer in Kubernetes. We can use tools like HashiCorp
Vault, AWS Secrets Manager, or Azure Key Vault. These tools help us
manage secrets better in our Helm charts.</p>
<h3 id="integrating-hashicorp-vault-with-helm">Integrating HashiCorp
Vault with Helm</h3>
<ol type="1">
<li><p><strong>Install Vault</strong>: We can use Helm to add Vault to
our Kubernetes cluster.</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo add hashicorp https://helm.releases.hashicorp.com</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install vault hashicorp/vault</span></code></pre></div></li>
<li><p><strong>Configure Vault</strong>: We need to enable the
Kubernetes auth method and set up a role for our application.</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> auth enable kubernetes</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> write auth/kubernetes/config <span class="dt">\</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    token_reviewer_jwt=<span class="st">&quot;YOUR_JWT&quot;</span> <span class="dt">\</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    kubernetes_host=<span class="st">&quot;https://YOUR_K8S_API_SERVER&quot;</span> <span class="dt">\</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    kubernetes_ca_cert=<span class="st">&quot;@/path/to/ca.crt&quot;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="ex">vault</span> write auth/kubernetes/role/my-role <span class="dt">\</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    bound_service_account_names=my-app-sa <span class="dt">\</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    bound_service_account_namespaces=default <span class="dt">\</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    policies=my-app-policy <span class="dt">\</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    ttl=24h</span></code></pre></div></li>
<li><p><strong>Fetch Secrets in Helm Templates</strong>: We can use the
<code>vault</code> Helm plugin or <code>helm-secrets</code> to get
secrets from Vault.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-secret</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.vault.password | vault </span><span class="st">&quot;my-secret/password&quot;</span><span class="at"> </span><span class="kw">}</span><span class="at">}</span></span></code></pre></div></li>
</ol>
<h3 id="using-aws-secrets-manager-with-helm">Using AWS Secrets Manager
with Helm</h3>
<ol type="1">
<li><p><strong>Setup IAM Role</strong>: We need to create an IAM role
that lets our Kubernetes pods access AWS Secrets Manager.</p></li>
<li><p><strong>Install External Secrets Operator</strong>: This operator
helps sync secrets from AWS Secrets Manager to Kubernetes.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://raw.githubusercontent.com/external-secrets/external-secrets/master/deploy/crds/external-secrets.k8s.io_externalsecrets_crd.yaml</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://raw.githubusercontent.com/external-secrets/external-secrets/master/deploy/deploy.yaml</span></code></pre></div></li>
<li><p><strong>Create External Secret</strong>: We define an
ExternalSecret resource to sync our secrets.</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> kubernetes-client.io/v1</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ExternalSecret</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-external-secret</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">backendType</span><span class="kw">:</span><span class="at"> secretsManager</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">key</span><span class="kw">:</span><span class="at"> my-secret</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> password</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">property</span><span class="kw">:</span><span class="at"> password</span></span></code></pre></div></li>
<li><p><strong>Use in Helm Chart</strong>: We can reference the synced
secret in our Helm chart.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-container</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my-image</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> SECRET_PASSWORD</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-external-secret</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">key</span><span class="kw">:</span><span class="at"> password</span></span></code></pre></div></li>
</ol>
<h3 id="leveraging-azure-key-vault-with-helm">Leveraging Azure Key Vault
with Helm</h3>
<ol type="1">
<li><p><strong>Setup Azure Key Vault</strong>: We create a Key Vault and
add our secrets.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">az</span> keyvault create <span class="at">--name</span> MyKeyVault <span class="at">--resource-group</span> MyResourceGroup <span class="at">--location</span> eastus</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">az</span> keyvault secret set <span class="at">--vault-name</span> MyKeyVault <span class="at">--name</span> MySecret <span class="at">--value</span> MySecretValue</span></code></pre></div></li>
<li><p><strong>Install the Azure Key Vault Provider</strong>: We need to
deploy the provider for Kubernetes.</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo add azure-keyvault-secrets-provider https://azure.github.io/secrets-store-csi-driver-provider-azure/charts</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install azure-keyvault-secrets-provider azure-keyvault-secrets-provider/azure-keyvault-secrets-provider</span></code></pre></div></li>
<li><p><strong>Create SecretProviderClass</strong>: We define a
SecretProviderClass for our application.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> secrets-store.csi.k8s.io/v1</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> SecretProviderClass</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-secret-provider</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">provider</span><span class="kw">:</span><span class="at"> azure</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">parameters</span><span class="kw">:</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">usePodIdentity</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;false&quot;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">keyvaultName</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;MyKeyVault&quot;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">cloudName</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;AzurePublicCloud&quot;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">    objects</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>      array:</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        - |</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>          objectName: MySecret</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>          objectType: secret</span></code></pre></div></li>
<li><p><strong>Reference in Helm Chart</strong>: We can use the secret
in our application deployment.</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-container</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my-image</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> SECRET_PASSWORD</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app-secret</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">key</span><span class="kw">:</span><span class="at"> MySecret</span></span></code></pre></div></li>
</ol>
<p>Using external secret management solutions with Helm can help us keep
our Kubernetes applications more secure. We can manage sensitive
credentials better this way.</p>
<h2 id="how-to-version-control-secrets-with-helm-releases">How to
Version Control Secrets with Helm Releases</h2>
<p>We need to control versions for secrets in Helm releases. This helps
us manage changes and keep our sensitive data safe across deployments.
We can do this by using Helm’s built-in tools and some best practices
for handling secrets.</p>
<ol type="1">
<li><p><strong>Using <code>helm get</code></strong>: We can get the
current values of a release to see changes over time.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> get values <span class="op">&lt;</span>release-name<span class="op">&gt;</span> --revision <span class="op">&lt;</span>revision-number<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Version Control with Git</strong>: We should store our
Helm chart templates and <code>values.yaml</code> files in a Git
repository. This way, we can track changes to our secrets and
configurations.</p>
<ul>
<li><p><strong>Commit changes</strong>:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add .</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">&quot;Update secret values for release&quot;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push</span></code></pre></div></li>
</ul></li>
<li><p><strong>Helm Secrets Plugin</strong>: We can use the <a
href="https://github.com/jkroepke/helm-secrets">Helm Secrets</a> plugin
to encrypt our secrets with tools like SOPS. This keeps our sensitive
data safe in our Git repository.</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> secrets enc secrets.yaml</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> secrets install <span class="op">&lt;</span>release-name<span class="op">&gt;</span> ./chart/</span></code></pre></div></li>
<li><p><strong>Helmfile</strong>: We can use Helmfile to manage many
Helm releases and their settings. This helps us have one main source of
truth.</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">releases</span><span class="kw">:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myapp</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">chart</span><span class="kw">:</span><span class="at"> ./myapp</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">values</span><span class="kw">:</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> secrets.yaml</span></span></code></pre></div></li>
<li><p><strong>Kubernetes External Secrets</strong>: We can use external
secret management tools, like AWS Secrets Manager or HashiCorp Vault.
This helps us get secrets when we deploy.</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> kubernetes.io/v1</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ExternalSecret</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-secret</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">backendType</span><span class="kw">:</span><span class="at"> secretsManager</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">key</span><span class="kw">:</span><span class="at"> myapp/secret</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-secret-key</span></span></code></pre></div></li>
<li><p><strong>Automated CI/CD Pipelines</strong>: We can set up CI/CD
pipelines that automatically deploy Helm releases with
version-controlled secrets. We can use environment variables or secret
management tools to get sensitive data during the pipeline run.</p></li>
</ol>
<p>If we follow these practices, we can version control secrets well in
our Helm releases. This keeps our data secure and makes it easy to trace
changes while we manage our Kubernetes applications. For more details on
handling secrets safely in Kubernetes, check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">this
guide</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="how-can-we-prevent-overwriting-secrets-in-helm-templates">1. How
can we prevent overwriting secrets in Helm templates?</h3>
<p>To stop overwriting secrets in Helm templates, we can use unique
names or labels for each secret. This keeps our secrets safe during
different releases. We can also use Helm’s built-in template functions.
They help us create unique identifiers. This way, our secrets stay
different between deployments. For more details, check out <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">how
to manage secrets in Kubernetes securely</a>.</p>
<h3 id="what-are-helm-hooks-and-how-can-they-help-with-secrets">2. What
are Helm hooks and how can they help with secrets?</h3>
<p>Helm hooks are a useful tool. They let us run specific actions at
certain times in the lifecycle of a Helm release. Using hooks can help
us manage secrets better. We can create or handle secrets before or
after the main installation. For instance, a pre-install hook can make a
secure secret. This way, it won’t get overwritten when we upgrade later.
Learn more about <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-use-helm-to-manage-releases-of-my-applications-on-kubernetes.html">using
Helm hooks to manage your Kubernetes resources</a>.</p>
<h3
id="how-do-we-implement-conditional-logic-in-helm-templates-for-managing-secrets">3.
How do we implement conditional logic in Helm templates for managing
secrets?</h3>
<p>We can use <code>if</code>, <code>else</code>, and <code>with</code>
statements to add conditional logic in Helm templates. This lets us
control when secrets are created based on certain conditions like
environment variables. By using this logic, we ensure secrets are only
made or changed when needed. This helps us avoid overwriting existing
secrets. For more help, see <a
href="https://bestonlinetutorial.com/kubernetes/how-to-use-templating-variables-in-values-yaml-for-helm-in-kubernetes.html">how
to use templating variables in Helm</a>.</p>
<h3
id="what-external-secret-management-solutions-can-we-use-with-helm">4.
What external secret management solutions can we use with Helm?</h3>
<p>We can improve our Kubernetes security by connecting external secret
management tools like HashiCorp Vault or AWS Secrets Manager with Helm.
These tools help us manage secrets dynamically. This means we do not
need to hardcode sensitive data in our Helm charts. By using these
solutions, we can keep our secrets safe and make our deployment process
cleaner. For more info, visit <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">how
to use external secret management solutions with Kubernetes</a>.</p>
<h3 id="how-do-we-version-control-secrets-with-helm-releases">5. How do
we version control secrets with Helm releases?</h3>
<p>Version controlling secrets in Helm is very important. It helps us
keep track of changes and allows us to roll back if needed. We can use
Helm’s release management features to see changes to secrets over time.
We should store secrets in a secure place and refer to them in our Helm
charts. This way, we can update secrets without losing old values. For
best practices, check out <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-use-helm-to-manage-releases-of-my-applications-on-kubernetes.html">how
to manage releases with Helm</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            