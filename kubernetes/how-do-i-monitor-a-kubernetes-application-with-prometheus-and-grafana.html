
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <title>How Do I Monitor a Kubernetes Application with Prometheus and Grafana?</title>
            <meta name="description" content="Learn how to effectively monitor your Kubernetes application using Prometheus and Grafana for real-time insights and performance.">

            <div id="head-placeholder"></div>
            <script src="/assets/js/blog.js" defer></script>
            <link rel="stylesheet" href="/assets/css/post.css">
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How Do I Monitor a Kubernetes Application with Prometheus and Grafana?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p><strong>Monitoring a Kubernetes Application with Prometheus and
Grafana</strong></p>
<p>Monitoring a Kubernetes application with Prometheus and Grafana means
we use these two great tools. They help us collect, analyze, and show
metrics from our Kubernetes environment. Prometheus is an open-source
tool for monitoring and alerting. It is made for reliability and
scalability. Grafana is a well-known open-source platform. It helps us
create dashboards and visualize our data.</p>
<p>In this article, we will talk about how to monitor a Kubernetes
application using Prometheus and Grafana. We will look at what we need
to set up these tools. We will go through the steps to install
Prometheus and Grafana in a Kubernetes cluster. We will also learn how
to configure Prometheus to scrape metrics from our applications.
Additionally, we will see how to make Grafana dashboards to visualize
these metrics, set up alerts, and fix common issues that come up during
monitoring.</p>
<ul>
<li>How Can We Effectively Monitor a Kubernetes Application with
Prometheus and Grafana?</li>
<li>What Are the Prerequisites for Setting Up Prometheus and
Grafana?</li>
<li>How Do We Install Prometheus in a Kubernetes Cluster?</li>
<li>How Do We Install Grafana in a Kubernetes Environment?</li>
<li>How Can We Configure Prometheus to Scrape Our Application
Metrics?</li>
<li>How Do We Create Grafana Dashboards for Visualizing Metrics?</li>
<li>What Are Some Real Life Use Cases for Monitoring Kubernetes
Applications?</li>
<li>How Do We Set Up Alerts for Our Kubernetes Application with
Prometheus?</li>
<li>How Do We Troubleshoot Common Issues with Prometheus and
Grafana?</li>
<li>Frequently Asked Questions</li>
</ul>
<p>By following this guide, we will understand how to monitor our
Kubernetes applications well with Prometheus and Grafana. For more
information on Kubernetes, we can read about <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubernetes-and-how-does-it-simplify-container-management.html">what
Kubernetes is and how it simplifies container management</a> and <a
href="https://bestonlinetutorial.com/kubernetes/why-should-i-use-kubernetes-for-my-applications.html">why
we should use Kubernetes for our applications</a>.</p>
<h2
id="what-are-the-prerequisites-for-setting-up-prometheus-and-grafana">What
Are the Prerequisites for Setting Up Prometheus and Grafana?</h2>
<p>Before we set up Prometheus and Grafana for monitoring our Kubernetes
application, we need to check if we have the following things ready:</p>
<ol type="1">
<li><p><strong>Kubernetes Cluster</strong>: We need a working Kubernetes
cluster. This can be a local setup with Minikube or a cloud service like
AWS EKS, Google GKE, or Azure AKS. For help on setting this up, we can
read <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-install-minikube-for-local-kubernetes-development.html">this
article on building a Kubernetes cluster</a>.</p></li>
<li><p><strong>kubectl</strong>: We should install <code>kubectl</code>,
the command-line tool to work with our Kubernetes cluster. We must also
make sure it connects to our cluster.</p></li>
<li><p><strong>Helm</strong>: Helm helps us manage Kubernetes
applications. We need to install Helm to make installing Prometheus and
Grafana easier. For more details on Helm, we can check <a
href="https://bestonlinetutorial.com/kubernetes/what-is-helm-and-how-does-it-help-with-kubernetes-deployments.html">this
article on using Helm</a>.</p></li>
<li><p><strong>Persistent Storage</strong>: We must set up persistent
storage in our Kubernetes cluster to keep Prometheus and Grafana data.
We can do this with Persistent Volumes (PVs) and Persistent Volume
Claims (PVCs).</p></li>
<li><p><strong>Resource Management</strong>: We need to check that our
Kubernetes cluster has enough resources like CPU and memory to run
Prometheus and Grafana well.</p></li>
<li><p><strong>Networking</strong>: We should set up the right network
rules and services. This will help our application, Prometheus, and
Grafana to talk to each other. We might also need Ingress for outside
access to Grafana.</p></li>
<li><p><strong>Access Permissions</strong>: We need to have the right
permissions to deploy apps and create resources in our Kubernetes
cluster.</p></li>
</ol>
<p>When we have these things ready, we can go ahead to install and set
up Prometheus and Grafana to monitor our Kubernetes applications.</p>
<h2 id="how-do-i-install-prometheus-in-a-kubernetes-cluster">How Do I
Install Prometheus in a Kubernetes Cluster?</h2>
<p>We can install Prometheus in a Kubernetes cluster using the
Prometheus Operator. This tool makes it easier to set up and manage
Prometheus. Here are the steps to install Prometheus with Helm, which is
a popular tool for managing packages in Kubernetes.</p>
<h3 id="step-1-install-helm">Step 1: Install Helm</h3>
<p>First, we need to install Helm if we do not have it yet. We can
follow the official Helm installation guide. After we install it, we
should run this command to set up Helm:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> init</span></code></pre></div>
<h3 id="step-2-add-the-prometheus-community-helm-repository">Step 2: Add
the Prometheus Community Helm Repository</h3>
<p>Next, we add the Prometheus community chart repository. We can do
this with these commands:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo add prometheus-community https://prometheus-community.github.io/helm-charts</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo update</span></code></pre></div>
<h3 id="step-3-install-prometheus">Step 3: Install Prometheus</h3>
<p>Now we can install Prometheus using the Helm chart. We can change our
installation by editing the <code>values.yaml</code> file or by passing
settings directly in the command:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install prometheus prometheus-community/kube-prometheus-stack</span></code></pre></div>
<h3 id="step-4-verify-the-installation">Step 4: Verify the
Installation</h3>
<p>To check if Prometheus is running, we can see the status of the pods
with this command:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">-n</span> default</span></code></pre></div>
<p>We should see the Prometheus pods running. We can also reach the
Prometheus UI by forwarding the port:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> port-forward svc/prometheus-kube-prometheus-prometheus 9090:9090</span></code></pre></div>
<p>After that, we can go to <code>http://localhost:9090</code> in our
web browser to access Prometheus.</p>
<h3 id="step-5-configure-prometheus">Step 5: Configure Prometheus</h3>
<p>To set up Prometheus to gather metrics from our applications, we need
to define service monitors in our Kubernetes settings. For example:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> monitoring.coreos.com/v1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ServiceMonitor</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-app</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">app</span><span class="kw">:</span><span class="at"> example-app</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> example-app</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">endpoints</span><span class="kw">:</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">port</span><span class="kw">:</span><span class="at"> metrics</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> 30s</span></span></code></pre></div>
<p>This setup tells Prometheus to gather metrics from any service that
has the label <code>app: example-app</code>.</p>
<p>If we need more help on monitoring Kubernetes applications, we can
check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">this
article on Kubernetes monitoring</a>.</p>
<h2 id="how-do-i-install-grafana-in-a-kubernetes-environment">How Do I
Install Grafana in a Kubernetes Environment?</h2>
<p>To install Grafana in a Kubernetes environment, we can use Helm. Helm
is a tool that helps manage packages in Kubernetes. Here are the steps
to set up Grafana:</p>
<ol type="1">
<li><p><strong>Add the Grafana Helm Chart Repository</strong>: First, we
need to add the Grafana chart repository to our Helm setup.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo add grafana https://grafana.github.io/helm-charts</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo update</span></code></pre></div></li>
<li><p><strong>Create a Namespace for Grafana</strong> (optional): It is
a good idea to create a separate namespace for Grafana.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create namespace grafana</span></code></pre></div></li>
<li><p><strong>Install Grafana</strong>: We can install Grafana using
this command. It will deploy Grafana with its default settings.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install grafana grafana/grafana <span class="at">--namespace</span> grafana</span></code></pre></div>
<p>If we want to change some settings, we can create a
<code>values.yaml</code> file with our choices. Then we can install it
like this:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># values.yaml</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">adminPassword</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;your-admin-password&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">service</span><span class="kw">:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadBalancer</span></span></code></pre></div>
<p>After that, we run:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install grafana grafana/grafana <span class="at">--namespace</span> grafana <span class="at">-f</span> values.yaml</span></code></pre></div></li>
<li><p><strong>Accessing Grafana</strong>: To access Grafana, we need to
get the service’s external IP. We run this command:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get svc <span class="at">--namespace</span> grafana</span></code></pre></div>
<p>We should look for the <code>EXTERNAL-IP</code> of the Grafana
service. Once it is ready, we can open Grafana in our browser at
<code>http://&lt;EXTERNAL-IP&gt;:80</code>.</p></li>
<li><p><strong>Login to Grafana</strong>: We can log in using the
default username <code>admin</code> and the password we set. If we did
not set a password, the default is <code>admin</code>.</p></li>
<li><p><strong>Configuring Data Sources</strong>: After we log in, we
can set up data sources like Prometheus. This helps us see our
metrics.</p></li>
</ol>
<p>For more information on monitoring applications, we can read about <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-set-up-kubernetes-monitoring-and-alerting.html">how
to set up Kubernetes monitoring and alerting</a>.</p>
<h2
id="how-can-we-configure-prometheus-to-scrape-our-application-metrics">How
Can We Configure Prometheus to Scrape Our Application Metrics?</h2>
<p>To configure Prometheus to scrape metrics from our Kubernetes
application, we need to follow these steps:</p>
<ol type="1">
<li><p><strong>Expose Metrics Endpoint</strong>: First, we need to make
sure our application exposes metrics in a way that Prometheus can
scrape. We usually do this through an HTTP endpoint, often at
<code>/metrics</code>. For instance, if we use a Node.js application, we
can use the <code>prom-client</code> library:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> client <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;prom-client&#39;</span>)<span class="op">;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express&#39;</span>)<span class="op">;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> app <span class="op">=</span> <span class="fu">express</span>()<span class="op">;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> collectDefaultMetrics <span class="op">=</span> client<span class="op">.</span><span class="at">collectDefaultMetrics</span><span class="op">;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">collectDefaultMetrics</span>({ <span class="dt">timeout</span><span class="op">:</span> <span class="dv">5000</span> })<span class="op">;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/metrics&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;Content-Type&#39;</span><span class="op">,</span> client<span class="op">.</span><span class="at">register</span><span class="op">.</span><span class="at">contentType</span>)<span class="op">;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">end</span>(client<span class="op">.</span><span class="at">register</span><span class="op">.</span><span class="fu">metrics</span>())<span class="op">;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">listen</span>(<span class="dv">3000</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Server is running on port 3000&#39;</span>)<span class="op">;</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div></li>
<li><p><strong>Create a ConfigMap for Prometheus Configuration</strong>:
Next, we need to make a <code>ConfigMap</code> for Prometheus where we
tell it how to scrape. Here is an example that shows how to set it
up:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ConfigMap</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> prometheus-config</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> monitoring</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">  prometheus.yml</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    global:</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>      scrape_interval: 15s</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    scrape_configs:</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      - job_name: &#39;my-application&#39;</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        kubernetes_sd_configs:</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>          - role: pod</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        relabel_configs:</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>          - source_labels: [__meta_kubernetes_pod_label_app]</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>            action: keep</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>            regex: my-app</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>          - action: labelmap</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>            regex: __meta_kubernetes_pod_label_(.+)</span></code></pre></div></li>
<li><p><strong>Deploy Prometheus</strong>: If we have not deployed
Prometheus yet, we can do it with this manifest. We must use the
ConfigMap we made:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> prometheus</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> monitoring</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> prometheus</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> prometheus</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> prometheus</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">image</span><span class="kw">:</span><span class="at"> prom/prometheus</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">args</span><span class="kw">:</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;--config.file=/etc/prometheus/prometheus.yml&#39;</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">containerPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">9090</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">volumeMounts</span><span class="kw">:</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> config-volume</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">mountPath</span><span class="kw">:</span><span class="at"> /etc/prometheus/</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> config-volume</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">configMap</span><span class="kw">:</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">name</span><span class="kw">:</span><span class="at"> prometheus-config</span></span></code></pre></div></li>
<li><p><strong>Service for Prometheus</strong>: We need to create a
service to expose Prometheus in our cluster:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Service</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> prometheus</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> monitoring</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">9090</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">targetPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">9090</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">app</span><span class="kw">:</span><span class="at"> prometheus</span></span></code></pre></div></li>
<li><p><strong>Verify Configuration</strong>: After we deploy, we must
check if Prometheus is scraping our application metrics. We can do this
by accessing the Prometheus UI. First, we use port-forwarding to reach
the Prometheus service:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> port-forward service/prometheus 9090:9090 <span class="at">-n</span> monitoring</span></code></pre></div>
<p>Then we go to <code>http://localhost:9090/targets</code> to see the
list of active targets.</p></li>
</ol>
<p>By doing these steps, we can configure Prometheus to scrape metrics
from our Kubernetes applications. This makes monitoring and
observability much better. For more details on monitoring Kubernetes, we
can read this <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-set-up-kubernetes-monitoring-and-alerting.html">article
on setting up monitoring and alerting</a>.</p>
<h2 id="how-do-i-create-grafana-dashboards-for-visualizing-metrics">How
Do I Create Grafana Dashboards for Visualizing Metrics?</h2>
<p>We can create Grafana dashboards to see metrics from our Kubernetes
app that Prometheus monitors. Here are the steps:</p>
<ol type="1">
<li><p><strong>Access Grafana</strong>: First, we open our web browser.
Then we go to our Grafana URL. It is usually
<code>http://&lt;your-grafana-ip&gt;:3000</code>. We log in using our
credentials. The default is admin/admin.</p></li>
<li><p><strong>Add Prometheus as a Data Source</strong>:</p>
<ul>
<li>We click on the gear icon (⚙️) on the left side to open the settings
menu.</li>
<li>We choose <strong>Data Sources</strong>.</li>
<li>Next, we click on <strong>Add data source</strong> and pick
<strong>Prometheus</strong>.</li>
<li>We set up the Prometheus data source by typing in the URL, which is
usually <code>http://prometheus-server:9090</code>. Then we click
<strong>Save &amp; Test</strong> to check the connection.</li>
</ul></li>
<li><p><strong>Create a New Dashboard</strong>:</p>
<ul>
<li>We click on the plus icon (➕) in the sidebar and choose
<strong>Dashboard</strong>.</li>
<li>Then we click on <strong>Add new panel</strong> to start making our
first visualization.</li>
</ul></li>
<li><p><strong>Configure the Panel</strong>:</p>
<ul>
<li><p>In the new panel, we can pick the type of visualization we want.
This could be Graph, Gauge, Table, and more.</p></li>
<li><p>Under the <strong>Queries</strong> tab, we select our Prometheus
data source.</p></li>
<li><p>We type our Prometheus query. For example, to show CPU usage, we
can use:</p>
<pre class="promql"><code>sum(rate(container_cpu_usage_seconds_total[5m])) by (pod)</code></pre></li>
</ul></li>
<li><p><strong>Customize the Panel</strong>:</p>
<ul>
<li>In the <strong>Panel</strong> tab, we set the title and description
for our panel.</li>
<li>We can change settings for visualization. This includes axes,
legends, and thresholds to make it look better.</li>
</ul></li>
<li><p><strong>Save the Dashboard</strong>:</p>
<ul>
<li>We click on the disk icon (💾) at the top to save our
dashboard.</li>
<li>We give a name for our dashboard and choose a folder if we need
to.</li>
</ul></li>
<li><p><strong>Add More Panels</strong>:</p>
<ul>
<li>We can repeat steps 3 to 6 to add more panels. We can visualize
different metrics like memory usage or request latency.</li>
</ul></li>
<li><p><strong>Organize and Share</strong>:</p>
<ul>
<li>We arrange panels by dragging them where we want.</li>
<li>We can share the dashboard with our team by clicking on the share
icon (🔗) and choosing how to share.</li>
</ul></li>
</ol>
<p>By following these steps, we can create and customize Grafana
dashboards. This helps us see metrics from our Kubernetes apps that
Prometheus monitors. For more help on using Grafana, we can check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">this
resource on monitoring Kubernetes applications</a>.</p>
<h2
id="what-are-some-real-life-use-cases-for-monitoring-kubernetes-applications">What
Are Some Real Life Use Cases for Monitoring Kubernetes
Applications?</h2>
<p>Monitoring Kubernetes applications with Prometheus and Grafana is
very important. It helps us keep good performance, reliability, and
observability. Here are some real-life examples that show why monitoring
is needed in a Kubernetes environment.</p>
<ol type="1">
<li><p><strong>Performance Optimization</strong>: We can track things
like CPU usage, memory use, and request time. This helps us find slow
spots and make our applications better. For example, if a microservice
uses too much CPU all the time, we can check the code or think about
scaling the service.</p></li>
<li><p><strong>Resource Management</strong>: When we monitor how much
resources we use, we can allocate them better. If some pods do not use
much, we can give their resources to applications that need more. This
makes the whole cluster work better.</p></li>
<li><p><strong>Alerting on Anomalies</strong>: We can set up alerts
using Prometheus. This lets us quickly respond to issues. For example,
if error rates go above a set limit, alerts can inform engineers to look
into the problems.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">groups</span><span class="kw">:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-alert</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">alert</span><span class="kw">:</span><span class="at"> HighErrorRate</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> sum(rate(http_requests_total{status=&quot;500&quot;}[5m])) &gt; 0.05</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">for</span><span class="kw">:</span><span class="at"> 10m</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">severity</span><span class="kw">:</span><span class="at"> critical</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">summary</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;High error rate detected&quot;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;More than 5% of HTTP requests are failing in the last 10 minutes.&quot;</span></span></code></pre></div></li>
<li><p><strong>Capacity Planning</strong>: We can use past data from
metrics to guess future resource needs. If a web application gets more
traffic at certain times, monitoring helps us plan for scaling during
busy times.</p></li>
<li><p><strong>Debugging and Troubleshooting</strong>: When problems
happen, having good metrics and logs helps us fix them faster. For
example, if an application is slow, teams can compare metrics from
Prometheus with logs from Grafana to find the problem.</p></li>
<li><p><strong>User Experience Monitoring</strong>: By adding
application performance monitoring (APM) metrics, we can track how users
interact and how fast things respond. This helps us ensure users have a
good experience. For example, checking frontend metrics with backend
metrics can show if slow response times are because of backend issues or
frontend problems.</p></li>
<li><p><strong>Security Monitoring</strong>: Monitoring Kubernetes
applications can help us find security issues. By watching for strange
spikes in traffic or unauthorized access attempts, teams can quickly
respond to possible threats.</p></li>
<li><p><strong>Multi-Cloud and Hybrid Environment Monitoring</strong>:
For teams that use applications across different cloud providers or
hybrid environments, monitoring helps us see performance and
availability in one view.</p></li>
</ol>
<p>Using Prometheus and Grafana helps us understand our Kubernetes
applications better. This allows us to manage proactively and improve
how we operate. For more information on how to set up monitoring in
Kubernetes, check out <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">how
to monitor my Kubernetes cluster</a>.</p>
<h2
id="how-do-i-set-up-alerts-for-my-kubernetes-application-with-prometheus">How
Do I Set Up Alerts for My Kubernetes Application with Prometheus?</h2>
<p>We can set up alerts for our Kubernetes application using Prometheus.
First, we need to define alerting rules in a file. Then we make sure
Prometheus checks these rules. Let’s go through this step by step.</p>
<ol type="1">
<li><p><strong>Create Alerting Rules File</strong>:<br />
We create a YAML file. We can name it <code>alert.rules.yml</code>. In
this file, we write our alerting rules. Here is an example that raises
an alert if the error rate of the application goes above a certain
point:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">groups</span><span class="kw">:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-alerts</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">alert</span><span class="kw">:</span><span class="at"> HighErrorRate</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> sum(rate(http_requests_total{status=&quot;500&quot;}[5m])) / sum(rate(http_requests_total[5m])) &gt; 0.1</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">for</span><span class="kw">:</span><span class="at"> 5m</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">severity</span><span class="kw">:</span><span class="at"> critical</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">summary</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;High error rate detected&quot;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;More than 10% of requests are failing in the last 5 minutes.&quot;</span></span></code></pre></div></li>
<li><p><strong>Update Prometheus Configuration</strong>:<br />
Next, we need to change the Prometheus configuration file. This file is
usually called <code>prometheus.yml</code>. We add our alerting rules
file in it.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rule_files</span><span class="kw">:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;alert.rules.yml&quot;</span></span></code></pre></div></li>
<li><p><strong>Configure Alertmanager</strong>:<br />
If we have not done this yet, we need to set up Alertmanager to manage
alerts from Prometheus. We will update the Alertmanager configuration
file, for example, <code>alertmanager.yml</code>, to say how to handle
alerts:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global</span><span class="kw">:</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resolve_timeout</span><span class="kw">:</span><span class="at"> 5m</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">route</span><span class="kw">:</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group_by</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&#39;alertname&#39;</span><span class="kw">]</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group_interval</span><span class="kw">:</span><span class="at"> 5m</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">repeat_interval</span><span class="kw">:</span><span class="at"> 3h</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">receiver</span><span class="kw">:</span><span class="at"> email</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">receivers</span><span class="kw">:</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> email</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">email_configs</span><span class="kw">:</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">to</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;alerts@example.com&#39;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;alertmanager@example.com&#39;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">smarthost</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;smtp.example.com:587&#39;</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">auth_username</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;alertmanager@example.com&#39;</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">auth_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;yourpassword&#39;</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">auth_identity</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;alertmanager@example.com&#39;</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">require_tls</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre></div></li>
<li><p><strong>Deploy Prometheus and Alertmanager</strong>:<br />
We need to make sure both Prometheus and Alertmanager are running in our
Kubernetes cluster. We can use Helm or Kubernetes manifests for this.
Here is an example command to install Prometheus with Helm:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install prometheus prometheus-community/prometheus <span class="at">--namespace</span> monitoring</span></code></pre></div></li>
<li><p><strong>Verify Alerting Configuration</strong>:<br />
After we deploy, we should check if our alerts are working. We can look
at the Prometheus UI under the “Alerts” section. There we should see our
alerts listed.</p></li>
<li><p><strong>Test the Alerts</strong>:<br />
To make sure alerts are triggered, we can create conditions that would
cause them. For example, we can generate errors in our application. We
will check the Alertmanager UI to see if it got the alerts and if
notifications are sent as we set.</p></li>
</ol>
<p>For more information on monitoring Kubernetes applications and
setting up Prometheus, we can read <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-set-up-kubernetes-monitoring-and-alerting.html">this
guide</a>.</p>
<h2
id="how-do-we-troubleshoot-common-issues-with-prometheus-and-grafana">How
Do We Troubleshoot Common Issues with Prometheus and Grafana?</h2>
<p>When we monitor Kubernetes apps with Prometheus and Grafana, we may
see different issues. Here are some common problems and simple steps to
fix them:</p>
<ol type="1">
<li><strong>Prometheus Not Scraping Metrics</strong>:
<ul>
<li><p>First, check if the app shows metrics at the right endpoint. This
is usually <code>/metrics</code>.</p></li>
<li><p>Next, look at the Prometheus config file
(<code>prometheus.yml</code>). Make sure the scrape job is set up
right:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scrape_configs</span><span class="kw">:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">job_name</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;my-k8s-app&#39;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kubernetes_sd_configs</span><span class="kw">:</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">role</span><span class="kw">:</span><span class="at"> endpoints</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">relabel_configs</span><span class="kw">:</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">source_labels</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">__meta_kubernetes_service_name</span><span class="kw">]</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">action</span><span class="kw">:</span><span class="at"> keep</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">regex</span><span class="kw">:</span><span class="at"> my-service</span></span></code></pre></div></li>
<li><p>Also, make sure the service account that Prometheus uses has the
right permissions to find services.</p></li>
</ul></li>
<li><strong>Grafana Not Displaying Data</strong>:
<ul>
<li>We need to check if the data source in Grafana points to our
Prometheus instance correctly.</li>
<li>Test the data source connection in Grafana settings to see if it
works.</li>
<li>Look at the time range in Grafana. If it is too narrow, we may not
see any data.</li>
</ul></li>
<li><strong>High Resource Usage by Prometheus</strong>:
<ul>
<li><p>Check the retention settings in the <code>prometheus.yml</code>
file. If we reduce the retention time, it can help with resource
use.</p></li>
<li><p>Also, make sure we are not scraping too often. Change the
<code>scrape_interval</code> to a better value:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scrape_interval</span><span class="kw">:</span><span class="at"> 30s</span></span></code></pre></div></li>
</ul></li>
<li><strong>Alertmanager Not Sending Alerts</strong>:
<ul>
<li><p>We need to check the Alertmanager config in
<code>alertmanager.yml</code>. Make sure routing and receivers are set
up right:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">route</span><span class="kw">:</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group_by</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&#39;alertname&#39;</span><span class="kw">]</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">receiver</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;email&#39;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">receivers</span><span class="kw">:</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;email&#39;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">email_configs</span><span class="kw">:</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">to</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;alerts@example.com&#39;</span></span></code></pre></div></li>
<li><p>Look at the logs of Alertmanager for any errors about sending
alerts.</p></li>
</ul></li>
<li><strong>Dashboard Panels Not Rendering</strong>:
<ul>
<li>Check the query in the Grafana panel. We can use the Query Inspector
to see if the query returns data.</li>
<li>Make sure the visualization type is correct for the data we are
querying.</li>
</ul></li>
<li><strong>Network Issues</strong>:
<ul>
<li>We can use <code>kubectl port-forward</code> to access Prometheus or
Grafana locally and see if they are reachable.</li>
<li>Check that network policies allow communication between Prometheus,
Grafana, and our apps.</li>
</ul></li>
<li><strong>Logs and Debugging</strong>:
<ul>
<li><p>Look at the logs for both Prometheus and Grafana for any error
messages that can help us understand the issue:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="op">&lt;</span>prometheus-pod-name<span class="op">&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="op">&lt;</span>grafana-pod-name<span class="op">&gt;</span></span></code></pre></div></li>
<li><p>We can also use the <code>kubectl describe</code> command on pods
to check for any events that show problems.</p></li>
</ul></li>
<li><strong>Configuration Issues</strong>:
<ul>
<li>Validate YAML syntax using online tools or command-line tools like
<code>yamllint</code> to find syntax errors.</li>
<li>Use Prometheus and Grafana documentation to check that our
configurations match the expected formats.</li>
</ul></li>
</ol>
<p>By following these steps, we can fix common issues when monitoring
Kubernetes apps with Prometheus and Grafana. For more details on setting
up monitoring and alerts, we can check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-set-up-kubernetes-monitoring-and-alerting.html">this
article on setting up Kubernetes monitoring and alerting</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="what-is-prometheus-and-how-does-it-work-with-kubernetes">1. What
is Prometheus and how does it work with Kubernetes?</h3>
<p>Prometheus is a free tool for monitoring and alerting. It helps us
keep track of how our systems are doing. It collects data from set
targets at regular times. Then, it stores this data in its time-series
database. We can also ask questions about this data to see what is
happening right now. In Kubernetes, Prometheus finds services
automatically using the Kubernetes API. This lets it gather data from
pods that have HTTP endpoints.</p>
<h3 id="how-can-i-visualize-kubernetes-metrics-using-grafana">2. How can
I visualize Kubernetes metrics using Grafana?</h3>
<p>Grafana is a great tool for showing data visually. It works well with
Prometheus to show the data we collect from our Kubernetes apps. When we
connect Grafana to our Prometheus data, we can make our own dashboards.
These dashboards can show different data like CPU usage, memory use, and
how our apps are performing. This helps us see how healthy and strong
our Kubernetes setups are.</p>
<h3
id="what-are-the-key-prerequisites-for-setting-up-prometheus-and-grafana-in-kubernetes">3.
What are the key prerequisites for setting up Prometheus and Grafana in
Kubernetes?</h3>
<p>Before we start with Prometheus and Grafana in our Kubernetes
cluster, we need to have a working Kubernetes environment. This can be a
local Minikube cluster or a cloud service like AWS EKS or GKE. We also
need to have <code>kubectl</code> installed to manage our Kubernetes
resources. It helps if we know how to deploy apps in Kubernetes to make
the setup easier.</p>
<h3
id="how-do-i-set-up-alerts-for-my-kubernetes-applications-using-prometheus">4.
How do I set up alerts for my Kubernetes applications using
Prometheus?</h3>
<p>To set up alerts for our Kubernetes apps with Prometheus, we need to
create alert rules in the Prometheus configuration. These rules tell us
when to trigger alerts based on the data we collect. We can use
Alertmanager from Prometheus to handle these alerts. It can send us
messages through email, Slack, or other ways when we reach certain
limits. This way, we can monitor things before they become a big
problem.</p>
<h3
id="what-are-some-common-troubleshooting-steps-for-prometheus-and-grafana-issues-in-kubernetes">5.
What are some common troubleshooting steps for Prometheus and Grafana
issues in Kubernetes?</h3>
<p>When we face problems with Prometheus and Grafana in Kubernetes, we
might see issues like metrics not being collected or wrong data sources.
To start fixing these, we should check the logs of both Prometheus and
Grafana pods using <code>kubectl logs</code>. We also need to make sure
our service discovery settings for Prometheus are correct. Lastly, we
should check if our Grafana dashboards are linked to the right
Prometheus data source.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            