
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <title>How Do I Use Kubernetes Secrets to Store Database Credentials?</title>
            <meta name="description" content="Learn how to securely store database credentials using Kubernetes Secrets in this comprehensive guide. Enhance your app's security!">

            <div id="head-placeholder"></div>
            <script src="/assets/js/blog.js" defer></script>
            <link rel="stylesheet" href="/assets/css/post.css">
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How Do I Use Kubernetes Secrets to Store Database Credentials?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>Kubernetes Secrets are a way that Kubernetes gives us to store and
manage sensitive information. This includes things like database
passwords, API keys, and other credentials. By using Kubernetes Secrets,
we can keep this sensitive data safe and separate from our application
code. This helps reduce the chance of exposing important information and
improves security in container environments.</p>
<p>In this article, we will talk about how to use Kubernetes Secrets to
store database credentials safely. We will look at what Kubernetes
Secrets are and why they are important. We will also go over how to
create and access Secrets in your Pods. We will share best practices for
managing them. Plus, we will show how to update Secrets without causing
any downtime. We will also give a real-life example by storing
PostgreSQL credentials in Kubernetes Secrets. At the end, we will answer
some common questions about Kubernetes Secrets.</p>
<ul>
<li>How Do I Use Kubernetes Secrets to Securely Store Database
Credentials?</li>
<li>What Are Kubernetes Secrets and Why Use Them?</li>
<li>How to Create a Kubernetes Secret for Database Credentials?</li>
<li>How to Access Kubernetes Secrets in Your Pods?</li>
<li>Best Practices for Managing Kubernetes Secrets</li>
<li>How to Update Kubernetes Secrets Without Downtime?</li>
<li>Real-Life Use Case: Storing PostgreSQL Credentials in Kubernetes
Secrets</li>
<li>How to Use Environment Variables with Kubernetes Secrets?</li>
<li>How to Encrypt Kubernetes Secrets at Rest?</li>
<li>Frequently Asked Questions</li>
</ul>
<p>For more reading on Kubernetes and its parts, check out articles like
<a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubernetes-and-how-does-it-simplify-container-management.html">What
is Kubernetes and How Does It Simplify Container Management?</a> and <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">How
Do I Manage Secrets in Kubernetes Securely?</a>.</p>
<h2 id="what-are-kubernetes-secrets-and-why-use-them">What Are
Kubernetes Secrets and Why Use Them?</h2>
<p>Kubernetes Secrets are objects in Kubernetes. They help us store
sensitive information like passwords, OAuth tokens, and SSH keys.
Secrets keep sensitive data out of our application code. They also give
us a safer way to manage credentials in our Kubernetes clusters.</p>
<h3 id="why-use-kubernetes-secrets">Why Use Kubernetes Secrets?</h3>
<ul>
<li><strong>Security</strong>: Secrets are base64-encoded. They can be
encrypted when stored. This reduces the chance of someone seeing
sensitive data compared to putting it directly in our application
code.</li>
<li><strong>Access Control</strong>: We can control who can see Secrets.
We do this with Kubernetes Role-Based Access Control (RBAC). This makes
sure only authorized users and applications can access them.</li>
<li><strong>Decoupling</strong>: By separating configuration data from
application code, we can change Secrets without needing to rebuild or
redeploy our applications.</li>
<li><strong>Environment Management</strong>: We can easily manage
Secrets for each environment like development, staging, and production.
This gives us flexible ways to deploy.</li>
</ul>
<h3 id="example-of-creating-a-kubernetes-secret">Example of Creating a
Kubernetes Secret</h3>
<p>To create a Kubernetes Secret for database credentials, we can use
this command:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create secret generic db-credentials <span class="dt">\</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--from-literal</span><span class="op">=</span>username=myuser <span class="dt">\</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--from-literal</span><span class="op">=</span>password=mypassword</span></code></pre></div>
<p>This command makes a Secret called <code>db-credentials</code> with
the username and password we specified.</p>
<h3 id="accessing-secrets">Accessing Secrets</h3>
<p>We can access Kubernetes Secrets in our Pods in two main ways: as
environment variables or as mounted volumes. Here is an example of using
them as environment variables:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> db-pod</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-database-container</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my-database-image</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> DB_USERNAME</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">name</span><span class="kw">:</span><span class="at"> db-credentials</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">key</span><span class="kw">:</span><span class="at"> username</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> DB_PASSWORD</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">name</span><span class="kw">:</span><span class="at"> db-credentials</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">key</span><span class="kw">:</span><span class="at"> password</span></span></code></pre></div>
<p>Using Kubernetes Secrets makes our security better. It also makes it
easier to manage sensitive information in our applications. For more
details on managing Secrets securely, check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">this
article</a>.</p>
<h2 id="how-to-create-a-kubernetes-secret-for-database-credentials">How
to Create a Kubernetes Secret for Database Credentials?</h2>
<p>We can store database credentials safely in Kubernetes by making a
Kubernetes Secret. Secrets are for keeping sensitive info like
passwords, OAuth tokens, and SSH keys. Here is a simple way to create a
Kubernetes Secret for database credentials.</p>
<h3 id="step-1-prepare-your-credentials">Step 1: Prepare Your
Credentials</h3>
<p>Let’s say we have these database credentials:</p>
<ul>
<li>Username: <code>db-user</code></li>
<li>Password: <code>db-password</code></li>
</ul>
<h3 id="step-2-create-the-secret">Step 2: Create the Secret</h3>
<p>We can create a Secret with <code>kubectl</code> or by using a YAML
file.</p>
<h4 id="option-1-using-kubectl-command">Option 1: Using kubectl
Command</h4>
<p>We can run this command in our terminal:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create secret generic db-credentials <span class="dt">\</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--from-literal</span><span class="op">=</span>username=db-user <span class="dt">\</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--from-literal</span><span class="op">=</span>password=db-password</span></code></pre></div>
<h4 id="option-2-using-a-yaml-file">Option 2: Using a YAML File</h4>
<p>We can make a file called <code>db-credentials.yaml</code> with this
content:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> db-credentials</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">username</span><span class="kw">:</span><span class="at"> ZGItdXNlcg==</span><span class="co"> # base64 encoded value of &#39;db-user&#39;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at"> ZGItcGFzc3dvcmQ=</span><span class="co"> # base64 encoded value of &#39;db-password&#39;</span></span></code></pre></div>
<p>To encode our values to base64, we can use this command:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-n</span> <span class="st">&#39;db-user&#39;</span> <span class="kw">|</span> <span class="fu">base64</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-n</span> <span class="st">&#39;db-password&#39;</span> <span class="kw">|</span> <span class="fu">base64</span></span></code></pre></div>
<p>After we create the YAML file, we apply it like this:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> db-credentials.yaml</span></code></pre></div>
<h3 id="step-3-verify-the-creation">Step 3: Verify the Creation</h3>
<p>We can check if the Secret is created by running:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get secrets</span></code></pre></div>
<p>To see the details of the Secret we created, we run:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> describe secret db-credentials</span></code></pre></div>
<p>This process helps us store our database credentials securely in
Kubernetes Secrets. Now, our applications can access sensitive info
without putting it directly in configuration files. For more help on
managing Kubernetes Secrets safely, we can look at <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">this
article</a>.</p>
<h2 id="how-to-access-kubernetes-secrets-in-your-pods">How to Access
Kubernetes Secrets in Your Pods?</h2>
<p>We can access Kubernetes secrets in our pods using environment
variables or volume mounts. Here are the easy methods to do this.</p>
<h3 id="using-environment-variables">Using Environment Variables</h3>
<p>We can inject secrets into our pods as environment variables. Here is
an example:</p>
<ol type="1">
<li><p><strong>Create a Secret</strong>:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create secret generic db-credentials <span class="dt">\</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>--from-literal=username=myuser <span class="dt">\</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>--from-literal=password=mypassword</span></code></pre></div></li>
<li><p><strong>Reference the Secret in a Pod</strong>:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myapp</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myapp-container</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">image</span><span class="kw">:</span><span class="at"> myapp-image</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> DB_USERNAME</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">name</span><span class="kw">:</span><span class="at"> db-credentials</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">key</span><span class="kw">:</span><span class="at"> username</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> DB_PASSWORD</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">name</span><span class="kw">:</span><span class="at"> db-credentials</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">key</span><span class="kw">:</span><span class="at"> password</span></span></code></pre></div></li>
</ol>
<h3 id="using-volume-mounts">Using Volume Mounts</h3>
<p>We can also mount a secret as a volume in our pod:</p>
<ol type="1">
<li><p><strong>Create a Secret</strong>:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create secret generic db-config <span class="dt">\</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>--from-file=config.txt</span></code></pre></div></li>
<li><p><strong>Reference the Secret in a Pod</strong>:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myapp</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myapp-container</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">image</span><span class="kw">:</span><span class="at"> myapp-image</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">volumeMounts</span><span class="kw">:</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> config-volume</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">mountPath</span><span class="kw">:</span><span class="at"> /etc/config</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> config-volume</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">secret</span><span class="kw">:</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">secretName</span><span class="kw">:</span><span class="at"> db-config</span></span></code></pre></div></li>
</ol>
<h3 id="accessing-secrets-in-the-application">Accessing Secrets in the
Application</h3>
<p>After we inject the secrets as environment variables or mount them as
files, our application can access them like this:</p>
<ul>
<li><p><strong>For environment variables</strong>: We access them as
normal environment variable in our programming language. For example, in
Python:
<code>python  import os  username = os.getenv('DB_USERNAME')  password = os.getenv('DB_PASSWORD')</code></p></li>
<li><p><strong>For mounted files</strong>: We can read the file directly
from the mount path. For example, in Python:
<code>python  with open('/etc/config/config.txt') as f:      config_data = f.read()</code></p></li>
</ul>
<p>Using Kubernetes secrets helps us keep sensitive information safe. It
also allows our applications to access necessary credentials. For more
information on managing secrets, check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">how
to manage secrets in Kubernetes securely</a>.</p>
<h2 id="best-practices-for-managing-kubernetes-secrets">Best Practices
for Managing Kubernetes Secrets</h2>
<p>Managing Kubernetes Secrets is very important. We need to keep
sensitive information safe. This includes things like database
passwords. Here are some best practices we can follow for managing
Kubernetes Secrets:</p>
<ul>
<li><p><strong>Use Encryption</strong>: Always turn on encryption for
your Kubernetes Secrets. This helps keep them safe from people who
should not see them. We can set this up in the Kubernetes API server by
using the <code>EncryptionConfiguration</code> file.</p></li>
<li><p><strong>Limit Secret Access</strong>: Use Role-Based Access
Control (RBAC). This helps us control who can see or change Secrets. We
should only let users and applications that really need access to get or
change Secrets.</p></li>
<li><p><strong>Regularly Rotate Secrets</strong>: We should have a plan
to change Secrets often. This helps reduce the chance of someone seeing
them. We can use tools like HashiCorp Vault or other external Secret
management tools to help with this.</p></li>
<li><p><strong>Avoid Hardcoding Secrets</strong>: Do not put Secrets
directly in your application code or config files. Instead, we can use
Kubernetes Secrets and environment variables to add them safely when our
app starts.</p></li>
<li><p><strong>Namespace Isolation</strong>: We should use different
namespaces for different environments. For example, we can have separate
namespaces for development, testing, and production. This helps keep
Secrets separate and reduces the risk of them being seen by
mistake.</p></li>
<li><p><strong>Audit and Monitor Secrets Usage</strong>: We should turn
on auditing to track how Secrets are accessed. It is important to check
logs for any strange access attempts or unusual use of Secrets.</p></li>
<li><p><strong>Limit Secret Size</strong>: It is best to keep our
Secrets small. The biggest size for a Kubernetes Secret is 1MB, but we
should try to make them even smaller. This helps with performance and
makes them easier to manage.</p></li>
<li><p><strong>Use External Secret Management</strong>: For better
security, we can think about using external secret management services.
Tools like AWS Secrets Manager, Azure Key Vault, or HashiCorp Vault are
good options. We can connect them with Kubernetes using tools like <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">Kubernetes
External Secrets</a>.</p></li>
<li><p><strong>Avoid Exposing Secrets in Logs</strong>: We need to make
sure our application does not log Secrets or other sensitive info. We
should check logging settings to stop any accidental leaks.</p></li>
<li><p><strong>Review and Clean Up Unused Secrets</strong>: We should
regularly check our Secrets and delete any that we don’t use anymore.
This helps reduce risks and keeps our cluster tidy.</p></li>
</ul>
<p>By following these best practices, we can manage Kubernetes Secrets
better and make our application’s sensitive information more secure.</p>
<h2 id="how-to-update-kubernetes-secrets-without-downtime">How to Update
Kubernetes Secrets Without Downtime?</h2>
<p>We can update Kubernetes Secrets without making downtime. Follow
these steps to keep our applications running smoothly during the
update.</p>
<ol type="1">
<li><p><strong>Create the New Secret</strong>: We use the
<code>kubectl create secret</code> command for making a new version of
the secret. We can use a different name or just replace the old one.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create secret generic my-database-secret <span class="at">--from-literal</span><span class="op">=</span>username=newuser <span class="at">--from-literal</span><span class="op">=</span>password=newpassword <span class="at">--dry-run</span><span class="op">=</span>client <span class="at">-o</span> yaml <span class="kw">|</span> <span class="ex">kubectl</span> apply <span class="at">-f</span> <span class="at">-</span></span></code></pre></div></li>
<li><p><strong>Update the Deployment</strong>: We need to change our
deployment to point to the new secret. If we keep the same secret name,
updating it will make the pods restart when they next use the
secret.</p>
<p>We update the deployment YAML like this:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app-container</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my-app-image</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> DB_USERNAME</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-database-secret</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">key</span><span class="kw">:</span><span class="at"> username</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> DB_PASSWORD</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-database-secret</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">key</span><span class="kw">:</span><span class="at"> password</span></span></code></pre></div></li>
<li><p><strong>Rolling Update</strong>: We can use rolling updates to
change our deployment without downtime. Kubernetes will slowly replace
old pods with new ones that use the updated secret.</p>
<p>To start a rolling update, we run:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout restart deployment/my-app</span></code></pre></div></li>
<li><p><strong>Monitor the Update</strong>: We should check the status
of the rollout to make sure all pods are updated correctly:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout status deployment/my-app</span></code></pre></div></li>
<li><p><strong>Verify the Update</strong>: After the rollout finishes,
we need to check that our application works well with the new secret
values.</p></li>
</ol>
<p>This method helps us manage and update Kubernetes Secrets without
stopping our service. Our applications can keep running during updates.
For more details about managing Kubernetes Secrets, we can check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">how
do I manage secrets in Kubernetes securely</a>.</p>
<h2
id="real-life-use-case-storing-postgresql-credentials-in-kubernetes-secrets">Real-Life
Use Case: Storing PostgreSQL Credentials in Kubernetes Secrets</h2>
<p>Storing database credentials safely is very important for any
application. We can use Kubernetes Secrets to manage sensitive info like
PostgreSQL credentials. This way, we do not expose them in our
application code or config files.</p>
<h3
id="creating-a-kubernetes-secret-for-postgresql-credentials">Creating a
Kubernetes Secret for PostgreSQL Credentials</h3>
<p>To store PostgreSQL credentials in Kubernetes Secrets, we can create
a secret with this command:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create secret generic postgres-secret <span class="dt">\</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--from-literal</span><span class="op">=</span>POSTGRES_USER=myuser <span class="dt">\</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--from-literal</span><span class="op">=</span>POSTGRES_PASSWORD=mypassword</span></code></pre></div>
<p>This command makes a secret called <code>postgres-secret</code>. It
has two key-value pairs: <code>POSTGRES_USER</code> and
<code>POSTGRES_PASSWORD</code>.</p>
<h3 id="accessing-postgresql-credentials-in-your-pods">Accessing
PostgreSQL Credentials in Your Pods</h3>
<p>We can access the stored secrets in our pods by mounting them as
environment variables or files. Here is how to use the secret in a pod
YAML definition:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> postgres-pod</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> postgres-container</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres:latest</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> POSTGRES_USER</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">name</span><span class="kw">:</span><span class="at"> postgres-secret</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">key</span><span class="kw">:</span><span class="at"> POSTGRES_USER</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> POSTGRES_PASSWORD</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">name</span><span class="kw">:</span><span class="at"> postgres-secret</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">key</span><span class="kw">:</span><span class="at"> POSTGRES_PASSWORD</span></span></code></pre></div>
<p>This setup puts the environment variables <code>POSTGRES_USER</code>
and <code>POSTGRES_PASSWORD</code> straight from the Kubernetes
Secret.</p>
<h3 id="best-practices-for-managing-kubernetes-secrets-1">Best Practices
for Managing Kubernetes Secrets</h3>
<ul>
<li><strong>Limit Access</strong>: We should use Role-Based Access
Control (RBAC) to limit who can access the secrets.</li>
<li><strong>Regularly Rotate Secrets</strong>: We must update secrets
often to reduce exposure.</li>
<li><strong>Use Encryption</strong>: We can enable encryption at rest
for secrets in etcd.</li>
<li><strong>Audit Access</strong>: We should keep logs of who accesses
secrets for monitoring and security checks.</li>
</ul>
<p>For more info on security best practices, we can check <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-security-best-practices.html">Kubernetes
Security Best Practices</a>.</p>
<h3 id="updating-postgresql-credentials-without-downtime">Updating
PostgreSQL Credentials Without Downtime</h3>
<p>To update the PostgreSQL credentials in a Kubernetes Secret, we can
use this command:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create secret generic postgres-secret <span class="dt">\</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--from-literal</span><span class="op">=</span>POSTGRES_USER=newuser <span class="dt">\</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--from-literal</span><span class="op">=</span>POSTGRES_PASSWORD=newpassword <span class="dt">\</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">--dry-run</span><span class="op">=</span>client <span class="at">-o</span> yaml <span class="kw">|</span> <span class="ex">kubectl</span> apply <span class="at">-f</span> <span class="at">-</span></span></code></pre></div>
<p>This command updates the secret without any downtime. We need to make
sure our application can handle the update nicely.</p>
<h3 id="using-environment-variables-with-kubernetes-secrets">Using
Environment Variables with Kubernetes Secrets</h3>
<p>As we see in the pod example, Kubernetes lets us inject secrets as
environment variables. This way, we keep sensitive data safe within the
container runtime. It also avoids hardcoding credentials in our
application code.</p>
<h3 id="encrypting-kubernetes-secrets-at-rest">Encrypting Kubernetes
Secrets at Rest</h3>
<p>To encrypt our Kubernetes Secrets at rest, we can change our
<code>EncryptionConfiguration</code> in the Kubernetes API server
config:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apiserver.k8s.io/v1</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> EncryptionConfiguration</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">resources</span><span class="kw">:</span><span class="at"> secrets</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">providers</span><span class="kw">:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">aescbc</span><span class="kw">:</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">secret</span><span class="kw">:</span><span class="at"> AESCBC-encryption-key</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">identity</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span></span></code></pre></div>
<p>This config makes sure that secrets are encrypted in etcd. This
improves security.</p>
<p>By following these steps, we can manage and secure PostgreSQL
credentials in Kubernetes using Secrets. This way not only improves
security but also makes it easier to manage sensitive data in our
Kubernetes environment.</p>
<h2 id="how-to-use-environment-variables-with-kubernetes-secrets">How to
Use Environment Variables with Kubernetes Secrets?</h2>
<p>We can use environment variables with Kubernetes Secrets to safely
add sensitive information like database passwords into our apps that run
on Kubernetes. This way, we keep our credentials away from our app code
and Kubernetes files. It helps to make things more secure.</p>
<p>To use Kubernetes Secrets as environment variables, we follow these
steps:</p>
<ol type="1">
<li><p><strong>Create a Kubernetes Secret</strong>: First, we need to
make a secret that holds our database details. For example, if we want
to save a PostgreSQL username and password, we can run this command:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create secret generic postgres-secret <span class="dt">\</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--from-literal</span><span class="op">=</span>username=myuser <span class="dt">\</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--from-literal</span><span class="op">=</span>password=mypassword</span></code></pre></div></li>
<li><p><strong>Define the Secret in Your Pod Specification</strong>:
Next, we need to mention the secret in our Pod file. We say which
environment variables should get the secret values. Here is an example
of a Pod YAML setup:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-container</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my-app-image</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> POSTGRES_USER</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">name</span><span class="kw">:</span><span class="at"> postgres-secret</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">key</span><span class="kw">:</span><span class="at"> username</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> POSTGRES_PASSWORD</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">name</span><span class="kw">:</span><span class="at"> postgres-secret</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">key</span><span class="kw">:</span><span class="at"> password</span></span></code></pre></div></li>
<li><p><strong>Access Environment Variables in Your
Application</strong>: Now, in our app, we can use these environment
variables like we normally do in our programming language. For example,
in a Python app, we can get the variables like this:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>postgres_user <span class="op">=</span> os.getenv(<span class="st">&quot;POSTGRES_USER&quot;</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>postgres_password <span class="op">=</span> os.getenv(<span class="st">&quot;POSTGRES_PASSWORD&quot;</span>)</span></code></pre></div></li>
</ol>
<p>By doing these steps, we can safely handle our database details using
Kubernetes Secrets and environment variables. This keeps our sensitive
data safe and easy to reach in our app.</p>
<p>For more information on how to manage secrets in Kubernetes, check
the article on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">how
to manage secrets in Kubernetes securely</a>.</p>
<h2 id="how-to-encrypt-kubernetes-secrets-at-rest">How to Encrypt
Kubernetes Secrets at Rest?</h2>
<p>Kubernetes Secrets can be sensitive. It is very important to encrypt
them at rest for better security. By default, Kubernetes saves Secrets
in etcd as plain text. To enable encryption at rest, we can follow these
steps:</p>
<ol type="1">
<li><p><strong>Configure Encryption Providers</strong>: We need to edit
the Kubernetes API server configuration. This is to set the encryption
providers. We can do this by changing the
<code>kube-apiserver.yaml</code> file or the configuration file we use.
Here is an example of the configuration:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> EncryptionConfig</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> secrets</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">providers</span><span class="kw">:</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">aescbc</span><span class="kw">:</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">keys</span><span class="kw">:</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> key1</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">secret</span><span class="kw">:</span><span class="at"> &lt;base64-encoded-key&gt;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">identity</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span></span></code></pre></div>
<p>We should replace <code>&lt;base64-encoded-key&gt;</code> with a
base64-encoded key for encryption.</p></li>
<li><p><strong>Update API Server Flags</strong>: We must add the
encryption configuration file to the API server start command. For
example:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">--encryption-provider-config=/etc/kubernetes/encryption-config.yaml</span></span></code></pre></div></li>
<li><p><strong>Restart the API Server</strong>: After we update the
configuration, we need to restart the Kubernetes API server to apply the
changes.</p></li>
<li><p><strong>Verify Encryption</strong>: To check if Secrets are
encrypted, we can create a new Secret and look at the etcd database. We
can use <code>kubectl</code> to create a Secret:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create secret generic my-secret <span class="at">--from-literal</span><span class="op">=</span>username=myuser <span class="at">--from-literal</span><span class="op">=</span>password=mypassword</span></code></pre></div>
<p>Then we can use the etcdctl command-line tool to check the stored
value:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">etcdctl</span> get /registry/secrets/default/my-secret</span></code></pre></div>
<p>We should see that the output is encrypted and not plain
text.</p></li>
<li><p><strong>Considerations</strong>:</p>
<ul>
<li>We must keep the encryption key safe and change it often.</li>
<li>We should watch for performance impact. Encryption can slow things
down, especially with large Secrets.</li>
</ul></li>
</ol>
<p>By doing these steps, we can encrypt Kubernetes Secrets at rest. This
helps keep sensitive data safe from unauthorized access. For more tips
on managing Kubernetes secrets securely, we can check out <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">this
article</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3
id="what-are-kubernetes-secrets-and-how-do-they-differ-from-configmaps">1.
What are Kubernetes Secrets and how do they differ from ConfigMaps?</h3>
<p>Kubernetes Secrets help us keep sensitive info safe. This info can be
things like database passwords, API tokens, or SSH keys in a Kubernetes
cluster. ConfigMaps are different. They hold non-sensitive data. Secrets
are made to store sensitive data in a special encoded way. This helps us
protect important information better. So, Kubernetes Secrets are very
important for keeping our applications secure.</p>
<h3
id="how-can-i-create-a-kubernetes-secret-for-my-database-credentials">2.
How can I create a Kubernetes Secret for my database credentials?</h3>
<p>We can create a Kubernetes Secret for database credentials using the
<code>kubectl</code> command-line tool. Just run this command, and
change <code>DB_USER</code> and <code>DB_PASSWORD</code> to your real
credentials:</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create secret generic db-credentials <span class="at">--from-literal</span><span class="op">=</span>username=DB_USER <span class="at">--from-literal</span><span class="op">=</span>password=DB_PASSWORD</span></code></pre></div>
<p>This command makes a Secret called <code>db-credentials</code>. We
can use this Secret in our Pod specs to safely access the database.</p>
<h3 id="how-do-i-access-kubernetes-secrets-in-my-pods">3. How do I
access Kubernetes Secrets in my Pods?</h3>
<p>We can access Kubernetes Secrets in our Pods using environment
variables or mounted volumes. If we want to use environment variables,
we add the Secret in our Pod YAML like this:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> DB_USERNAME</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> db-credentials</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">key</span><span class="kw">:</span><span class="at"> username</span></span></code></pre></div>
<p>We can also mount the Secret as a volume. This way, our application
can read the credentials straight from the file system.</p>
<h3 id="what-are-the-best-practices-for-managing-kubernetes-secrets">4.
What are the best practices for managing Kubernetes Secrets?</h3>
<p>To manage Kubernetes Secrets well, we should encrypt them when
stored. We can use RBAC to limit who can access them. It is good to
change Secrets regularly too. Also, we should not write Secrets directly
in our application code. Instead, we can use tools like Helm for
managing Secrets. We can also think about using external management
tools like HashiCorp Vault for better security.</p>
<h3 id="how-do-i-update-kubernetes-secrets-without-downtime">5. How do I
update Kubernetes Secrets without downtime?</h3>
<p>To update Kubernetes Secrets without downtime, we can use the
<code>kubectl apply</code> command with our new YAML. Kubernetes will
take care of the update for us. We should also make sure our application
can handle changes well. This can be done by reloading configurations
often or using a sidecar to manage Secrets. This way, we reduce service
interruptions when we update.</p>
<p>For more info on managing sensitive data, we can check our article on
<a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">how
to manage secrets in Kubernetes securely</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            