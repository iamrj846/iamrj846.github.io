
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <!-- Common CSS & Icons -->
            <link rel="icon" href="/favicon.ico" type="image/x-icon">
            <link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
            <link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
            <link rel="stylesheet" href="/assets/css/post.css">
            <title>How Can You Share Secrets Across Namespaces in Kubernetes?</title>
            <meta name="description" content="Learn how to securely share secrets across namespaces in Kubernetes to enhance your application security and efficiency.">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How Can You Share Secrets Across Namespaces in Kubernetes?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>Sharing secrets in Kubernetes across namespaces is something we can
do in many simple ways. We can use tools like Kubernetes External
Secrets, Custom Resource Definitions (CRDs), and kubectl commands. These
help us manage sensitive data easily in different namespaces. Also, we
can use Role-Based Access Control (RBAC) to make sure only the right
users and services can see these secrets. This helps us keep our
Kubernetes safe.</p>
<p>In this article, we will talk about different ways to share secrets
in Kubernetes namespaces. We will see how to share secrets directly. We
will also look at using Kubernetes External Secrets, Custom Resource
Definitions, RBAC for safe access, and how to use kubectl to copy
secrets easily. Here is a short summary of what we will cover:</p>
<ul>
<li>How to Share Secrets Across Namespaces in Kubernetes</li>
<li>Why Share Secrets Across Namespaces in Kubernetes</li>
<li>Using Kubernetes External Secrets to Share Secrets Across
Namespaces</li>
<li>Leveraging Kubernetes Custom Resource Definitions for Secret
Sharing</li>
<li>Implementing Kubernetes Role-Based Access Control for Secret
Sharing</li>
<li>How to Use kubectl to Copy Secrets Across Namespaces</li>
<li>Frequently Asked Questions</li>
</ul>
<p>For more reading, we can check other articles on <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-security-best-practices.html">Kubernetes
security best practices</a> and <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">managing
secrets securely</a>.</p>
<h2 id="why-share-secrets-across-namespaces-in-kubernetes">Why Share
Secrets Across Namespaces in Kubernetes</h2>
<p>We think sharing secrets across namespaces in Kubernetes is important
for many reasons.</p>
<ol type="1">
<li><p><strong>Resource Isolation</strong>: Kubernetes namespaces help
to keep resources safe from each other, including secrets. But
sometimes, apps need to access shared secrets across different
namespaces. This helps keep things consistent.</p></li>
<li><p><strong>Multi-Tenancy</strong>: In places where many teams or
apps work, they might live in separate namespaces. They still need to
use shared secrets like database login info or API keys to work
right.</p></li>
<li><p><strong>Centralized Management</strong>: Sharing secrets lets us
manage sensitive info in one place. This helps reduce copies and keeps
things from getting mixed up between namespaces.</p></li>
<li><p><strong>Easier Integration</strong>: When services in different
namespaces need to work together, sharing secrets makes this easier. For
example, a backend service in one namespace might need to get a database
credential from another namespace.</p></li>
<li><p><strong>Operational Efficiency</strong>: Sharing secrets helps us
work better. It cuts down on the number of secrets we need to make and
keep track of. This makes updates easier and helps us avoid mistakes
during deployments.</p></li>
<li><p><strong>Security Practices</strong>: When we share secrets in a
careful way, we make sure that sensitive info is safe. This follows good
security rules.</p></li>
</ol>
<p>To share secrets across namespaces in a safe way, we can use
Kubernetes Role-Based Access Control (RBAC). This lets us decide who can
see which secrets. This way, only the right services or users can get
sensitive information.</p>
<h2
id="using-kubernetes-external-secrets-to-share-secrets-across-namespaces">Using
Kubernetes External Secrets to Share Secrets Across Namespaces</h2>
<p>We can use Kubernetes External Secrets to connect external secret
management systems like AWS Secrets Manager, HashiCorp Vault, or Azure
Key Vault with Kubernetes. This helps us share secrets safely across
different namespaces.</p>
<p>To share secrets across namespaces using Kubernetes External Secrets,
we can follow these steps:</p>
<ol type="1">
<li><p><strong>Install External Secrets Operator</strong>: First, we
need to install the External Secrets Operator in our Kubernetes cluster.
We can do this by using the command below:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://github.com/external-secrets/external-secrets/releases/latest/download/external-secrets-operator.yaml</span></code></pre></div></li>
<li><p><strong>Create External Secret</strong>: Next, we define an
<code>ExternalSecret</code> resource in the namespace we want. This
resource pulls secrets from the external store.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> external-secrets.io/v1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ExternalSecret</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-external-secret</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> target-namespace</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">backendType</span><span class="kw">:</span><span class="at"> secretsManager</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">key</span><span class="kw">:</span><span class="at"> my-secret-key</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-secret</span></span></code></pre></div></li>
<li><p><strong>Access the Secret in Another Namespace</strong>: To share
this secret with another namespace, we create a <code>Secret</code>
object in that namespace. This object points to the
<code>ExternalSecret</code>.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> shared-secret</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> other-namespace</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stringData</span><span class="kw">:</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">my-shared-secret</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;{{ external-secrets.my-external-secret.my-secret }}&#39;</span></span></code></pre></div></li>
<li><p><strong>Configure RBAC</strong>: We need to make sure that the
<code>ServiceAccount</code> used by the External Secrets Operator has
permission to access secrets in both the source and target
namespaces.</p>
<p>Here is an example of RBAC configuration:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io/v1</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Role</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> target-namespace</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> external-secrets-role</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">apiGroups</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;secrets.external-secrets.io&quot;</span><span class="kw">]</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">resources</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;externalsecrets&quot;</span><span class="kw">]</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">verbs</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;get&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;list&quot;</span><span class="kw">]</span></span></code></pre></div></li>
<li><p><strong>Deploy and Test</strong>: Finally, we deploy the
configuration and check if secrets can be accessed across the namespaces
we set.</p></li>
</ol>
<p>For more details about integrating with specific secret providers, we
can look at the <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-use-kubernetes-secrets-to-store-database-credentials.html">Kubernetes
External Secrets documentation</a>.</p>
<p>Using Kubernetes External Secrets makes it easier to manage sensitive
information. It helps us share secrets safely and efficiently across
namespaces in our Kubernetes cluster.</p>
<h2
id="leveraging-kubernetes-custom-resource-definitions-for-secret-sharing">Leveraging
Kubernetes Custom Resource Definitions for Secret Sharing</h2>
<p>Kubernetes Custom Resource Definitions (CRDs) help us to add new
types of resources in Kubernetes. This is very useful for sharing
secrets between namespaces. We can create a custom resource that makes
secret management easier.</p>
<h3 id="step-1-define-a-custom-resource-definition">Step 1: Define a
Custom Resource Definition</h3>
<p>First, we need to create a CRD for our shared secrets. Here is a
simple example in YAML:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apiextensions.k8s.io/v1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> CustomResourceDefinition</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> sharedsecrets.yourdomain.com</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> yourdomain.com</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">names</span><span class="kw">:</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> SharedSecret</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">listKind</span><span class="kw">:</span><span class="at"> SharedSecretList</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">plural</span><span class="kw">:</span><span class="at"> sharedsecrets</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">singular</span><span class="kw">:</span><span class="at"> sharedsecret</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scope</span><span class="kw">:</span><span class="at"> Namespaced</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">versions</span><span class="kw">:</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">served</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">storage</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">schema</span><span class="kw">:</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">openAPIV3Schema</span><span class="kw">:</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">properties</span><span class="kw">:</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">additionalProperties</span><span class="kw">:</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span></code></pre></div>
<h3 id="step-2-create-the-custom-resource">Step 2: Create the Custom
Resource</h3>
<p>Next, we create a shared secret using the CRD we just defined:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> yourdomain.com/v1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> SharedSecret</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-secret</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> default</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">username</span><span class="kw">:</span><span class="at"> admin</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at"> secret123</span></span></code></pre></div>
<h3 id="step-3-implement-a-controller">Step 3: Implement a
Controller</h3>
<p>Now we need to develop a controller. This controller watches for
changes in our <code>SharedSecret</code> resources. It will sync secrets
to the right namespaces. We can use a client-go library to look for
changes in <code>SharedSecret</code> and create or update secrets in the
target namespaces:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;context&quot;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;log&quot;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;k8s.io/client-go/kubernetes&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;k8s.io/client-go/tools/clientcmd&quot;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> syncSecret<span class="op">(</span>clientset <span class="op">*</span>kubernetes<span class="op">.</span>Clientset<span class="op">,</span> secret SharedSecret<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    secretData <span class="op">:=</span> secret<span class="op">.</span>Data</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _<span class="op">,</span> namespace <span class="op">:=</span> <span class="kw">range</span> targetNamespaces <span class="op">{</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        _<span class="op">,</span> err <span class="op">:=</span> clientset<span class="op">.</span>CoreV1<span class="op">().</span>Secrets<span class="op">(</span>namespace<span class="op">).</span>Create<span class="op">(</span>context<span class="op">.</span>TODO<span class="op">(),</span> <span class="op">&amp;</span>v1<span class="op">.</span>Secret<span class="op">{</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            ObjectMeta<span class="op">:</span> metav1<span class="op">.</span>ObjectMeta<span class="op">{</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                Name<span class="op">:</span>      secret<span class="op">.</span>Name<span class="op">,</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                Namespace<span class="op">:</span> namespace<span class="op">,</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>            Data<span class="op">:</span> secretData<span class="op">,</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span> metav1<span class="op">.</span>CreateOptions<span class="op">{})</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            log<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Error creating secret in namespace %s: %v&quot;</span><span class="op">,</span> namespace<span class="op">,</span> err<span class="op">)</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="step-4-role-based-access-control-rbac">Step 4: Role-Based Access
Control (RBAC)</h3>
<p>We must make sure our controller has permissions to manage secrets
across namespaces. We create a ClusterRole and ClusterRoleBinding like
this:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io/v1</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ClusterRole</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> secret-manager</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">apiGroups</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;core&quot;</span><span class="kw">]</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">resources</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;secrets&quot;</span><span class="kw">]</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">verbs</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;get&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;list&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;create&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;update&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;delete&quot;</span><span class="kw">]</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io/v1</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ClusterRoleBinding</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> secret-manager-binding</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="fu">roleRef</span><span class="kw">:</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">apiGroup</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> ClusterRole</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> secret-manager</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="fu">subjects</span><span class="kw">:</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> ServiceAccount</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;your-service-account&gt;</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> &lt;your-namespace&gt;</span></span></code></pre></div>
<h3 id="step-5-deploy-the-controller">Step 5: Deploy the Controller</h3>
<p>Finally, we deploy our controller as a Kubernetes deployment. It
needs access to the Kubernetes API to manage secrets in the right
namespaces.</p>
<p>By using Kubernetes Custom Resource Definitions, we can build a
strong way to share secrets across namespaces in a controlled and
scalable way. For more details on Kubernetes RBAC, check this <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-implement-role-based-access-control-rbac-in-kubernetes.html">guide</a>.</p>
<h2
id="implementing-kubernetes-role-based-access-control-for-secret-sharing">Implementing
Kubernetes Role-Based Access Control for Secret Sharing</h2>
<p>To share secrets safely across namespaces in Kubernetes, we need to
use Role-Based Access Control (RBAC). RBAC helps us set rules about who
can access specific secrets and when. This way, only the right users or
services can get sensitive information.</p>
<h3 id="steps-for-implementing-rbac-for-secret-sharing">Steps for
Implementing RBAC for Secret Sharing</h3>
<ol type="1">
<li><p><strong>Create a Role</strong>: First, we define a role that
gives permission to access secrets.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io/v1</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Role</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> &lt;target-namespace&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> secret-reader</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">apiGroups</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;v1&quot;</span><span class="kw">]</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resources</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;secrets&quot;</span><span class="kw">]</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">verbs</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;get&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;list&quot;</span><span class="kw">]</span></span></code></pre></div></li>
<li><p><strong>Create a RoleBinding</strong>: Next, we bind the role to
a user, group, or service account.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io/v1</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> RoleBinding</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> secret-reader-binding</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> &lt;target-namespace&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">subjects</span><span class="kw">:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> User</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;username&gt;</span><span class="co">  # or use ServiceAccount or Group</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">apiGroup</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">roleRef</span><span class="kw">:</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> Role</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> secret-reader</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">apiGroup</span><span class="kw">:</span><span class="at"> rbac.authorization.k8s.io</span></span></code></pre></div></li>
<li><p><strong>Access the Secret</strong>: Now, the user or service
account linked to the role can access secrets in the namespace we
set.</p>
<p>Example command to get a secret:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get secret <span class="op">&lt;</span>secret-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>target-namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Namespace Consideration</strong>: We must make sure that
the RoleBinding is in the same namespace as the secret. Roles only work
in their own namespace.</p></li>
<li><p><strong>Test Permissions</strong>: We should check if the user or
service account can access the secret as we want. They should not be
able to access secrets in other namespaces without the right
permissions.</p></li>
</ol>
<p>By defining roles and bindings carefully, we can manage access to
secrets in our Kubernetes cluster. This helps us keep things secure and
follow rules. For more details on RBAC implementation, check out the <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-implement-role-based-access-control-rbac-in-kubernetes.html">Kubernetes
documentation on RBAC</a>.</p>
<h2 id="how-to-use-kubectl-to-copy-secrets-across-namespaces">How to Use
kubectl to Copy Secrets Across Namespaces</h2>
<p>To copy secrets between namespaces in Kubernetes with
<code>kubectl</code>, we can use the <code>kubectl get</code> and
<code>kubectl apply</code> commands. Here is how we can do it:</p>
<ol type="1">
<li><p><strong>Get the Secret from the Source Namespace</strong>: First,
we need to get the secret in YAML format from the source namespace. We
can use this command:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get secret <span class="op">&lt;</span>secret-name<span class="op">&gt;</span> --namespace=<span class="op">&lt;</span>source-namespace<span class="op">&gt;</span> -o yaml <span class="op">&gt;</span> secret.yaml</span></code></pre></div></li>
<li><p><strong>Edit the YAML File</strong>: Next, we open the
<code>secret.yaml</code> file in a text editor. We change the
<code>namespace</code> field to the target namespace. We also remove the
<code>resourceVersion</code>, <code>selfLink</code>, <code>uid</code>,
and <code>creationTimestamp</code> fields. These fields are not needed
for the new secret.</p>
<p>Here is an example of what the modified content in
<code>secret.yaml</code> looks like:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;secret-name&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> &lt;target-namespace&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">key</span><span class="kw">:</span><span class="at"> &lt;base64-encoded-value&gt;</span></span></code></pre></div></li>
<li><p><strong>Apply the Secret to the Target Namespace</strong>: Now we
use the <code>kubectl apply</code> command to create the secret in the
target namespace.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> secret.yaml <span class="at">--namespace</span><span class="op">=&lt;</span>target-namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Verify the Secret</strong>: Finally, we check that the
secret has been created in the target namespace. We can run this
command:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get secrets <span class="at">--namespace</span><span class="op">=&lt;</span>target-namespace<span class="op">&gt;</span></span></code></pre></div></li>
</ol>
<p>By following these steps, we can copy secrets from one namespace to
another in Kubernetes. For more information on managing secrets, we can
check the article <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">how
do I manage secrets in Kubernetes securely</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3
id="how-can-we-share-kubernetes-secrets-across-different-namespaces">1.
How can we share Kubernetes secrets across different namespaces?</h3>
<p>We can share secrets across namespaces in Kubernetes in a few ways.
One way is to copy secrets manually with <code>kubectl</code>. We can
also use Kubernetes External Secrets or Custom Resource Definitions
(CRDs). Each way has good and bad points. It depends on how we want to
manage security and our applications. For more details, check our guide
on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-secrets-in-kubernetes-securely.html">how
to manage secrets in Kubernetes securely</a>.</p>
<h3 id="are-kubernetes-secrets-namespace-scoped">2. Are Kubernetes
secrets namespace-scoped?</h3>
<p>Yes, Kubernetes secrets are namespace-scoped. This means they can
only be used in the namespace where we made them. To share secrets
between namespaces, we need to copy them or use tools like Kubernetes
External Secrets or CRDs. This keeps sensitive data safe but still
available where we need it.</p>
<h3
id="what-are-kubernetes-external-secrets-and-how-do-they-help-with-secret-sharing">3.
What are Kubernetes External Secrets, and how do they help with secret
sharing?</h3>
<p>Kubernetes External Secrets is a tool that works with secret
management systems from cloud providers. It helps us sync secrets from
these external services into our Kubernetes cluster. By using Kubernetes
External Secrets, we can share secrets across namespaces without making
copies of sensitive data. This helps us keep things consistent and
secure. For more info, check our article on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-use-kubernetes-secrets-to-store-database-credentials.html">using
Kubernetes External Secrets</a>.</p>
<h3 id="how-can-we-copy-secrets-between-namespaces-using-kubectl">4. How
can we copy secrets between namespaces using kubectl?</h3>
<p>We can copy secrets between namespaces in Kubernetes using the
<code>kubectl get</code> command and then <code>kubectl create</code>.
For example:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get secret my-secret <span class="at">-n</span> source-namespace <span class="at">-o</span> yaml <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/namespace: source-namespace/namespace: target-namespace/&#39;</span> <span class="kw">|</span> <span class="ex">kubectl</span> apply <span class="at">-f</span> <span class="at">-</span></span></code></pre></div>
<p>This command gets the secret and puts it in the target namespace
while changing the namespace field. For a detailed guide, visit our
section on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-use-kubectl-to-manage-my-kubernetes-resources.html">how
to use kubectl to manage Kubernetes resources</a>.</p>
<h3
id="what-role-does-role-based-access-control-rbac-play-in-sharing-secrets-across-namespaces">5.
What role does Role-Based Access Control (RBAC) play in sharing secrets
across namespaces?</h3>
<p>Role-Based Access Control (RBAC) is important for managing
permissions in Kubernetes. When we share secrets across namespaces, we
can set specific roles and permissions. This helps control who can
access secrets based on user or service account needs. Using RBAC makes
sure that only the right people can see sensitive information. This
improves security in our Kubernetes environment. For more details, check
our guide on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-implement-role-based-access-control-rbac-in-kubernetes.html">implementing
RBAC in Kubernetes</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            