
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TFCQEJR7TD');
</script>
            <title>How Do I Build a Custom Kubernetes Operator?</title>
            <meta name="description" content="Learn how to build a custom Kubernetes operator step-by-step. Enhance your Kubernetes skills and automate your workflows today!">

            <div id="head-placeholder"></div>
            <script src="/assets/js/blog.js" defer></script>
            <link rel="stylesheet" href="/assets/css/post.css">
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How Do I Build a Custom Kubernetes Operator?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>Building a custom Kubernetes operator is about making a controller.
This controller helps to manage complex applications on Kubernetes.
Operators use the Kubernetes API. They help to make Kubernetes better by
managing applications just like Kubernetes manages its own
resources.</p>
<p>In this article, we will talk about how to build a custom Kubernetes
operator from the beginning. We will look at what you need to start, how
to set up your work space, the tools and frameworks you need, how to
define custom resources, how to write controller logic, how to deploy
your operator to a Kubernetes cluster, how to test your operator, and
some real-life examples. Here is what we will cover:</p>
<ul>
<li>How Can I Build a Custom Kubernetes Operator?</li>
<li>What Are the Prerequisites for Building a Custom Kubernetes
Operator?</li>
<li>How Do I Set Up My Development Environment?</li>
<li>What Tools and Frameworks Do I Need for Building a Custom
Operator?</li>
<li>How Do I Define the Custom Resource for My Operator?</li>
<li>How Do I Implement the Controller Logic?</li>
<li>What Are Some Real Life Use Cases for Custom Kubernetes
Operators?</li>
<li>How Do I Deploy My Custom Operator to a Kubernetes Cluster?</li>
<li>How Can I Test My Custom Kubernetes Operator?</li>
<li>Frequently Asked Questions</li>
</ul>
<p>For more information about Kubernetes and what it can do, we can
check these articles: <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-operators-and-how-do-they-automate-tasks.html">What
Are Kubernetes Operators and How Do They Automate Tasks?</a> and <a
href="https://bestonlinetutorial.com/kubernetes/what-are-custom-resource-definitions-crds-in-kubernetes.html">What
Are Custom Resource Definitions (CRDs) in Kubernetes?</a>.</p>
<h2
id="what-are-the-prerequisites-for-building-a-custom-kubernetes-operator">What
Are the Prerequisites for Building a Custom Kubernetes Operator?</h2>
<p>To build a custom Kubernetes operator, we need to meet some important
prerequisites. This will help us have a smooth development process. Here
are the main requirements:</p>
<ol type="1">
<li><strong>Understanding of Kubernetes Concepts</strong>:
<ul>
<li>We should know how Kubernetes works. This includes Pods, Services,
Deployments, and Custom Resource Definitions (CRDs).<br />
</li>
<li>We also need to be familiar with kubelet, etcd, and the Kubernetes
API.</li>
</ul></li>
<li><strong>Development Environment</strong>:
<ul>
<li>We need a local Kubernetes cluster, like Minikube, Kind, or a
managed Kubernetes service to test our operator.<br />
</li>
<li>We must have access to the Kubernetes command-line tool, called
<code>kubectl</code>.</li>
</ul></li>
<li><strong>Programming Skills</strong>:
<ul>
<li>We should know Go because most Kubernetes operators are written in
Go. It is important to be familiar with the Go programming language and
its tools.<br />
</li>
<li>We also need a basic understanding of YAML because we use it to
define Kubernetes resources.</li>
</ul></li>
<li><strong>Operator Framework</strong>:
<ul>
<li>We should know about an operator framework, like the Operator SDK.
This makes it easier to create and manage Kubernetes operators.<br />
</li>
<li>It helps if we are familiar with tools like Helm. They can help us
package and deploy our custom operator.</li>
</ul></li>
<li><strong>Version Control System</strong>:
<ul>
<li>We should be good with Git. We use Git for managing source code and
working with others.</li>
</ul></li>
<li><strong>Optional but Recommended</strong>:
<ul>
<li>It helps to understand CI/CD practices. These can automate testing
and deployment of our operator.<br />
</li>
<li>Knowing about testing frameworks for Go, like Ginkgo and Gomega, is
good. We can use them to write unit and integration tests for our
operator.</li>
</ul></li>
</ol>
<p>By making sure we have these prerequisites, we will be ready to start
building a custom Kubernetes operator. This operator can meet our
specific needs. For more information on Kubernetes concepts and operator
development, we can check this <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-build-a-kubernetes-operator.html">article
on building a Kubernetes operator</a>.</p>
<h2 id="how-do-we-set-up-our-development-environment">How Do We Set Up
Our Development Environment?</h2>
<p>To build a custom Kubernetes operator, we need to set up our
development environment right. Here are the steps we can follow for a
smooth process:</p>
<ol type="1">
<li><p><strong>Install Go</strong>: We usually write Kubernetes
operators in Go. First, we need to install the latest version of Go from
the <a href="https://golang.org/dl/">official Go website</a>.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://golang.org/dl/go1.19.4.linux-amd64.tar.gz</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> tar <span class="at">-C</span> /usr/local <span class="at">-xzf</span> go1.19.4.linux-amd64.tar.gz</span></code></pre></div>
<p>We have to add Go to our PATH:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&#39;export PATH=$PATH:/usr/local/go/bin&#39;</span> <span class="op">&gt;&gt;</span> ~/.bashrc</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/.bashrc</span></code></pre></div></li>
<li><p><strong>Set Up a Go Workspace</strong>: Next, we create a folder
for our Go workspaces.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">$HOME</span>/go/src</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">GOPATH</span><span class="op">=</span><span class="va">$HOME</span>/go</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&#39;export GOPATH=$HOME/go&#39;</span> <span class="op">&gt;&gt;</span> ~/.bashrc</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/.bashrc</span></code></pre></div></li>
<li><p><strong>Install Kubernetes CLI (kubectl)</strong>: Now we need
the Kubernetes CLI to work with our Kubernetes cluster.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-LO</span> <span class="st">&quot;https://storage.googleapis.com/kubernetes-release/release/</span><span class="va">$(</span><span class="ex">curl</span> <span class="at">-s</span> https://storage.googleapis.com/kubernetes-release/release/stable.txt<span class="va">)</span><span class="st">/bin/linux/amd64/kubectl&quot;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x ./kubectl</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mv ./kubectl /usr/local/bin/kubectl</span></code></pre></div></li>
<li><p><strong>Set Up Minikube</strong>: For local work, we can use
Minikube to create a local Kubernetes cluster.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-Lo</span> minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x minikube</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mv minikube /usr/local/bin/</span></code></pre></div>
<p>We can start Minikube with:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">minikube</span> start</span></code></pre></div></li>
<li><p><strong>Install Operator SDK</strong>: The Operator SDK helps us
start a new operator project.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-sSL</span> https://github.com/operator-framework/operator-sdk/releases/download/v1.24.0/operator-sdk-v1.24.0-x86_64-linux-gnu <span class="at">-o</span> /usr/local/bin/operator-sdk</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x /usr/local/bin/operator-sdk</span></code></pre></div></li>
<li><p><strong>Install Other Dependencies</strong>: Depending on what we
need for our operator, we might need extra tools. If we want to use
Helm, we can install it like this:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 <span class="kw">|</span> <span class="fu">bash</span></span></code></pre></div></li>
<li><p><strong>Verify Installation</strong>: Finally, we should check if
all tools are installed correctly.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">go</span> version</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> version <span class="at">--client</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">minikube</span> status</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">operator-sdk</span> version</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> version</span></code></pre></div></li>
</ol>
<p>By following these steps, we will have our development environment
ready to build a custom Kubernetes operator. For more details on
building Kubernetes operators, we can check the article <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-build-a-kubernetes-operator.html">How
Do I Build a Kubernetes Operator</a>.</p>
<h2
id="what-tools-and-frameworks-do-we-need-for-building-a-custom-operator">What
Tools and Frameworks Do We Need for Building a Custom Operator?</h2>
<p>To build a custom Kubernetes operator, we need different tools and
frameworks for development, testing, and deployment. Here is a list of
tools and frameworks we recommend:</p>
<ol type="1">
<li><strong>Operator SDK</strong>:
<ul>
<li><p>This framework helps us build Kubernetes operators. It gives us
tools to create operators in Go, Ansible, or Helm.</p></li>
<li><p>To install it, we can use this command:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-sSL</span> https://github.com/operator-framework/operator-sdk/releases/latest/download/operator-sdk-v<span class="va">$(</span><span class="ex">curl</span> <span class="at">-sSL</span> https://github.com/operator-framework/operator-sdk/releases/latest <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-oP</span> <span class="st">&#39;(?&lt;=tag/v)[^&quot;]*&#39;</span><span class="va">)</span>-x86_64-linux-gnu <span class="at">-o</span> /usr/local/bin/operator-sdk</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x /usr/local/bin/operator-sdk</span></code></pre></div></li>
</ul></li>
<li><strong>Kubebuilder</strong>:
<ul>
<li><p>This is a framework for making Kubernetes APIs using custom
resource definitions (CRDs). It makes developing operators
easier.</p></li>
<li><p>To install it, we run:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">go</span> install sigs.k8s.io/controller-tools/cmd/controller-gen@latest</span></code></pre></div></li>
</ul></li>
<li><strong>Kubernetes CLI (kubectl)</strong>:
<ul>
<li>This command-line tool helps us interact with our Kubernetes
cluster. It is very important for deploying and managing
applications.</li>
<li>We can find installation instructions <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubectl-and-how-do-i-use-it-to-manage-kubernetes.html">here</a>.</li>
</ul></li>
<li><strong>Go Programming Language</strong>:
<ul>
<li><p>Most operators use Go. We need to have Go installed because it is
required for the Operator SDK and Kubebuilder.</p></li>
<li><p>We can install it by using:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://golang.org/dl/go1.18.linux-amd64.tar.gz</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> tar <span class="at">-C</span> /usr/local <span class="at">-xzf</span> go1.18.linux-amd64.tar.gz</span></code></pre></div></li>
</ul></li>
<li><strong>Docker</strong>:
<ul>
<li>We use Docker to build and manage container images for our
operator.</li>
<li>Installation instructions can be found <a
href="https://docs.docker.com/get-docker/">here</a>.</li>
</ul></li>
<li><strong>Kustomize</strong>:
<ul>
<li><p>This tool helps us customize Kubernetes YAML files. It is useful
for managing different deployment setups.</p></li>
<li><p>We can install it using:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">go</span> install sigs.k8s.io/kustomize/kustomize/v4@latest</span></code></pre></div></li>
</ul></li>
<li><strong>Helm</strong>:
<ul>
<li>Helm is a package manager for Kubernetes. It makes it easier to
deploy applications and works well with operators.</li>
<li>We can find installation instructions <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i/create-and-manage-helm-charts.html">here</a>.</li>
</ul></li>
<li><strong>Kind (Kubernetes in Docker)</strong>:
<ul>
<li><p>This tool helps us run local Kubernetes clusters using Docker
containers. It is good for testing operators locally.</p></li>
<li><p>We can install it by running:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">go</span> install sigs.k8s.io/kind@latest</span></code></pre></div></li>
</ul></li>
<li><strong>Prometheus and Grafana</strong>:
<ul>
<li>These are monitoring tools that we can connect with our operator.
They help us see how well our operator is performing.</li>
<li>We can find installation instructions for Prometheus <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i/monitor-my-kubernetes-cluster.html">here</a>.</li>
</ul></li>
<li><strong>Git</strong>:
<ul>
<li>Git is a version control system. We use it to manage our operator’s
source code.</li>
<li>Installation instructions can be found <a
href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">here</a>.</li>
</ul></li>
</ol>
<p>These tools and frameworks help us build, test, and deploy custom
Kubernetes operators. They make it easier for us to manage our
applications well.</p>
<h2 id="how-do-we-define-the-custom-resource-for-our-operator">How Do We
Define the Custom Resource for Our Operator?</h2>
<p>To build a custom Kubernetes operator, we need to define the Custom
Resource (CR). This step is very important. A Custom Resource Definition
(CRD) helps us add new resource types in Kubernetes.</p>
<h3 id="defining-a-custom-resource">Defining a Custom Resource</h3>
<ol type="1">
<li><strong>Create a CRD YAML file</strong>: This file tells about the
schema, validation, and behavior of our custom resource.</li>
</ol>
<div class="sourceCode" id="cb15"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apiextensions.k8s.io/v1</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> CustomResourceDefinition</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myresources.example.com</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> example.com</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">versions</span><span class="kw">:</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">served</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">storage</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">schema</span><span class="kw">:</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">openAPIV3Schema</span><span class="kw">:</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">properties</span><span class="kw">:</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">properties</span><span class="kw">:</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">replicas</span><span class="kw">:</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> integer</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">image</span><span class="kw">:</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scope</span><span class="kw">:</span><span class="at"> Namespaced</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">names</span><span class="kw">:</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">plural</span><span class="kw">:</span><span class="at"> myresources</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">singular</span><span class="kw">:</span><span class="at"> myresource</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> MyResource</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">shortNames</span><span class="kw">:</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mr</span></span></code></pre></div>
<ol start="2" type="1">
<li><strong>Apply the CRD</strong>: We use <code>kubectl</code> to
create the CRD in our Kubernetes cluster.</li>
</ol>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> myresource-crd.yaml</span></code></pre></div>
<h3 id="creating-a-custom-resource-instance">Creating a Custom Resource
Instance</h3>
<p>After we define the CRD, we can create instances of our custom
resource.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> example.com/v1</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> MyResource</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-resource-instance</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my-image:latest</span></span></code></pre></div>
<ol start="3" type="1">
<li><strong>Apply the Custom Resource</strong>:</li>
</ol>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> myresource-instance.yaml</span></code></pre></div>
<h3 id="validation-of-custom-resource">Validation of Custom
Resource</h3>
<p>We should add validation rules in our CRD. This way, we can make sure
the custom resource has the right structure. For example, we can say
which fields are needed and what types they should be:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">validation</span><span class="kw">:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">openAPIV3Schema</span><span class="kw">:</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">properties</span><span class="kw">:</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">required</span><span class="kw">:</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> replicas</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> image</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">properties</span><span class="kw">:</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">replicas</span><span class="kw">:</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">type</span><span class="kw">:</span><span class="at"> integer</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">minimum</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">image</span><span class="kw">:</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span></code></pre></div>
<h3 id="summary-of-key-points">Summary of Key Points</h3>
<ul>
<li>We define the CRD using YAML.</li>
<li>We use <code>kubectl</code> to put the CRD in the cluster.</li>
<li>We create instances of our custom resource with specific
details.</li>
<li>We add validation rules in our CRD to keep data correct.</li>
</ul>
<p>For more details on Custom Resource Definitions, check <a
href="https://bestonlinetutorial.com/kubernetes/what-are-custom-resource-definitions-crds-in-kubernetes.html">what
are Custom Resource Definitions (CRDs) in Kubernetes</a>.</p>
<h2 id="how-do-we-implement-the-controller-logic">How Do We Implement
the Controller Logic?</h2>
<p>Implementing the controller logic for a custom Kubernetes operator
means we define how our operator responds to changes in the custom
resources (CRs) it manages. The controller keeps an eye on events about
these resources. It takes the right actions based on their state.</p>
<h3 id="setup-the-controller">1. Setup the Controller</h3>
<p>We usually use a framework like the Operator SDK to create our
controller. Here is a simple example in Go with the client-go
library.</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;context&quot;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;fmt&quot;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;log&quot;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sigs.k8s.io/controller-runtime/pkg/controller&quot;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sigs.k8s.io/controller-runtime/pkg/controller/controllerutil&quot;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sigs.k8s.io/controller-runtime/pkg/handler&quot;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sigs.k8s.io/controller-runtime/pkg/manager&quot;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sigs.k8s.io/controller-runtime/pkg/source&quot;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    mgr<span class="op">,</span> err <span class="op">:=</span> manager<span class="op">.</span>New<span class="op">(</span>cfg<span class="op">,</span> manager<span class="op">.</span>Options<span class="op">{})</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        log<span class="op">.</span>Fatal<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    c<span class="op">,</span> err <span class="op">:=</span> controller<span class="op">.</span>New<span class="op">(</span><span class="st">&quot;my-operator-controller&quot;</span><span class="op">,</span> mgr<span class="op">,</span> controller<span class="op">.</span>Options<span class="op">{</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        Reconciler<span class="op">:</span> <span class="op">&amp;</span>ReconcileMyResource<span class="op">{</span>client<span class="op">:</span> mgr<span class="op">.</span>GetClient<span class="op">()},</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        log<span class="op">.</span>Fatal<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    err <span class="op">=</span> c<span class="op">.</span>Watch<span class="op">(&amp;</span>source<span class="op">.</span>Kind<span class="op">{</span>Type<span class="op">:</span> <span class="op">&amp;</span>MyResource<span class="op">{}},</span> <span class="op">&amp;</span>handler<span class="op">.</span>EnqueueRequestForObject<span class="op">{})</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>        log<span class="op">.</span>Fatal<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">:=</span> mgr<span class="op">.</span>Start<span class="op">(</span>context<span class="op">.</span>Background<span class="op">());</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>        log<span class="op">.</span>Fatal<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="define-the-reconcile-logic">2. Define the Reconcile Logic</h3>
<p>In the reconcile logic, we decide how to manage the state of our
custom resource. This usually means checking the current state,
comparing it with the desired state, and making changes as needed.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ReconcileMyResource <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    client<span class="op">.</span>Client</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>r <span class="op">*</span>ReconcileMyResource<span class="op">)</span> Reconcile<span class="op">(</span>req ctrl<span class="op">.</span>Request<span class="op">)</span> <span class="op">(</span>ctrl<span class="op">.</span>Result<span class="op">,</span> <span class="dt">error</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    ctx <span class="op">:=</span> context<span class="op">.</span>Background<span class="op">()</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    myResource <span class="op">:=</span> <span class="op">&amp;</span>MyResource<span class="op">{}</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    err <span class="op">:=</span> r<span class="op">.</span>Get<span class="op">(</span>ctx<span class="op">,</span> req<span class="op">.</span>NamespacedName<span class="op">,</span> myResource<span class="op">)</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ctrl<span class="op">.</span>Result<span class="op">{},</span> client<span class="op">.</span>IgnoreNotFound<span class="op">(</span>err<span class="op">)</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We need to manage the resource</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> myResource<span class="op">.</span>Spec<span class="op">.</span>DesiredState <span class="op">!=</span> myResource<span class="op">.</span>Status<span class="op">.</span>CurrentState <span class="op">{</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Update status or take action</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        myResource<span class="op">.</span>Status<span class="op">.</span>CurrentState <span class="op">=</span> myResource<span class="op">.</span>Spec<span class="op">.</span>DesiredState</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> err <span class="op">:=</span> r<span class="op">.</span>Status<span class="op">().</span>Update<span class="op">(</span>ctx<span class="op">,</span> myResource<span class="op">);</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ctrl<span class="op">.</span>Result<span class="op">{},</span> err</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ctrl<span class="op">.</span>Result<span class="op">{},</span> <span class="ot">nil</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="handle-events">3. Handle Events</h3>
<p>Our controller should listen for events about our custom resources
and act on them. We do this by using the <code>Reconcile</code> method,
as we showed above. This method gets called whenever a change happens to
the resources our operator manages.</p>
<h3 id="use-kubernetes-client-libraries">4. Use Kubernetes Client
Libraries</h3>
<p>We can use client libraries like <code>client-go</code> or
<code>controller-runtime</code> to work with the Kubernetes API. We can
perform actions like creating, updating, or deleting resources.</p>
<h3 id="implement-custom-logic">5. Implement Custom Logic</h3>
<p>In the <code>Reconcile</code> function, we can add any custom logic
we need for our operator. This may include:</p>
<ul>
<li>Creating dependent resources.</li>
<li>Updating statuses.</li>
<li>Handling errors and retries.</li>
</ul>
<h3 id="test-your-controller">6. Test Your Controller</h3>
<p>Before we deploy our operator, we need to test our controller logic
well. We should consider different scenarios like resource creation,
updates, and deletions.</p>
<p>For more details on how to build your custom Kubernetes operator and
the main ideas, you can check this article on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-build-a-kubernetes-operator.html">how
to build a Kubernetes operator</a>.</p>
<h2
id="what-are-some-real-life-use-cases-for-custom-kubernetes-operators">What
Are Some Real Life Use Cases for Custom Kubernetes Operators?</h2>
<p>Custom Kubernetes Operators help us automate the management of
complex applications on Kubernetes. Let us look at some real-life
examples of using custom operators.</p>
<ol type="1">
<li><p><strong>Database Management</strong>: Operators help us with the
deployment, scaling, and management of databases like PostgreSQL, MySQL,
or MongoDB. For example, an operator can handle database backups and
restore processes. It can also scale the database based on workload.</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> databases.example.com/v1</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Postgres</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-postgres</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">size</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;13&quot;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">storage</span><span class="kw">:</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">size</span><span class="kw">:</span><span class="at"> 10Gi</span></span></code></pre></div></li>
<li><p><strong>Machine Learning Workflows</strong>: Operators manage the
lifecycle of machine learning models. They help with deployment,
scaling, and versioning. For instance, an operator can automate the
rollout of new model versions and manage canary testing.</p></li>
<li><p><strong>Custom Application Management</strong>: Some businesses
have specific applications. They can create operators to manage the
deployment lifecycle of these applications. For example, an operator can
make sure a microservices application runs the correct version of each
service.</p></li>
<li><p><strong>CI/CD Integration</strong>: Operators support continuous
integration and continuous deployment workflows. They can automatically
deploy new versions of applications when changes are pushed to a
repository.</p></li>
<li><p><strong>Monitoring and Alerting</strong>: Custom operators work
with monitoring tools like Prometheus. They can automatically set up
alerts based on application metrics. They also scale resources when
needed.</p></li>
<li><p><strong>Infrastructure Management</strong>: Operators can manage
cloud resources. They can provision and deprovision resources based on
application demand. This helps us optimize costs and
performance.</p></li>
<li><p><strong>Stateful Applications</strong>: Operators make it easier
to deploy and manage stateful applications. They ensure that data stays
consistent and persistent when scaling and updating.</p></li>
<li><p><strong>Multi-Cluster Management</strong>: Custom operators can
monitor and manage applications across many Kubernetes clusters. They
give us a clear view and control of distributed systems.</p></li>
<li><p><strong>Event-Driven Applications</strong>: Operators can handle
events from different sources. They can trigger actions based on
specific conditions or changes in the environment. This includes
auto-scaling or reallocating resources.</p></li>
<li><p><strong>Backup and Disaster Recovery</strong>: Operators can
automate backups for applications and databases. They manage schedules
and ensure data integrity through consistent snapshots.</p></li>
</ol>
<p>These use cases show how useful custom Kubernetes operators are. They
help us automate complex workflows and manage application lifecycles
well. If you want to read more about Kubernetes operators, check this
article on <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-operators-and-how-do-they-automate-tasks.html">what
are Kubernetes operators and how do they automate tasks</a>.</p>
<h2
id="how-do-we-deploy-our-custom-operator-to-a-kubernetes-cluster">How Do
We Deploy Our Custom Operator to a Kubernetes Cluster?</h2>
<p>To deploy our custom Kubernetes operator to a cluster, we can follow
these steps:</p>
<ol type="1">
<li><p><strong>Build Our Operator Image</strong>: We need to use Docker
to make a container image of our operator. We have to make sure our
Dockerfile is set up right.</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> golang:1.16 <span class="kw">AS</span> builder</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">go</span> build <span class="at">-o</span> my-operator .</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> gcr.io/distroless/base</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=builder</span> /app/my-operator /my-operator</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="kw">ENTRYPOINT</span> [<span class="st">&quot;/my-operator&quot;</span>]</span></code></pre></div>
<p>Now we build the image:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> my-operator:latest .</span></code></pre></div></li>
<li><p><strong>Push Our Image to a Registry</strong>: After we build the
image, we push it to a container registry like Docker Hub, GCR, or
ECR.</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> tag my-operator:latest <span class="op">&lt;</span>your-registry<span class="op">&gt;</span>/my-operator:latest</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push <span class="op">&lt;</span>your-registry<span class="op">&gt;</span>/my-operator:latest</span></code></pre></div></li>
<li><p><strong>Create a Custom Resource Definition (CRD)</strong>: We
need to define our CRD in a YAML file. This tells what custom resource
our operator will manage.</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apiextensions.k8s.io/v1</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> CustomResourceDefinition</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myresources.mygroup.example.com</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> mygroup.example.com</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">names</span><span class="kw">:</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> MyResource</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">listKind</span><span class="kw">:</span><span class="at"> MyResourceList</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">plural</span><span class="kw">:</span><span class="at"> myresources</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">singular</span><span class="kw">:</span><span class="at"> myresource</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scope</span><span class="kw">:</span><span class="at"> Namespaced</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">versions</span><span class="kw">:</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">served</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">storage</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">schema</span><span class="kw">:</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">openAPIV3Schema</span><span class="kw">:</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">properties</span><span class="kw">:</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">properties</span><span class="kw">:</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">foo</span><span class="kw">:</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> string</span></span></code></pre></div>
<p>We apply the CRD to the cluster:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> myresource-crd.yaml</span></code></pre></div></li>
<li><p><strong>Deploy the Operator</strong>: We create a deployment for
our operator using a Kubernetes deployment YAML file.</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-operator</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> default</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> my-operator</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> my-operator</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-operator</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">image</span><span class="kw">:</span><span class="at"> &lt;your-registry&gt;/my-operator:latest</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">imagePullPolicy</span><span class="kw">:</span><span class="at"> Always</span></span></code></pre></div>
<p>Then we deploy the operator:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> my-operator-deployment.yaml</span></code></pre></div></li>
<li><p><strong>Verify Deployment</strong>: We check the status of our
operator deployment to make sure it runs good.</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">-l</span> app=my-operator</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="op">&lt;</span>pod-name<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Create Custom Resources</strong>: After we deploy our
operator, we can create instances of the custom resource we defined in
our CRD.</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> mygroup.example.com/v1</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> MyResource</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-myresource</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> default</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">foo</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;bar&quot;</span></span></code></pre></div>
<p>We apply our custom resource:</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> myresource-instance.yaml</span></code></pre></div></li>
</ol>
<p>By following these steps, our custom Kubernetes operator will be
deployed. It will be ready to manage the custom resources we defined in
our cluster. For more information on building Kubernetes operators, we
can check out <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-build-a-kubernetes-operator.html">this
guide</a>.</p>
<h2 id="how-can-we-test-our-custom-kubernetes-operator">How Can We Test
Our Custom Kubernetes Operator?</h2>
<p>Testing our custom Kubernetes Operator is very important. It helps us
make sure it works well and is reliable. Here are some simple ways and
tools that we can use to test our Operator.</p>
<h3 id="unit-testing">Unit Testing</h3>
<ol type="1">
<li><strong>Framework</strong>: We can use Go’s testing package to write
unit tests for our controller logic.</li>
<li><strong>Mocking</strong>: We should use libraries like
<code>gomock</code> or <code>testify</code> to create mock Kubernetes
clients and resources.</li>
</ol>
<div class="sourceCode" id="cb33"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> controller</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;testing&quot;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;github.com/stretchr/testify/assert&quot;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> TestReconcile<span class="op">(</span>t <span class="op">*</span>testing<span class="op">.</span>T<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Setup test environment and objects</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    req <span class="op">:=</span> reconcile<span class="op">.</span>Request<span class="op">{</span>NamespacedName<span class="op">:</span> types<span class="op">.</span>NamespacedName<span class="op">{</span>Name<span class="op">:</span> <span class="st">&quot;test&quot;</span><span class="op">,</span> Namespace<span class="op">:</span> <span class="st">&quot;default&quot;</span><span class="op">}}</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    result<span class="op">,</span> err <span class="op">:=</span> Reconcile<span class="op">(</span>req<span class="op">)</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">.</span>NoError<span class="op">(</span>t<span class="op">,</span> err<span class="op">)</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">.</span>Equal<span class="op">(</span>t<span class="op">,</span> reconcile<span class="op">.</span>Result<span class="op">{},</span> result<span class="op">)</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="integration-testing">Integration Testing</h3>
<ol type="1">
<li><strong>Framework</strong>: We can use <code>envtest</code> from the
controller-runtime to create a test environment.</li>
<li><strong>Setup</strong>: We need to start a local Kubernetes cluster.
We can use Kind or Minikube to deploy our Operator and test how it
works.</li>
</ol>
<div class="sourceCode" id="cb34"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start Kind cluster</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kind</span> create cluster</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Deploy our operator</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> config/manager/manager.yaml</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Test our operator with real Kubernetes objects</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> config/samples/example_v1alpha1_myresource.yaml</span></code></pre></div>
<h3 id="end-to-end-testing">End-to-End Testing</h3>
<ol type="1">
<li><strong>Tools</strong>: We should use tools like Helm and Kube-bench
to check our Operator in a full application scenario.</li>
<li><strong>Scripts</strong>: We can automate our deployment and
validation scripts. This will help us see if the Operator works as we
expect.</li>
</ol>
<div class="sourceCode" id="cb35"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Helm chart for our operator</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install my-operator ./my-operator-chart</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate deployment</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">--namespace</span> default</span></code></pre></div>
<h3 id="monitoring-and-logging">Monitoring and Logging</h3>
<ol type="1">
<li><strong>Tools</strong>: We can add monitoring tools like Prometheus
and logging tools like Fluentd. This helps us watch how our Operator
behaves in production.</li>
<li><strong>Metrics</strong>: We can show metrics with Prometheus to
check the health and performance of our Operator.</li>
</ol>
<div class="sourceCode" id="cb36"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ConfigMap</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> prometheus-config</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">  prometheus.yml</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    global:</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>      scrape_interval: 15s</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    scrape_configs:</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>      - job_name: &#39;my-operator&#39;</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        static_configs:</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>          - targets: [&#39;my-operator:8080&#39;]</span></code></pre></div>
<h3 id="continuous-integration">Continuous Integration</h3>
<ol type="1">
<li><strong>Tools</strong>: We can set up CI/CD pipelines with tools
like GitHub Actions or Jenkins.</li>
<li><strong>Automation</strong>: We should automate our testing on pull
requests. This way, we can make sure new changes do not break what
already works.</li>
</ol>
<div class="sourceCode" id="cb37"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> CI Pipeline</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">push</span><span class="kw">,</span><span class="at"> pull_request</span><span class="kw">]</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">test</span><span class="kw">:</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout code</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v2</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Run tests</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> go test ./...</span></span></code></pre></div>
<h3 id="testing-custom-resources">Testing Custom Resources</h3>
<ol type="1">
<li><strong>CRDs</strong>: We must create test cases for our Custom
Resource Definitions (CRDs). This helps us check that our Operator
handles them correctly.</li>
<li><strong>Validation</strong>: We should check that our CRDs enforce
the right rules and behavior.</li>
</ol>
<div class="sourceCode" id="cb38"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apiextensions.k8s.io/v1</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> CustomResourceDefinition</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> myresources.example.com</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> example.com</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">names</span><span class="kw">:</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> MyResource</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">listKind</span><span class="kw">:</span><span class="at"> MyResourceList</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">plural</span><span class="kw">:</span><span class="at"> myresources</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">singular</span><span class="kw">:</span><span class="at"> myresource</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scope</span><span class="kw">:</span><span class="at"> Namespaced</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">versions</span><span class="kw">:</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> v1alpha1</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">served</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">storage</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">schema</span><span class="kw">:</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">openAPIV3Schema</span><span class="kw">:</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">properties</span><span class="kw">:</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">type</span><span class="kw">:</span><span class="at"> object</span></span></code></pre></div>
<p>By following these testing ways, we can make sure our custom
Kubernetes Operator is strong and reliable. For more information on
building and managing Kubernetes Operators, we can check out articles on
<a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-operators-and-how-do-they-automate-tasks.html">Kubernetes
Operators</a> and <a
href="https://bestonlinetutorial.com/kubernetes/what-are-custom-resource-definitions-crds-in-kubernetes.html">Custom
Resource Definitions</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="what-is-a-kubernetes-operator-and-why-would-we-create-one">1.
What is a Kubernetes Operator and why would we create one?</h3>
<p>A Kubernetes Operator is a way to package, deploy, and manage a
Kubernetes application. It helps us manage complex applications and how
they work over time. When we build a custom Kubernetes Operator, we can
automate tasks that are special for our application. This helps us
manage it better and scale it easily. If we want to improve our
Kubernetes setup, we should learn <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-build-a-kubernetes-operator.html">how
to build a Kubernetes Operator</a>.</p>
<h3 id="what-are-custom-resource-definitions-crds-in-kubernetes">2. What
are Custom Resource Definitions (CRDs) in Kubernetes?</h3>
<p>Custom Resource Definitions (CRDs) let us add new resource types to
Kubernetes API. When we create a custom Kubernetes Operator, defining
CRDs is very important. They show the desired state of our application’s
parts. Learning about CRDs is a key step in understanding <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-build-a-kubernetes-operator.html">how
to build a custom Kubernetes Operator</a> well.</p>
<h3 id="how-can-we-test-our-custom-kubernetes-operator-1">3. How can we
test our custom Kubernetes Operator?</h3>
<p>We can test our custom Kubernetes Operator by running unit tests and
integration tests. We can use tools like <code>Kubebuilder</code> or
<code>Operator SDK</code> that help us write tests. Testing makes sure
our Operator works as we want when it manages the lifecycle of our
custom resources. For more details, we can check how to test our <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-build-a-kubernetes-operator.html">custom
Kubernetes Operator</a>.</p>
<h3 id="what-tools-are-important-for-building-a-kubernetes-operator">4.
What tools are important for building a Kubernetes Operator?</h3>
<p>When we build a Kubernetes Operator, we need tools like
<code>Kubebuilder</code>, <code>Operator SDK</code>, and
<code>kustomize</code>. These tools make the development process easier.
They give us a structure, help generate code, and assist with
deployment. To find out more about the tools we need, we can read this
guide on <a
href="https://bestonlinetutorial.com/kubernetes/what-tools-are-essential-for-kubernetes-development.html">tools
for Kubernetes development</a>.</p>
<h3
id="how-do-we-deploy-our-custom-operator-to-a-kubernetes-cluster-1">5.
How do we deploy our custom Operator to a Kubernetes cluster?</h3>
<p>To deploy our custom Kubernetes Operator to a cluster, we need to
create a deployment YAML file. Then we apply it using
<code>kubectl</code> and make sure our CRDs are registered. This lets
Kubernetes manage our Operator with other resources. For a step-by-step
guide, we can look at this resource on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-build-a-kubernetes-operator.html">deploying
a Kubernetes Operator</a>.</p>
<p>By answering these common questions, we can understand better how to
build a custom Kubernetes Operator and use its features for our
applications.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            