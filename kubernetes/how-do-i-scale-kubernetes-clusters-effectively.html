
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TFCQEJR7TD');
</script>
            <title>How Do I Scale Kubernetes Clusters Effectively?</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "BestOnlineTutorial",
      "url": "https://www.bestonlinetutorial.com/"
    }
    </script>

<!-- Common CSS & Icons -->
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
<link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
<link rel="stylesheet" href="/assets/css/post.css">
            <meta name="description" content="Discover expert tips on effectively scaling Kubernetes clusters for optimal performance and resource management. Read more!">

            <div id="head-placeholder"></div>
            <script src="/assets/js/blog.js" defer></script>
            <link rel="stylesheet" href="/assets/css/post.css">
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How Do I Scale Kubernetes Clusters Effectively?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p><strong>Scaling Kubernetes Clusters Effectively</strong></p>
<p>Scaling Kubernetes clusters means changing the size and power of our
clusters. We do this to meet the needs of the applications running on
them. This includes managing resources, handling workloads, and making
sure the cluster can deal with different levels of traffic and
processing needs.</p>
<p>In this article, we will look at some important points about scaling
Kubernetes clusters. We will talk about using horizontal pod
autoscaling. We will also learn about the Cluster Autoscaler and how to
set resource requests and limits. We will share best practices for
scaling stateful applications. We will explain how to use custom metrics
for autoscaling. We will give real-life examples of scaling Kubernetes
clusters. We will also mention tools that help in monitoring and
scaling. Finally, we will answer some common questions.</p>
<ul>
<li>How Can I Scale Kubernetes Clusters Effectively?</li>
<li>What Are the Key Metrics for Kubernetes Cluster Scaling?</li>
<li>How Do I Use Horizontal Pod Autoscaling in Kubernetes?</li>
<li>What Is Cluster Autoscaler and How Does It Work?</li>
<li>How Can I Optimize Resource Requests and Limits for Effective
Scaling?</li>
<li>What Are the Best Practices for Scaling Stateful Applications in
Kubernetes?</li>
<li>How Do I Implement Custom Metrics for Autoscaling?</li>
<li>Can You Provide Real Life Use Cases for Scaling Kubernetes
Clusters?</li>
<li>What Tools Can Assist in Monitoring and Scaling Kubernetes
Clusters?</li>
<li>Frequently Asked Questions</li>
</ul>
<h2 id="what-are-the-key-metrics-for-kubernetes-cluster-scaling">What
Are the Key Metrics for Kubernetes Cluster Scaling?</h2>
<p>When we scale Kubernetes clusters, we need to monitor some important
metrics. These metrics help us understand how we use resources and how
well the system performs. Here are the key metrics we should look
at:</p>
<ol type="1">
<li><strong>CPU Utilization</strong>:
<ul>
<li><p>This shows the percentage of CPU use across nodes and
pods.</p></li>
<li><p>We can check it with the <code>kubectl top</code> command:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> top nodes</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> top pods <span class="at">--all-namespaces</span></span></code></pre></div></li>
</ul></li>
<li><strong>Memory Utilization</strong>:
<ul>
<li><p>This measures how much memory nodes and pods are using.</p></li>
<li><p>We can use the same commands to monitor it:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> top nodes</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> top pods <span class="at">--all-namespaces</span></span></code></pre></div></li>
</ul></li>
<li><strong>Request and Limit Metrics</strong>:
<ul>
<li><p>We need to track the resource requests and limits set for pods.
This helps us know if they are right.</p></li>
<li><p>We can check the YAML file like this:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;64Mi&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;250m&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;128Mi&quot;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;500m&quot;</span></span></code></pre></div></li>
</ul></li>
<li><strong>Pod Status</strong>:
<ul>
<li><p>We should monitor the status of pods. They can be Running,
Pending, or Failed. This helps us find scaling problems.</p></li>
<li><p>Use this command:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">--all-namespaces</span></span></code></pre></div></li>
</ul></li>
<li><strong>Node Health</strong>:
<ul>
<li><p>We need to check for unhealthy nodes. They can affect how well
the cluster works.</p></li>
<li><p>We can verify this with:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get nodes</span></code></pre></div></li>
</ul></li>
<li><strong>Network Traffic</strong>:
<ul>
<li>We should keep an eye on incoming and outgoing network traffic for
services and pods.</li>
<li>Tools like Prometheus and Grafana can help us see this better.</li>
</ul></li>
<li><strong>Custom Application Metrics</strong>:
<ul>
<li>We can add specific metrics for our applications. These show us the
load and how well they perform.</li>
<li>We can connect with Prometheus to collect and use these metrics for
autoscaling.</li>
</ul></li>
<li><strong>Error Rates</strong>:
<ul>
<li>We need to measure how many errors happen in applications. This
tells us if we need to scale.</li>
<li>We can use logging and monitoring tools to track this.</li>
</ul></li>
<li><strong>Latency</strong>:
<ul>
<li>We should monitor how long services take to respond. This is
important for good user experience.</li>
<li>Tools like Jaeger or OpenTelemetry can help us track latency.</li>
</ul></li>
<li><strong>Scaling Events</strong>:
<ul>
<li>We should keep a record of when and why we trigger scaling events.
This helps us see patterns over time.</li>
</ul></li>
</ol>
<p>By watching these metrics closely, we can make smart choices about
scaling our Kubernetes clusters. This will help us use resources wisely
and keep applications running well. For more details, check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">this
article on Kubernetes metrics</a>.</p>
<h2 id="how-do-i-use-horizontal-pod-autoscaling-in-kubernetes">How Do I
Use Horizontal Pod Autoscaling in Kubernetes?</h2>
<p>Horizontal Pod Autoscaling (HPA) in Kubernetes helps us to
automatically change the number of pods in a deployment. It does this
based on CPU usage or other chosen metrics. This way, our applications
can manage different loads better.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>We need to make sure that our Kubernetes cluster has the metrics
server. This server helps to collect metrics for HPA.</li>
<li>We also need a deployment that is ready to scale.</li>
</ul>
<h3 id="basic-hpa-configuration">Basic HPA Configuration</h3>
<p>To set up HPA, we can use this command:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> autoscale deployment <span class="op">&lt;</span>deployment-name<span class="op">&gt;</span> --cpu-percent=<span class="op">&lt;</span>target-cpu-utilization<span class="op">&gt;</span> --min=<span class="op">&lt;</span>min-replicas<span class="op">&gt;</span> --max=<span class="op">&lt;</span>max-replicas<span class="op">&gt;</span></span></code></pre></div>
<h3 id="example">Example</h3>
<p>Let’s see an example. We will create an HPA for a deployment called
<code>my-app</code> that targets 50% CPU usage:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> autoscale deployment my-app <span class="at">--cpu-percent</span><span class="op">=</span>50 <span class="at">--min</span><span class="op">=</span>2 <span class="at">--max</span><span class="op">=</span>10</span></code></pre></div>
<h3 id="yaml-configuration">YAML Configuration</h3>
<p>We can also set HPA using a YAML file:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> autoscaling/v2beta2</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> HorizontalPodAutoscaler</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app-hpa</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scaleTargetRef</span><span class="kw">:</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">minReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">maxReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">metrics</span><span class="kw">:</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Resource</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">resource</span><span class="kw">:</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cpu</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">target</span><span class="kw">:</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Utilization</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">averageUtilization</span><span class="kw">:</span><span class="at"> </span><span class="dv">50</span></span></code></pre></div>
<p>We apply this config using:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> hpa.yaml</span></code></pre></div>
<h3 id="monitoring-hpa">Monitoring HPA</h3>
<p>To see the status of our HPA, we can use:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get hpa</span></code></pre></div>
<h3 id="custom-metrics">Custom Metrics</h3>
<p>If we want to do more advanced things, we can use custom metrics with
the Kubernetes Metrics API. We need to make sure our application shows
metrics that the metrics server can scrape.</p>
<p>For more info about how Kubernetes works and its parts, we can check
<a
href="https://bestonlinetutorial.com/kubernetes/what-are-the-key-components-of-a-kubernetes-cluster.html">what
are the key components of a Kubernetes cluster</a>.</p>
<h2 id="what-is-cluster-autoscaler-and-how-does-it-work">What Is Cluster
Autoscaler and How Does It Work?</h2>
<p>Cluster Autoscaler is a part of Kubernetes. It helps to change the
size of our Kubernetes cluster automatically. It does this by looking at
how much resources our nodes are using. It can add or remove nodes based
on what we need.</p>
<h3 id="how-it-works">How It Works</h3>
<ul>
<li><p><strong>Node Scaling Up</strong>: When there are pods that cannot
be scheduled because there are not enough resources, the Cluster
Autoscaler adds more nodes to the cluster. It checks the available node
groups in the cloud provider. Then, it creates new nodes when
needed.</p></li>
<li><p><strong>Node Scaling Down</strong>: If some nodes are not being
used much and we can move their workloads to fewer nodes, the Cluster
Autoscaler will take away the extra nodes. It checks if the nodes are
empty or if it is safe to move the pods to other nodes.</p></li>
</ul>
<h3 id="configuration">Configuration</h3>
<p>To set up Cluster Autoscaler, we need to:</p>
<ol type="1">
<li><p><strong>Deploy Cluster Autoscaler</strong>: We can deploy it with
a YAML manifest. Here is an example for AWS:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cluster-autoscaler</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> kube-system</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> cluster-autoscaler</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cluster-autoscaler</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> k8s.gcr.io/cluster-autoscaler:v1.21.0</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">command</span><span class="kw">:</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> ./cluster-autoscaler</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> --cloud-provider=aws</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> --nodes=1:10:YOUR-ASG-NAME</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> --v=4</span></span></code></pre></div></li>
<li><p><strong>IAM Permissions</strong>: We must make sure that the IAM
role for our EC2 instances has the right permissions to allow scaling
actions.</p></li>
<li><p><strong>Tags for Auto Scaling Groups</strong>: For AWS, we tag
our Auto Scaling Group with:</p>
<ul>
<li><code>kubernetes.io/cluster/YOUR-CLUSTER-NAME</code>:
<code>owned</code></li>
<li><code>kubernetes.io/cluster-autoscaler/enabled</code>:
<code>true</code></li>
<li><code>kubernetes.io/cluster-autoscaler/YOUR-CLUSTER-NAME</code>:
<code>owned</code></li>
</ul></li>
</ol>
<h3 id="key-features">Key Features</h3>
<ul>
<li><strong>Multi-cloud Support</strong>: It works with different cloud
providers like AWS, GCP, and Azure.</li>
<li><strong>Integration with Kubernetes Scheduler</strong>: It works
well with the Kubernetes scheduling process. This helps to use resources
in the best way.</li>
<li><strong>Customizable Behavior</strong>: We can change how scaling
works based on what our application needs.</li>
</ul>
<p>Cluster Autoscaler is important for handling changing workloads in
Kubernetes. It helps us use resources wisely while keeping our
applications running well. For more details on Kubernetes autoscaling,
we can look at <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-autosale-my-applications-with-horizontal-pod-autoscaler-hpa.html">this
article</a>.</p>
<h2
id="how-can-we-optimize-resource-requests-and-limits-for-effective-scaling">How
Can We Optimize Resource Requests and Limits for Effective Scaling?</h2>
<p>Optimizing resource requests and limits is very important for scaling
well in Kubernetes clusters. When we manage resources properly, our
applications can run smoothly without overloading the cluster or wasting
resources.</p>
<h3 id="setting-resource-requests-and-limits">Setting Resource Requests
and Limits</h3>
<p>We can set resource requests and limits for our Pods in the
deployment YAML file. Requests tell us the minimum CPU and memory
needed. Limits tell us the most that can be used. Here’s a simple
example:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-deployment</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> example</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> example</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-container</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> example-image:latest</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;256Mi&quot;</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;500m&quot;</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;512Mi&quot;</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;1&quot;</span></span></code></pre></div>
<h3 id="best-practices-for-resource-optimization">Best Practices for
Resource Optimization</h3>
<ul>
<li><strong>Analyze Workload Needs</strong>: We should watch our
application to see how it uses resources before we set requests and
limits.</li>
<li><strong>Start Small</strong>: We can begin with lower requests and
then change them based on what we see.</li>
<li><strong>Use Vertical Pod Autoscaler (VPA)</strong>: VPA can change
resource requests and limits automatically based on usage.</li>
<li><strong>Use Resource Quotas</strong>: We can set resource quotas at
the namespace level to stop one application from using too many
resources.</li>
<li><strong>Monitor and Adjust</strong>: We should use tools like
Prometheus and Grafana to check resource usage and change requests and
limits when needed.</li>
</ul>
<h3 id="using-limit-ranges">Using Limit Ranges</h3>
<p>We can also use LimitRanges to set default resource requests and
limits for containers in a namespace:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> LimitRange</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-limit-range</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> example-namespace</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">default</span><span class="kw">:</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;500m&quot;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;256Mi&quot;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">defaultRequest</span><span class="kw">:</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;250m&quot;</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;128Mi&quot;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Container</span></span></code></pre></div>
<p>This setup makes sure that all Pods in the namespace have good
defaults. This helps with scaling and using resources well.</p>
<h3 id="conclusion">Conclusion</h3>
<p>By setting resource requests and limits carefully, using tools like
the Vertical Pod Autoscaler, and following best practices, we can manage
resources better for effective scaling in Kubernetes clusters. For more
information about managing resources, we can check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-resource-limits-and-requests-in-kubernetes.html">how
do I manage resource limits and requests in Kubernetes</a>.</p>
<h2
id="what-are-the-best-practices-for-scaling-stateful-applications-in-kubernetes">What
Are the Best Practices for Scaling Stateful Applications in
Kubernetes?</h2>
<p>Scaling stateful applications in Kubernetes needs careful thought
about data and how the application is built. Here are some best
practices to help us scale stateful applications well:</p>
<ol type="1">
<li><p><strong>Use StatefulSets</strong>: StatefulSets are used to
manage stateful applications. They give unique identities and stable
network names to pods. This is important for applications that need
steady storage.</p>
<p>Example configuration for a StatefulSet:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> StatefulSet</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-statefulset</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">serviceName</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;my-service&quot;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-container</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my-image</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">containerPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">80</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">volumeMounts</span><span class="kw">:</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-storage</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">mountPath</span><span class="kw">:</span><span class="at"> /data</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">volumeClaimTemplates</span><span class="kw">:</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-storage</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">accessModes</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> </span><span class="st">&quot;ReadWriteOnce&quot;</span><span class="at"> </span><span class="kw">]</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">storage</span><span class="kw">:</span><span class="at"> 1Gi</span></span></code></pre></div></li>
<li><p><strong>Persistent Storage</strong>: We must make sure that
stateful applications have persistent storage. Use
PersistentVolumeClaims (PVCs) that connect to storage classes which can
create storage automatically.</p></li>
<li><p><strong>Data Replication</strong>: We should set up data
replication strategies. For example, using databases that have built-in
replication. This helps keep data available and safe during pod
scaling.</p></li>
<li><p><strong>Service Discovery</strong>: We can use Kubernetes
Services for stable network identities. This helps stateful applications
find each other without issues.</p></li>
<li><p><strong>Graceful Scaling</strong>: Use preStop hooks and
terminationGracePeriodSeconds. This helps instances shut down nicely.
They can finish processing requests before they are stopped.</p>
<p>Example of a preStop hook:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lifecycle</span><span class="kw">:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">preStop</span><span class="kw">:</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">exec</span><span class="kw">:</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;/bin/sh&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;-c&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;sleep 30&quot;</span><span class="kw">]</span></span></code></pre></div></li>
<li><p><strong>Horizontal Pod Autoscaler (HPA)</strong>: We can use HPA
to scale based on metrics. But we should be careful with stateful
applications. HPA works best when the application can run many instances
without losing state.</p></li>
<li><p><strong>Monitoring and Logging</strong>: We need good monitoring
and logging systems. This helps us track performance and find problems.
Tools like Prometheus and Grafana give us insights into how the
application works.</p></li>
<li><p><strong>Custom Resource Definitions (CRDs)</strong>: We can think
about using CRDs to create extra scaling rules that fit our application
needs.</p></li>
<li><p><strong>Test Scaling Strategies</strong>: We should regularly do
load testing and chaos engineering. This helps us check if scaling
strategies work and if the application performs well under
stress.</p></li>
<li><p><strong>Backup and Restore</strong>: We need to have a good
backup and restore plan for our stateful data. This protects against
data loss during scaling.</p></li>
</ol>
<p>By following these best practices, we can scale stateful applications
in Kubernetes while keeping data safe and available. For more
information on managing stateful applications, check out <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-stateful-applications-with-statefulsets.html">How
Do I Manage Stateful Applications with StatefulSets?</a>.</p>
<h2 id="how-do-i-implement-custom-metrics-for-autoscaling">How Do I
Implement Custom Metrics for Autoscaling?</h2>
<p>To implement custom metrics for autoscaling in Kubernetes, we can use
the Kubernetes Metrics Server with the Horizontal Pod Autoscaler (HPA).
Custom metrics help us scale our apps based on specific metrics. This is
better than only using CPU or memory.</p>
<h3 id="prerequisites-1">Prerequisites</h3>
<ol type="1">
<li><strong>Metrics Server</strong>: We need to make sure the Metrics
Server is installed in our cluster.</li>
<li><strong>Custom Metrics Adapter</strong>: This lets HPA access our
custom metrics.</li>
</ol>
<h3 id="steps-to-implement-custom-metrics">Steps to Implement Custom
Metrics</h3>
<ol type="1">
<li><p><strong>Install Custom Metrics Adapter</strong>:</p>
<p>We can use <code>kube-prometheus-stack</code> or
<code>prometheus-adapter</code>. Here is an example with
<code>prometheus-adapter</code>.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://github.com/kubernetes-sigs/prometheus-adapter/releases/latest/download/prometheus-adapter.yaml</span></code></pre></div></li>
<li><p><strong>Expose Custom Metrics</strong>:</p>
<p>We need to change our application to expose custom metrics. If we use
Prometheus, we can show metrics in the Prometheus format. For example,
with a Go application:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;net/http&quot;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;github.com/prometheus/client_golang/prometheus&quot;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> requestCount <span class="op">=</span> prometheus<span class="op">.</span>NewCounterVec<span class="op">(</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    prometheus<span class="op">.</span>CounterOpts<span class="op">{</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        Name<span class="op">:</span> <span class="st">&quot;app_requests_total&quot;</span><span class="op">,</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        Help<span class="op">:</span> <span class="st">&quot;Total number of requests processed by the app&quot;</span><span class="op">,</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">[]</span><span class="dt">string</span><span class="op">{</span><span class="st">&quot;method&quot;</span><span class="op">},</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> init<span class="op">()</span> <span class="op">{</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    prometheus<span class="op">.</span>MustRegister<span class="op">(</span>requestCount<span class="op">)</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> handler<span class="op">(</span>w http<span class="op">.</span>ResponseWriter<span class="op">,</span> r <span class="op">*</span>http<span class="op">.</span>Request<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    requestCount<span class="op">.</span>WithLabelValues<span class="op">(</span>r<span class="op">.</span>Method<span class="op">).</span>Inc<span class="op">()</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    w<span class="op">.</span>Write<span class="op">([]</span><span class="dt">byte</span><span class="op">(</span><span class="st">&quot;Hello, World!&quot;</span><span class="op">))</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    http<span class="op">.</span>Handle<span class="op">(</span><span class="st">&quot;/metrics&quot;</span><span class="op">,</span> promhttp<span class="op">.</span>Handler<span class="op">())</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    http<span class="op">.</span>HandleFunc<span class="op">(</span><span class="st">&quot;/&quot;</span><span class="op">,</span> handler<span class="op">)</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    http<span class="op">.</span>ListenAndServe<span class="op">(</span><span class="st">&quot;:8080&quot;</span><span class="op">,</span> <span class="ot">nil</span><span class="op">)</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong>Configure HPA with Custom Metrics</strong>:</p>
<p>We need to create an HPA configuration that uses our custom metric.
Here is an example YAML for HPA:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> autoscaling/v2beta2</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> HorizontalPodAutoscaler</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app-hpa</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scaleTargetRef</span><span class="kw">:</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">minReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">maxReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">metrics</span><span class="kw">:</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Pods</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">pods</span><span class="kw">:</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">metric</span><span class="kw">:</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> app_requests_total</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">target</span><span class="kw">:</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Average</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">averageValue</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span></code></pre></div></li>
<li><p><strong>Apply the HPA Configuration</strong>:</p>
<p>We can deploy the HPA configuration with this command:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> hpa.yaml</span></code></pre></div></li>
<li><p><strong>Verify HPA Status</strong>:</p>
<p>We should check the status of our HPA to make sure it is working
well:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get hpa</span></code></pre></div></li>
</ol>
<h3 id="additional-resources">Additional Resources</h3>
<p>For more information on autoscaling apps in Kubernetes, we can look
at <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-autosale-my-applications-with-horizontal-pod-autoscaler-hpa.html">how
to autoscale applications using Kubernetes</a>. This link gives a good
guide on HPA configurations and best ways to do it.</p>
<h2
id="can-you-provide-real-life-use-cases-for-scaling-kubernetes-clusters">Can
You Provide Real Life Use Cases for Scaling Kubernetes Clusters?</h2>
<p>Scaling Kubernetes clusters well is very important for managing
workloads and keeping applications running smoothly. Here are some
real-life examples showing how companies use Kubernetes scaling:</p>
<ol type="1">
<li><strong>E-Commerce Application During Peak Seasons</strong>:
<ul>
<li><p><strong>Scenario</strong>: An e-commerce site gets a lot of
visitors during holiday sales.</p></li>
<li><p><strong>Solution</strong>: We can use Horizontal Pod Autoscaler
(HPA) to automatically change the number of pods based on CPU and memory
use.</p></li>
<li><p><strong>Example</strong>:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> autoscaling/v2beta2</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> HorizontalPodAutoscaler</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ecommerce-hpa</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scaleTargetRef</span><span class="kw">:</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ecommerce-deployment</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">minReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">maxReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">metrics</span><span class="kw">:</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Resource</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">resource</span><span class="kw">:</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cpu</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">target</span><span class="kw">:</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Utilization</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">averageUtilization</span><span class="kw">:</span><span class="at"> </span><span class="dv">50</span></span></code></pre></div></li>
</ul></li>
<li><strong>Media Streaming Service</strong>:
<ul>
<li><strong>Scenario</strong>: A media company streams videos and must
adjust to changing user demand.</li>
<li><strong>Solution</strong>: We can use Cluster Autoscaler to add or
remove nodes based on how much resources we need.</li>
<li><strong>Configuration</strong>: Turn on Cluster Autoscaler on
services like AWS EKS or Google GKE.</li>
</ul></li>
<li><strong>Machine Learning Workloads</strong>:
<ul>
<li><p><strong>Scenario</strong>: A data science team runs batch jobs
for training models, which needs a lot of resources.</p></li>
<li><p><strong>Solution</strong>: We can use Kubernetes Jobs with
resource requests and limits set. This helps scale nodes
efficiently.</p></li>
<li><p><strong>Example</strong>:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> batch/v1</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Job</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ml-training-job</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> training-container</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> ml-training-image</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;4Gi&quot;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;2&quot;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;8Gi&quot;</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;4&quot;</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">restartPolicy</span><span class="kw">:</span><span class="at"> Never</span></span></code></pre></div></li>
</ul></li>
<li><strong>Gaming Applications</strong>:
<ul>
<li><strong>Scenario</strong>: A multiplayer online game server has
changing player activity.</li>
<li><strong>Solution</strong>: We can set up custom metrics for
autoscaling based on how many players are online. This helps to have
enough resources during busy times.</li>
<li><strong>Custom Metric Example</strong>:
<ul>
<li>We can use Prometheus to collect metrics and set up HPA to scale
based on player numbers.</li>
</ul></li>
</ul></li>
<li><strong>Microservices Architecture</strong>:
<ul>
<li><strong>Scenario</strong>: A company uses microservices for
different tasks, which can have different loads.</li>
<li><strong>Solution</strong>: We can scale each microservice separately
based on its performance metrics. This helps save resources and
costs.</li>
<li><strong>Example</strong>: We can deploy HPA for each
microservice.</li>
</ul></li>
<li><strong>CI/CD Pipelines</strong>:
<ul>
<li><strong>Scenario</strong>: When development is heavy, the number of
build and test jobs goes up a lot.</li>
<li><strong>Solution</strong>: We can automatically scale Jenkins or
GitLab runners based on how many jobs are waiting.</li>
<li><strong>Implementation</strong>: Use Kubernetes to manage the
runners and set proper resource requests.</li>
</ul></li>
<li><strong>Data Processing Applications</strong>:
<ul>
<li><strong>Scenario</strong>: A company works with large datasets for
analytics.</li>
<li><strong>Solution</strong>: We can use Apache Spark on Kubernetes and
change the number of executors based on the workload.</li>
<li><strong>Example</strong>: We can set Spark to scale dynamically
based on job needs.</li>
</ul></li>
</ol>
<p>These examples show how flexible Kubernetes is for handling different
applications and workloads by using good scaling methods. For more on
scaling Kubernetes applications, check out <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-scale-applications-using-kubernetes-deployments.html">how
do I scale applications using Kubernetes deployments</a>.</p>
<h2
id="what-tools-can-help-us-monitor-and-scale-kubernetes-clusters">What
Tools Can Help Us Monitor and Scale Kubernetes Clusters?</h2>
<p>To monitor and scale Kubernetes clusters well, we can use several
tools. These tools help us track resource use, check performance
numbers, and automate scaling tasks.</p>
<ol type="1">
<li><p><strong>Prometheus</strong>: This is a strong monitoring and
alerting toolkit. It gathers metrics from set targets at specific times.
It also checks rule expressions and can send alerts if conditions are
met.</p>
<ul>
<li><p><strong>Installation</strong>:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install prometheus prometheus-community/prometheus</span></code></pre></div></li>
<li><p><strong>Configuration</strong>: We need to add this to our
<code>prometheus.yml</code> to collect metrics from our Kubernetes
nodes:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scrape_configs</span><span class="kw">:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">job_name</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;kubernetes-nodes&#39;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kubernetes_sd_configs</span><span class="kw">:</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">role</span><span class="kw">:</span><span class="at"> node</span></span></code></pre></div></li>
</ul></li>
<li><p><strong>Grafana</strong>: This is a visualization tool that works
with many data sources, including Prometheus. It helps us create
dashboards to see our Kubernetes cluster’s performance better.</p>
<ul>
<li><p><strong>Installation</strong>:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install grafana grafana/grafana</span></code></pre></div></li>
<li><p><strong>Setup</strong>: We need to connect Grafana to Prometheus
and create dashboards to show metrics.</p></li>
</ul></li>
<li><p><strong>Kubernetes Metrics Server</strong>: This tool collects
resource usage data in our cluster. It gets metrics from Kubelets and
shows them through the Kubernetes API.</p>
<ul>
<li><p><strong>Installation</strong>:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span></code></pre></div></li>
<li><p><strong>Usage</strong>: We can use the <code>kubectl top</code>
command to see resource usage:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> top nodes</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> top pods</span></code></pre></div></li>
</ul></li>
<li><p><strong>Horizontal Pod Autoscaler (HPA)</strong>: This tool
automatically changes the number of pods in a deployment based on CPU
use or other metrics we choose.</p>
<ul>
<li><p><strong>Example Configuration</strong>:</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> autoscaling/v2beta2</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> HorizontalPodAutoscaler</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app-hpa</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scaleTargetRef</span><span class="kw">:</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">minReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">maxReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">metrics</span><span class="kw">:</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Resource</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">resource</span><span class="kw">:</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cpu</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">target</span><span class="kw">:</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Utilization</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">averageUtilization</span><span class="kw">:</span><span class="at"> </span><span class="dv">50</span></span></code></pre></div></li>
</ul></li>
<li><p><strong>Cluster Autoscaler</strong>: This tool changes the size
of the Kubernetes cluster based on resource needs. It adds nodes when
pods can’t start because of not enough resources. It also removes nodes
when they are not used much.</p>
<ul>
<li><p><strong>Installation on AWS</strong>:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://raw.githubusercontent.com/kubernetes/autoscaler/master/cluster-autoscaler/cloudprovider/aws/examples/cluster-autoscaler.yaml</span></code></pre></div></li>
</ul></li>
<li><p><strong>KubePrometheus Stack</strong>: This is a group of
monitoring tools, including Prometheus, Grafana, and Alertmanager. They
are set up to work together easily.</p>
<ul>
<li><p><strong>Installation</strong>:</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/prometheus-operator/kube-prometheus.git</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> kube-prometheus</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> manifests/setup</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> manifests/</span></code></pre></div></li>
</ul></li>
<li><p><strong>Datadog</strong>: This is a monitoring and analytics tool
that works with Kubernetes. It gives us full visibility. We can check
metrics, logs, and traces in real time.</p>
<ul>
<li><p><strong>Setup</strong>: We can install the Datadog agent on our
Kubernetes cluster using Helm:</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install datadog datadog/datadog <span class="at">--set</span> apiKey=<span class="op">&lt;</span>YOUR_DATADOG_API_KEY<span class="op">&gt;</span></span></code></pre></div></li>
</ul></li>
<li><p><strong>ELK Stack (Elasticsearch, Logstash, Kibana)</strong>: We
can use ELK for logging and monitoring. It collects logs from all
containers, giving us insights into how our application performs.</p>
<ul>
<li><strong>Installation</strong>: We can use Helm or Docker to set up
the ELK stack in our Kubernetes cluster.</li>
</ul></li>
</ol>
<p>By using these tools, we can monitor and scale our Kubernetes
clusters effectively. For more details on using Kubernetes well, we can
check <a
href="https://bestonlinetutorial.com/kubernetes/what-are-the-key-components-of-a-kubernetes-cluster.html">this
article on Kubernetes components</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="what-is-the-best-way-to-scale-kubernetes-clusters">1. What is
the best way to scale Kubernetes clusters?</h3>
<p>We can scale Kubernetes clusters by using both horizontal and
vertical strategies. Horizontal scaling means we add more nodes or
increase the number of pods. Vertical scaling means we change the
resource limits and requests for existing pods. To scale well, we can
use tools like the Kubernetes Cluster Autoscaler and Horizontal Pod
Autoscaler. These tools help to manage resources based on the needs.</p>
<h3 id="how-does-horizontal-pod-autoscaling-work-in-kubernetes">2. How
does Horizontal Pod Autoscaling work in Kubernetes?</h3>
<p>Horizontal Pod Autoscaling (HPA) in Kubernetes helps to change the
number of pod replicas based on CPU usage or other chosen metrics. To
use HPA right, we need to set resource requests and limits for our
containers. We also need to say what metrics we want to use for scaling.
This helps our application to handle different loads without losing
performance. For more help, see <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-autosale-my-applications-with-horizontal-pod-autoscaler-hpa.html">How
Do I Autoscale My Applications with Horizontal Pod Autoscaler
(HPA)?</a>.</p>
<h3 id="what-metrics-should-i-monitor-for-kubernetes-cluster-scaling">3.
What metrics should I monitor for Kubernetes cluster scaling?</h3>
<p>Important metrics for scaling Kubernetes clusters are CPU and memory
use, pod restart rates, and request latency. By watching these metrics,
we can see how resources are used and how our application performs.
Tools like Prometheus and Grafana can help us see these metrics. This
way, we can make smart scaling decisions and keep our applications
running well even when it is busy.</p>
<h3 id="how-does-the-cluster-autoscaler-function-in-kubernetes">4. How
does the Cluster Autoscaler function in Kubernetes?</h3>
<p>The Cluster Autoscaler in Kubernetes changes the size of the cluster
based on the needs of our workloads. It adds new nodes when pods cannot
start because of not enough resources. It also removes nodes when they
are not used much. This tool helps us use resources well and saves money
while keeping our application performance good. For more details, check
<a
href="https://bestonlinetutorial.com/kubernetes/what-is-cluster-autoscaler-and-how-does-it-work.html">How
Does Cluster Autoscaler Work?</a>.</p>
<h3
id="what-are-the-best-practices-for-scaling-stateful-applications-in-kubernetes-1">5.
What are the best practices for scaling stateful applications in
Kubernetes?</h3>
<p>Scaling stateful applications in Kubernetes needs special care. We
must keep data consistent and available. Best practices include using
StatefulSets to deploy stateful apps, setting up persistent storage for
data, and planning resource requests and limits carefully. We should
also make sure our application can handle scaling changes smoothly to
prevent data loss or downtime. For more tips, see <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-manage-stateful-applications-with-statefulsets.html">How
Do I Manage Stateful Applications with StatefulSets?</a>.</p>
<p>By answering these questions, we can understand better how to scale
Kubernetes clusters well. This helps us to make our applications work
better and be more reliable.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            