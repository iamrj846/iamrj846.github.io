
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TFCQEJR7TD');
</script>
            <title>How Do I Integrate Kubernetes with Monitoring Tools?</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Common CSS & Icons -->
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
<link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
<link rel="stylesheet" href="/assets/css/post.css">
            <meta name="description" content="Discover how to seamlessly integrate Kubernetes with top monitoring tools to enhance performance and visibility for your applications.">

            <div id="head-placeholder"></div>
            <script src="/assets/js/blog.js" defer></script>
            <link rel="stylesheet" href="/assets/css/post.css">
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How Do I Integrate Kubernetes with Monitoring Tools?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>Integrating Kubernetes with monitoring tools is very important for
keeping our containerized applications healthy and running well.
Monitoring tools help us see what is happening in the cluster. We can
track metrics, set alerts, and watch data trends. This helps us manage
resources better and fix problems before they get worse.</p>
<p>In this article, we will talk about different ways to connect
Kubernetes with monitoring tools. We will look at some of the best
monitoring solutions out there. We will also give simple steps on how to
install and set up tools like Prometheus and Grafana. We will discuss
what we need to do for good monitoring. We will learn how to collect
metrics from Kubernetes pods. We will also cover common uses for
monitoring, how to make visuals in Grafana, and how to set up alerts for
better management.</p>
<ul>
<li>How Can I Integrate Kubernetes with Monitoring Tools</li>
<li>What Are the Best Monitoring Tools for Kubernetes</li>
<li>How Do I Install Prometheus for Kubernetes Monitoring</li>
<li>How Can I Set Up Grafana with Kubernetes</li>
<li>What Configuration is Needed for Effective Monitoring</li>
<li>How Do I Collect Metrics from Kubernetes Pods</li>
<li>What Are Common Use Cases for Kubernetes Monitoring</li>
<li>How Can I Visualize Metrics in Grafana</li>
<li>How Do I Set Up Alerts for Kubernetes Monitoring</li>
<li>Frequently Asked Questions</li>
</ul>
<h2 id="what-are-the-best-monitoring-tools-for-kubernetes">What Are the
Best Monitoring Tools for Kubernetes?</h2>
<p>When we look at monitoring tools for Kubernetes, some options are
really good. They have nice features, great community support, and are
easy to use. Here are the best monitoring tools for Kubernetes:</p>
<ol type="1">
<li><strong>Prometheus</strong>
<ul>
<li>This is an open-source monitoring system.</li>
<li>It collects data from targets we set at certain times.</li>
<li>It uses a multi-dimensional data model and a strong query language
called PromQL.</li>
</ul></li>
<li><strong>Grafana</strong>
<ul>
<li>This is a tool for visualizing data.</li>
<li>We often use it with Prometheus.</li>
<li>It helps us make dashboards and graphs to analyze our data.</li>
<li>It works with many different data sources.</li>
</ul></li>
<li><strong>Elasticsearch, Fluentd, and Kibana (EFK) Stack</strong>
<ul>
<li><strong>Elasticsearch</strong>: This is a search and analytics
engine that is distributed and RESTful.</li>
<li><strong>Fluentd</strong>: It is a data collector for logging.</li>
<li><strong>Kibana</strong>: This tool helps us visualize data from
Elasticsearch.</li>
<li>This stack is great for logging and seeing log data.</li>
</ul></li>
<li><strong>Datadog</strong>
<ul>
<li>This is a complete monitoring and analytics platform.</li>
<li>It gives us ready-to-use Kubernetes monitoring.</li>
<li>It has features for logs, metrics, and APM (Application Performance
Monitoring).</li>
</ul></li>
<li><strong>Sysdig</strong>
<ul>
<li>This tool is made for monitoring containers and Kubernetes.</li>
<li>It gives us deep insight into how containers perform and their
security.</li>
<li>It helps with monitoring and solving problems.</li>
</ul></li>
<li><strong>New Relic</strong>
<ul>
<li>This is a full-stack observability platform.</li>
<li>It supports Kubernetes monitoring with detailed performance
metrics.</li>
<li>It works well with other New Relic services.</li>
</ul></li>
<li><strong>Kube-state-metrics</strong>
<ul>
<li>This tool shows us metrics about the state of Kubernetes
objects.</li>
<li>It helps us check the health and performance of our cluster.</li>
</ul></li>
<li><strong>Thanos</strong>
<ul>
<li>This is a Prometheus setup that is highly available and can store
data for a long time.</li>
<li>It helps us gather metrics from many Prometheus instances.</li>
</ul></li>
<li><strong>OpenTelemetry</strong>
<ul>
<li>It is a framework for observing cloud-native software.</li>
<li>It gives us APIs, libraries, agents, and tools for metrics and
tracing.</li>
</ul></li>
<li><strong>Instana</strong>
<ul>
<li>This is a solution for monitoring application performance.</li>
<li>It automatically finds microservices and monitors Kubernetes
environments.</li>
</ul></li>
</ol>
<p>Choosing the right monitoring tool depends on what we need for our
Kubernetes environment. We should think about scalability, how easy it
is to integrate, and what type of metrics we want to collect. For more
information on how to use these tools, check out <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">how
to monitor your Kubernetes cluster</a>.</p>
<h2 id="how-do-we-install-prometheus-for-kubernetes-monitoring">How Do
We Install Prometheus for Kubernetes Monitoring?</h2>
<p>To install Prometheus for monitoring our Kubernetes cluster, we can
use the Prometheus Operator or Helm charts. Using Helm is easier and
gives us more flexibility. Here are the simple steps to install
Prometheus using Helm.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>We need to have a Kubernetes cluster running.</li>
<li>We also need to install Helm on our local machine.</li>
</ul>
<h3 id="step-1-add-the-prometheus-helm-chart-repository">Step 1: Add the
Prometheus Helm Chart Repository</h3>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo add prometheus-community https://prometheus-community.github.io/helm-charts</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo update</span></code></pre></div>
<h3 id="step-2-install-prometheus">Step 2: Install Prometheus</h3>
<p>Let us install Prometheus with the command below. This command will
create a <code>prometheus</code> namespace and deploy Prometheus with
its parts.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install prometheus prometheus-community/prometheus <span class="at">--namespace</span> prometheus <span class="at">--create-namespace</span></span></code></pre></div>
<h3 id="step-3-verify-the-installation">Step 3: Verify the
Installation</h3>
<p>To check if Prometheus is running, we can look at the pods in the
<code>prometheus</code> namespace.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">--namespace</span> prometheus</span></code></pre></div>
<p>We should see several pods running. One of them will be
<code>prometheus-server</code>.</p>
<h3 id="step-4-access-prometheus-ui">Step 4: Access Prometheus UI</h3>
<p>To get to the Prometheus web interface, we can use port
forwarding:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> port-forward svc/prometheus-server 9090:80 <span class="at">--namespace</span> prometheus</span></code></pre></div>
<p>Now we can access the Prometheus UI by going to
<code>http://localhost:9090</code> in our web browser.</p>
<h3 id="step-5-configure-prometheus">Step 5: Configure Prometheus</h3>
<p>To change our Prometheus settings, we can create a
<code>values.yaml</code> file. Here is a simple example:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">alertmanager</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">enabled</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">server</span><span class="kw">:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">persistentVolume</span><span class="kw">:</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">enabled</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">service</span><span class="kw">:</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> NodePort</span></span></code></pre></div>
<p>After that, we install Prometheus with our custom settings:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install prometheus prometheus-community/prometheus <span class="at">--namespace</span> prometheus <span class="at">--values</span> values.yaml</span></code></pre></div>
<h3 id="additional-configuration">Additional Configuration</h3>
<p>We might want to set Prometheus to scrape metrics from certain
services or change retention settings. We can do this in the Prometheus
configuration file or in the Helm chart values.</p>
<p>For more advanced setups, we can integrate Prometheus with Grafana
for better visuals. For more details about monitoring our Kubernetes
environment, we can look at <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">how
to monitor my Kubernetes cluster</a>.</p>
<h2 id="how-can-i-set-up-grafana-with-kubernetes">How Can I Set Up
Grafana with Kubernetes?</h2>
<p>To set up Grafana with Kubernetes, we can follow these simple
steps:</p>
<ol type="1">
<li><p><strong>Create a namespace for Grafana</strong>:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create namespace grafana</span></code></pre></div></li>
<li><p><strong>Deploy Grafana using a Helm chart</strong>: First, we add
the Grafana Helm repository:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo add grafana https://grafana.github.io/helm-charts</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo update</span></code></pre></div>
<p>Now we install Grafana:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install grafana grafana/grafana <span class="at">--namespace</span> grafana</span></code></pre></div></li>
<li><p><strong>Get the Grafana admin password</strong>: We run this
command:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get secret <span class="at">--namespace</span> grafana grafana <span class="at">-o</span> jsonpath=<span class="st">&quot;{.data.admin-password}&quot;</span> <span class="kw">|</span> <span class="fu">base64</span> <span class="at">--decode</span> <span class="kw">;</span> <span class="bu">echo</span></span></code></pre></div></li>
<li><p><strong>Expose Grafana using a LoadBalancer service</strong>: We
need to change the service type in the Grafana deployment. Here is the
YAML:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Service</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> grafana</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> grafana</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> LoadBalancer</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">80</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">targetPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">3000</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">app</span><span class="kw">:</span><span class="at"> grafana</span></span></code></pre></div></li>
<li><p><strong>Access Grafana</strong>: After we deploy, we get the
service details to find the external IP:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get svc <span class="at">--namespace</span> grafana</span></code></pre></div>
<p>We open our browser and go to
<code>http://&lt;EXTERNAL_IP&gt;:80</code>, and we log in using:</p>
<ul>
<li>Username: <code>admin</code></li>
<li>Password: (the value we got before)</li>
</ul></li>
<li><p><strong>Set up data sources</strong>: When we log in, we can set
up data sources like Prometheus. We go to <strong>Configuration &gt;
Data Sources</strong> and add Prometheus with the URL
<code>http://prometheus-service:9090</code> (change service name if
needed).</p></li>
<li><p><strong>Create dashboards</strong>: We can use the Grafana UI to
create new dashboards. This helps us to see metrics from our Kubernetes
cluster.</p></li>
</ol>
<p>For more details on Kubernetes monitoring, we can check the article
on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">how
to monitor my Kubernetes cluster</a>.</p>
<h2 id="what-configuration-is-needed-for-effective-monitoring">What
Configuration is Needed for Effective Monitoring?</h2>
<p>To have good monitoring in Kubernetes, we need some important
settings. Here are the main parts:</p>
<ol type="1">
<li><p><strong>Resource Limits and Requests</strong>: We must set
resource limits and requests for our pods. This way, we can allocate and
monitor resources properly.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-pod</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-container</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">image</span><span class="kw">:</span><span class="at"> nginx</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;64Mi&quot;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;250m&quot;</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;128Mi&quot;</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;500m&quot;</span></span></code></pre></div></li>
<li><p><strong>Monitoring Stack</strong>: We should create a monitoring
stack that usually has:</p>
<ul>
<li><strong>Prometheus</strong> to gather metrics.</li>
<li><strong>Grafana</strong> to show data visually.</li>
<li><strong>Alertmanager</strong> for sending alerts.</li>
</ul></li>
<li><p><strong>Service Discovery</strong>: We configure Prometheus to
use Kubernetes service discovery. This helps it find targets
automatically.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scrape_configs</span><span class="kw">:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">job_name</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;kubernetes-apiservers&#39;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kubernetes_sd_configs</span><span class="kw">:</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">role</span><span class="kw">:</span><span class="at"> endpoints</span></span></code></pre></div></li>
<li><p><strong>Node Exporter</strong>: We need to deploy Node Exporter
on each node. This tool collects hardware and OS metrics.</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://raw.githubusercontent.com/prometheus/node_exporter/master/examples/kubernetes/daemonset.yml</span></code></pre></div></li>
<li><p><strong>Persistent Storage</strong>: We should use persistent
storage for Prometheus. This way, it can keep historical data.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> PersistentVolumeClaim</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> prometheus-pvc</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">accessModes</span><span class="kw">:</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> ReadWriteOnce</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">storage</span><span class="kw">:</span><span class="at"> 10Gi</span></span></code></pre></div></li>
<li><p><strong>Network Policies</strong>: We need to use Network
Policies. This controls traffic to and from monitoring services. It
helps make our setup safer.</p></li>
<li><p><strong>Alerts Configuration</strong>: We set up alert rules in
Prometheus. This notifies us of important issues.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">groups</span><span class="kw">:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-alerts</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">alert</span><span class="kw">:</span><span class="at"> HighCPUUsage</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> sum(rate(container_cpu_usage_seconds_total[5m])) by (pod) &gt; 0.5</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">for</span><span class="kw">:</span><span class="at"> 5m</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">severity</span><span class="kw">:</span><span class="at"> warning</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">summary</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;High CPU usage detected&quot;</span></span></code></pre></div></li>
<li><p><strong>Log Collection</strong>: We can combine logging solutions
like Fluentd or Logstash with our monitoring stack. This helps us
connect logs with metrics.</p></li>
<li><p><strong>Grafana Dashboard</strong>: We can use ready-made Grafana
dashboards that are made for Kubernetes monitoring. This makes setup
fast.</p></li>
<li><p><strong>Security Configuration</strong>: We need to make sure our
monitoring stack follows security best practices. This includes using
RBAC for authorization.</p></li>
</ol>
<p>By setting up these parts, we can create a strong monitoring solution
for our Kubernetes environment. This way, we can see how our
applications perform and stay healthy. For more details on Kubernetes
monitoring, we can read about <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">how
to monitor your Kubernetes cluster</a>.</p>
<h2 id="how-do-we-collect-metrics-from-kubernetes-pods">How Do We
Collect Metrics from Kubernetes Pods?</h2>
<p>To collect metrics from Kubernetes Pods, we can use different ways.
Prometheus is one of the most popular tools for this. Here are the steps
to set up metrics collection from Pods.</p>
<h3 id="install-prometheus">1. Install Prometheus</h3>
<p>First, we need to make sure we have Prometheus installed in our
Kubernetes cluster. We can use Helm to install it:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo add prometheus-community https://prometheus-community.github.io/helm-charts</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo update</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install prometheus prometheus-community/prometheus</span></code></pre></div>
<h3 id="configure-metrics-endpoints">2. Configure Metrics Endpoints</h3>
<p>Next, we need to ensure our application Pods show metrics. We can do
this by adding an endpoint in our application code. For example, in a
Node.js application using <code>express</code>:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express&#39;</span>)<span class="op">;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> app <span class="op">=</span> <span class="fu">express</span>()<span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> client <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;prom-client&#39;</span>)<span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> collectDefaultMetrics <span class="op">=</span> client<span class="op">.</span><span class="at">collectDefaultMetrics</span><span class="op">;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">collectDefaultMetrics</span>({ <span class="dt">timeout</span><span class="op">:</span> <span class="dv">5000</span> })<span class="op">;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/metrics&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;Content-Type&#39;</span><span class="op">,</span> client<span class="op">.</span><span class="at">register</span><span class="op">.</span><span class="at">contentType</span>)<span class="op">;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">end</span>(client<span class="op">.</span><span class="at">register</span><span class="op">.</span><span class="fu">metrics</span>())<span class="op">;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">listen</span>(<span class="dv">3000</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Server listening on port 3000&#39;</span>)<span class="op">;</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="use-service-monitors">3. Use Service Monitors</h3>
<p>We need to create a ServiceMonitor. This tells Prometheus to scrape
the metrics from our Pods. Here is an example YAML configuration for a
ServiceMonitor:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> monitoring.coreos.com/v1</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ServiceMonitor</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app-monitor</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">app</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespaceSelector</span><span class="kw">:</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchNames</span><span class="kw">:</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> default</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">endpoints</span><span class="kw">:</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">port</span><span class="kw">:</span><span class="at"> metrics</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /metrics</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> 30s</span></span></code></pre></div>
<h3 id="deploy-the-servicemonitor">4. Deploy the ServiceMonitor</h3>
<p>Now we apply the ServiceMonitor configuration using
<code>kubectl</code>:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> service-monitor.yaml</span></code></pre></div>
<h3 id="verify-metrics-collection">5. Verify Metrics Collection</h3>
<p>To check if metrics are being collected, we can look at the
Prometheus UI:</p>
<ul>
<li>We can access the Prometheus UI. If we installed it with Helm, we
might need to port-forward to access it:</li>
</ul>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> port-forward svc/prometheus-server 9090:80</span></code></pre></div>
<ul>
<li>Then we open our browser and go to
<code>http://localhost:9090</code>. We check the “Targets” section to
see if our Pods are listed and their scraping status.</li>
</ul>
<h3 id="querying-metrics">6. Querying Metrics</h3>
<p>We can query metrics using Prometheus’s query language called PromQL.
For example, to get the request count for our application, we can
use:</p>
<pre class="promql"><code>http_requests_total{app=&quot;my-app&quot;}</code></pre>
<h3 id="related-resources">Related Resources</h3>
<p>For more information on monitoring Kubernetes clusters, we can refer
to <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">how
do I monitor my Kubernetes cluster</a>.</p>
<h2 id="what-are-common-use-cases-for-kubernetes-monitoring">What Are
Common Use Cases for Kubernetes Monitoring?</h2>
<p>Kubernetes monitoring is very important for keeping our containerized
applications healthy and working well. Here are some common use cases
for Kubernetes monitoring:</p>
<ol type="1">
<li><p><strong>Resource Utilization Monitoring</strong>: We track CPU,
memory, and storage use of pods and nodes. This helps us allocate
resources better. We can find out which resources are not used enough or
used too much. This helps us make better decisions about scaling.</p>
<p>Here is a simple example of how we can monitor resource use:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> resource-monitor</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> metrics-exporter</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> metrics-server/metrics-server:v0.4.4</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">args</span><span class="kw">:</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> --metric-resolution=15s</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">containerPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">4443</span></span></code></pre></div></li>
<li><p><strong>Application Performance Monitoring (APM)</strong>: We
check how well applications run in pods. This helps us find latency
issues, errors, and slow points. We can use tools like Prometheus to
collect metrics from application endpoints.</p></li>
<li><p><strong>Cluster Health Monitoring</strong>: We need to make sure
the entire Kubernetes cluster is healthy. We monitor the status of
nodes, pods, and services. We can set alerts to notify us if any node or
pod fails.</p></li>
<li><p><strong>Network Monitoring</strong>: We analyze network traffic
and check connections between pods and services. This helps us fix
communication problems. We also monitor traffic going in and out of the
cluster.</p></li>
<li><p><strong>Alerting and Incident Response</strong>: We can set
alerts for certain limits on resource use, application errors, or
cluster events. Using tools like Grafana helps us visualize data and
respond to incidents quickly.</p>
<p>Here is an example of an alert configuration in Prometheus:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">groups</span><span class="kw">:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> alert-rules</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">alert</span><span class="kw">:</span><span class="at"> HighCpuUsage</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> sum(rate(container_cpu_usage_seconds_total[5m])) by (pod) &gt; 0.8</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">for</span><span class="kw">:</span><span class="at"> 5m</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">severity</span><span class="kw">:</span><span class="at"> critical</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">summary</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;CPU usage is high for pod {{ $labels.pod }}&quot;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Pod {{ $labels.pod }} is using more than 80% CPU.&quot;</span></span></code></pre></div></li>
<li><p><strong>Log Aggregation and Analysis</strong>: We gather logs
from all containers. This makes debugging and analysis easier. Tools
like Fluentd or ELK stack can help us collect and visualize
logs.</p></li>
<li><p><strong>Compliance and Security Monitoring</strong>: We check if
we follow security rules and best practices. This includes looking for
unauthorized access attempts or unsafe settings.</p></li>
<li><p><strong>Capacity Planning</strong>: We look at past data to
predict our resource needs. This helps us plan for upgrades or scaling.
We monitor trends in resource usage over time.</p></li>
<li><p><strong>Custom Metrics Monitoring</strong>: We collect and keep
track of custom application metrics. This gives us insight into specific
business needs or functions. We can do this by adding libraries like
Prometheus client libraries to our application code.</p></li>
</ol>
<p>By using good Kubernetes monitoring practices, we can make our
applications more reliable, perform better, and be safer in a changing
containerized environment. For more details about setting up good
monitoring in Kubernetes, you can check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">how
do I monitor my Kubernetes cluster</a>.</p>
<h2 id="how-can-i-visualize-metrics-in-grafana">How Can I Visualize
Metrics in Grafana?</h2>
<p>To see metrics from Kubernetes in Grafana, we need to do some
steps.</p>
<ol type="1">
<li><p><strong>Install Grafana</strong>: If we do not have Grafana yet,
we can set it up on Kubernetes using Helm. First, we add the Grafana
Helm repository:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo add grafana https://grafana.github.io/helm-charts</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo update</span></code></pre></div>
<p>Now we install Grafana:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install grafana grafana/grafana <span class="at">--namespace</span> monitoring <span class="at">--create-namespace</span></span></code></pre></div></li>
<li><p><strong>Access the Grafana Dashboard</strong>: After we install
it, we can access Grafana by forwarding the service:</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> port-forward svc/grafana 3000:80 <span class="at">--namespace</span> monitoring</span></code></pre></div>
<p>We can open Grafana at <code>http://localhost:3000</code>. The
default login is <code>admin</code>. We can find the password by
running:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get secret <span class="at">--namespace</span> monitoring grafana <span class="at">-o</span> jsonpath=<span class="st">&quot;{.data.admin-password}&quot;</span> <span class="kw">|</span> <span class="fu">base64</span> <span class="at">--decode</span> <span class="kw">;</span> <span class="bu">echo</span></span></code></pre></div></li>
<li><p><strong>Add Data Source</strong>: In Grafana, we need to add
Prometheus as a data source:</p>
<ul>
<li>Go to <strong>Configuration</strong> &gt; <strong>Data
Sources</strong>.</li>
<li>Click on <strong>Add data source</strong> and pick
<strong>Prometheus</strong>.</li>
<li>Set the URL to your Prometheus server. It is usually
<code>http://prometheus:9090</code> if we run it in the same Kubernetes
cluster.</li>
<li>Click <strong>Save &amp; Test</strong> to check the connection.</li>
</ul></li>
<li><p><strong>Create Dashboards</strong>: To see metrics:</p>
<ul>
<li><p>Go to <strong>Create</strong> &gt;
<strong>Dashboard</strong>.</p></li>
<li><p>Click on <strong>Add new panel</strong>.</p></li>
<li><p>In the panel settings, choose your Prometheus data
source.</p></li>
<li><p>Use PromQL queries to get metrics, like:</p>
<pre class="promql"><code>sum(rate(container_cpu_usage_seconds_total{job=&quot;kubelet&quot;, cluster=&quot;&quot;, image!=&quot;&quot;, container!=&quot;POD&quot;}[5m])) by (pod)</code></pre></li>
<li><p>Set the visualization type (Graph, Gauge, Table, etc.) based on
what we want.</p></li>
</ul></li>
<li><p><strong>Save the Dashboard</strong>: After we set up our panels,
we should save the dashboard for later use.</p></li>
<li><p><strong>Set up Variables</strong>: We can make our dashboards
more flexible by using variables. Go to <strong>Dashboard
settings</strong> &gt; <strong>Variables</strong> and add new variables
based on our metrics, like pod names or namespaces.</p></li>
<li><p><strong>Apply Annotations and Alerts</strong>: We can also add
annotations to our graphs for better understanding. We can set up alerts
based on our metrics too. Go to the <strong>Alert</strong> tab in panel
settings to set alerts.</p></li>
</ol>
<p>By doing these steps, we can see and track our Kubernetes metrics
using Grafana. For more details on monitoring our Kubernetes cluster, we
can check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">how
do I monitor my Kubernetes cluster</a>.</p>
<h2 id="how-do-we-set-up-alerts-for-kubernetes-monitoring">How Do We Set
Up Alerts for Kubernetes Monitoring?</h2>
<p>Setting up alerts for Kubernetes monitoring is very important. It
helps us keep our applications healthy and performing well. We can use
tools like Prometheus and Alertmanager to make alert rules and
notifications.</p>
<ol type="1">
<li><p><strong>Install and Configure Prometheus</strong>: First, we need
to install Prometheus. If we haven’t done this yet, we can check the
section on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-install-prometheus-for-kubernetes-monitoring.html">How
Do I Install Prometheus for Kubernetes Monitoring?</a>.</p></li>
<li><p><strong>Create Alert Rules</strong>: Next, we need to create
alert rules in a YAML file. For example, if we want to alert on high CPU
usage, we can make a file called <code>alerts.yaml</code>:</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">groups</span><span class="kw">:</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> example-alerts</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">alert</span><span class="kw">:</span><span class="at"> HighCPUUsage</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> sum(rate(container_cpu_usage_seconds_total[5m])) by (container_name) &gt; 0.9</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">for</span><span class="kw">:</span><span class="at"> 5m</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">severity</span><span class="kw">:</span><span class="at"> critical</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">summary</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;High CPU usage detected&quot;</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;CPU usage is above 90% for more than 5 minutes.&quot;</span></span></code></pre></div></li>
<li><p><strong>Update Prometheus Configuration</strong>: After that, we
need to update our Prometheus config to add the new alert rules. We can
change our <code>prometheus.yml</code> file like this:</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rule_files</span><span class="kw">:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;/etc/prometheus/alerts.yaml&#39;</span></span></code></pre></div></li>
<li><p><strong>Deploy Alertmanager</strong>: If we don’t have
Alertmanager set up, we can deploy it using this command:</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://raw.githubusercontent.com/prometheus/alertmanager/main/alertmanager.yaml</span></code></pre></div></li>
<li><p><strong>Configure Alertmanager</strong>: Now, we need to create a
config file for Alertmanager (like <code>alertmanager.yml</code>). This
file will define our notification routes and receivers:</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global</span><span class="kw">:</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">resolve_timeout</span><span class="kw">:</span><span class="at"> 5m</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">route</span><span class="kw">:</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group_by</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&#39;alertname&#39;</span><span class="kw">]</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group_wait</span><span class="kw">:</span><span class="at"> 30s</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">group_interval</span><span class="kw">:</span><span class="at"> 5m</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">repeat_interval</span><span class="kw">:</span><span class="at"> 3h</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">receiver</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;email&#39;</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">receivers</span><span class="kw">:</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;email&#39;</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">email_configs</span><span class="kw">:</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">to</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;you@example.com&#39;</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">from</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;alertmanager@example.com&#39;</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">smarthost</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;smtp.example.com:587&#39;</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">auth_username</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;alertmanager@example.com&#39;</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">auth_password</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;yourpassword&#39;</span></span></code></pre></div></li>
<li><p><strong>Deploy Alertmanager Configuration</strong>: We can apply
our Alertmanager config with this command:</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> alertmanager.yml</span></code></pre></div></li>
<li><p><strong>Test Alerts</strong>: It is important to test that our
alerts work. We can simulate conditions that should trigger the alerts.
We should check the Alertmanager UI to see if the alerts show
up.</p></li>
<li><p><strong>Monitor Alerts</strong>: Finally, we can use the
Alertmanager web UI or connect to communication tools like Slack or
PagerDuty for notifications.</p></li>
</ol>
<p>By following these steps, we can set up alerts for our Kubernetes
monitoring. This way, we will know about any critical issues in our
applications. For more detailed information about Kubernetes monitoring,
we can read the article on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">How
Do I Monitor My Kubernetes Cluster?</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="what-is-kubernetes-monitoring-and-why-is-it-important">What is
Kubernetes monitoring and why is it important?</h3>
<p>Kubernetes monitoring is about watching how well our applications
work in Kubernetes clusters. It is very important for keeping things
reliable. It helps us find problems and use resources better. Good
monitoring helps us keep application performance, fix issues fast, and
make the user experience better.</p>
<h3 id="how-can-i-integrate-monitoring-tools-with-kubernetes">How can I
integrate monitoring tools with Kubernetes?</h3>
<p>We can integrate monitoring tools with Kubernetes in different ways.
One way is to use tools like Prometheus and Grafana. These tools help us
collect and show metrics from Kubernetes parts and applications. For
more details, we can check our guide on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-set-up-kubernetes-monitoring-and-alerting.html">how
to set up Kubernetes monitoring</a>.</p>
<h3 id="what-metrics-should-i-monitor-in-kubernetes">What metrics should
I monitor in Kubernetes?</h3>
<p>We should monitor key metrics in Kubernetes like CPU usage, memory
usage, node health, pod status, and network traffic. Watching these
metrics helps us find performance problems. It also makes sure our
applications work within their limits. Using tools like Prometheus can
help us collect these important metrics automatically.</p>
<h3 id="how-do-i-set-up-alerts-for-kubernetes-monitoring">How do I set
up alerts for Kubernetes monitoring?</h3>
<p>To set up alerts for Kubernetes monitoring, we usually need to
configure alerting rules in tools like Prometheus. We can set conditions
to trigger alerts when metrics reach certain levels. Also, we can use
Alertmanager with Prometheus to manage notifications. This way, the
right teams get informed about possible issues quickly.</p>
<h3 id="can-i-visualize-kubernetes-metrics-with-grafana">Can I visualize
Kubernetes metrics with Grafana?</h3>
<p>Yes, we can visualize Kubernetes metrics with Grafana. We just need
to connect it to our Prometheus data source. Grafana gives us an easy
way to create dashboards that show real-time metrics. This helps us
monitor the health and performance of our Kubernetes clusters well. For
help, we can look at our article on <a
href="https://bestonlinetutorial.com/kubernetes/how-can-i-set-up-grafana-with-kubernetes.html">setting
up Grafana with Kubernetes</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            