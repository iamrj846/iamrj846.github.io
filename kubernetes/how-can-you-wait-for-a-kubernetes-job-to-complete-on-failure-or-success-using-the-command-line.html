
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
            <meta property="og:title" content="How can you wait for a Kubernetes job to complete on failure or success using the command line?" />
            <meta property="og:description" content="Learn how to monitor Kubernetes job completion using command line tools for both success and failure scenarios effectively." />
            <meta property="og:url" content="https://www.bestonlinetutorial.com/kubernetes/how-can-you-wait-for-a-kubernetes-job-to-complete-on-failure-or-success-using-the-command-line.html" />
            <link rel="canonical" href="https://www.bestonlinetutorial.com/kubernetes/how-can-you-wait-for-a-kubernetes-job-to-complete-on-failure-or-success-using-the-command-line.html">
            <meta property="og:type" content="article" />
            <meta property="og:site_name" content=“BestOnlineTutorial” />
            <meta name="twitter:title" content="How can you wait for a Kubernetes job to complete on failure or success using the command line?" />
            <meta name="twitter:description" content="Learn how to monitor Kubernetes job completion using command line tools for both success and failure scenarios effectively." />
            <meta name="pinterest-rich-pin" content="true" />

            <script type="application/ld+json">
                {
                "@context": "https://schema.org",
                "@type": "WebSite",
                "name": "BestOnlineTutorial",
                "url": "https://www.bestonlinetutorial.com/"
                }
            </script>
            <!-- Common CSS & Icons -->
            <link rel="icon" href="/favicon.ico" type="image/x-icon">
            <link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
            <link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
            <link rel="stylesheet" href="/assets/css/post.css">
            <title>How can you wait for a Kubernetes job to complete on failure or success using the command line?</title>
            <meta name="description" content="Learn how to monitor Kubernetes job completion using command line tools for both success and failure scenarios effectively.">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How can you wait for a Kubernetes job to complete on failure or success using the command line?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>To wait for a Kubernetes job to finish, whether it is a success or
failure, we can use the command line tool <code>kubectl</code>. This
tool helps us see the job’s status in real-time. We can know when the
job has stopped and what its exit status is. By using some
<code>kubectl</code> commands, we can find out if jobs are done and deal
with any errors that happen during the process.</p>
<p>In this article, we will talk about good ways to wait for Kubernetes
jobs to finish. We will show how to check job status with
<code>kubectl</code>. We will also explain how to poll to see if the job
is done. We will look at Kubernetes events for updates, how to get job
completion output, and how to manage job failures nicely. Here is a
summary of what we will cover:</p>
<ul>
<li>How to wait for a Kubernetes job to finish, whether it fails or
succeeds, using the command line</li>
<li>How to use <code>kubectl</code> to check job status in
Kubernetes</li>
<li>How to poll to wait for job completion in Kubernetes</li>
<li>How to use Kubernetes events to check job status</li>
<li>How to get job completion output in Kubernetes</li>
<li>How to manage job failures nicely in Kubernetes</li>
</ul>
<p>By the end of this article, we will understand how to handle
Kubernetes jobs well using the command line.</p>
<h2 id="how-can-we-use-kubectl-to-check-job-status-in-kubernetes">How
Can We Use kubectl to Check Job Status in Kubernetes?</h2>
<p>We can check the status of a Kubernetes job using the
<code>kubectl</code> command-line tool. The commands below will help us
get information about the job and what is happening with it.</p>
<ol type="1">
<li><p><strong>List all jobs in a namespace:</strong></p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get jobs <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div>
<p>We should replace <code>&lt;namespace&gt;</code> with the right name
of the namespace. If we want to see jobs in the default namespace, we
can skip the <code>-n &lt;namespace&gt;</code> part.</p></li>
<li><p><strong>Describe a specific job:</strong></p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> describe job <span class="op">&lt;</span>job-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div>
<p>This command shows us detailed information about the job we choose.
It includes its conditions, events, and any mistakes that happened while
it was running.</p></li>
<li><p><strong>Check the logs of a job’s pods:</strong> First, we need
to find the pods that belong to the job:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">--selector</span><span class="op">=</span>job-name=<span class="op">&lt;</span>job-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div>
<p>Then, we can get logs from a specific pod:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="op">&lt;</span>pod-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Get job status directly:</strong> We can get the status
of a job by formatting the output to show only the important
information:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get jobs <span class="op">&lt;</span>job-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span> -o jsonpath=<span class="st">&#39;{.status.conditions[?(@.type==&quot;Complete&quot;)].status}&#39;</span></span></code></pre></div></li>
<li><p><strong>Watch job status updates:</strong> If we want to keep an
eye on the job status, we can use the <code>--watch</code> flag:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get jobs <span class="op">&lt;</span>job-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span> --watch</span></code></pre></div></li>
</ol>
<p>These commands help us to monitor and manage Kubernetes jobs using
<code>kubectl</code>. For more information on Kubernetes job management,
we can check this <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-run-batch-jobs-in-kubernetes-with-jobs-and-cronjobs.html">article
on running batch jobs in Kubernetes</a>.</p>
<h2
id="how-can-we-implement-polling-to-wait-for-job-completion-in-kubernetes">How
Can We Implement Polling to Wait for Job Completion in Kubernetes?</h2>
<p>To implement polling for waiting on a Kubernetes job’s completion, we
can use a simple shell script. This script will check the job status
again and again until it completes or fails. Here is how we can do
it:</p>
<ol type="1">
<li><p><strong>Define the Job Name and Namespace:</strong></p>
<p>First, we set the job name and namespace variables. This makes it
easy to reference them:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="va">JOB_NAME</span><span class="op">=</span>my-kubernetes-job</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="va">NAMESPACE</span><span class="op">=</span>my-namespace</span></code></pre></div></li>
<li><p><strong>Polling Script:</strong></p>
<p>Next, we use a loop to check the job’s status at regular times. We
can change the interval by changing the <code>sleep</code> duration:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="fu">true</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">STATUS</span><span class="op">=</span><span class="va">$(</span><span class="ex">kubectl</span> get jobs <span class="va">$JOB_NAME</span> <span class="at">-n</span> <span class="va">$NAMESPACE</span> <span class="at">-o</span> jsonpath=<span class="st">&#39;{.status.conditions[?(@.type==&quot;Complete&quot;)].status}&#39;</span><span class="va">)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">FAILED</span><span class="op">=</span><span class="va">$(</span><span class="ex">kubectl</span> get jobs <span class="va">$JOB_NAME</span> <span class="at">-n</span> <span class="va">$NAMESPACE</span> <span class="at">-o</span> jsonpath=<span class="st">&#39;{.status.conditions[?(@.type==&quot;Failed&quot;)].status}&#39;</span><span class="va">)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="st">&quot;</span><span class="va">$STATUS</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;True&quot;</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&quot;Job completed successfully.&quot;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="kw">[[</span> <span class="st">&quot;</span><span class="va">$FAILED</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;True&quot;</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&quot;Job failed.&quot;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&quot;Job is still running...&quot;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sleep</span> 5 <span class="co"># Poll every 5 seconds</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div></li>
<li><p><strong>Running the Script:</strong></p>
<p>We save this script to a file, like <code>wait-for-job.sh</code>, and
run it in our terminal:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> wait-for-job.sh</span></code></pre></div></li>
</ol>
<p>This method lets us check the job’s status actively. We get real-time
feedback on whether it is completed or failed. We should also know that
changing the sleep time can help reduce the load on our Kubernetes
cluster.</p>
<p>By using this polling method, we can wait for Kubernetes jobs to
complete. This helps us with better automation in our CI/CD pipelines.
For more details on Kubernetes job configurations, check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-run-batch-jobs-in-kubernetes-with-jobs-and-cronjobs.html">this
article on running batch jobs in Kubernetes</a>.</p>
<h2 id="how-can-we-use-kubernetes-events-to-monitor-job-status">How Can
We Use Kubernetes Events to Monitor Job Status?</h2>
<p>Kubernetes events help us monitor the status of jobs and other
resources in a cluster. By using events, we can see what happens to a
job. This includes when it starts, finishes, fails, or has problems.
Here is how we can use Kubernetes events to watch job status well:</p>
<ol type="1">
<li><p><strong>List Events for a Specific Job</strong>: We can get
events related to a specific job with this command:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get events <span class="at">--field-selector</span> involvedObject.kind=Job,involvedObject.name=<span class="op">&lt;</span>job-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Watch Events in Real-Time</strong>: To see events as they
happen, we can use the <code>--watch</code> flag:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get events <span class="at">--watch</span> <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Filtering Events</strong>: We can filter events by
severity like Normal or Warning using the <code>--field-selector</code>
option:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get events <span class="at">--field-selector</span> type=Warning <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Verbose Output</strong>: For more details about each
event, we can use the <code>-o wide</code> option:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get events <span class="at">-o</span> wide <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Understanding Event Types</strong>:</p>
<ul>
<li><strong>Normal</strong> events show successful operations like Job
completion.</li>
<li><strong>Warning</strong> events show problems or failures that we
need to check, like Job failure.</li>
</ul></li>
<li><p><strong>Using jq for Event Filtering</strong>: If we want to
filter some fields from the event output, we can use <code>jq</code>
like this:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get events <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span> -o json <span class="kw">|</span> <span class="ex">jq</span> <span class="st">&#39;.items[] | {reason: .reason, message: .message, time: .lastTimestamp}&#39;</span></span></code></pre></div></li>
<li><p><strong>Resources for Further Learning</strong>: To learn more
about Kubernetes jobs and monitoring, we can read about <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-run-batch-jobs-in-kubernetes-with-jobs-and-cronjobs.html">how
to run batch jobs in Kubernetes</a>.</p></li>
</ol>
<p>By using Kubernetes events well, we can monitor job status and find
problems quickly when they happen. This helps us manage Kubernetes
resources better and keep everything running smoothly.</p>
<h2 id="how-can-we-capture-job-completion-output-in-kubernetes">How Can
We Capture Job Completion Output in Kubernetes?</h2>
<p>To capture the output of a Kubernetes job when it is done, we can use
several methods. These include checking logs and saving output to
storage. Here is a simple guide on how to do this well.</p>
<ol type="1">
<li><p><strong>Accessing Logs Directly</strong>: When the job is done,
we can get the logs from the pod created by the job. We use this
command:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="op">&lt;</span>pod-name<span class="op">&gt;</span></span></code></pre></div>
<p>Make sure to replace <code>&lt;pod-name&gt;</code> with the real name
of the pod. We can find the pod name by listing the pods linked to our
job:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">--selector</span><span class="op">=</span>job-name=<span class="op">&lt;</span>job-name<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Using <code>kubectl get</code> to Retrieve Job
Status</strong>: To see the status and details of the job, we can
use:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get jobs <span class="op">&lt;</span>job-name<span class="op">&gt;</span> -o json</span></code></pre></div>
<p>This command shows the job’s details in JSON format. It includes the
completion status and other important info.</p></li>
<li><p><strong>Storing Output in a ConfigMap or Persistent
Volume</strong>: If we want to keep the output for later, we can use a
ConfigMap or a Persistent Volume (PV). For example, we can attach a
volume to our job’s pod where the output can be saved. Here is how we
can define the job with a volume:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> batch/v1</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Job</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> output-job</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> job-container</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> your-image</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;sh&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;-c&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;your-command &gt; /output/output.txt&quot;</span><span class="kw">]</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">volumeMounts</span><span class="kw">:</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> output-storage</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">mountPath</span><span class="kw">:</span><span class="at"> /output</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">restartPolicy</span><span class="kw">:</span><span class="at"> Never</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> output-storage</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">persistentVolumeClaim</span><span class="kw">:</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">claimName</span><span class="kw">:</span><span class="at"> your-pvc</span></span></code></pre></div>
<p>This setup mounts a PVC called <code>your-pvc</code> to the
<code>/output</code> folder. This way, the job can write the output to a
file.</p></li>
<li><p><strong>Using a Sidecar Container</strong>: Another good way is
to use a sidecar container. This container can help with logging and
collecting output. It runs next to our main job container and captures
outputs for us.</p></li>
<li><p><strong>Exporting Job Outputs</strong>: After the job is done, we
might want to send outputs to another system like cloud storage. We can
use tools like <code>kubectl cp</code> to copy files from the pod to our
local computer:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> cp <span class="op">&lt;</span>pod-name<span class="op">&gt;</span>:/output/output.txt ./output.txt</span></code></pre></div></li>
</ol>
<p>By using these methods, we can easily capture and manage the output
of our Kubernetes jobs. This helps us have access to the results of our
batch processing tasks. For more details on managing jobs in Kubernetes,
check out <a
href="https://bestonlinetutorial.com/kubernetes/run-batch-jobs-in-kubernetes-with-jobs-and-cronjobs.html">this
article</a>.</p>
<h2 id="how-can-we-handle-job-failures-gracefully-in-kubernetes">How Can
We Handle Job Failures Gracefully in Kubernetes?</h2>
<p>Handling job failures in Kubernetes is important. We can use some
simple strategies to help our applications recover when jobs fail. Here
are a few techniques we can use:</p>
<ol type="1">
<li><p><strong>Set Backoff Limit</strong>: We can set the
<code>backoffLimit</code> in our Job details. This tells Kubernetes how
many times to retry the job before it is marked as failed.</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> batch/v1</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Job</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-job</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">backoffLimit</span><span class="kw">:</span><span class="at"> </span><span class="dv">4</span><span class="co">  # Number of tries before job is failed</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-container</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my-image</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">restartPolicy</span><span class="kw">:</span><span class="at"> Never</span></span></code></pre></div></li>
<li><p><strong>Use Pod Anti-Affinity Rules</strong>: We can use
anti-affinity rules. This helps ensure that if a job fails because of a
node issue, it can run on another node.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">affinity</span><span class="kw">:</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">podAntiAffinity</span><span class="kw">:</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">requiredDuringSchedulingIgnoredDuringExecution</span><span class="kw">:</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">labelSelector</span><span class="kw">:</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">matchExpressions</span><span class="kw">:</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">key</span><span class="kw">:</span><span class="at"> job-name</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">operator</span><span class="kw">:</span><span class="at"> In</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">values</span><span class="kw">:</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> my-job</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">topologyKey</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;kubernetes.io/hostname&quot;</span></span></code></pre></div></li>
<li><p><strong>Utilize Kubernetes Events</strong>: We should monitor
Kubernetes events. This gives us information about job failures. We can
check events for a Job like this:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> describe job my-job</span></code></pre></div></li>
<li><p><strong>Implement Notifications</strong>: We can use tools like
Kubernetes Events to send alerts when a job fails. We can do this with
webhooks or by connecting to monitoring tools.</p></li>
<li><p><strong>Job Cleanup Policy</strong>: We should set a cleanup
policy with <code>ttlSecondsAfterFinished</code>. This will clean up
completed or failed jobs after a time. This keeps our cluster clean.</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ttlSecondsAfterFinished</span><span class="kw">:</span><span class="at"> </span><span class="dv">3600</span><span class="co">  # Job will be deleted after one hour</span></span></code></pre></div></li>
<li><p><strong>Analyze Logs for Debugging</strong>: We can get logs from
failed job pods. This helps us understand why the job failed. We can use
this command to get logs:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs job/my-job <span class="at">--previous</span></span></code></pre></div></li>
<li><p><strong>Job Completion Callbacks</strong>: We can think about
using a callback system. This can trigger actions when a job finishes or
fails.</p></li>
<li><p><strong>Resource Management</strong>: We need to make sure our
jobs have enough resources. This helps to stop them from being killed
due to lack of resources.</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;64Mi&quot;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;250m&quot;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;128Mi&quot;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;500m&quot;</span></span></code></pre></div></li>
<li><p><strong>Use CronJobs for Scheduled Jobs</strong>: For jobs that
need to retry on failure regularly, we can use <code>CronJob</code>.
This lets us set a schedule for running jobs. It can handle failures
better.</p></li>
</ol>
<p>Using these strategies will help us handle job failures in
Kubernetes. This makes sure our applications are strong and can recover
from problems well. If you want to read more about managing Kubernetes
jobs, you can check this article: <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-run-batch-jobs-in-kubernetes-with-jobs-and-cronjobs.html">How
to Run Batch Jobs in Kubernetes with Jobs and CronJobs</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="how-can-we-check-the-status-of-a-kubernetes-job">1. How can we
check the status of a Kubernetes job?</h3>
<p>To check the status of a Kubernetes job, we use the
<code>kubectl get jobs</code> command and add the job name. This command
shows us if the job has finished and if it succeeded or failed. For
example, when we run <code>kubectl get jobs &lt;job-name&gt;</code>, we
can see how the job is doing. This helps us to wait for a Kubernetes job
to finish.</p>
<h3 id="what-command-can-we-use-to-watch-a-kubernetes-jobs-progress">2.
What command can we use to watch a Kubernetes job’s progress?</h3>
<p>We can use the command
<code>kubectl get jobs &lt;job-name&gt; --watch</code> to see the
progress of a Kubernetes job in real-time. This command lets us wait for
the job to finish. We can see updates on the job’s status until it
either succeeds or fails.</p>
<h3
id="how-do-we-implement-polling-to-check-job-completion-in-kubernetes">3.
How do we implement polling to check job completion in Kubernetes?</h3>
<p>To implement polling for job completion, we can use a simple script.
This script checks the job status at certain times. We can use
<code>kubectl get jobs &lt;job-name&gt; -o jsonpath='{.status.succeeded}'</code>
in a loop. This way, we can monitor the job status until it shows that
it is complete. This method helps us to wait for a Kubernetes job to
finish.</p>
<h3
id="what-are-kubernetes-events-and-how-can-we-use-them-to-monitor-job-status">4.
What are Kubernetes events, and how can we use them to monitor job
status?</h3>
<p>Kubernetes events give us information about the state and actions on
resources in the cluster, including jobs. We can use the command
<code>kubectl get events --sort-by='.metadata.creationTimestamp'</code>
to see events related to our job. By monitoring these events, we can
wait for a Kubernetes job to complete by checking for success or failure
messages.</p>
<h3 id="how-can-we-capture-the-output-of-a-completed-kubernetes-job">5.
How can we capture the output of a completed Kubernetes job?</h3>
<p>We can capture the output of a completed Kubernetes job by looking at
the logs of the job’s pods. We use the command
<code>kubectl logs &lt;pod-name&gt;</code>. To find the pod name, we
first list the pods linked to the job with
<code>kubectl get pods --selector=job-name=&lt;job-name&gt;</code>. This
way, we can get the output once the job finishes successfully.</p>
<p>For more information on managing Kubernetes jobs and understanding
their status, we can check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-run-batch-jobs-in-kubernetes-with-jobs-and-cronjobs.html">how
to run batch jobs in Kubernetes</a>. This source gives us more details
about job management and monitoring.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            