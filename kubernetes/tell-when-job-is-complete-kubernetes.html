
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            
            <title>Tell when Job is Complete - kubernetes</title>
            <meta name="description" content="Learn how to effectively determine job completion in Kubernetes with our expert guide. Ensure efficient workflow management!">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">Tell when Job is Complete - kubernetes</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>To know when a Kubernetes Job is done, we can use the Job status
features that come with it. Kubernetes gives us an easy way to check if
Jobs are finished. We can use the <code>kubectl</code> command-line tool
to look at the Job’s status. This tool shows us how many times the Job
succeeded or failed. This helps us manage our tasks and automate our
deployments better.</p>
<p>In this article, we will look at different ways to find out when
Kubernetes Jobs are complete. We will talk about how to read job
statuses. We will also see how to use <code>kubectl</code> commands for
checking. We will learn about setting up event notifications. We will
explore the Kubernetes API and how to integrate Prometheus for better
monitoring. Here are the topics we will discuss:</p>
<ul>
<li>How to Tell When Job is Complete in Kubernetes?</li>
<li>Using Kubernetes Job Status to Determine Completion</li>
<li>Monitoring Kubernetes Jobs with kubectl Commands</li>
<li>Implementing Kubernetes Event Notifications for Job Completion</li>
<li>Leveraging Kubernetes API to Check Job Completion</li>
<li>Integrating Prometheus for Kubernetes Job Monitoring</li>
<li>Frequently Asked Questions</li>
</ul>
<p>For more information about Kubernetes and what it can do, you can
read articles like <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubernetes-and-how-does-it-simplify-container-management.html">What
is Kubernetes and How Does it Simplify Container Management</a> and <a
href="https://bestonlinetutorial.com/kubernetes/why-should-i-use-kubernetes-for-my-applications.html">Why
Should I Use Kubernetes for My Applications</a>.</p>
<h2 id="using-kubernetes-job-status-to-determine-completion">Using
Kubernetes Job Status to Determine Completion</h2>
<p>In Kubernetes, we use Jobs to run batch processing tasks. To find out
if a Job is done, we can check the Job’s status fields. These fields
show how many pods succeeded, failed, and are still active.</p>
<p>To get the status of a Job, we can use this <code>kubectl</code>
command:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get jobs <span class="op">&lt;</span>job-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span> -o jsonpath=<span class="st">&#39;{.status}&#39;</span></span></code></pre></div>
<p>The output will show us the job status. It includes:</p>
<ul>
<li><strong>succeeded</strong>: How many pods finished successfully</li>
<li><strong>failed</strong>: How many pods did not succeed</li>
<li><strong>active</strong>: How many pods are still running</li>
</ul>
<p>For example, if we want to check the status of a Job called
<code>example-job</code> in the <code>default</code> namespace, we
run:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get jobs example-job <span class="at">-n</span> default <span class="at">-o</span> jsonpath=<span class="st">&#39;{.status}&#39;</span></span></code></pre></div>
<p>If we need more details, including conditions, we can use:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> describe job <span class="op">&lt;</span>job-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div>
<p>This command will give us a full view. It includes events related to
the Job. This can help us find problems if the Job does not finish as we
want.</p>
<p>Also, we can check the pods created by the Job. This will show us
their individual statuses:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">-l</span> job-name=<span class="op">&lt;</span>job-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div>
<p>Using these commands, we can easily monitor and know the completion
status of our Kubernetes Jobs. This helps make sure our batch operations
run well. For more information about managing Kubernetes Jobs, we can
check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-run-batch-jobs-in-kubernetes-with-jobs-and-cronjobs.html">how
to run batch jobs in Kubernetes</a>.</p>
<h2 id="monitoring-kubernetes-jobs-with-kubectl-commands">Monitoring
Kubernetes Jobs with kubectl Commands</h2>
<p>We can monitor Kubernetes Jobs with some <code>kubectl</code>
commands. These commands help us see their status and progress.</p>
<ol type="1">
<li><p><strong>Get All Jobs:</strong> To list all jobs in a certain
namespace, we use:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get jobs <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Describe a Specific Job:</strong> For more details about
a job, like its status and events, we can use:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> describe job <span class="op">&lt;</span>job-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Check Job Status:</strong> To check the status of jobs,
we can do:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get jobs <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span> -o wide</span></code></pre></div></li>
<li><p><strong>Get Job Pods:</strong> To see the pods from a job, first
find the job name, then run:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">--selector</span><span class="op">=</span>job-name=<span class="op">&lt;</span>job-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>View Pod Logs:</strong> To see logs of a specific pod
from a job, we use:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="op">&lt;</span>pod-name<span class="op">&gt;</span> -n <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>Watch Job Status:</strong> To watch the job status in
real-time, we can use:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get jobs <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span> --watch</span></code></pre></div></li>
<li><p><strong>Filter by Completion:</strong> To filter jobs by their
completion status, we can do:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get jobs <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span> --field-selector=status.successful=1</span></code></pre></div></li>
</ol>
<p>These <code>kubectl</code> commands help us monitor and fix issues
with Kubernetes Jobs. This way, we can make sure they finish
successfully and work as we expect. If we want to learn more about how
Kubernetes Jobs work, we can read <a
href="https://bestonlinetutorial.com/kubernetes/run-batch-jobs-in-kubernetes-with-jobs-and-cronjobs.html">this
article</a>.</p>
<h2
id="implementing-kubernetes-event-notifications-for-job-completion">Implementing
Kubernetes Event Notifications for Job Completion</h2>
<p>To set up notifications for job completion in Kubernetes, we can use
Kubernetes’ event system. This system helps us get alerts when a job’s
status changes to complete. We can do this with custom controllers,
outside tools, or notification systems.</p>
<h3 id="using-kubernetes-events">Using Kubernetes Events</h3>
<p>Kubernetes creates events for many actions, including when jobs
finish. We can watch these events to send notifications. Here is how we
can do it:</p>
<ol type="1">
<li><p><strong>Setup an Event Monitoring Tool:</strong> We can use tools
like <code>kubewatch</code>, <code>Kubernetes Event Exporter</code>, or
our scripts to watch for job completion events.</p></li>
<li><p><strong>Example with kubewatch:</strong> First, we need to
install <code>kubewatch</code> to check Kubernetes events.</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://raw.githubusercontent.com/bitnami-labs/kubewatch/master/deploy/kubewatch.yaml</span></code></pre></div>
<p>Next, we need to set up <code>kubewatch</code> to notify us when jobs
finish:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ConfigMap</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubewatch-config</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">  config.yaml</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    notify:</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>      - type: slack</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        channel: your-channel</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    resources:</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>      jobs: true</span></code></pre></div></li>
<li><p><strong>Use Kubernetes Event Exporter:</strong> We can also use
the Kubernetes Event Exporter to send events to places like Prometheus,
Slack, or webhooks.</p>
<p>To install the exporter:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://raw.githubusercontent.com/bitnami-labs/kube-event-exporter/master/deploy/kube-event-exporter.yaml</span></code></pre></div>
<p>Then, we configure the exporter to filter job completion events:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ConfigMap</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kube-event-exporter-config</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">  config.yaml</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    apiVersion: v1</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    kind: Config</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    outputs:</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>      - name: slack</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        type: slack</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        channel: your-channel</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    rules:</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>      - name: job-completion</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        resource: jobs</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        event: Normal</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        reason: Completed</span></code></pre></div></li>
<li><p><strong>Custom Controller:</strong> If we like to have a custom
method, we can create a Kubernetes controller with the client-go library
to watch for job events.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;context&quot;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;fmt&quot;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;k8s.io/client-go/kubernetes&quot;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;k8s.io/client-go/tools/clientcmd&quot;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;k8s.io/apimachinery/pkg/watch&quot;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    config<span class="op">,</span> err <span class="op">:=</span> clientcmd<span class="op">.</span>BuildConfigFromFlags<span class="op">(</span><span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;/path/to/kubeconfig&quot;</span><span class="op">)</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">panic</span><span class="op">(</span>err<span class="op">)</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    clientset<span class="op">,</span> err <span class="op">:=</span> kubernetes<span class="op">.</span>NewForConfig<span class="op">(</span>config<span class="op">)</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">panic</span><span class="op">(</span>err<span class="op">)</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    watch<span class="op">,</span> err <span class="op">:=</span> clientset<span class="op">.</span>BatchV1<span class="op">().</span>Jobs<span class="op">(</span><span class="st">&quot;&quot;</span><span class="op">).</span>Watch<span class="op">(</span>context<span class="op">.</span>TODO<span class="op">())</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">panic</span><span class="op">(</span>err<span class="op">)</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> event <span class="op">:=</span> <span class="kw">range</span> watch<span class="op">.</span>ResultChan<span class="op">()</span> <span class="op">{</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        job<span class="op">,</span> ok <span class="op">:=</span> event<span class="op">.</span>Object<span class="op">.(*</span>batchv1<span class="op">.</span>Job<span class="op">)</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ok <span class="op">&amp;&amp;</span> job<span class="op">.</span>Status<span class="op">.</span>Succeeded <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>            fmt<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Job %s completed</span><span class="ch">\n</span><span class="st">&quot;</span><span class="op">,</span> job<span class="op">.</span>Name<span class="op">)</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>            <span class="co">// We can add notification logic here</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong>Integrate with Notification Services:</strong> We can use
webhooks or connect with notification services like Slack, Discord, or
email to send messages when a job is done.</p></li>
</ol>
<p>By using these methods, we can watch and get notifications for job
completions in Kubernetes. This will help us understand and respond to
job status in our Kubernetes cluster better.</p>
<h2 id="leveraging-kubernetes-api-to-check-job-completion">Leveraging
Kubernetes API to Check Job Completion</h2>
<p>We can check if a Kubernetes Job is done by using the Kubernetes API.
We do this with a <code>GET</code> request on the Job resource. The API
gives us details about the Job, including if it is complete.</p>
<h3 id="example-of-checking-job-completion">Example of Checking Job
Completion</h3>
<ol type="1">
<li><p><strong>Get Job Details</strong>:</p>
<p>We can check the Job status by sending a <code>GET</code> request to
the Kubernetes API. Just replace <code>&lt;namespace&gt;</code> and
<code>&lt;job-name&gt;</code> with your specific values.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> GET <span class="dt">\</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>http://<span class="op">&lt;</span>kubernetes-api-server<span class="op">&gt;</span>/apis/batch/v1/namespaces/<span class="op">&lt;</span>namespace<span class="op">&gt;</span>/jobs/<span class="op">&lt;</span>job-name<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>-H <span class="st">&quot;Authorization: Bearer &lt;your-token&gt;&quot;</span> <span class="dt">\</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>-H <span class="st">&quot;Accept: application/json&quot;</span></span></code></pre></div></li>
<li><p><strong>Inspect the Response</strong>:</p>
<p>The response will look like this:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;apiVersion&quot;</span><span class="fu">:</span> <span class="st">&quot;batch/v1&quot;</span><span class="fu">,</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;kind&quot;</span><span class="fu">:</span> <span class="st">&quot;Job&quot;</span><span class="fu">,</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;metadata&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;job-name&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;namespace&quot;</span><span class="fu">:</span> <span class="st">&quot;&lt;namespace&gt;&quot;</span><span class="fu">,</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;conditions&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;Complete&quot;</span><span class="fu">,</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="st">&quot;True&quot;</span><span class="fu">,</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;lastProbeTime&quot;</span><span class="fu">:</span> <span class="st">&quot;2023-10-01T12:00:00Z&quot;</span><span class="fu">,</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;lastTransitionTime&quot;</span><span class="fu">:</span> <span class="st">&quot;2023-10-01T12:00:00Z&quot;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;succeeded&quot;</span><span class="fu">:</span> <span class="dv">1</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ul>
<li>The <code>conditions</code> field tells us if the Job is complete.
If <code>type</code> is <code>Complete</code> and <code>status</code> is
<code>True</code>, then the Job finished successfully.</li>
<li>The <code>succeeded</code> field shows how many times the Job has
completed successfully.</li>
</ul></li>
<li><p><strong>Using a Client Library</strong>:</p>
<p>If we like to access it programmatically, we can use client libraries
in different programming languages. For example, in Python, we can use
the <code>kubernetes</code> package:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> kubernetes <span class="im">import</span> client, config</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load kubeconfig</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>config.load_kube_config()</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the API</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>batch_v1 <span class="op">=</span> client.BatchV1Api()</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the job</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>job <span class="op">=</span> batch_v1.read_namespaced_job(name<span class="op">=</span><span class="st">&quot;&lt;job-name&gt;&quot;</span>, namespace<span class="op">=</span><span class="st">&quot;&lt;namespace&gt;&quot;</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>job_status <span class="op">=</span> job.status.conditions</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Check job completion</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> condition <span class="kw">in</span> job_status:</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> condition.<span class="bu">type</span> <span class="op">==</span> <span class="st">&quot;Complete&quot;</span> <span class="kw">and</span> condition.status <span class="op">==</span> <span class="st">&quot;True&quot;</span>:</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Job is complete.&quot;</span>)</span></code></pre></div></li>
</ol>
<p>By using the Kubernetes API, we can check the Job completion status
easily. This helps us automate processes and connect with other
workflows. For more details about Kubernetes Jobs and how to manage
them, we can read <a
href="https://bestonlinetutorial.com/kubernetes/run-batch-jobs-in-kubernetes-with-jobs-and-cronjobs.html">this
article</a>.</p>
<h2
id="integrating-prometheus-for-kubernetes-job-monitoring">Integrating
Prometheus for Kubernetes Job Monitoring</h2>
<p>We can monitor Kubernetes jobs well by using Prometheus. It helps us
get metrics from Kubernetes and shows us about job completion and
performance. Let’s see how we can set it up for our Kubernetes jobs.</p>
<h3 id="step-1-install-prometheus">Step 1: Install Prometheus</h3>
<p>We can deploy Prometheus with Helm. It makes the process easier.
First, we need to add the Prometheus Helm chart repository:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo add prometheus-community https://prometheus-community.github.io/helm-charts</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo update</span></code></pre></div>
<p>Now we install Prometheus:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install prometheus prometheus-community/prometheus</span></code></pre></div>
<h3 id="step-2-configure-prometheus-to-scrape-kubernetes-jobs">Step 2:
Configure Prometheus to Scrape Kubernetes Jobs</h3>
<p>Next, we need to change the <code>prometheus.yml</code> file. We will
add a scrape job for Kubernetes jobs. We do this by adding the following
under <code>scrape_configs</code>:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scrape_configs</span><span class="kw">:</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">job_name</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;kubernetes-jobs&#39;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kubernetes_sd_configs</span><span class="kw">:</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">role</span><span class="kw">:</span><span class="at"> job</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">relabel_configs</span><span class="kw">:</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">source_labels</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">__meta_kubernetes_job_name</span><span class="kw">]</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">action</span><span class="kw">:</span><span class="at"> keep</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">regex</span><span class="kw">:</span><span class="at"> .*</span></span></code></pre></div>
<p>Don’t forget to apply these changes to our Prometheus deployment.</p>
<h3 id="step-3-expose-metrics">Step 3: Expose Metrics</h3>
<p>We need to make sure our Kubernetes jobs show metrics that Prometheus
can scrape. We can do this by adding a metrics endpoint in our
application. For example, if we use a Node.js application, we can use
the <code>prom-client</code> library:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> client <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;prom-client&#39;</span>)<span class="op">;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express&#39;</span>)<span class="op">;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> app <span class="op">=</span> <span class="fu">express</span>()<span class="op">;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> register <span class="op">=</span> <span class="kw">new</span> client<span class="op">.</span><span class="fu">Registry</span>()<span class="op">;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>client<span class="op">.</span><span class="fu">collectDefaultMetrics</span>({ register })<span class="op">;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/metrics&#39;</span><span class="op">,</span> <span class="kw">async</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;Content-Type&#39;</span><span class="op">,</span> register<span class="op">.</span><span class="at">contentType</span>)<span class="op">;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">end</span>(<span class="cf">await</span> register<span class="op">.</span><span class="fu">metrics</span>())<span class="op">;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">listen</span>(<span class="dv">3000</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Server running on port 3000&#39;</span>)<span class="op">;</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="step-4-query-metrics-in-prometheus">Step 4: Query Metrics in
Prometheus</h3>
<p>After Prometheus scrapes our job metrics, we can check job completion
status using the Prometheus web UI. A common query we can use is:</p>
<pre class="plaintext"><code>kube_job_status_succeeded</code></pre>
<p>This shows us the count of succeeded jobs.</p>
<h3 id="step-5-set-up-alerts">Step 5: Set Up Alerts</h3>
<p>We can set alerts for job failures or completions with Alertmanager.
We can configure it in our Prometheus setup. For example, to alert on
failed jobs:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">groups</span><span class="kw">:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> job-alerts</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">alert</span><span class="kw">:</span><span class="at"> JobFailed</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> kube_job_status_failed &gt; 0</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">for</span><span class="kw">:</span><span class="at"> 5m</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">severity</span><span class="kw">:</span><span class="at"> critical</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">summary</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Job failed&quot;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;The job {{ $labels.job }} has failed.&quot;</span></span></code></pre></div>
<h3 id="resources-for-further-learning">Resources for Further
Learning</h3>
<p>If we want to learn more about deploying and managing Kubernetes jobs
with Prometheus, we can check these articles:</p>
<ul>
<li><a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">How
do I monitor my Kubernetes cluster?</a></li>
<li><a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-set-up-kubernetes-monitoring-and-alerting.html">How
do I set up Kubernetes monitoring and alerting?</a></li>
</ul>
<p>Integrating Prometheus for monitoring Kubernetes jobs lets us track
everything well and set alerts. This way, we can keep our Kubernetes
environment running smoothly.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="how-do-we-check-the-status-of-a-kubernetes-job">1. How do we
check the status of a Kubernetes Job?</h3>
<p>To check the status of a Kubernetes Job, we can use the
<code>kubectl get jobs</code> command. This command shows us a list of
jobs and their status. If we want to know more about a specific job, we
can use <code>kubectl describe job &lt;job-name&gt;</code>. This gives
us detailed info like completion status, start time, and any errors that
happened. This helps us know if our Kubernetes Job is done.</p>
<h3 id="what-does-the-complete-status-mean-for-a-kubernetes-job">2. What
does the ‘Complete’ status mean for a Kubernetes Job?</h3>
<p>A Kubernetes Job gets the ‘Complete’ status when all its pods have
finished successfully. This means the tasks we gave to the Job were done
right. When we see this status, it shows the Job has done its job, and
we don’t need to do anything more. We should keep an eye on this status
to manage batch processing in Kubernetes well.</p>
<h3
id="how-can-we-automate-notifications-for-job-completion-in-kubernetes">3.
How can we automate notifications for Job completion in Kubernetes?</h3>
<p>We can automate notifications for Job completion by using Kubernetes
Events and connecting them to a notification system like Slack or email.
We can use tools like Prometheus with Alertmanager to send alerts when
Jobs complete. This way, we know right away when our Kubernetes Jobs
finish, which helps us manage our work better.</p>
<h3 id="is-there-a-way-to-monitor-kubernetes-jobs-with-prometheus">4. Is
there a way to monitor Kubernetes Jobs with Prometheus?</h3>
<p>Yes, we can monitor Kubernetes Jobs with Prometheus. We need to set
it up so it collects metrics from our Kubernetes cluster. We can use
<code>kube-state-metrics</code> to show Job metrics that Prometheus can
collect. When we do this, we can see Job status, completion rates, and
failures in Grafana dashboards. It makes our Kubernetes monitoring much
better.</p>
<h3
id="what-are-the-differences-between-kubernetes-jobs-and-cronjobs">5.
What are the differences between Kubernetes Jobs and CronJobs?</h3>
<p>Kubernetes Jobs are for tasks that run until they are done. CronJobs
are for scheduled tasks that run at certain times. Jobs are one-time
tasks. CronJobs happen again and again. Knowing these differences is
important. It helps us manage workloads in our Kubernetes cluster and
pick the right tool for what we need to do.</p>
<p>For more info on Kubernetes, check our articles on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-run-batch-jobs-in-kubernetes-with-jobs-and-cronjobs.html">Kubernetes
Jobs and CronJobs</a> and <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-a-kubernetes-application-with-prometheus-and-grafana.html">setting
up monitoring with Prometheus</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            