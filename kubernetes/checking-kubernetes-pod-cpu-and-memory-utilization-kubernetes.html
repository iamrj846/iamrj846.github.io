
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            
            <title>Checking Kubernetes pod CPU and memory utilization - kubernetes</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Common CSS & Icons -->
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
<link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
<link rel="stylesheet" href="/assets/css/post.css">
            <meta name="description" content="Learn how to check Kubernetes pod CPU and memory utilization effectively to optimize performance and resource management.">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">Checking Kubernetes pod CPU and memory utilization - kubernetes</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>To check Kubernetes pod CPU and memory usage, we can use different
tools and commands. These tools give us real-time data about how much
resources we are using. With the <code>kubectl</code> command-line tool,
we can easily see how much CPU and memory our pods are using. This helps
us manage and optimize resources in our Kubernetes setup. By monitoring
this, we can make sure our applications run well without using too many
resources. Using too many resources can cause performance problems.</p>
<p>In this article, we will look at different ways to monitor CPU and
memory usage of Kubernetes pods. We will talk about using
<code>kubectl</code> commands for quick checks. We will also learn how
to set up the Metrics Server for ongoing monitoring. We will see how to
analyze resource usage with Prometheus and how to show metrics with
Grafana. Plus, we will discuss custom metrics and answer common
questions to help us understand Kubernetes resource management
better.</p>
<ul>
<li>Checking Kubernetes Pod CPU and Memory Utilization -
Kubernetes?</li>
<li>How to Use kubectl to Check Kubernetes Pod Resource
Utilization?</li>
<li>Monitoring Kubernetes Pod CPU and Memory with Metrics Server?</li>
<li>Analyzing Resource Usage with Prometheus in Kubernetes?</li>
<li>Visualizing Kubernetes Pod Resource Utilization with Grafana?</li>
<li>Using Custom Metrics for Kubernetes Pod CPU and Memory
Monitoring?</li>
<li>Frequently Asked Questions.</li>
</ul>
<p>For more info on Kubernetes, we can look at articles like <a
href="https://bestonlinetutorial.com/kubernetes/what-is-kubernetes-and-how-does-it-simplify-container-management.html">What
is Kubernetes and How Does it Simplify Container Management?</a> and <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">How
Do I Monitor My Kubernetes Cluster?</a> for more understanding and
real-life uses.</p>
<h2
id="how-to-use-kubectl-to-check-kubernetes-pod-resource-utilization">How
to Use kubectl to Check Kubernetes Pod Resource Utilization?</h2>
<p>To check how much CPU and memory Kubernetes pods are using, we can
use the <code>kubectl</code> command-line tool. Below are some commands
that will help us get this information quickly.</p>
<h3 id="check-pod-resource-requests-and-limits">Check Pod Resource
Requests and Limits</h3>
<p>We can see the resource requests and limits for each pod by using
this command:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="op">&lt;</span>pod-name<span class="op">&gt;</span> -o=jsonpath=<span class="st">&#39;{.spec.containers[*].resources}&#39;</span></span></code></pre></div>
<p>Just change <code>&lt;pod-name&gt;</code> to the name of your pod.
This command will show us the CPU and memory requests and limits that
are set in the pod’s settings.</p>
<h3 id="get-current-resource-usage">Get Current Resource Usage</h3>
<p>To get the current CPU and memory usage for all pods, we can use this
command:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> top pods</span></code></pre></div>
<p>Make sure the Metrics Server is running in our cluster. This command
gives us real-time information about resource usage.</p>
<h3 id="check-resource-usage-for-a-specific-pod">Check Resource Usage
for a Specific Pod</h3>
<p>If we want to check the resource usage for a specific pod, we can
run:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> top pod <span class="op">&lt;</span>pod-name<span class="op">&gt;</span></span></code></pre></div>
<p>This will show us the current CPU and memory usage for that pod.</p>
<h3 id="get-detailed-pod-information">Get Detailed Pod Information</h3>
<p>For more details about a pod’s settings, including resource limits,
we can use this command:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> describe pod <span class="op">&lt;</span>pod-name<span class="op">&gt;</span></span></code></pre></div>
<p>This command gives us a lot of information. We can see events,
resource requests, limits, and more.</p>
<h3 id="example-listing-all-pods-with-resource-usage">Example: Listing
All Pods with Resource Usage</h3>
<p>To see all pods along with their resource usage, we can run:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">--sort-by</span><span class="op">=</span>.spec.containers<span class="pp">[</span><span class="ss">0</span><span class="pp">]</span>.resources.requests.cpu</span></code></pre></div>
<p>This command sorts the pods by their CPU requests. It helps us spot
which pods are using more resources.</p>
<p>For better monitoring and managing Kubernetes resources, we can think
about using tools like <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">Metrics
Server</a> and <a
href="https://bestonlinetutorial.com/kubernetes/analyzing-resource-usage-with-prometheus-in-kubernetes.html">Prometheus</a>.</p>
<h2
id="monitoring-kubernetes-pod-cpu-and-memory-with-metrics-server">Monitoring
Kubernetes Pod CPU and Memory with Metrics Server</h2>
<p>To monitor CPU and memory usage of Kubernetes pods, we need the
Metrics Server. This tool collects resource data from Kubelets and shows
it through the Kubernetes API. It helps us get CPU and memory info for
pods and nodes in our cluster.</p>
<h3 id="installing-metrics-server">Installing Metrics Server</h3>
<p>To install the Metrics Server, we can use this command:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span></code></pre></div>
<h3 id="verifying-installation">Verifying Installation</h3>
<p>After we install it, we should check if the Metrics Server is running
well:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get deployment metrics-server <span class="at">-n</span> kube-system</span></code></pre></div>
<h3 id="checking-pod-metrics">Checking Pod Metrics</h3>
<p>To see the CPU and memory usage of all pods in a specific namespace,
we can run this command:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> top pods <span class="at">-n</span> <span class="op">&lt;</span>namespace<span class="op">&gt;</span></span></code></pre></div>
<p>For example, to check metrics in the <code>default</code>
namespace:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> top pods <span class="at">-n</span> default</span></code></pre></div>
<h3 id="output-example">Output Example</h3>
<p>The output will show us the pod name, CPU usage, and memory
usage:</p>
<pre><code>NAME             CPU(cores)   MEMORY(bytes)
my-app-abc-xyz  250m         512Mi
my-app-def-uvw  300m         256Mi</code></pre>
<h3 id="checking-node-metrics">Checking Node Metrics</h3>
<p>We can also check resource usage for nodes by running:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> top nodes</span></code></pre></div>
<p>This command gives us a view of CPU and memory usage for each node in
the cluster.</p>
<h3 id="customizing-metrics-collection">Customizing Metrics
Collection</h3>
<p>We can change the Metrics Server by updating its deployment settings.
For example, we can set the resource requests and limits in the
metrics-server deployment YAML:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> metrics-server</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> 100m</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> 200Mi</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> 200m</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> 400Mi</span></span></code></pre></div>
<h3 id="troubleshooting-metrics-server">Troubleshooting Metrics
Server</h3>
<p>If we have problems with Metrics Server not giving metrics, we should
check:</p>
<ul>
<li>The Metrics Server is running with no errors.</li>
<li>Kubelet is set up to allow metrics collection.</li>
<li>The API aggregation layer is on in our Kubernetes cluster.</li>
</ul>
<p>For more details about monitoring Kubernetes, we can look at <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">how
do I monitor my Kubernetes cluster</a>.</p>
<h2
id="analyzing-resource-usage-with-prometheus-in-kubernetes">Analyzing
Resource Usage with Prometheus in Kubernetes</h2>
<p>To analyze resource usage in Kubernetes with Prometheus, we need to
set up Prometheus to get metrics from our Kubernetes cluster. Here are
the steps we should follow:</p>
<ol type="1">
<li><p><strong>Install Prometheus</strong>: We can use Helm to install
Prometheus in our Kubernetes cluster.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo add prometheus-community https://prometheus-community.github.io/helm-charts</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo update</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install prometheus prometheus-community/prometheus</span></code></pre></div></li>
<li><p><strong>Configure Prometheus to Scrape Metrics</strong>: We must
ensure that Prometheus is ready to scrape metrics from our pods. We can
change the <code>prometheus.yml</code> file to add this scrape config
for Kubernetes:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scrape_configs</span><span class="kw">:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">job_name</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;kubernetes-pods&#39;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kubernetes_sd_configs</span><span class="kw">:</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">role</span><span class="kw">:</span><span class="at"> pod</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">relabel_configs</span><span class="kw">:</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">source_labels</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">__meta_kubernetes_namespace</span><span class="kw">]</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">action</span><span class="kw">:</span><span class="at"> keep</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">regex</span><span class="kw">:</span><span class="at"> default|kube-system</span></span></code></pre></div></li>
<li><p><strong>Access Prometheus Dashboard</strong>: After we deploy, we
can access the Prometheus UI to see metrics. We can port-forward the
service like this:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> port-forward svc/prometheus-server 9090:80</span></code></pre></div>
<p>Then, we go to <code>http://localhost:9090</code> in our web
browser.</p></li>
<li><p><strong>Query Metrics</strong>: We can use Prometheus queries to
check CPU and memory usage. Here are some example queries:</p>
<ul>
<li><p>To check CPU usage of pods:</p>
<pre class="plaintext"><code>sum(rate(container_cpu_usage_seconds_total{image!=&quot;&quot;}[5m])) by (pod)</code></pre></li>
<li><p>To check memory usage of pods:</p>
<pre class="plaintext"><code>sum(container_memory_usage_bytes{image!=&quot;&quot;}) by (pod)</code></pre></li>
</ul></li>
<li><p><strong>Set Up Alerts</strong>: We can create alerts based on
these usage metrics. We can make an alerting rule like this:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">groups</span><span class="kw">:</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kubernetes-resources</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">alert</span><span class="kw">:</span><span class="at"> HighCpuUsage</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">expr</span><span class="kw">:</span><span class="at"> sum(rate(container_cpu_usage_seconds_total{image!=&quot;&quot;}[5m])) by (pod) &gt; 0.8</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">for</span><span class="kw">:</span><span class="at"> 5m</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">severity</span><span class="kw">:</span><span class="at"> critical</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">summary</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;High CPU usage detected on pod {{ $labels.pod }}&quot;</span></span></code></pre></div></li>
</ol>
<p>This setup helps us to monitor and analyze resource usage in
Kubernetes with Prometheus. For more details about monitoring Kubernetes
clusters, we can check <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">this
guide</a>.</p>
<h2
id="visualizing-kubernetes-pod-resource-utilization-with-grafana">Visualizing
Kubernetes Pod Resource Utilization with Grafana</h2>
<p>Grafana is a great tool for showing data. It works well with
Kubernetes. It helps us see how much resources our pods use. To see CPU
and memory usage of Kubernetes pods with Grafana, we can follow these
steps:</p>
<ol type="1">
<li><p><strong>Set Up Prometheus</strong>: First, we need to install
Prometheus in our Kubernetes cluster. Prometheus will collect metrics
from our Kubernetes nodes and pods.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> create namespace monitoring</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/bundle.yaml</span></code></pre></div></li>
<li><p><strong>Install Grafana</strong>: We can set up Grafana in our
Kubernetes cluster. We can use Helm or YAML files.</p>
<p>Using Helm:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> repo add grafana https://grafana.github.io/helm-charts</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install grafana grafana/grafana <span class="at">--namespace</span> monitoring</span></code></pre></div>
<p>Using YAML:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://raw.githubusercontent.com/grafana/helm-charts/main/charts/grafana/templates/deployment.yaml</span></code></pre></div></li>
<li><p><strong>Configure Data Source in Grafana</strong>: After we
install Grafana, we should log in (the default username is admin and
password is prom-operator). Then we need to add Prometheus as a data
source:</p>
<ul>
<li>Go to <strong>Configuration</strong> &gt; <strong>Data
Sources</strong> &gt; <strong>Add data source</strong>.</li>
<li>Choose Prometheus and put the URL (it is usually
<code>http://prometheus-operated.monitoring.svc.cluster.local:9090</code>).</li>
</ul></li>
<li><p><strong>Create a Dashboard</strong>:</p>
<ul>
<li>Click on <strong>Dashboards</strong> &gt; <strong>New
Dashboard</strong>.</li>
<li>Add a new Panel.</li>
<li>Use these Prometheus queries to see CPU and memory usage:
<ul>
<li><p><strong>CPU Utilization</strong>:</p>
<pre class="promql"><code>sum(rate(container_cpu_usage_seconds_total{image!=&quot;&quot;}[5m])) by (pod)</code></pre></li>
<li><p><strong>Memory Utilization</strong>:</p>
<pre class="promql"><code>sum(container_memory_usage_bytes{image!=&quot;&quot;}) by (pod)</code></pre></li>
</ul></li>
</ul></li>
<li><p><strong>Customize Visualization</strong>:</p>
<ul>
<li>Pick the type of visualization (like Graph or Gauge) that you
like.</li>
<li>Set thresholds and labels to help understand the data better.</li>
</ul></li>
<li><p><strong>Deploy and View</strong>:</p>
<ul>
<li>Save the dashboard and take a look at it.</li>
<li>We can now watch the resource usage of our Kubernetes pods in
real-time.</li>
</ul></li>
</ol>
<p>For more details on how to deploy apps with monitoring in Kubernetes,
we can check this article on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-a-kubernetes-application-with-prometheus-and-grafana.html">monitoring
Kubernetes applications with Prometheus and Grafana</a>.</p>
<h2
id="using-custom-metrics-for-kubernetes-pod-cpu-and-memory-monitoring">Using
Custom Metrics for Kubernetes Pod CPU and Memory Monitoring?</h2>
<p>Custom metrics in Kubernetes help us monitor and optimize how we use
resources. This is especially true for CPU and memory usage in pods. By
using the Kubernetes API and custom metrics, we can set specific metrics
that fit our applications.</p>
<h3 id="setting-up-custom-metrics">Setting Up Custom Metrics</h3>
<ol type="1">
<li><p><strong>Install Metrics Server</strong>: First, we need to have
the Metrics Server running in our cluster. This server gives us
important resource metrics.</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span></code></pre></div></li>
<li><p><strong>Define Custom Metrics</strong>: We use the Kubernetes API
to show custom metrics. We can create our metrics with any good
monitoring tool or library. Prometheus is a common choice.</p></li>
<li><p><strong>Expose Metrics</strong>: We need to change our
application to show metrics in a way that Prometheus can read. Usually,
we do this at an HTTP endpoint.</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prometheus_client <span class="im">import</span> start_http_server, Summary</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a metric to track CPU usage</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>cpu_usage <span class="op">=</span> Summary(<span class="st">&#39;cpu_usage&#39;</span>, <span class="st">&#39;CPU usage of the application&#39;</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="at">@cpu_usage.time</span>()</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_request():</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our code logic here</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    start_http_server(<span class="dv">8000</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        process_request()</span></code></pre></div></li>
</ol>
<h3
id="configuring-horizontal-pod-autoscaler-hpa-with-custom-metrics">Configuring
Horizontal Pod Autoscaler (HPA) with Custom Metrics</h3>
<p>To use custom metrics for autoscaling, we configure the Horizontal
Pod Autoscaler (HPA) with the custom metrics API.</p>
<ol type="1">
<li><p><strong>Install the Custom Metrics Adapter</strong>: If we use
Prometheus, we might need to install the Prometheus Adapter.</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install prometheus-adapter prometheus-community/prometheus-adapter</span></code></pre></div></li>
<li><p><strong>Define HPA with Custom Metrics</strong>: We create an HPA
resource that uses our custom metrics.</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> autoscaling/v2beta2</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> HorizontalPodAutoscaler</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app-hpa</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scaleTargetRef</span><span class="kw">:</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-app</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">minReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">maxReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">metrics</span><span class="kw">:</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Pods</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">pods</span><span class="kw">:</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">metric</span><span class="kw">:</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cpu_usage</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">target</span><span class="kw">:</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">type</span><span class="kw">:</span><span class="at"> AverageValue</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">averageValue</span><span class="kw">:</span><span class="at"> 100m</span></span></code></pre></div></li>
<li><p><strong>Apply the HPA</strong>: We deploy the HPA setup using
kubectl.</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> hpa.yaml</span></code></pre></div></li>
</ol>
<h3 id="monitor-and-validate">Monitor and Validate</h3>
<ol type="1">
<li><p><strong>Check HPA Status</strong>: We need to make sure the HPA
is working right.</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get hpa</span></code></pre></div></li>
<li><p><strong>Inspect Pod Metrics</strong>: We check that our custom
metrics are collected correctly.</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get <span class="at">--raw</span> <span class="st">&quot;/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/pods/my-app/cpu_usage&quot;</span></span></code></pre></div></li>
</ol>
<p>By using custom metrics in Kubernetes, we can monitor CPU and memory
use based on our application needs. This helps us manage and optimize
resources better with autoscaling. For more information on Kubernetes
monitoring, we can look at this article on <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-a-kubernetes-application-with-prometheus-and-grafana.html">monitoring
a Kubernetes application with Prometheus and Grafana</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3
id="how-can-we-check-the-cpu-and-memory-usage-of-a-kubernetes-pod">1.
How can we check the CPU and memory usage of a Kubernetes pod?</h3>
<p>To check the CPU and memory of a Kubernetes pod, we can use the
<code>kubectl top pod</code> command. This command shows the current
usage of resources for all pods in our namespace. Just run
<code>kubectl top pod</code> to see the CPU and memory numbers. We must
make sure that the Metrics Server is installed in our cluster to get
correct readings.</p>
<h3 id="what-is-the-role-of-metrics-server-in-kubernetes">2. What is the
role of Metrics Server in Kubernetes?</h3>
<p>The Metrics Server is important for checking resources in Kubernetes.
It collects data from Kubelets and shares it using the Kubernetes API.
This helps us use commands like <code>kubectl top</code> to see how much
resources pods and nodes are using. It is also needed for Horizontal Pod
Autoscaling because it gives the needed data for scaling decisions.</p>
<h3 id="can-we-visualize-kubernetes-pod-resource-usage-with-grafana">3.
Can we visualize Kubernetes pod resource usage with Grafana?</h3>
<p>Yes, we can use Grafana to visualize resource usage of Kubernetes
pods. By connecting Prometheus with Grafana, we can make dashboards that
show real-time data about our pods, including CPU and memory use. This
setup makes monitoring and analyzing easier. It helps us use resources
better in our Kubernetes clusters.</p>
<h3
id="how-do-we-set-resource-requests-and-limits-for-a-kubernetes-pod">4.
How do we set resource requests and limits for a Kubernetes pod?</h3>
<p>We can set resource requests and limits for a Kubernetes pod by
adding them in the pod’s YAML file. Under the <code>containers</code>
part, we add <code>resources</code> with <code>requests</code> and
<code>limits</code> for CPU and memory. Here is an example:</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Pod</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-pod</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> my-container</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> my-image</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;64Mi&quot;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;250m&quot;</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;128Mi&quot;</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;500m&quot;</span></span></code></pre></div>
<p>This setup makes sure the pod has guaranteed resources while also
setting upper limits.</p>
<h3
id="what-tools-can-we-use-for-advanced-monitoring-of-kubernetes-pods">5.
What tools can we use for advanced monitoring of Kubernetes pods?</h3>
<p>For better monitoring of Kubernetes pods, tools like Prometheus and
Grafana are good choices. Prometheus collects and saves metrics, while
Grafana gives us a way to visualize data. Other tools like Datadog and
New Relic can also help us monitor everything well. These tools help us
keep track of CPU and memory usage, making resource management better in
our Kubernetes environment.</p>
<p>For more information about Kubernetes and its features, we can check
articles like <a
href="https://bestonlinetutorial.com/kubernetes/what-are-kubernetes-pods-and-how-do-i-work-with-them.html">what
are Kubernetes pods and how do I work with them</a> or <a
href="https://bestonlinetutorial.com/kubernetes/how-do-i-monitor-my-kubernetes-cluster.html">how
do I monitor my Kubernetes cluster</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            