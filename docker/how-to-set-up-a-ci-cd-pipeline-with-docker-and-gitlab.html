
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <title>How to Set Up a CI/CD Pipeline with Docker and GitLab?</title>
            <meta name="description" content="Learn how to set up a CI/CD pipeline using Docker and GitLab for seamless integration and delivery. Boost your development today!">

            <div id="head-placeholder"></div>
            <script src="/assets/js/blog.js" defer></script>
            <link rel="stylesheet" href="/assets/css/post.css">
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How to Set Up a CI/CD Pipeline with Docker and GitLab?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>Setting up a Continuous Integration and Continuous Deployment (CI/CD)
pipeline with Docker and GitLab helps us automate the testing and
deployment of our applications. This way, we can make our development
process smoother. It also boosts our productivity. Plus, it keeps our
code quality high by making sure we have the same builds and deployments
in different environments.</p>
<p>In this article, we will talk about the important steps to create a
CI/CD pipeline using Docker and GitLab. First, we will look at what we
need to set it up. Then, we will learn how to configure GitLab CI/CD for
our project. After that, we will write a <code>.gitlab-ci.yml</code>
file for Docker builds. We will also see how to use Docker images in the
pipeline. Finally, we will test and deploy our application. We will
answer some common questions about the CI/CD process with Docker and
GitLab too.</p>
<ul>
<li>How to Create a CI/CD Pipeline with Docker and GitLab?</li>
<li>What Are the Prerequisites for Setting Up a CI/CD Pipeline with
Docker and GitLab?</li>
<li>How to Configure GitLab CI/CD for Your Project?</li>
<li>How to Write a .gitlab-ci.yml File for Docker Builds?</li>
<li>How to Use Docker Images in Your CI/CD Pipeline?</li>
<li>How to Test and Deploy Your Application with GitLab CI/CD?</li>
<li>Frequently Asked Questions</li>
</ul>
<p>For more information on Docker, we can check out other articles like
<a
href="https://bestonlinetutorial.com/docker/what-is-docker-and-why-should-you-use-it.html">What
is Docker and Why Should You Use It?</a> and <a
href="https://bestonlinetutorial.com/docker/how-to-automate-docker-builds-with-ci-cd-pipelines.html">How
to Automate Docker Builds with CI/CD Pipelines</a>. These links will
give us more knowledge about Docker and how it works in CI/CD.</p>
<h2
id="what-are-the-prerequisites-for-setting-up-a-cicd-pipeline-with-docker-and-gitlab">What
Are the Prerequisites for Setting Up a CI/CD Pipeline with Docker and
GitLab?</h2>
<p>To set up a CI/CD pipeline with Docker and GitLab, we need to make
sure we have these things ready:</p>
<ol type="1">
<li><p><strong>GitLab Account</strong>: We should create a GitLab
account. We can use either GitLab.com or our own GitLab server.</p></li>
<li><p><strong>GitLab Runner</strong>: We must install GitLab Runner on
the server where we want to run our CI/CD jobs. We can do this with the
command below:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install gitlab-runner</span></code></pre></div></li>
<li><p><strong>Docker Installation</strong>: We need to have Docker
installed on the same machine as the GitLab Runner. We can follow the
guide for our operating system <a
href="https://bestonlinetutorial.com/docker/how-to-install-docker-on-different-operating-systems.html">here</a>.</p></li>
<li><p><strong>Docker Permissions</strong>: We should add the GitLab
Runner user to the Docker group. This lets it run Docker commands
without needing sudo:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> usermod <span class="at">-aG</span> docker gitlab-runner</span></code></pre></div></li>
<li><p><strong>Project Repository</strong>: We need to create or access
a GitLab project repository where our application code is.</p></li>
<li><p><strong>.gitlab-ci.yml File</strong>: We must prepare a
<code>.gitlab-ci.yml</code> file in the root of our repository. This
file will define our CI/CD pipeline setup. It includes the stages, jobs,
and scripts for our pipeline.</p></li>
<li><p><strong>Basic Knowledge of Docker</strong>: It is important to
know some Docker basics like images, containers, and Dockerfiles. We
should understand how to create and manage Docker containers for our
application.</p></li>
<li><p><strong>Understanding of CI/CD Concepts</strong>: We need to have
a basic understanding of Continuous Integration (CI) and Continuous
Deployment (CD) ideas. This will help us design good pipelines.</p></li>
</ol>
<p>When we have all these things ready, we will be able to set up a
CI/CD pipeline with Docker and GitLab. This will help us automate
building, testing, and deploying our application easily.</p>
<h2 id="how-to-configure-gitlab-cicd-for-your-project">How to Configure
GitLab CI/CD for Your Project?</h2>
<p>To configure GitLab CI/CD for our project, we can follow these
steps:</p>
<ol type="1">
<li><p><strong>Create a GitLab Repository</strong>: First, we need to
create a new repository in GitLab for our project if we did not do it
yet.</p></li>
<li><p><strong>Enable CI/CD</strong>: Next, we go to our repository and
select <code>Settings &gt; CI/CD</code>. We should expand the
<strong>General pipelines</strong> settings and make sure the option to
enable pipelines is checked.</p></li>
<li><p><strong>Set Up Runners</strong>: GitLab uses runners to run the
CI/CD jobs. We can use shared runners from GitLab or set up our own. To
set up a specific runner, we need to:</p>
<ul>
<li><p>Install GitLab Runner on our server.</p></li>
<li><p>Register the runner with our GitLab instance by using this
command:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gitlab-runner</span> register</span></code></pre></div></li>
<li><p>We will follow the prompts to give details like URL, token,
description, and executor type (for example, Docker).</p></li>
</ul></li>
<li><p><strong>Create the <code>.gitlab-ci.yml</code> File</strong>: We
have to create a file called <code>.gitlab-ci.yml</code> at the root of
our project repository. This file will define the CI/CD pipeline stages,
jobs, and settings.</p>
<p>Here is a simple example of a <code>.gitlab-ci.yml</code> file:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stages</span><span class="kw">:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> build</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> test</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> deploy</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> build</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> echo &quot;Building the application...&quot;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker build -t myapp .</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span><span class="kw">:</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> test</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> echo &quot;Running tests...&quot;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker run myapp test</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> deploy</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> echo &quot;Deploying application...&quot;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker run -d -p 80:80 myapp</span></span></code></pre></div></li>
<li><p><strong>Commit and Push Changes</strong>: After that, we commit
our changes and push the <code>.gitlab-ci.yml</code> file to the
repository. GitLab will automatically find this file and start running
the CI/CD pipeline we defined.</p></li>
<li><p><strong>Monitor Pipeline Execution</strong>: We can go to
<code>CI/CD &gt; Pipelines</code> in our GitLab repository to see the
status of our pipeline execution. We are able to view logs and results
for each job.</p></li>
<li><p><strong>Environment Variables</strong>: If our application needs
environment variables, we can set them in the GitLab UI under
<code>Settings &gt; CI/CD &gt; Variables</code>. We can access these
variables in our <code>.gitlab-ci.yml</code> file by using
<code>$VARIABLE_NAME</code>.</p></li>
</ol>
<p>By following these steps, we can set up GitLab CI/CD for our project.
This will help us with automatic builds, tests, and deployments. For
more detailed info on how to automate Docker builds with CI/CD
pipelines, we can check <a
href="https://bestonlinetutorial.com/docker/how-to-automate-docker-builds-with-ci-cd-pipelines.html">this
article</a>.</p>
<h2 id="how-to-write-a-.gitlab-ci.yml-file-for-docker-builds">How to
Write a .gitlab-ci.yml File for Docker Builds?</h2>
<p>To set up a CI/CD pipeline with GitLab for Docker builds, we need to
create a <code>.gitlab-ci.yml</code> file in the root of our repository.
This file tells GitLab how our CI/CD pipeline will work. It includes the
stages, jobs, and the Docker images we will use.</p>
<p>Here is a simple structure for a <code>.gitlab-ci.yml</code> file
made for Docker builds:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stages</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> build</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> test</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> deploy</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">variables</span><span class="kw">:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">IMAGE_NAME</span><span class="kw">:</span><span class="at"> myapp</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">IMAGE_TAG</span><span class="kw">:</span><span class="at"> latest</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">before_script</span><span class="kw">:</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> docker login -u &quot;$CI_REGISTRY_USER&quot; -p &quot;$CI_REGISTRY_PASSWORD&quot; &quot;$CI_REGISTRY&quot;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> build</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker build -t $CI_REGISTRY/$IMAGE_NAME:$IMAGE_TAG .</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker push $CI_REGISTRY/$IMAGE_NAME:$IMAGE_TAG</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span><span class="kw">:</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> test</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">image</span><span class="kw">:</span><span class="at"> $CI_REGISTRY/$IMAGE_NAME:$IMAGE_TAG</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker run --rm $CI_REGISTRY/$IMAGE_NAME:$IMAGE_TAG npm test</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> deploy</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> echo &quot;Deploying to production...&quot;</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker run -d -p 80:80 $CI_REGISTRY/$IMAGE_NAME:$IMAGE_TAG</span></span></code></pre></div>
<h3 id="breakdown-of-the-.gitlab-ci.yml-file">Breakdown of the
<code>.gitlab-ci.yml</code> file:</h3>
<ul>
<li><strong>stages</strong>: These are the steps in our pipeline (build,
test, deploy).</li>
<li><strong>variables</strong>: These are for setting constants like
image names and tags.</li>
<li><strong>before_script</strong>: These are commands that run before
each job (like logging into Docker).</li>
<li><strong>build</strong>: This job builds the Docker image and pushes
it to GitLab container registry.</li>
<li><strong>test</strong>: This job runs tests in the built Docker
image.</li>
<li><strong>deploy</strong>: This job deploys the app using the Docker
image.</li>
</ul>
<p>We should change <code>myapp</code> to our real application name.
Also, we need to update the commands in the <code>script</code> sections
based on what our project needs.</p>
<p>For more information on Docker and CI/CD, we can check out <a
href="https://bestonlinetutorial.com/docker/how-to-automate-docker-builds-with-ci-cd-pipelines.html">How
to Automate Docker Builds with CI/CD Pipelines</a>.</p>
<h2 id="how-to-use-docker-images-in-your-cicd-pipeline">How to Use
Docker Images in Your CI/CD Pipeline?</h2>
<p>We can use Docker images in our CI/CD pipeline to make application
builds and deployments consistent and reliable. To integrate Docker
images into our GitLab CI/CD pipeline, we can follow these steps:</p>
<ol type="1">
<li><p><strong>Define Your Docker Image</strong>: First, we need to
specify the base image in our <code>.gitlab-ci.yml</code> file.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span><span class="kw">:</span><span class="at"> docker:latest</span></span></code></pre></div></li>
<li><p><strong>Set Up Docker-in-Docker (DinD)</strong>: We should enable
Docker-in-Docker to build images in our CI jobs.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> docker:dind</span></span></code></pre></div></li>
<li><p><strong>Create a Job for Building the Docker Image</strong>: We
can create a job to build our Docker image. Make sure Docker is
installed on our CI runner.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> build</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker build -t my-image:latest .</span></span></code></pre></div></li>
<li><p><strong>Push the Docker Image to a Registry</strong>: After we
build the image, we need to push it to a container registry like Docker
Hub or GitLab Container Registry.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> deploy</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker push my-image:latest</span></span></code></pre></div></li>
<li><p><strong>Use Docker Images for Testing</strong>: We can also run
tests using the Docker image we built.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span><span class="kw">:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> test</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker run --rm my-image:latest npm test</span></span></code></pre></div></li>
<li><p><strong>Deploy Using Docker Images</strong>: Finally, we can
deploy the Docker image to our production environment.</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deploy_production</span><span class="kw">:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> deploy</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker run -d -p 80:80 my-image:latest</span></span></code></pre></div></li>
<li><p><strong>Environment Variables</strong>: We should use GitLab
CI/CD environment variables to store sensitive data like our registry
credentials.</p></li>
</ol>
<p>By following these steps, we can use Docker images in our CI/CD
pipeline. This helps our application builds, tests, and deployments to
be reliable and easy to repeat. For more info on Docker in development,
check this article on <a
href="https://bestonlinetutorial.com/docker/what-are-the-benefits-of-using-docker-in-development.html">the
benefits of using Docker in development</a>.</p>
<h2 id="how-to-test-and-deploy-your-application-with-gitlab-cicd">How to
Test and Deploy Your Application with GitLab CI/CD?</h2>
<p>To test and deploy our application with GitLab CI/CD, we need to set
up stages in our <code>.gitlab-ci.yml</code> file. These stages will
handle testing and deployment. Here is a simple step-by-step guide with
code examples.</p>
<h3 id="define-stages">1. Define Stages</h3>
<p>First, we define the stages for testing and deployment in our
<code>.gitlab-ci.yml</code> file. For example:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stages</span><span class="kw">:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> test</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> deploy</span></span></code></pre></div>
<h3 id="configure-the-test-job">2. Configure the Test Job</h3>
<p>Next, we create a job for testing our application. This job can run
unit tests, integration tests, or other validation checks. Here is a
test job example for a Node.js application:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span><span class="kw">:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> test</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">image</span><span class="kw">:</span><span class="at"> node:latest</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> npm install</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> npm test</span></span></code></pre></div>
<h3 id="configure-the-deploy-job">3. Configure the Deploy Job</h3>
<p>Now we set up a deployment job. This job will deploy our application
after testing is successful. Here is an example of deploying a Docker
application:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> deploy</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">image</span><span class="kw">:</span><span class="at"> docker:latest</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker:dind</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker build -t your-image-name .</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker run -d -p 80:80 your-image-name</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">only</span><span class="kw">:</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> master</span></span></code></pre></div>
<h3 id="use-environment-variables-for-secrets">4. Use Environment
Variables for Secrets</h3>
<p>For safety, we should use GitLab CI/CD environment variables. These
variables can hold sensitive info like API keys or database passwords.
We can use them in our script like this:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> echo &quot;$DOCKER_PASSWORD&quot; | docker login -u &quot;$DOCKER_USERNAME&quot; --password-stdin</span></span></code></pre></div>
<h3 id="enable-automatic-deployment">5. Enable Automatic Deployment</h3>
<p>To make automatic deployment work, we can use GitLab’s deployment
strategies. For example, if we want to auto-deploy to a staging area
after tests pass, we add this:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deploy_to_staging</span><span class="kw">:</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> deploy</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> echo &quot;Deploying to Staging...&quot;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">    # Add deployment commands here</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> staging</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> http://staging.example.com</span></span></code></pre></div>
<h3 id="monitor-pipeline-status">6. Monitor Pipeline Status</h3>
<p>After we set up our pipeline, we can check its status in the GitLab
UI under the CI/CD section. This helps us find any issues in testing or
deployment stages.</p>
<p>By following these steps, we can test and deploy our application with
GitLab CI/CD. This makes our workflow smoother and more automated. For
more tips on Docker and CI/CD, look for articles like <a
href="https://bestonlinetutorial.com/docker/how-to-automate-docker-builds-with-ci-cd-pipelines.html">How
to Automate Docker Builds with CI/CD Pipelines</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3
id="what-is-a-cicd-pipeline-and-how-does-it-work-with-docker-and-gitlab">1.
What is a CI/CD pipeline, and how does it work with Docker and
GitLab?</h3>
<p>A CI/CD pipeline is a way to automate processes. It helps us build,
test, and deploy applications more easily. When we use Docker, these
pipelines help us create container images. This makes sure we have the
same setup in development and production. GitLab CI/CD gives us a good
platform to use these pipelines. It helps us connect with our Docker
workflows easily. We can learn more about <a
href="https://bestonlinetutorial.com/docker/how-to-automate-docker-builds-with-ci-cd-pipelines.html">how
to automate Docker builds with CI/CD pipelines</a>.</p>
<h3
id="what-are-the-prerequisites-for-setting-up-a-cicd-pipeline-with-docker-and-gitlab-1">2.
What are the prerequisites for setting up a CI/CD pipeline with Docker
and GitLab?</h3>
<p>Before we set up a CI/CD pipeline with Docker and GitLab, we need to
know some basics. We should understand Git, Docker, and CI/CD ideas.
Also, we must have Docker on our development machine and a GitLab
account. It helps if we know how to write <code>.gitlab-ci.yml</code>
files. These files tell us how the CI/CD process works. For a good
start, we can check the article on <a
href="https://bestonlinetutorial.com/docker/how-to-install-docker-on-different-operating-systems.html">how
to install Docker on different operating systems</a>.</p>
<h3 id="how-do-i-write-a-.gitlab-ci.yml-file-for-docker-builds">3. How
do I write a .gitlab-ci.yml file for Docker builds?</h3>
<p>To write a <code>.gitlab-ci.yml</code> file for Docker builds, we
need to define stages and jobs. These will show how we want to build and
test our application. We usually add commands to build our Docker image,
run tests, and deploy our app. Here is a simple example of a
<code>.gitlab-ci.yml</code> file:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stages</span><span class="kw">:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> build</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> test</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> deploy</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> build</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker build -t myapp .</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span><span class="kw">:</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> test</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker run myapp test</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> deploy</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> docker push myapp</span></span></code></pre></div>
<h3 id="how-can-docker-images-be-used-effectively-in-a-cicd-pipeline">4.
How can Docker images be used effectively in a CI/CD pipeline?</h3>
<p>We need Docker images to create the same environments in CI/CD
pipelines. By using Docker images, we can make sure our application
works the same in development, testing, and production. We can use a
Docker registry like Docker Hub to share and manage our images. For more
information, we can read about <a
href="https://bestonlinetutorial.com/docker/what-are-docker-images-and-how-do-they-work.html">what
Docker images are and how they work</a>.</p>
<h3 id="how-do-i-test-and-deploy-my-application-using-gitlab-cicd">5.
How do I test and deploy my application using GitLab CI/CD?</h3>
<p>To test and deploy our application with GitLab CI/CD, we create jobs
in our <code>.gitlab-ci.yml</code> file. These jobs run our tests and
deployment scripts. After we build our Docker image, we can run
automated tests using Docker containers. Once the tests pass, we can run
deployment steps to push the image to production. For more details, we
can check <a
href="https://bestonlinetutorial.com/docker/how-to-implement-continuous-deployment-with-docker.html">how
to implement continuous deployment with Docker</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            