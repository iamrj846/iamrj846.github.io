
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <!-- Common CSS & Icons -->
            <link rel="icon" href="/favicon.ico" type="image/x-icon">
            <link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
            <link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
            <link rel="stylesheet" href="/assets/css/post.css">
            <title>How Can You Effectively Use a Supervisor in Docker?</title>
            <meta name="description" content="Learn how to effectively utilize a supervisor in Docker for better process management and enhanced container performance.">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How Can You Effectively Use a Supervisor in Docker?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>To use a supervisor in Docker, we need to add the Supervisor process
control system in our Docker containers. This helps us manage many
processes easily. It makes sure our application runs well without
needing to do it manually. When we use Supervisor, it can restart
processes that stop working. It also helps us manage logs better and
keeps our application organized. This way, we can make our Docker
environment more reliable.</p>
<p>In this article, we will learn how to use a supervisor in Docker. We
will look at important parts like understanding what a supervisor does
in Docker, how to set it up in Docker containers, how to configure it
for better process management, and how to use its monitoring and logging
features. We will also share the best ways to use Supervisor in Docker
and answer some common questions to help us understand better. Here is
what we will cover:</p>
<ul>
<li>How to Use a Supervisor in Docker</li>
<li>What is the Role of a Supervisor in Docker</li>
<li>How to Set Up a Supervisor in Docker Containers</li>
<li>How to Configure Supervisor for Process Management in Docker</li>
<li>How to Monitor and Log with Supervisor in Docker</li>
<li>Best Ways to Use Supervisor in Docker</li>
<li>Common Questions</li>
</ul>
<h2
id="understanding-the-role-of-a-supervisor-in-docker-environments">Understanding
the Role of a Supervisor in Docker Environments</h2>
<p>In Docker environments, we use a Supervisor to manage and monitor
processes inside a Docker container. It helps keep our applications
running as they should. If an application crashes, the Supervisor can
restart it automatically. It also helps us manage logs. This is very
helpful when we have containers that run many processes or need to stay
up all the time.</p>
<h3 id="key-roles-of-supervisor">Key Roles of Supervisor:</h3>
<ul>
<li><strong>Process Management</strong>: It starts, checks, and restarts
processes when needed.</li>
<li><strong>Automatic Restarts</strong>: It makes sure that crashed
processes restart on their own.</li>
<li><strong>Logging</strong>: It collects logs from different processes,
making it easy to find problems.</li>
<li><strong>Configuration Management</strong>: It lets us set how
processes start and work using configuration files.</li>
</ul>
<h3 id="example-configuration-for-supervisor-in-docker">Example
Configuration for Supervisor in Docker</h3>
<p>To use Supervisor, we normally create a configuration file. This file
tells it what processes to manage. Here is an example of
<code>supervisord.conf</code> for a Docker container that runs a web
application and a worker process:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[supervisord]</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">nodaemon</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">[program:web]</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">command</span><span class="ot">=</span><span class="st">/usr/bin/python3 /app/web.py</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="dt">autostart</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="dt">autorestart</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="dt">stderr_logfile</span><span class="ot">=</span><span class="st">/var/log/web.err.log</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout_logfile</span><span class="ot">=</span><span class="st">/var/log/web.out.log</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">[program:worker]</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="dt">command</span><span class="ot">=</span><span class="st">/usr/bin/python3 /app/worker.py</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="dt">autostart</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="dt">autorestart</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="dt">stderr_logfile</span><span class="ot">=</span><span class="st">/var/log/worker.err.log</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout_logfile</span><span class="ot">=</span><span class="st">/var/log/worker.out.log</span></span></code></pre></div>
<h3 id="dockerfile-example">Dockerfile Example</h3>
<p>Our Dockerfile should install Supervisor and copy the configuration
file into the container:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> python:3.8-slim</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Supervisor</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> supervisor</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy application files and supervisor config</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . /app</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> supervisord.conf /etc/supervisor/conf.d/supervisord.conf</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Command to run Supervisor</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;/usr/bin/supervisord&quot;</span>]</span></code></pre></div>
<p>This setup helps us manage multiple processes in a Docker container
using Supervisor. It makes our applications more reliable and easy to
maintain. For more information about Docker, we can check articles like
<a
href="https://bestonlinetutorial.com/docker/what-is-docker-and-why-should-you-use-it.html">What
is Docker and Why Should You Use It?</a>.</p>
<h2 id="setting-up-a-supervisor-in-docker-containers">Setting Up a
Supervisor in Docker Containers</h2>
<p>To set up a Supervisor in Docker containers, we need to create a
Dockerfile. This file will install Supervisor and set it up to manage
our application processes. Here is a simple example to help us.</p>
<ol type="1">
<li><strong>Create a Dockerfile</strong>:</li>
</ol>
<div class="sourceCode" id="cb3"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use a Python runtime as a base image</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> python:3.9-slim</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the working folder</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Supervisor</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> install <span class="at">-y</span> supervisor <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> clean</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy the application code and Supervisor config</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . /app</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy Supervisor config file</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> supervisord.conf /etc/supervisor/conf.d/supervisord.conf</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the necessary port (if needed)</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 8000</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Command to start Supervisor</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;/usr/bin/supervisord&quot;</span>, <span class="st">&quot;-n&quot;</span>]</span></code></pre></div>
<ol start="2" type="1">
<li><strong>Create a Supervisor Configuration File
(supervisord.conf)</strong>:</li>
</ol>
<div class="sourceCode" id="cb4"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[supervisord]</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">nodaemon</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">[program:myapp]</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="dt">command</span><span class="ot">=</span><span class="st">python app.py</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="dt">autostart</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="dt">autorestart</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="dt">stderr_logfile</span><span class="ot">=</span><span class="st">/var/log/myapp.err.log</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout_logfile</span><span class="ot">=</span><span class="st">/var/log/myapp.out.log</span></span></code></pre></div>
<ol start="3" type="1">
<li><strong>Build the Docker Image</strong>:</li>
</ol>
<p>We run this command in the folder where our Dockerfile is
located:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> myapp:latest .</span></code></pre></div>
<ol start="4" type="1">
<li><strong>Run the Docker Container</strong>:</li>
</ol>
<p>Next, we use this command to start the container:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">-p</span> 8000:8000 myapp:latest</span></code></pre></div>
<p>This setup makes sure that Supervisor starts our application
(<code>app.py</code>) when the container starts. It will also restart
the app if it crashes. We can change the ports, commands, and settings
to fit our specific application needs.</p>
<p>For more details on Docker setups, we can check this article on <a
href="https://bestonlinetutorial.com/docker/how-to-install-docker-on-different-operating-systems.html">how
to install Docker on different operating systems</a>.</p>
<h2
id="configuring-supervisor-for-process-management-in-docker">Configuring
Supervisor for Process Management in Docker</h2>
<p>We will show you how to set up Supervisor for managing processes in
Docker containers. Follow these easy steps:</p>
<ol type="1">
<li><p><strong>Install Supervisor</strong>: First, we need to install
Supervisor in our Docker image. We can do this by adding these lines in
our Dockerfile:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> python:3.8-slim</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> supervisor</span></code></pre></div></li>
<li><p><strong>Create Supervisor Configuration File</strong>: Next, we
should make a Supervisor configuration file named
<code>supervisord.conf</code>. This file will help us manage our
processes. Here is an example:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[supervisord]</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="dt">nodaemon</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">[program:myapp]</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="dt">command</span><span class="ot">=</span><span class="st">python /path/to/your/app.py</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="dt">autostart</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="dt">autorestart</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="dt">stderr_logfile</span><span class="ot">=</span><span class="st">/var/log/myapp.err.log</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout_logfile</span><span class="ot">=</span><span class="st">/var/log/myapp.out.log</span></span></code></pre></div></li>
<li><p><strong>Copy Configuration to Container</strong>: Now, we will
copy the Supervisor configuration into the container using our
Dockerfile:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> supervisord.conf /etc/supervisor/conf.d/supervisord.conf</span></code></pre></div></li>
<li><p><strong>Run Supervisor</strong>: Then, we will change the CMD
instruction in our Dockerfile to start Supervisor:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;/usr/bin/supervisord&quot;</span>, <span class="st">&quot;-c&quot;</span>, <span class="st">&quot;/etc/supervisor/conf.d/supervisord.conf&quot;</span>]</span></code></pre></div></li>
<li><p><strong>Build and Run Your Docker Container</strong>: Finally,
after we set up the Dockerfile and Supervisor configuration, we can
build and run our Docker container:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> myapp .</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> myapp</span></code></pre></div></li>
</ol>
<p>This setup helps Supervisor manage our processes in the Docker
container. It gives us features like automatic restarts and logging. The
processes we defined in the Supervisor configuration will run as we
want. This way, we make sure they are monitored and managed well.</p>
<p>If you want to learn more, you can check <a
href="https://bestonlinetutorial.com/docker/how-to-install-docker-on-different-operating-systems.html">how
to install Docker on different operating systems</a> to make your Docker
experience better.</p>
<h2 id="monitoring-and-logging-with-supervisor-in-docker">Monitoring and
Logging with Supervisor in Docker</h2>
<p>We can use Supervisor in Docker to monitor and log easily. It helps
us manage many processes in one container. Supervisor can restart
processes if they fail. It also logs their output and helps us check the
health of our services.</p>
<h3 id="setting-up-logging-with-supervisor">Setting Up Logging with
Supervisor</h3>
<p>To set up logging in Supervisor, we need to edit the
<code>supervisord.conf</code> file. Here is a simple example:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[supervisord]</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="dt">logfile</span><span class="ot">=</span><span class="st">/var/log/supervisord.log</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="dt">loglevel</span><span class="ot">=</span><span class="st">info</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[program:myapp]</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="dt">command</span><span class="ot">=</span><span class="st">/path/to/myapp</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="dt">autostart</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="dt">autorestart</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="dt">stderr_logfile</span><span class="ot">=</span><span class="st">/var/log/myapp.err.log</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout_logfile</span><span class="ot">=</span><span class="st">/var/log/myapp.out.log</span></span></code></pre></div>
<ul>
<li><code>logfile</code>: This is where the Supervisor log file is
located.</li>
<li><code>loglevel</code>: Here we set the level of logging (info,
debug, warning, etc.).</li>
<li><code>stderr_logfile</code> and <code>stdout_logfile</code>: These
are paths for error and output logs for our program.</li>
</ul>
<h3 id="monitoring-process-status">Monitoring Process Status</h3>
<p>We can check the status of our processes by using the Supervisor
command line. To see the status of all programs, we type this
command:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">supervisorctl</span> status</span></code></pre></div>
<p>If we want to see detailed info about a specific program, we can
use:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">supervisorctl</span> tail myapp</span></code></pre></div>
<p>This command will show the last few lines of the log for
<code>myapp</code>.</p>
<h3 id="integrating-with-docker-logs">Integrating with Docker Logs</h3>
<p>To access Supervisor logs from Docker, we need to mount a volume to
the container where logs are stored. We can change our Dockerfile or
Docker Compose file like this:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3&#39;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">myapp</span><span class="kw">:</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> myapp-image</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./logs:/var/log</span></span></code></pre></div>
<p>This mapping makes sure that logs from Supervisor stay outside the
container. We can then access them for analysis or debugging.</p>
<h3 id="using-supervisor-with-docker-logging-drivers">Using Supervisor
with Docker Logging Drivers</h3>
<p>Besides Supervisor’s logging features, we can also use Docker’s
built-in logging drivers. We can change our Docker run command or Docker
Compose file to set a logging driver:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3&#39;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">myapp</span><span class="kw">:</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> myapp-image</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">logging</span><span class="kw">:</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">driver</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;json-file&quot;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">options</span><span class="kw">:</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">max-size</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;10m&quot;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">max-file</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;3&quot;</span></span></code></pre></div>
<p>This setup will rotate logs. It limits the size of log files and the
number of files we keep.</p>
<h3 id="monitoring-with-external-tools">Monitoring with External
Tools</h3>
<p>For better monitoring, we can connect Supervisor logs to tools like
ELK Stack or Prometheus. We can send logs to Elasticsearch for analysis.
We just need to set up Filebeat or a similar tool in our container:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">filebeat</span><span class="kw">:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> docker.elastic.co/beats/filebeat:7.9.3</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./logs:/var/log</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./filebeat.yml:/usr/share/filebeat/filebeat.yml</span></span></code></pre></div>
<h3 id="summary-of-key-points">Summary of Key Points</h3>
<ul>
<li>We need to configure <code>supervisord.conf</code> for logging.</li>
<li>We can use Supervisor commands to check process status.</li>
<li>We should mount log directories in Docker for keeping logs.</li>
<li>We can use Docker logging drivers for better log handling.</li>
<li>We might use external tools for central log monitoring and
analysis.</li>
</ul>
<p>By following these steps, we can monitor and log processes managed by
Supervisor in Docker. This improves our containerized application’s
reliability and maintainability. For more info on Docker and its best
practices, check this article on <a
href="https://bestonlinetutorial.com/docker/what-are-the-benefits-of-using-docker-in-development.html">using
Docker in development</a>.</p>
<h2 id="best-practices-for-using-supervisor-in-docker">Best Practices
for Using Supervisor in Docker</h2>
<p>When we use Supervisor in Docker, following best practices helps us
manage processes better and makes things more stable. Here are some
important practices to think about:</p>
<ol type="1">
<li><p><strong>Use a Single Process per Supervisor Instance</strong>:
Each Supervisor process should only manage one app or service. This
makes it easier to monitor and fix issues. It stops problems that happen
when multiple processes get in each other’s way.</p></li>
<li><p><strong>Keep Supervisor Configuration Lightweight</strong>: Keep
the configuration file simple with only what we need. A smaller
configuration helps start faster and is easier to manage. Here is an
example configuration:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[supervisord]</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="dt">logfile</span><span class="ot">=</span><span class="st">/var/log/supervisord.log</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">[program:myapp]</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="dt">command</span><span class="ot">=</span><span class="st">python /app/myapp.py</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="dt">autostart</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="dt">autorestart</span><span class="ot">=</span><span class="kw">true</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="dt">stderr_logfile</span><span class="ot">=</span><span class="st">/var/log/myapp.err.log</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout_logfile</span><span class="ot">=</span><span class="st">/var/log/myapp.out.log</span></span></code></pre></div></li>
<li><p><strong>Properly Handle Signals</strong>: We should set up
Supervisor to manage UNIX signals correctly. This helps us stop
processes nicely when we stop the container. We can use
<code>stopsignal</code> in the configuration.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[program:myapp]</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="dt">command</span><span class="ot">=</span><span class="st">python /app/myapp.py</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="dt">stopsignal</span><span class="ot">=</span><span class="st">TERM</span></span></code></pre></div></li>
<li><p><strong>Use Docker Health Checks</strong>: We should add Docker
health checks to make sure the app is running well. This lets Docker
restart the container if it gets unhealthy.</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">HEALTHCHECK</span> <span class="kw">CMD</span> <span class="ex">curl</span> <span class="at">--fail</span> http://localhost:8000/ <span class="kw">||</span> <span class="bu">exit</span> 1</span></code></pre></div></li>
<li><p><strong>Log Management</strong>: We should send logs to Docker’s
logging system instead of saving them in local files. We can do this by
using <code>stdout</code> and <code>stderr</code> in the Supervisor
configuration.</p></li>
<li><p><strong>Set Resource Limits</strong>: We must set resource limits
for the Supervisor processes in the Docker container. This helps prevent
using too many resources. We can use Docker’s resource management
flags:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--memory</span><span class="op">=</span><span class="st">&quot;256m&quot;</span> <span class="at">--cpus</span><span class="op">=</span><span class="st">&quot;1&quot;</span> my_supervisor_image</span></code></pre></div></li>
<li><p><strong>Utilize Environment Variables</strong>: We can pass
configuration settings through environment variables. This keeps things
flexible and safe. It allows different settings in different
environments.</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> APP_ENV production</span></code></pre></div></li>
<li><p><strong>Container Lifecycle Management</strong>: We should use
the <code>--restart</code> flag when we run the container. This makes
sure the Supervisor restarts if it crashes:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--restart</span><span class="op">=</span>always my_supervisor_image</span></code></pre></div></li>
<li><p><strong>Test Configuration Changes</strong>: We always need to
test configuration changes in a staging environment before we go live.
This helps ensure stability and good performance.</p></li>
<li><p><strong>Monitor Supervisor</strong>: We can use tools like
Prometheus or Grafana to watch Supervisor metrics. This gives us
insights into how our apps are doing under Supervisor.</p></li>
</ol>
<p>By following these best practices, we can improve how we use
Supervisor in Docker. This leads to better process management and more
reliable applications. For more information about Docker and its parts,
we can check <a
href="https://bestonlinetutorial.com/docker/what-are-the-benefits-of-using-docker-in-development.html">this
article on the benefits of using Docker in development</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="what-is-the-purpose-of-using-supervisor-in-docker">1. What is
the purpose of using Supervisor in Docker?</h3>
<p>We use Supervisor in Docker to manage processes in our containers. It
helps keep our applications running. If a process fails, Supervisor can
restart it. It also makes it easy to set up and control many processes
at once. By using Supervisor, we can keep our applications stable and
reliable. This is helpful when we deploy microservices and other complex
setups.</p>
<h3 id="how-do-i-set-up-supervisor-in-a-docker-container">2. How do I
set up Supervisor in a Docker container?</h3>
<p>To set up Supervisor in a Docker container, we first need to install
it in our Dockerfile. We can do this by adding this line:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> supervisor</span></code></pre></div>
<p>After we install it, we create a Supervisor configuration file. This
file tells Supervisor which processes we want to manage. Finally, we
change our Docker entry point to run Supervisor. This way, it can manage
our processes inside the container.</p>
<h3 id="can-supervisor-be-used-with-multiple-processes-in-docker">3. Can
Supervisor be used with multiple processes in Docker?</h3>
<p>Yes, we can use Supervisor to manage multiple processes in one Docker
container. We can list many programs in the Supervisor configuration
file. This lets us run different services at the same time. Normally, it
is better to run one service per container. But using Supervisor can
help when we need to manage related processes together.</p>
<h3 id="how-can-i-monitor-logs-with-supervisor-in-docker">4. How can I
monitor logs with Supervisor in Docker?</h3>
<p>To watch logs with Supervisor in Docker, we configure our Supervisor
programs to write logs to specific files. We can set the
<code>stdout_logfile</code> and <code>stderr_logfile</code> options in
the Supervisor config. This helps us collect and check the output of our
processes easily. Also, we can use tools like <code>tail</code> to see
logs in real-time, which makes debugging easier.</p>
<h3 id="what-are-the-best-practices-for-using-supervisor-in-docker">5.
What are the best practices for using Supervisor in Docker?</h3>
<p>Some best practices for using Supervisor in Docker are to keep our
containers small by running one service if we can. We should also use
environment variables for settings and make sure we have good logging
and monitoring. It is important to handle process stops correctly and
use health checks to make sure our containers work as they should. For
more tips on Docker best practices, we can check <a
href="https://bestonlinetutorial.com/docker/what-are-docker-security-best-practices.html">Docker
security best practices</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            