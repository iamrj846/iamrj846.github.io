
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "BestOnlineTutorial",
      "url": "https://www.bestonlinetutorial.com/"
    }
    </script>
            <!-- Common CSS & Icons -->
            <link rel="icon" href="/favicon.ico" type="image/x-icon">
            <link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
            <link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
            <link rel="stylesheet" href="/assets/css/post.css">
            <title>How can you securely pass AWS credentials to a Docker container?</title>
            <meta name="description" content="Learn how to securely pass AWS credentials to Docker containers to enhance security and streamline your cloud development process.">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How can you securely pass AWS credentials to a Docker container?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>To pass AWS credentials to a Docker container safely, we can use
different methods that keep our information secure. Some ways include
using AWS IAM roles, Docker secrets, environment variables, and AWS
Systems Manager Parameter Store. These options help protect sensitive
information while letting our application access AWS services.</p>
<p>In this article, we will talk about safe ways to pass AWS credentials
to Docker containers. We will look at how to use AWS IAM Roles for
Service Accounts, Docker secrets, environment variables, and AWS Systems
Manager Parameter Store. We will also see how to set up Docker Compose
for passing credentials safely to our containers. The methods we will
explore are:</p>
<ul>
<li>Using AWS IAM Roles for Service Accounts to Pass AWS Credentials to
a Docker Container</li>
<li>Using Docker Secrets to Pass AWS Credentials to a Docker
Container</li>
<li>Using Environment Variables to Pass AWS Credentials to a Docker
Container</li>
<li>Using AWS Systems Manager Parameter Store to Pass AWS Credentials to
a Docker Container</li>
<li>Setting up Docker Compose for Passing AWS Credentials to a Docker
Container</li>
</ul>
<p>For more details on Docker and how it works, check this article on <a
href="https://bestonlinetutorial.com/docker/what-is-docker-and-why-should-you-use-it.html">what
is Docker and why you should use it</a>.</p>
<h2
id="using-aws-iam-roles-for-service-accounts-to-securely-pass-aws-credentials-to-a-docker-container">Using
AWS IAM Roles for Service Accounts to Securely Pass AWS Credentials to a
Docker Container</h2>
<p>AWS IAM Roles for Service Accounts (IRSA) let Kubernetes pods take on
IAM roles. This gives us a safe way to manage AWS credentials for apps
running in Docker containers on Amazon EKS. By using this method, we do
not need to hard-code AWS access keys in our app.</p>
<h3 id="steps-to-implement-irsa">Steps to Implement IRSA:</h3>
<ol type="1">
<li><strong>Create an IAM Role</strong>:
<ul>
<li>We need to define an IAM role with the right permissions.</li>
<li>The trust relationship should let the EKS cluster take on the
role.</li>
</ul>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;Principal&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;Federated&quot;</span><span class="fu">:</span> <span class="st">&quot;arn:aws:eks:&lt;region&gt;:&lt;account-id&gt;:oidc:idp-&lt;oidc-provider&gt;&quot;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="st">&quot;sts:AssumeRoleWithWebIdentity&quot;</span><span class="fu">,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;Condition&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;StringEquals&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;oidc-provider:sub&quot;</span><span class="fu">:</span> <span class="st">&quot;system:serviceaccount:&lt;namespace&gt;:&lt;service-account-name&gt;&quot;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div></li>
<li><strong>Attach Policies</strong>:
<ul>
<li>We should attach the needed IAM policies to our role. This gives
permissions to access AWS resources.</li>
</ul></li>
<li><strong>Create a Kubernetes Service Account</strong>:
<ul>
<li>Let’s create a service account in EKS and add the IAM role ARN.</li>
</ul>
<div class="sourceCode" id="cb2"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ServiceAccount</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;service-account-name&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> &lt;namespace&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">annotations</span><span class="kw">:</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">eks.amazonaws.com/role-arn</span><span class="kw">:</span><span class="at"> arn:aws:iam::&lt;account-id&gt;:role/&lt;role-name&gt;</span></span></code></pre></div></li>
<li><strong>Deploy Your Application</strong>:
<ul>
<li>We can use the service account in our deployment YAML file.</li>
</ul>
<div class="sourceCode" id="cb3"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;deployment-name&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> &lt;namespace&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> &lt;app-name&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> &lt;app-name&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">serviceAccountName</span><span class="kw">:</span><span class="at"> &lt;service-account-name&gt;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> &lt;container-name&gt;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">image</span><span class="kw">:</span><span class="at"> &lt;image-name&gt;</span></span></code></pre></div></li>
<li><strong>Access AWS Services</strong>:
<ul>
<li>In our application, we can use AWS SDKs without managing AWS
credentials directly. The SDK will get the credentials from the service
account.</li>
</ul></li>
</ol>
<p>By following these steps, we can safely pass AWS credentials to a
Docker container on Amazon EKS using IAM Roles for Service Accounts.
This improves security by reducing the risk of exposing credentials. For
more details on Docker and Kubernetes integration, we can check out <a
href="https://bestonlinetutorial.com/docker/how-to-use-docker-in-cloud-environments-aws-gcp-azure.html">this
article</a>.</p>
<h2
id="using-docker-secrets-to-securely-pass-aws-credentials-to-a-docker-container">Using
Docker Secrets to Securely Pass AWS Credentials to a Docker
Container</h2>
<p>Docker Secrets helps us store and manage important data safely. This
includes AWS credentials in a Docker Swarm cluster. When we use Docker
Secrets, we make sure our AWS credentials are not hardcoded in our
application code or saved in environment variables. This way, we lower
the risk of them being exposed.</p>
<h3 id="steps-to-use-docker-secrets-for-aws-credentials">Steps to Use
Docker Secrets for AWS Credentials</h3>
<ol type="1">
<li><p><strong>Create a Secret</strong>:<br />
We can create a secret for our AWS credentials using the Docker CLI. We
do this by running these commands:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;your_aws_access_key&quot;</span> <span class="kw">|</span> <span class="ex">docker</span> secret create aws_access_key <span class="at">-</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;your_aws_secret_key&quot;</span> <span class="kw">|</span> <span class="ex">docker</span> secret create aws_secret_key <span class="at">-</span></span></code></pre></div></li>
<li><p><strong>Deploy a Service with Secrets</strong>:<br />
When we deploy a Docker service, we need to specify the secrets we want
to use. Here is an example of a service definition that uses the secrets
we created:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> service create <span class="at">--name</span> my_service <span class="dt">\</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>--secret aws_access_key <span class="dt">\</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>--secret aws_secret_key <span class="dt">\</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>your_image_name</span></code></pre></div></li>
<li><p><strong>Accessing Secrets in the Container</strong>:<br />
We can find Docker Secrets at
<code>/run/secrets/&lt;secret_name&gt;</code>. For example, to get the
AWS access key and secret key in our application, we can read the files
like this:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;/run/secrets/aws_access_key&#39;</span>, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    aws_access_key <span class="op">=</span> f.read().strip()</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;/run/secrets/aws_secret_key&#39;</span>, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    aws_secret_key <span class="op">=</span> f.read().strip()</span></code></pre></div></li>
<li><p><strong>Example of Using AWS SDK with Secrets</strong>:<br />
We can use the AWS SDK (like Boto3 for Python) with the secrets we read
from the files below:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>session <span class="op">=</span> boto3.Session(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    aws_access_key_id<span class="op">=</span>aws_access_key,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    aws_secret_access_key<span class="op">=</span>aws_secret_key</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> session.resource(<span class="st">&#39;s3&#39;</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we can use the s3 resource to work with AWS S3</span></span></code></pre></div></li>
</ol>
<h3 id="benefits-of-using-docker-secrets">Benefits of Using Docker
Secrets</h3>
<ul>
<li><strong>Better Security</strong>: Docker Secrets encrypts sensitive
data when it is stored and while it moves.</li>
<li><strong>Lower Risk of Exposure</strong>: Secrets do not stay in the
filesystem of the container.</li>
<li><strong>Simple Management</strong>: Docker Secrets gives us an easy
way to manage sensitive information across services in a Swarm.</li>
</ul>
<p>For more details on how to use Docker safely, we can check <a
href="https://bestonlinetutorial.com/docker/how-to-use-docker-secrets-for-sensitive-data-storage.html">Docker
Secrets for Sensitive Data Storage</a>.</p>
<h2
id="using-environment-variables-to-securely-pass-aws-credentials-to-a-docker-container">Using
Environment Variables to Securely Pass AWS Credentials to a Docker
Container</h2>
<p>We can use environment variables to pass AWS credentials to a Docker
container safely. This way, we reduce the chance of showing sensitive
information in our Dockerfile or image.</p>
<p>To set environment variables for AWS credentials, we can use the
Docker command line or a Docker Compose file. Here are examples of both
ways.</p>
<h3 id="using-docker-command-line">Using Docker Command Line</h3>
<p>We can pass environment variables directly when we run our Docker
container with the <code>-e</code> flag:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-e</span> AWS_ACCESS_KEY_ID=<span class="op">&lt;</span>your_access_key_id<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">-e</span> AWS_SECRET_ACCESS_KEY=<span class="op">&lt;</span>your_secret_access_key<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">-e</span> AWS_DEFAULT_REGION=<span class="op">&lt;</span>your_region<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>           your_docker_image</span></code></pre></div>
<h3 id="using-docker-compose">Using Docker Compose</h3>
<p>In a <code>docker-compose.yml</code> file, we can set environment
variables under the service definition:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">my_service</span><span class="kw">:</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> your_docker_image</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">AWS_ACCESS_KEY_ID</span><span class="kw">:</span><span class="at"> &lt;your_access_key_id&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">AWS_SECRET_ACCESS_KEY</span><span class="kw">:</span><span class="at"> &lt;your_secret_access_key&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">AWS_DEFAULT_REGION</span><span class="kw">:</span><span class="at"> &lt;your_region&gt;</span></span></code></pre></div>
<h3 id="best-practices">Best Practices</h3>
<ul>
<li><p><strong>Do not hard-code sensitive data:</strong> We should not
put sensitive information directly in our Dockerfiles or files that are
version controlled.</p></li>
<li><p><strong>Use <code>.env</code> files:</strong> We can also load
environment variables from a <code>.env</code> file. First, create a
<code>.env</code> file with your credentials:</p>
<pre class="plaintext"><code>AWS_ACCESS_KEY_ID=&lt;your_access_key_id&gt;
AWS_SECRET_ACCESS_KEY=&lt;your_secret_access_key&gt;
AWS_DEFAULT_REGION=&lt;your_region&gt;</code></pre>
<p>Then, we can reference this file in our
<code>docker-compose.yml</code>:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">my_service</span><span class="kw">:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> your_docker_image</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">env_file</span><span class="kw">:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> .env</span></span></code></pre></div></li>
</ul>
<p>By using environment variables, we can securely pass AWS credentials
to our Docker containers. This helps keep our information safe. For more
tips on best practices with Docker, check <a
href="https://bestonlinetutorial.com/docker/what-are-docker-security-best-practices.html">this
article</a>.</p>
<h2
id="leveraging-aws-systems-manager-parameter-store-for-securely-passing-aws-credentials-to-a-docker-container">Leveraging
AWS Systems Manager Parameter Store for Securely Passing AWS Credentials
to a Docker Container</h2>
<p>AWS Systems Manager Parameter Store helps us manage our configuration
data and secrets like AWS credentials. We can use it to pass AWS
credentials to a Docker container safely. Here is how we can do it.</p>
<ol type="1">
<li><p><strong>Store AWS Credentials in Parameter Store</strong>:<br />
First, we can use the AWS Management Console or AWS CLI to create
parameters for our AWS credentials.</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">aws</span> ssm put-parameter <span class="at">--name</span> <span class="st">&quot;/myapp/aws/access-key&quot;</span> <span class="at">--value</span> <span class="st">&quot;YOUR_AWS_ACCESS_KEY&quot;</span> <span class="at">--type</span> SecureString</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">aws</span> ssm put-parameter <span class="at">--name</span> <span class="st">&quot;/myapp/aws/secret-key&quot;</span> <span class="at">--value</span> <span class="st">&quot;YOUR_AWS_SECRET_KEY&quot;</span> <span class="at">--type</span> SecureString</span></code></pre></div></li>
<li><p><strong>Grant IAM Role Permissions</strong>:<br />
Next, we need to make sure that the IAM role linked to our EC2 instance
or ECS task has the right permissions to access the parameters. We
attach this policy:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Version&quot;</span><span class="fu">:</span> <span class="st">&quot;2012-10-17&quot;</span><span class="fu">,</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Statement&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;Effect&quot;</span><span class="fu">:</span> <span class="st">&quot;Allow&quot;</span><span class="fu">,</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;Action&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;ssm:GetParameter&quot;</span><span class="ot">,</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;ssm:GetParameters&quot;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>            <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;Resource&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;arn:aws:ssm:REGION:ACCOUNT_ID:parameter/myapp/aws/*&quot;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            <span class="ot">]</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div></li>
<li><p><strong>Retrieve Parameters in Docker Container</strong>:<br />
Now, in our Docker container, we can get the parameters using the AWS
CLI or SDK. We must install the AWS CLI in our Docker image first.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> amazonlinux:2</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">yum</span> install <span class="at">-y</span> aws-cli</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;sh&quot;</span>, <span class="st">&quot;-c&quot;</span>, <span class="st">&quot;aws ssm get-parameters --names \&quot;</span>/myapp/aws/access-key\<span class="st">&quot; \&quot;</span>/myapp/aws/secret-key\<span class="st">&quot; --with-decryption --query \&quot;</span>Parameters[*].Value\<span class="st">&quot; --output text&quot;</span>]</span></code></pre></div></li>
<li><p><strong>Run Docker Container</strong>:<br />
When we run our Docker container, it will fetch the AWS credentials from
Parameter Store safely.</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> myapp-image</span></code></pre></div></li>
</ol>
<p>By doing these steps, we can manage and pass AWS credentials to our
Docker containers using AWS Systems Manager Parameter Store. This helps
keep our sensitive info safe. For more on securing Docker containers,
check out <a
href="https://bestonlinetutorial.com/docker/what-are-docker-security-best-practices.html">this
article</a>.</p>
<h2
id="configuring-docker-compose-for-securely-passing-aws-credentials-to-a-docker-container">Configuring
Docker Compose for Securely Passing AWS Credentials to a Docker
Container</h2>
<p>To pass AWS credentials to a Docker container safely using Docker
Compose, we can use environment variables, Docker secrets, or AWS IAM
roles. Here are the ways to do this:</p>
<h3 id="using-environment-variables">Using Environment Variables</h3>
<p>We can set AWS credentials as environment variables in the
<code>docker-compose.yml</code> file. This method is simple but we need
to be careful with sensitive data.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">app</span><span class="kw">:</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> your_image_name</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">AWS_ACCESS_KEY_ID</span><span class="kw">:</span><span class="at"> ${AWS_ACCESS_KEY_ID}</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">AWS_SECRET_ACCESS_KEY</span><span class="kw">:</span><span class="at"> ${AWS_SECRET_ACCESS_KEY}</span></span></code></pre></div>
<p>We need to create a <code>.env</code> file in the same folder with
this content:</p>
<pre><code>AWS_ACCESS_KEY_ID=your_access_key
AWS_SECRET_ACCESS_KEY=your_secret_key</code></pre>
<h3 id="utilizing-docker-secrets">Utilizing Docker Secrets</h3>
<p>For better security, we can use Docker secrets to handle sensitive
information. This way is best for production environments.</p>
<ol type="1">
<li>Create a secret for your AWS credentials:</li>
</ol>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;your_access_key&quot;</span> <span class="kw">|</span> <span class="ex">docker</span> secret create aws_access_key <span class="at">-</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;your_secret_key&quot;</span> <span class="kw">|</span> <span class="ex">docker</span> secret create aws_secret_key <span class="at">-</span></span></code></pre></div>
<ol start="2" type="1">
<li>We reference these secrets in the
<code>docker-compose.yml</code>:</li>
</ol>
<div class="sourceCode" id="cb19"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">app</span><span class="kw">:</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> your_image_name</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">secrets</span><span class="kw">:</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> aws_access_key</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> aws_secret_key</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">AWS_ACCESS_KEY_ID</span><span class="kw">:</span><span class="at"> /run/secrets/aws_access_key</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">AWS_SECRET_ACCESS_KEY</span><span class="kw">:</span><span class="at"> /run/secrets/aws_secret_key</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">secrets</span><span class="kw">:</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">aws_access_key</span><span class="kw">:</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">external</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">aws_secret_key</span><span class="kw">:</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">external</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre></div>
<h3 id="using-aws-iam-roles">Using AWS IAM Roles</h3>
<p>If we run the Docker container on AWS (like ECS), we can use IAM
roles. This means we do not need to manage AWS credentials directly.</p>
<ol type="1">
<li>We assign an IAM role to our ECS task. This role needs the right
permissions.</li>
<li>In our container, the AWS SDK will automatically get temporary
credentials from the IAM role.</li>
</ol>
<p>We do not need to change anything in the
<code>docker-compose.yml</code> for this method. The SDK takes care of
the authentication by itself.</p>
<h3 id="example-docker-compose-file">Example Docker Compose File</h3>
<p>Here is a full example of a <code>docker-compose.yml</code> using
environment variables and Docker secrets:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">app</span><span class="kw">:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> your_image_name</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">AWS_REGION</span><span class="kw">:</span><span class="at"> us-east-1</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">secrets</span><span class="kw">:</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> aws_access_key</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> aws_secret_key</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;your_command&quot;</span><span class="kw">]</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">secrets</span><span class="kw">:</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">aws_access_key</span><span class="kw">:</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">file</span><span class="kw">:</span><span class="at"> ./aws_access_key.txt</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">aws_secret_key</span><span class="kw">:</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">file</span><span class="kw">:</span><span class="at"> ./aws_secret_key.txt</span></span></code></pre></div>
<p>We must store our AWS credentials in <code>aws_access_key.txt</code>
and <code>aws_secret_key.txt</code>.</p>
<p>By using these ways, we can pass AWS credentials to a Docker
container safely with Docker Compose. This helps our application connect
to AWS services without showing sensitive data.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3
id="how-can-we-securely-pass-aws-credentials-to-a-docker-container">1.
How can we securely pass AWS credentials to a Docker container?</h3>
<p>We can pass AWS credentials to a Docker container in a safe way by
using options like AWS IAM Roles for Service Accounts, Docker Secrets,
environment variables, or AWS Systems Manager Parameter Store. Each
option has its benefits. IAM roles give us temporary credentials. Docker
Secrets keep sensitive data safe. Parameter Store helps us manage
configuration data in one place. We should pick the option that fits our
app’s needs and security.</p>
<h3
id="what-are-docker-secrets-and-how-do-they-secure-aws-credentials">2.
What are Docker Secrets, and how do they secure AWS credentials?</h3>
<p>Docker Secrets is a safe way to handle sensitive info, like AWS
credentials, in Docker Swarm mode. With Docker Secrets, we store
sensitive data in an encrypted format. We only give access to specific
services in the swarm. This means our AWS credentials are not hardcoded
in Dockerfiles or code. This greatly improves the security of our
container apps. We can learn more about <a
href="https://bestonlinetutorial.com/docker/how-to-use-docker-secrets-for-sensitive-data-storage.html">how
to use Docker Secrets for sensitive data storage</a>.</p>
<h3
id="can-we-use-environment-variables-to-pass-aws-credentials-into-a-docker-container">3.
Can we use environment variables to pass AWS credentials into a Docker
container?</h3>
<p>Yes, we can use environment variables to pass AWS credentials to a
Docker container. We can set these variables in our Dockerfile or when
we run the container with the <code>-e</code> flag. But we must be
careful. These credentials should not be hardcoded in the Dockerfile or
shown in logs. This can create security issues. For a safer way, we
should think about using Docker Secrets or AWS IAM roles.</p>
<h3
id="how-do-aws-iam-roles-for-service-accounts-work-with-docker-containers">4.
How do AWS IAM Roles for Service Accounts work with Docker
containers?</h3>
<p>AWS IAM Roles for Service Accounts (IRSA) let us assign IAM roles
directly to Kubernetes service accounts. When we use Docker containers
in a Kubernetes setup, this allows containers to take on IAM roles. They
can get temporary AWS credentials without putting sensitive info inside
the container. This method is good for security. It follows the least
privilege rule and is great for apps running on Amazon EKS.</p>
<h3
id="what-is-the-aws-systems-manager-parameter-store-and-how-can-we-use-it-for-docker">5.
What is the AWS Systems Manager Parameter Store, and how can we use it
for Docker?</h3>
<p>AWS Systems Manager Parameter Store is a service that safely stores
configuration data and secrets like AWS credentials. We can use it to
save parameters and get them in our Docker containers when they run. By
connecting Parameter Store with our app, we keep flexibility and
security without hardcoding sensitive info. For more setup details, we
can look at <a
href="https://bestonlinetutorial.com/docker/how-to-use-docker-in-cloud-environments-aws-gcp-azure.html">Utilizing
AWS Systems Manager Parameter Store</a>.</p>
<p>These FAQs help answer common questions on how we can securely pass
AWS credentials to Docker containers. This way, our apps stay safe while
using AWS services.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            