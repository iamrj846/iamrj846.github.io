
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "BestOnlineTutorial",
      "url": "https://www.bestonlinetutorial.com/"
    }
    </script>
            <!-- Common CSS & Icons -->
            <link rel="icon" href="/favicon.ico" type="image/x-icon">
            <link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
            <link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
            <link rel="stylesheet" href="/assets/css/post.css">
            <title>How to Resolve FastAPI RedirectResponse Returning {"message": "Forbidden"} When Redirecting to a Different Route in Docker?</title>
            <meta name="description" content="Learn how to fix FastAPI RedirectResponse returning Forbidden when redirecting in Docker. Step-by-step solutions inside.">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How to Resolve FastAPI RedirectResponse Returning {"message": "Forbidden"} When Redirecting to a Different Route in Docker?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>Sure! Here is a rewritten version of your content following your
guidelines:</p>
<hr />
<p>To fix the problem of FastAPI’s <code>RedirectResponse</code> giving
a <code>{"message": "Forbidden"}</code> error when we try to redirect to
another route in Docker, we need to check our CORS (Cross-Origin
Resource Sharing) settings. We must set the right headers. This will let
requests come from the origin we are using. Docker can have stricter
rules that stop cross-origin requests. So, we need to make sure our
FastAPI app can accept requests from the right origins. This will help
us avoid these forbidden errors.</p>
<p>In this article, we will talk about how FastAPI’s
<code>RedirectResponse</code> works in a Docker setting. We will look at
common reasons why we see forbidden errors when redirecting. We will
share solutions like how to set up CORS for FastAPI. We will also check
that we use the right URL paths for redirects. Lastly, we will look at
middleware that might change how redirects work. Here’s what we will
cover:</p>
<ul>
<li>Understanding FastAPI <code>RedirectResponse</code> behavior in
Docker</li>
<li>Common reasons for forbidden errors in FastAPI redirects</li>
<li>How to set up CORS for FastAPI in Docker</li>
<li>Checking proper URL paths for FastAPI
<code>RedirectResponse</code></li>
<li>Debugging FastAPI middleware for redirect problems</li>
<li>Common questions about FastAPI redirects in Docker</li>
</ul>
<hr />
<p>I hope this helps! Let me know if you need anything else.</p>
<h2
id="understanding-the-fastapi-redirectresponse-behavior-in-docker">Understanding
the FastAPI RedirectResponse Behavior in Docker</h2>
<p>FastAPI’s <code>RedirectResponse</code> might give a
<code>{"message": "Forbidden"}</code> error in some cases when we use it
in Docker. This issue often happens because of how FastAPI manages
request contexts, CORS (Cross-Origin Resource Sharing), and routing
inside a container.</p>
<h3 id="redirectresponse-example">RedirectResponse Example</h3>
<p>When we use FastAPI, a usual redirect looks like this:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.responses <span class="im">import</span> RedirectResponse</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">&quot;/redirect&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> redirect_route():</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> RedirectResponse(url<span class="op">=</span><span class="st">&quot;/new-route&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">&quot;/new-route&quot;</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> new_route():</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">&quot;message&quot;</span>: <span class="st">&quot;You&#39;ve been redirected!&quot;</span>}</span></code></pre></div>
<h3 id="common-problems">Common Problems</h3>
<ol type="1">
<li><strong>CORS Issues</strong>: If someone accesses your FastAPI app
from a different origin, CORS can block the request.</li>
<li><strong>Incorrect URL Paths</strong>: We need to check if the URL
paths are right and reachable in Docker.</li>
<li><strong>Docker Networking</strong>: If Docker networks are not set
up right, it can cause routes to be unreachable.</li>
</ol>
<h3 id="debugging-steps">Debugging Steps</h3>
<ul>
<li><strong>Check Logs</strong>: Look at the logs of your FastAPI app to
find the problem.</li>
<li><strong>CORS Configuration</strong>: Make sure the FastAPI app is
set up correctly for CORS. We can use
<code>fastapi.middleware.cors.CORSMiddleware</code> to manage allowed
origins.</li>
</ul>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.middleware.cors <span class="im">import</span> CORSMiddleware</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>app.add_middleware(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    CORSMiddleware,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    allow_origins<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],  <span class="co"># In production, set to specific origins</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    allow_credentials<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    allow_methods<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    allow_headers<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<ul>
<li><strong>Test Routes Manually</strong>: We can use tools like
<code>curl</code> or Postman to access the routes directly and see if we
get the right responses.</li>
</ul>
<h3 id="proper-docker-configuration">Proper Docker Configuration</h3>
<p>We need to ensure our Docker setup opens the right ports and that the
FastAPI app can be reached from outside the container. Here is an
example of a <code>Dockerfile</code> setup:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> python:3.9</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . /app</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install fastapi uvicorn</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;uvicorn&quot;</span>, <span class="st">&quot;main:app&quot;</span>, <span class="st">&quot;--host&quot;</span>, <span class="st">&quot;0.0.0.0&quot;</span>, <span class="st">&quot;--port&quot;</span>, <span class="st">&quot;8000&quot;</span>]</span></code></pre></div>
<p>In your <code>docker-compose.yml</code>, make sure the ports are
mapped correctly:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3&#39;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">fastapi</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8000:8000&quot;</span></span></code></pre></div>
<p>By following the right configurations and debugging steps, we can fix
the issue of <code>RedirectResponse</code> returning a
<code>{"message": "Forbidden"}</code> when redirecting in Docker.</p>
<h2 id="common-causes-of-forbidden-errors-in-fastapi-redirects">Common
Causes of Forbidden Errors in FastAPI Redirects</h2>
<p>When we use FastAPI with Docker, we might see a
<code>Forbidden</code> error ({“message”: “Forbidden”}) during
redirects. This can happen due to different reasons. Here are some
common causes and how we can fix them:</p>
<ol type="1">
<li><strong>CORS Configuration</strong>:
<ul>
<li>If our app is on a different origin than the frontend, we need to
make sure CORS is set up right. If CORS headers are missing, we can get
forbidden errors when accessing resources.</li>
</ul>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.middleware.cors <span class="im">import</span> CORSMiddleware</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>app.add_middleware(</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    CORSMiddleware,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    allow_origins<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],  <span class="co"># Change this if needed</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    allow_credentials<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    allow_methods<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    allow_headers<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div></li>
<li><strong>Authentication and Authorization</strong>:
<ul>
<li>We must check that the route we are redirecting to has the right
authentication and authorization settings. If the user does not have the
right permissions, the server gives a <code>403 Forbidden</code>
error.</li>
</ul>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> Depends, HTTPException, status</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_current_user(token: <span class="bu">str</span> <span class="op">=</span> Depends(oauth2_scheme)):</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> authenticate_user(token)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> user:</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span>status.HTTP_403_FORBIDDEN, detail<span class="op">=</span><span class="st">&quot;Not authorized&quot;</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> user</span></code></pre></div></li>
<li><strong>Incorrect URL Path</strong>:
<ul>
<li>We have to make sure the URL we are redirecting to is correct and we
can access it. A typo in the route or a wrong endpoint setup can cause a
forbidden response.</li>
</ul>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.responses <span class="im">import</span> RedirectResponse</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">&quot;/redirect&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> redirect_example():</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> RedirectResponse(url<span class="op">=</span><span class="st">&quot;/target-route&quot;</span>)  <span class="co"># Check if &quot;/target-route&quot; is valid</span></span></code></pre></div></li>
<li><strong>Docker Network Configuration</strong>:
<ul>
<li>If our FastAPI app runs in a Docker container, we must check that
the network settings allow requests to the routes we want. Wrong network
settings can block access and cause forbidden errors.</li>
</ul>
<div class="sourceCode" id="cb8"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3&#39;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">fastapi-app</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> fastapi-image</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8000:8000&quot;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> app-network</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">app-network</span><span class="kw">:</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">driver</span><span class="kw">:</span><span class="at"> bridge</span></span></code></pre></div></li>
<li><strong>Middleware Interference</strong>:
<ul>
<li>We should see if any middleware is getting in the way of the request
processing. Some middleware might be set to reject requests that do not
meet certain rules.</li>
</ul>
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.middleware</span>(<span class="st">&quot;http&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> check_request(request: Request, call_next):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> some_condition:</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> JSONResponse(status_code<span class="op">=</span><span class="dv">403</span>, content<span class="op">=</span>{<span class="st">&quot;message&quot;</span>: <span class="st">&quot;Forbidden&quot;</span>})</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> <span class="cf">await</span> call_next(request)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response</span></code></pre></div></li>
<li><strong>Environment Variables</strong>:
<ul>
<li>We need to ensure that the environment variables needed for setup
(like API keys or secrets) are set correctly in our Docker container.
Missing or wrong values can cause access problems.</li>
</ul>
<div class="sourceCode" id="cb10"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> SECRET_KEY=mysecretkey</span></span></code></pre></div></li>
</ol>
<p>By looking at these common causes, we can fix the
<code>Forbidden</code> errors when using FastAPI’s
<code>RedirectResponse</code> in a Docker environment. Each part needs
our careful attention to make sure routes are open and set up right.</p>
<h2 id="how-to-configure-cors-for-fastapi-in-docker">How to Configure
CORS for FastAPI in Docker</h2>
<p>To fix problems with <code>FastAPI</code>
<code>RedirectResponse</code> giving
<code>{"message": "Forbidden"}</code> when we try to redirect to another
route in Docker, we need to set up Cross-Origin Resource Sharing (CORS).
FastAPI has built-in support for CORS. We can use the
<code>fastapi.middleware.cors</code> middleware to configure it.</p>
<p>Here are the steps to set up CORS in our FastAPI app running in
Docker:</p>
<ol type="1">
<li><p><strong>Install the Required Libraries</strong>: First, we need
to make sure we have <code>fastapi</code> and <code>uvicorn</code> in
our Docker environment. We can do this by adding these lines to our
<code>Dockerfile</code>:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install fastapi uvicorn</span></code></pre></div></li>
<li><p><strong>Import the CORS Middleware</strong>: Next, we need to
import the CORS middleware in our FastAPI app file:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.middleware.cors <span class="im">import</span> CORSMiddleware</span></code></pre></div></li>
<li><p><strong>Configure the Middleware</strong>: Now, we add the CORS
middleware to our FastAPI app with the right settings:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>app.add_middleware(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    CORSMiddleware,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    allow_origins<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],  <span class="co"># Change this to your allowed origins</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    allow_credentials<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    allow_methods<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    allow_headers<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<ul>
<li>We can set the <code>allow_origins</code> to specific domains to
limit access. For example, we can use
<code>["http://localhost:3000", "https://yourdomain.com"]</code>.</li>
<li>We can also change <code>allow_methods</code> and
<code>allow_headers</code> based on what our app needs.</li>
</ul></li>
<li><p><strong>Docker Compose Configuration</strong>: If we use Docker
Compose, we need to make sure our service is set up right in our
<code>docker-compose.yml</code> file:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">fastapi</span><span class="kw">:</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8000:8000&quot;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ENV_VAR_NAME=value</span></span></code></pre></div></li>
<li><p><strong>Run Your Application</strong>: Finally, we start our
FastAPI app using Docker:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">--build</span></span></code></pre></div></li>
</ol>
<p>With CORS set up right, our FastAPI app should now manage
cross-origin requests better. This should fix the <code>Forbidden</code>
errors we got during redirects. If we want to know more about using
Docker with FastAPI, we can check the article on <a
href="https://bestonlinetutorial.com/docker/how-to-dockerize-a-python-web-application-flask-django.html">how
to dockerize a Python web application</a>.</p>
<h2 id="ensuring-proper-url-paths-for-fastapi-redirectresponse">Ensuring
Proper URL Paths for FastAPI RedirectResponse</h2>
<p>When we use FastAPI’s <code>RedirectResponse</code>, it is very
important to make sure that the URL paths are set up right. This is
especially true when we run our application in a Docker environment. If
URL paths are wrong, we can get <code>{"message": "Forbidden"}</code>
errors. Here are some key points and settings to help us ensure proper
URL paths:</p>
<ol type="1">
<li><p><strong>Base URL Configuration</strong>:<br />
We need to check that the base URL in our FastAPI app is correct. If we
are behind a reverse proxy, we might have to set the right base
path.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.responses <span class="im">import</span> RedirectResponse</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">&quot;/&quot;</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> read_root():</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> RedirectResponse(url<span class="op">=</span><span class="st">&quot;/new-path&quot;</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">&quot;/new-path&quot;</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> read_new_path():</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">&quot;message&quot;</span>: <span class="st">&quot;This is the new path&quot;</span>}</span></code></pre></div></li>
<li><p><strong>Use of Full URLs</strong>:<br />
When we redirect, especially from Docker containers, it is good to use
full URLs if the service is accessed from outside.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">&quot;/&quot;</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> read_root():</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> RedirectResponse(url<span class="op">=</span><span class="st">&quot;http://localhost:8000/new-path&quot;</span>)</span></code></pre></div></li>
<li><p><strong>Network Configuration</strong>:<br />
We should check that our Docker container’s network settings let it
communicate well. We can use Docker networks to help find services and
make sure our paths are reachable from other services.</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">fastapi-app</span><span class="kw">:</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8000:8000&quot;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> my-network</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">my-network</span><span class="kw">:</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">driver</span><span class="kw">:</span><span class="at"> bridge</span></span></code></pre></div></li>
<li><p><strong>Docker Host Configuration</strong>:<br />
If our FastAPI app is running in a Docker container and we access it
from the host machine, we should use the Docker host’s IP address in our
redirect URLs.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">&quot;/&quot;</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> read_root():</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> RedirectResponse(url<span class="op">=</span><span class="st">&quot;http://&lt;docker_host_ip&gt;:8000/new-path&quot;</span>)</span></code></pre></div></li>
<li><p><strong>CORS Settings</strong>:<br />
We must make sure that CORS (Cross-Origin Resource Sharing) settings are
set up right. This allows requests from our frontend application if
needed.</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.middleware.cors <span class="im">import</span> CORSMiddleware</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>app.add_middleware(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    CORSMiddleware,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    allow_origins<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],  <span class="co"># Change as needed</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    allow_credentials<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    allow_methods<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    allow_headers<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div></li>
<li><p><strong>Debugging Redirects</strong>:<br />
We can use FastAPI’s built-in logging to help us fix any problems with
redirects. We should set our logging level to <code>DEBUG</code> to get
detailed info about incoming requests and outgoing responses.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.DEBUG)</span></code></pre></div></li>
</ol>
<p>By following these tips, we can make sure our FastAPI
<code>RedirectResponse</code> works well. This helps us avoid
<code>{"message": "Forbidden"}</code> errors when we redirect to
different routes in a Docker environment.</p>
<h2 id="debugging-fastapi-middleware-for-redirect-issues">Debugging
FastAPI Middleware for Redirect Issues</h2>
<p>When we see a <code>RedirectResponse</code> in FastAPI that gives
<code>{"message": "Forbidden"}</code>, we need to check the middleware
settings. FastAPI middleware can change how requests are handled. This
can cause permission problems when we try to redirect.</p>
<h3 id="common-debugging-steps">Common Debugging Steps</h3>
<ol type="1">
<li><p><strong>Check Middleware Order</strong>: The order of middleware
matters. We should make sure that authentication or CORS middleware is
in the right order.</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> starlette.middleware.cors <span class="im">import</span> CORSMiddleware</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>app.add_middleware(</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    CORSMiddleware,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    allow_origins<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],  <span class="co"># Change this if needed</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    allow_credentials<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    allow_methods<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    allow_headers<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add your authentication middleware here</span></span></code></pre></div></li>
<li><p><strong>Inspect Middleware Logic</strong>: If we wrote custom
middleware, we must check it does not block requests that should go
through. For example:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CustomMiddleware:</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, request: Request, call_next):</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check permissions or change request here</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> <span class="cf">await</span> call_next(request)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response</span></code></pre></div></li>
<li><p><strong>Review CORS Configuration</strong>: We need to check that
CORS headers are set right. If CORS settings are wrong, we can get
forbidden errors. This is especially true when redirecting between
different domains.</p></li>
<li><p><strong>Verify Route Permissions</strong>: We should check if the
routes we are redirecting to have the right permission checks. It helps
to log user roles or permissions just before redirects.</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">&quot;/secure-route&quot;</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> secure_route(current_user: User <span class="op">=</span> Depends(get_current_user)):</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> current_user.is_authenticated:</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span><span class="dv">403</span>, detail<span class="op">=</span><span class="st">&quot;Forbidden&quot;</span>)</span></code></pre></div></li>
<li><p><strong>Logging Middleware</strong>: We can add logging to see
which requests we are processing and where errors happen. This helps us
find out if the problem is before or during the redirect.</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.INFO)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LoggingMiddleware:</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, request: Request, call_next):</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f&quot;Request path: </span><span class="sc">{</span>request<span class="sc">.</span>url<span class="sc">.</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> <span class="cf">await</span> call_next(request)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f&quot;Response status: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response</span></code></pre></div></li>
</ol>
<h3 id="test-redirects-locally">Test Redirects Locally</h3>
<p>If we can, we should test the FastAPI application outside of Docker.
This way, we can see if the behavior is the same. It helps us know if
the issue is with Docker or the application settings.</p>
<p>By following these steps, we can find and fix problems with a
<code>RedirectResponse</code> that gives a forbidden message in FastAPI.
This is especially useful when we use Docker.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3
id="why-do-i-get-a-message-forbidden-error-when-using-fastapis-redirectresponse-in-docker">1.
Why do I get a {“message”: “Forbidden”} error when using FastAPI’s
RedirectResponse in Docker?</h3>
<p>We often see the {“message”: “Forbidden”} error because of wrong CORS
settings or bad URL paths in our FastAPI app running in Docker. First,
we should check that CORS is set up right. This will let requests from
our front-end app go through. Next, we need to look at the URL paths in
our <code>RedirectResponse</code>. We have to make sure they are correct
and can be accessed in the Docker environment.</p>
<h3 id="how-can-i-set-up-cors-in-fastapi-to-avoid-forbidden-errors">2.
How can I set up CORS in FastAPI to avoid Forbidden errors?</h3>
<p>To set up CORS in FastAPI, we can use the
<code>CORSMiddleware</code>. This middleware helps us say which origins,
methods, and headers we allow. Here is a simple example:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.middleware.cors <span class="im">import</span> CORSMiddleware</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>app.add_middleware(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    CORSMiddleware,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    allow_origins<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],  <span class="co"># Change this to what you need</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    allow_credentials<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    allow_methods<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    allow_headers<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We should change the <code>allow_origins</code> setting to match the
origins we want to allow, especially when using Docker.</p>
<h3
id="how-do-i-make-sure-my-url-paths-are-right-for-fastapi-redirectresponse">3.
How do I make sure my URL paths are right for FastAPI
RedirectResponse?</h3>
<p>When we use FastAPI’s <code>RedirectResponse</code>, we need to check
that the URLs we give are correct and can be reached. We can use full
URLs or right relative paths, depending on how our Docker container
connects. For example:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.responses <span class="im">import</span> RedirectResponse</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">&quot;/redirect&quot;</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> redirect_example():</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> RedirectResponse(url<span class="op">=</span><span class="st">&quot;/target-route&quot;</span>)</span></code></pre></div>
<p>We must make sure <code>/target-route</code> exists and can be
reached from where the request comes.</p>
<h3
id="what-are-common-reasons-for-forbidden-errors-during-fastapi-redirects">4.
What are common reasons for Forbidden errors during FastAPI
redirects?</h3>
<p>Some common reasons for Forbidden errors in FastAPI redirects are
wrong CORS settings, bad URL paths, or issues with authentication. We
need to confirm that the route we are redirecting to is accessible
according to our app’s security settings. Also, we should check if our
app needs any authentication tokens that are not there during the
redirect.</p>
<h3
id="how-can-i-find-out-about-middleware-issues-in-fastapi-related-to-redirects">5.
How can I find out about middleware issues in FastAPI related to
redirects?</h3>
<p>To find middleware issues in FastAPI, we can turn on logging to see
detailed request and response cycles. We can use Python’s logging
library and set the logging level to DEBUG. This helps us find out where
the request goes wrong. Here is an example:</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.DEBUG)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="at">@app.middleware</span>(<span class="st">&quot;http&quot;</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> log_requests(request: Request, call_next):</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    logging.debug(<span class="ss">f&quot;Request URL: </span><span class="sc">{</span>request<span class="sc">.</span>url<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> <span class="cf">await</span> call_next(request)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    logging.debug(<span class="ss">f&quot;Response status: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response</span></code></pre></div>
<p>With this setup, we will see the requests and responses. This helps
us understand why we get the Forbidden error.</p>
<p>For more tips on Docker settings that might affect FastAPI apps,
check out <a
href="https://bestonlinetutorial.com/docker/what-are-the-benefits-of-using-docker-in-development.html">What
are the benefits of using Docker in development</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            