
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "BestOnlineTutorial",
      "url": "https://www.bestonlinetutorial.com/"
    }
    </script>
            <!-- Common CSS & Icons -->
            <link rel="icon" href="/favicon.ico" type="image/x-icon">
            <link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
            <link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
            <link rel="stylesheet" href="/assets/css/post.css">
            <title>How can you create a user and database in a script for Docker Postgres?</title>
            <meta name="description" content="Learn to create a user and database in Docker Postgres with our step-by-step script guide. Simplify your database setup!">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How can you create a user and database in a script for Docker Postgres?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>Creating a user and a database in a script for Docker Postgres can be
simple if we use environment variables and initialization scripts. This
way, we can set up our PostgreSQL instance easily. The user and database
will be ready when the container starts. This helps us save time and
makes fewer mistakes in setup.</p>
<p>In this article, we will go through the steps to create a user and a
database in Docker Postgres using scripts. We will talk about what we
need before starting. We will show how to create a user. Then we will
see how to create a database. Finally, we will learn how to put these
steps together in one script. We will also check how to make sure the
user and database are created correctly. Here are the main points we
will cover:</p>
<ul>
<li>What we need to create a user and database in Docker Postgres</li>
<li>Steps to create a user in Docker Postgres using a script</li>
<li>Steps to create a database in Docker Postgres using a script</li>
<li>How to combine user and database creation in one script for Docker
Postgres</li>
<li>How to check user and database creation in Docker Postgres</li>
<li>Common questions about setting up users and databases in Docker
Postgres</li>
</ul>
<p>For more information about Docker and what it can do, you can check
these topics: <a
href="https://bestonlinetutorial.com/docker/what-is-docker-and-why-should-you-use-it.html">What
is Docker and Why Should You Use It?</a> and <a
href="https://bestonlinetutorial.com/docker/how-does-docker-differ-from-virtual-machines.html">How
Does Docker Differ from Virtual Machines?</a>.</p>
<h2
id="what-are-the-prerequisites-for-creating-a-user-and-database-in-docker-postgres">What
are the prerequisites for creating a user and database in Docker
Postgres</h2>
<p>To create a user and database in Docker Postgres, we need some basic
things ready.</p>
<ol type="1">
<li><p><strong>Docker Installed</strong>: First, we have to check if
Docker is on our machine. We can do this by running:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> <span class="at">--version</span></span></code></pre></div></li>
<li><p><strong>Docker Compose (Optional)</strong>: If we want to manage
more than one container, it is good to have Docker Compose. We can check
if it is installed by running:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> <span class="at">--version</span></span></code></pre></div></li>
<li><p><strong>PostgreSQL Image</strong>: We need the official
PostgreSQL Docker image. We can get it by running:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull postgres</span></code></pre></div></li>
<li><p><strong>Environment Variables</strong>: We should prepare some
environment variables for PostgreSQL. These are:</p>
<ul>
<li><code>POSTGRES_USER</code>: This is the superuser’s username.</li>
<li><code>POSTGRES_PASSWORD</code>: This is the superuser’s
password.</li>
<li><code>POSTGRES_DB</code>: This is the name of the database we want
to create.</li>
</ul></li>
<li><p><strong>Basic Knowledge of Docker Commands</strong>: It helps to
know some basic Docker commands. This way we can manage our containers
better.</p></li>
<li><p><strong>Network Configuration</strong>: We must check that our
Docker network settings let our application talk to the PostgreSQL
container if needed.</p></li>
<li><p><strong>Volume Management (Optional)</strong>: If we want to keep
our data safe, we can set up a Docker volume. We can create a volume by
running:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> volume create pgdata</span></code></pre></div></li>
</ol>
<p>These steps will help us prepare to create a user and database in our
Docker PostgreSQL setup. If we want to learn more about Docker and how
it works, we can look at <a
href="https://bestonlinetutorial.com/docker/what-is-docker-and-why-should-you-use-it.html">What
is Docker and why should you use it</a>.</p>
<h2 id="how-can-we-create-a-user-in-docker-postgres-using-a-script">How
can we create a user in Docker Postgres using a script</h2>
<p>To create a user in Docker Postgres using a script, we can use the
PostgreSQL command-line tool inside our Docker container. We will make
an SQL script and then run it with the <code>psql</code> command. Here
is how we can do it:</p>
<ol type="1">
<li><p><strong>Create an SQL Script</strong>: First, we make a file
called <code>create_user.sql</code>. This file will have the command to
create the user.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="fu">USER</span> new_user <span class="kw">WITH</span> <span class="kw">PASSWORD</span> <span class="st">&#39;user_password&#39;</span>;</span></code></pre></div></li>
<li><p><strong>Dockerfile Configuration</strong>: If we use a Dockerfile
to build our Postgres image, we can copy the SQL script into the
container. Then we can run it when the container starts.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> postgres:latest</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> create_user.sql /docker-entrypoint-initdb.d/</span></code></pre></div></li>
<li><p><strong>Run the Container</strong>: Next, we build and run our
Docker container. The SQL script in
<code>/docker-entrypoint-initdb.d/</code> will run automatically when
the container starts.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> my_postgres_image .</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--name</span> my_postgres_container <span class="at">-e</span> POSTGRES_PASSWORD=mysecretpassword <span class="at">-d</span> my_postgres_image</span></code></pre></div></li>
<li><p><strong>Verifying User Creation</strong>: To check if the user is
created, we can connect to the Postgres container and list the
users.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> my_postgres_container psql <span class="at">-U</span> postgres <span class="at">-c</span> <span class="st">&quot;\du&quot;</span></span></code></pre></div></li>
</ol>
<p>This way, we make sure that user creation is automatic. It runs every
time we start a new Postgres container. For more information on Docker
and PostgreSQL, look at <a
href="https://bestonlinetutorial.com/docker/how-to-connect-docker-compose-with-spring-boot-and-postgres.html">this
article</a>.</p>
<h2
id="how-can-you-create-a-database-in-docker-postgres-using-a-script">How
can you create a database in Docker Postgres using a script</h2>
<p>To create a database in Docker Postgres using a script, we need to
make a SQL script file. This file will have the commands to create the
database. We can run this script when the PostgreSQL Docker container
starts.</p>
<ol type="1">
<li><p><strong>Create a SQL Script</strong><br />
First, we create a file called <code>init-db.sql</code>. In this file,
we put this content. Change <code>your_database_name</code> to whatever
name we want for our database:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">DATABASE</span> your_database_name;</span></code></pre></div></li>
<li><p><strong>Dockerfile Setup</strong><br />
Next, we make a Dockerfile to build an image that has our SQL script.
Here is an example:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> postgres:latest</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> init-db.sql /docker-entrypoint-initdb.d/</span></code></pre></div></li>
<li><p><strong>Building the Docker Image</strong><br />
Now, we build the Docker image with this command:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> my-postgres-image .</span></code></pre></div></li>
<li><p><strong>Running the Docker Container</strong><br />
We can run the Docker container from the image we just created:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--name</span> my-postgres-container <span class="at">-e</span> POSTGRES_PASSWORD=mysecretpassword <span class="at">-d</span> my-postgres-image</span></code></pre></div>
<p>This command starts the container. It sets the
<code>POSTGRES_PASSWORD</code> which is needed for the default
<code>postgres</code> user.</p></li>
<li><p><strong>Verifying the Database Creation</strong><br />
To check if the database was created, we can connect to the PostgreSQL
container and list the databases:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> my-postgres-container psql <span class="at">-U</span> postgres <span class="at">-c</span> <span class="st">&#39;\l&#39;</span></span></code></pre></div></li>
</ol>
<p>This way, we make sure our database is created when the Docker
container starts. If we want to learn more about using Docker with
databases, we can read this article on <a
href="https://bestonlinetutorial.com/docker/how-to-use-docker-for-database-migrations.html">how
to use Docker for database migrations</a>.</p>
<h2
id="how-can-you-combine-user-and-database-creation-in-a-single-script-for-docker-postgres">How
can you combine user and database creation in a single script for Docker
Postgres</h2>
<p>To combine user and database creation in a single script for Docker
Postgres, we can use an initialization script. This script runs when the
Postgres container starts. It will have SQL commands to create both the
user and the database at the same time.</p>
<p>Here is a simple guide with a sample script:</p>
<ol type="1">
<li><p><strong>Create a Directory for Initialization
Scripts</strong><br />
First, we need to create a directory on our host. This directory will
hold the initialization SQL script. For example, we can name it
<code>docker-entrypoint-initdb.d</code>.</p></li>
<li><p><strong>Create the SQL Script</strong><br />
Inside this directory, we create a file named <code>init.sql</code>. We
can use the following content:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create a user</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="fu">USER</span> myuser <span class="kw">WITH</span> <span class="kw">PASSWORD</span> <span class="st">&#39;mypassword&#39;</span>;</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create a database</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">DATABASE</span> mydatabase;</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Grant privileges</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">ALL</span> <span class="kw">PRIVILEGES</span> <span class="kw">ON</span> <span class="kw">DATABASE</span> mydatabase <span class="kw">TO</span> myuser;</span></code></pre></div></li>
<li><p><strong>Run the Postgres Container</strong><br />
Now, we run the Docker Postgres container. We need to mount the
initialization scripts directory to the correct location inside the
container:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--name</span> my_postgres <span class="at">-e</span> POSTGRES_PASSWORD=mysecretpassword <span class="at">-d</span> <span class="dt">\</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>-v /path/to/docker-entrypoint-initdb.d:/docker-entrypoint-initdb.d <span class="dt">\</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>-p 5432:5432 postgres</span></code></pre></div>
<p>Remember to replace <code>/path/to/docker-entrypoint-initdb.d</code>
with the real path to our initialization scripts directory.</p></li>
<li><p><strong>Verify the User and Database Creation</strong><br />
After the container starts, we can connect to the Postgres database.
This way, we check if the user and database were created correctly:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> my_postgres psql <span class="at">-U</span> postgres <span class="at">-c</span> <span class="st">&quot;\du&quot;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> my_postgres psql <span class="at">-U</span> postgres <span class="at">-c</span> <span class="st">&quot;\l&quot;</span></span></code></pre></div></li>
</ol>
<p>This method helps us set up both a database and a user in Docker
Postgres using just one script. This makes it easier to start our
PostgreSQL container. If we want to learn more about using Docker with
databases, we can check out <a
href="https://bestonlinetutorial.com/docker/what-is-docker-and-why-should-you-use-it.html">what
is Docker and why should you use it</a>.</p>
<h2
id="how-can-we-verify-user-and-database-creation-in-docker-postgres">How
Can We Verify User and Database Creation in Docker Postgres</h2>
<p>We can verify the creation of a user and database in Docker Postgres
by following these steps:</p>
<ol type="1">
<li><p><strong>Access the Postgres container</strong>: First, we need to
access the running Postgres container’s shell. We can use this
command.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> <span class="op">&lt;</span>container_name<span class="op">&gt;</span> bash</span></code></pre></div></li>
<li><p><strong>Connect to the Postgres database</strong>: Next, we use
the <code>psql</code> command to connect to the Postgres database. We
replace <code>&lt;username&gt;</code> with our Postgres username and
<code>&lt;dbname&gt;</code> with the database name.</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">psql</span> <span class="at">-U</span> <span class="op">&lt;</span>username<span class="op">&gt;</span> -d <span class="op">&lt;</span>dbname<span class="op">&gt;</span></span></code></pre></div></li>
<li><p><strong>List users</strong>: To check if the user was created, we
can run this SQL command inside the <code>psql</code> shell.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>\du</span></code></pre></div>
<p>This command will show all the users in the Postgres
database.</p></li>
<li><p><strong>List databases</strong>: To check if the database was
created, we can run this command:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>\l</span></code></pre></div>
<p>This will show all the databases in your Postgres instance.</p></li>
<li><p><strong>Check user permissions</strong>: If we want to see the
permissions for a specific user, we can run:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> information_schema.role_table_grants <span class="kw">WHERE</span> grantee <span class="op">=</span> <span class="st">&#39;&lt;username&gt;&#39;</span>;</span></code></pre></div></li>
<li><p><strong>Exit psql</strong>: To leave the Postgres shell, we just
type:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>\q</span></code></pre></div></li>
</ol>
<p>By following these steps, we can easily verify both the user and
database creation in our Docker Postgres setup.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="how-do-we-create-a-postgresql-user-in-docker">1. How do we
create a PostgreSQL user in Docker?</h3>
<p>To create a PostgreSQL user in Docker, we can use the
<code>CREATE USER</code> command in a SQL script. This script runs when
the container starts. We usually put this script file in the
<code>/docker-entrypoint-initdb.d/</code> directory. This way, the
script will run automatically when the PostgreSQL container starts. It
will create the user we need.</p>
<h3
id="what-environment-variables-do-we-need-to-set-up-postgresql-in-docker">2.
What environment variables do we need to set up PostgreSQL in
Docker?</h3>
<p>When we set up PostgreSQL in Docker, we use environment variables
like <code>POSTGRES_USER</code>, <code>POSTGRES_PASSWORD</code>, and
<code>POSTGRES_DB</code>. These variables help us create a user, a
password, and a database when the container starts. We must add these in
our <code>docker run</code> command or in our
<code>docker-compose.yml</code> file to set up the database
correctly.</p>
<h3
id="how-can-we-check-if-our-postgresql-user-and-database-were-created-successfully-in-docker">3.
How can we check if our PostgreSQL user and database were created
successfully in Docker?</h3>
<p>To check if our PostgreSQL user and database were created in Docker,
we connect to our PostgreSQL container. We can use a command like
<code>docker exec -it &lt;container_id&gt; psql -U &lt;username&gt; -d &lt;database_name&gt;</code>.
If we can log in without errors, then the user and database are created.
We can also run <code>\du</code> to list users and <code>\l</code> to
list databases.</p>
<h3
id="can-we-combine-user-and-database-creation-in-one-script-for-postgresql-in-docker">4.
Can we combine user and database creation in one script for PostgreSQL
in Docker?</h3>
<p>Yes, we can combine user and database creation in one SQL script for
PostgreSQL in Docker. We just need to put both the
<code>CREATE USER</code> and <code>CREATE DATABASE</code> commands in
one script file. Then we place this script in the
<code>/docker-entrypoint-initdb.d/</code> directory. PostgreSQL will run
it when the container starts. This will create both the user and
database together.</p>
<h3
id="what-are-some-common-issues-when-we-create-users-or-databases-in-docker-postgresql">5.
What are some common issues when we create users or databases in Docker
PostgreSQL?</h3>
<p>Some common issues when we create users or databases in Docker
PostgreSQL are permission errors, wrong environment variable settings,
and mistakes in our SQL script. We need to make sure we run the correct
PostgreSQL commands. Also, the Docker container must have the right
permissions. We should check the logs of our PostgreSQL container for
any errors to fix the problems.</p>
<p>For more tips on using Docker with databases, we can read articles on
<a
href="https://bestonlinetutorial.com/docker/how-to-use-docker-for-database-migrations.html">how
to use Docker for database migrations</a> or <a
href="https://bestonlinetutorial.com/docker/how-to-connect-docker-compose-with-spring-boot-and-postgres.html">how
to connect Docker Compose with Spring Boot and PostgreSQL</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            