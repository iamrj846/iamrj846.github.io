
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TFCQEJR7TD');
</script>
            <title>How to Use Docker for Database Migrations?</title>
            <meta name="description" content="Learn how to streamline database migrations with Docker. Step-by-step guide to simplify your development workflow!">

            <div id="head-placeholder"></div>
            <script src="/assets/js/blog.js" defer></script>
            <link rel="stylesheet" href="/assets/css/post.css">
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How to Use Docker for Database Migrations?</h1>
                        </header>

                        <div class="blog-post-body">
                            <h1 id="docker-for-database-migrations">Docker for Database
Migrations</h1>
<p>Using Docker for database migrations makes it easier to update and
manage database schemas. It does this in a consistent way. By putting
your database environment in containers, Docker makes sure that
migrations work the same in different places. This helps to solve the
problem of “it works on my machine.” With this method, we can focus on
writing migration scripts. We do not need to worry about differences in
environments.</p>
<p>In this article, we will see how to use Docker for database
migrations. We will talk about these topics:</p>
<ul>
<li>How Can You Use Docker for Effective Database Migrations?</li>
<li>What Are Docker Containers and Their Role in Database
Migrations?</li>
<li>How to Set Up a Dockerized Database Environment for Migrations?</li>
<li>What Tools Can You Use for Database Migrations in Docker?</li>
<li>How to Write and Execute Database Migration Scripts in Docker?</li>
<li>How to Manage Database Versions and Rollbacks with Docker?</li>
<li>Frequently Asked Questions</li>
</ul>
<p>This guide will help you understand how Docker works with database
migration processes. We will give you practical steps to use it
successfully.</p>
<h2
id="what-are-docker-containers-and-their-role-in-database-migrations">What
Are Docker Containers and Their Role in Database Migrations?</h2>
<p>Docker containers are light and portable. They hold an application
and everything it needs to run. This makes them great for running apps.
They help a lot when we move databases from one place to another.</p>
<p>Docker containers help in database migrations by:</p>
<ul>
<li><p><strong>Isolation</strong>: We can run each migration in its own
container. This way, the parts and settings do not mix up with other
services or setups.</p></li>
<li><p><strong>Consistency</strong>: Docker makes sure that the same
migration script works the same way everywhere. Whether we are in
development, testing, or production, it helps avoid the “it works on my
machine” issue.</p></li>
<li><p><strong>Version Control</strong>: We can keep different versions
of containers. This means we can go back to an earlier database state if
something goes wrong during a migration.</p></li>
<li><p><strong>Scalability</strong>: We can create many containers for
different database instances. This helps us run migrations at the same
time for big databases or microservices.</p></li>
</ul>
<h3 id="example-of-a-simple-docker-container-for-postgresql">Example of
a Simple Docker Container for PostgreSQL</h3>
<p>To make a Docker container for a PostgreSQL database, we can use this
command:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--name</span> my_postgres <span class="at">-e</span> POSTGRES_PASSWORD=mysecretpassword <span class="at">-d</span> postgres</span></code></pre></div>
<p>This command:</p>
<ul>
<li>Starts a new PostgreSQL container called
<code>my_postgres</code>.</li>
<li>Sets the superuser password to <code>mysecretpassword</code>.</li>
<li>Runs the container in the background.</li>
</ul>
<h3 id="using-docker-for-migrations">Using Docker for Migrations</h3>
<p>When we do database migrations, we can run migration scripts inside a
Docker container. For instance, if we are using a Node.js app with a
tool like Sequelize, we can run:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> my_postgres npx sequelize-cli db:migrate</span></code></pre></div>
<p>This command runs the migration inside the PostgreSQL container. It
makes sure that the database updates according to the migration scripts
we defined.</p>
<p>Using Docker containers makes database migrations easier. They are
also more reliable and the same in different environments. This helps us
a lot in our development work. For more information on Docker and its
advantages, we can check out <a
href="https://bestonlinetutorial.com/docker/what-are-the-benefits-of-using-docker-in-development.html">what
are the benefits of using Docker in development</a>.</p>
<h2
id="how-to-set-up-a-dockerized-database-environment-for-migrations">How
to Set Up a Dockerized Database Environment for Migrations?</h2>
<p>We can set up a Dockerized database environment for migrations by
creating Docker containers. These containers will hold your database and
the tools you need for migration. Here is a simple guide to help us.</p>
<ol type="1">
<li><p><strong>Install Docker</strong>: First, we need to install Docker
on our computer. We can follow the <a
href="https://bestonlinetutorial.com/docker/how-to-install-docker-on-different-operating-systems.html">installation
guide</a> for our operating system.</p></li>
<li><p><strong>Create a Docker Network</strong>: This helps our
containers talk to each other.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> network create db-network</span></code></pre></div></li>
<li><p><strong>Create a Docker Compose File
(<code>docker-compose.yml</code>)</strong>: This file tells what
database service we use and any other services for migrations.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">db</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres:latest</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_USER</span><span class="kw">:</span><span class="at"> example</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_PASSWORD</span><span class="kw">:</span><span class="at"> example</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_DB</span><span class="kw">:</span><span class="at"> example_db</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> db-network</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> db_data:/var/lib/postgresql/data</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">migration</span><span class="kw">:</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> migrate/migrate</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> db-network</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> db</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./migrations:/migrations</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">db_data</span><span class="kw">:</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">db-network</span><span class="kw">:</span></span></code></pre></div></li>
<li><p><strong>Create Migration Scripts</strong>: We should put our
migration scripts in a folder called <code>migrations</code> in our
project. We must check that the scripts work with our database, like
using SQL for PostgreSQL.</p></li>
<li><p><strong>Run Docker Compose</strong>: Now we can start our Docker
containers.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">-d</span></span></code></pre></div></li>
<li><p><strong>Execute Migrations</strong>: We need to use the migration
container to apply our migrations to the database.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run migration migrate <span class="at">-path</span><span class="op">=</span>/migrations <span class="at">-database</span><span class="op">=</span><span class="st">&quot;postgres://example:example@db:5432/example_db?sslmode=disable&quot;</span> up</span></code></pre></div></li>
</ol>
<p>This command will run the migration scripts on our PostgreSQL
database in the <code>db</code> container. We can change the database
connection string if we need to.</p>
<ol start="7" type="1">
<li><p><strong>Check Database State</strong>: We can connect to the
PostgreSQL container to see if the migrations worked.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> <span class="va">$(</span><span class="ex">docker</span> ps <span class="at">-qf</span> <span class="st">&quot;name=db&quot;</span><span class="va">)</span> psql <span class="at">-U</span> example <span class="at">-d</span> example_db</span></code></pre></div></li>
</ol>
<p>By following these steps, we can set up a Dockerized database
environment. It will be flexible and easy to manage for our migration
tasks. For more information on Docker and its features, we can check
resources like <a
href="https://bestonlinetutorial.com/docker/what-are-docker-volumes-and-how-do-they-work.html">What
Are Docker Volumes and How Do They Work?</a>.</p>
<h2 id="what-tools-can-we-use-for-database-migrations-in-docker">What
Tools Can We Use for Database Migrations in Docker?</h2>
<p>When we use Docker for database migrations, we can use several tools
to make the process better. These tools help us be more efficient and
reliable. Here are some popular tools we can use:</p>
<ol type="1">
<li><strong>Flyway</strong>: This is a well-known open-source tool for
database migrations. It supports migrations based on SQL.
<ul>
<li><p><strong>Setup</strong>: We need to create a
<code>Dockerfile</code> for Flyway.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> flyway/flyway:latest</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> sql/ /flyway/sql</span></code></pre></div></li>
<li><p><strong>Execute Migrations</strong>:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> flyway/flyway migrate</span></code></pre></div></li>
</ul></li>
<li><strong>Liquibase</strong>: This is another strong open-source tool.
It supports many databases and lets us use XML, YAML, JSON, or SQL
changesets.
<ul>
<li><p><strong>Setup</strong>: We can use a Docker image for
Liquibase.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> liquibase/liquibase:latest</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> changelog/ /liquibase/changelog</span></code></pre></div></li>
<li><p><strong>Run Migrations</strong>:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> liquibase/liquibase update</span></code></pre></div></li>
</ul></li>
<li><strong>Alembic</strong>: This is a small migration tool for use
with SQLAlchemy in Python apps.
<ul>
<li><p><strong>Setup</strong>: We can run Alembic in Docker.</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> python:3.8</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install alembic</span></code></pre></div></li>
<li><p><strong>Run Migrations</strong>:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> your-image-name alembic upgrade head</span></code></pre></div></li>
</ul></li>
<li><strong>Dbmate</strong>: This is a small tool that works with many
databases. It supports SQL migrations.
<ul>
<li><p><strong>Usage</strong>:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-v</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>:/app dbmate up</span></code></pre></div></li>
</ul></li>
<li><strong>Knex.js</strong>: This is a SQL query builder for Node.js.
It also provides migration features.
<ul>
<li><p><strong>Setup</strong>: We should include Knex in our
Dockerfile.</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> node:14</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> package.json ./</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">npm</span> install</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span></code></pre></div></li>
<li><p><strong>Run Migrations</strong>:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> your-image-name knex migrate:latest</span></code></pre></div></li>
</ul></li>
<li><strong>Rails Active Record Migrations</strong>: For Ruby on Rails
apps, we can use the built-in Active Record features.
<ul>
<li><p><strong>Setup</strong>:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> ruby:2.7</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">bundle</span> install</span></code></pre></div></li>
<li><p><strong>Run Migrations</strong>:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> your-image-name rails db:migrate</span></code></pre></div></li>
</ul></li>
</ol>
<p>These tools help us manage and automate database migrations easily in
Docker. They make our integration and deployment processes smooth. For
more details about setting up a Dockerized database environment, we can
check <a
href="https://bestonlinetutorial.com/docker/how-to-set-up-a-dockerized-database-environment-for-migrations.html">this
guide</a>.</p>
<h2
id="how-to-write-and-execute-database-migration-scripts-in-docker">How
to Write and Execute Database Migration Scripts in Docker?</h2>
<p>To manage database migrations in Docker, we can write migration
scripts with different tools. Here is how we create and run these
scripts.</p>
<h3 id="creating-migration-scripts">Creating Migration Scripts</h3>
<ol type="1">
<li><p><strong>Choose a Migration Tool</strong>: There are many tools to
choose from. Some popular ones are Flyway, Liquibase, and Alembic for
Python. In this example, we will use Flyway.</p></li>
<li><p><strong>Install Flyway</strong>: We can run Flyway in a Docker
container. Use this command to get the Flyway image:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull flyway/flyway</span></code></pre></div></li>
<li><p><strong>Create Migration Scripts</strong>: We need to name our
migration scripts in a special way for Flyway to see them. The name
should be like <code>V&lt;version&gt;__&lt;description&gt;.sql</code>.
For example:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- V1__Create_user_table.sql</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    username <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">password</span> <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>);</span></code></pre></div></li>
<li><p><strong>Store Migration Scripts</strong>: We should save our
migration scripts in a folder, for example,
<code>./sql/migrations</code>.</p></li>
</ol>
<h3 id="executing-migration-scripts">Executing Migration Scripts</h3>
<ol type="1">
<li><p><strong>Prepare Docker Command</strong>: We can use this command
to run our migration scripts in Docker:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-v</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/sql/migrations:/flyway/sql flyway/flyway <span class="dt">\</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>-url=jdbc:postgresql://<span class="op">&lt;</span>DB_HOST<span class="op">&gt;</span>:<span class="op">&lt;</span>DB_PORT<span class="op">&gt;</span>/<span class="op">&lt;</span>DB_NAME<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>-user=<span class="op">&lt;</span>DB_USER<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>-password=<span class="op">&lt;</span>DB_PASSWORD<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>migrate</span></code></pre></div>
<p>Remember to change <code>&lt;DB_HOST&gt;</code>,
<code>&lt;DB_PORT&gt;</code>, <code>&lt;DB_NAME&gt;</code>,
<code>&lt;DB_USER&gt;</code>, and <code>&lt;DB_PASSWORD&gt;</code> to
your real database info.</p></li>
<li><p><strong>Run Migration</strong>: We can now run the command in our
terminal. This will apply all waiting migrations to our
database.</p></li>
</ol>
<h3 id="example-docker-compose-configuration">Example Docker Compose
Configuration</h3>
<p>If we use Docker Compose, we can set our Flyway service in the
<code>docker-compose.yml</code> file like this:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">flyway</span><span class="kw">:</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> flyway/flyway</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./sql/migrations:/flyway/sql</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">FLYWAY_URL</span><span class="kw">:</span><span class="at"> jdbc:postgresql://&lt;DB_HOST&gt;:&lt;DB_PORT&gt;/&lt;DB_NAME&gt;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">FLYWAY_USER</span><span class="kw">:</span><span class="at"> &lt;DB_USER&gt;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">FLYWAY_PASSWORD</span><span class="kw">:</span><span class="at"> &lt;DB_PASSWORD&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> migrate</span></span></code></pre></div>
<p>We need to run this command to start the Flyway migration:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up</span></code></pre></div>
<p>This way, we can handle database migrations easily in a Docker setup.
It helps keep things the same in development, testing, and production
environments.</p>
<p>For more information on Docker and its advantages, you can check <a
href="https://bestonlinetutorial.com/docker/what-are-the-benefits-of-using-docker-in-development.html">What
Are the Benefits of Using Docker in Development</a>.</p>
<h2 id="how-to-manage-database-versions-and-rollbacks-with-docker">How
to Manage Database Versions and Rollbacks with Docker?</h2>
<p>Managing database versions and rollbacks in a Docker environment is
important. We can use migration tools to help us with changes in our
database. Here is how we can do it:</p>
<h3 id="versioning-database-migrations">Versioning Database
Migrations</h3>
<ol type="1">
<li><p><strong>Use Migration Tools</strong>: We can use tools like
<code>Flyway</code> or <code>Liquibase</code>. These tools help us
control the version of our database schema with migration
scripts.</p></li>
<li><p><strong>Directory Structure</strong>: We should organize our
migration scripts in a folder in our project. For example:
<code>├── migrations     │   ├── V1__initial_schema.sql     │   ├── V2__add_users_table.sql     │   └── V3__add_orders_table.sql</code></p></li>
<li><p><strong>Dockerfile Configuration</strong>: We need to make sure
the migration tool is in our Dockerfile and set up properly:
<code>Dockerfile     FROM openjdk:11-jre-slim     RUN apt-get update &amp;&amp; apt-get install -y flyway     COPY ./migrations /flyway/sql</code></p></li>
</ol>
<h3 id="running-migrations">Running Migrations</h3>
<ol type="1">
<li><p><strong>Database Connection</strong>: We have to set environment
variables in our <code>docker-compose.yml</code> for the database
connection.
<code>yaml     services:       db:         image: postgres         environment:           POSTGRES_USER: user           POSTGRES_PASSWORD: password           POSTGRES_DB: mydatabase       flyway:         image: flyway         environment:           FLYWAY_URL: jdbc:postgresql://db:5432/mydatabase           FLYWAY_USER: user           FLYWAY_PASSWORD: password         volumes:           - ./migrations:/flyway/sql</code></p></li>
<li><p><strong>Execute Migrations</strong>: We can run this command to
apply migrations:
<code>bash     docker-compose run flyway migrate</code></p></li>
</ol>
<h3 id="rollback-mechanism">Rollback Mechanism</h3>
<ol type="1">
<li><p><strong>Undo Scripts</strong>: We should create undo scripts for
each migration. For example:
<code>├── migrations     │   ├── U1__drop_users_table.sql     │   └── U2__drop_orders_table.sql</code></p></li>
<li><p><strong>Reverting Migrations</strong>: We can use the rollback
command from our migration tool. If we use Flyway, we run:
<code>bash     docker-compose run flyway undo</code></p></li>
<li><p><strong>Version Control</strong>: We need to keep track of our
migration versions with a table. Flyway or Liquibase makes this table
and logs each migration we run.</p></li>
</ol>
<p>With these methods, we can manage our database versions and rollbacks
in a Docker environment. For more details about using Docker for
database migrations, check this <a
href="https://bestonlinetutorial.com/docker/what-are-docker-images-and-how-do-they-work.html">article
on Docker migration tools</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3
id="what-is-the-best-way-to-manage-database-migrations-with-docker">1.
What is the best way to manage database migrations with Docker?</h3>
<p>We can manage database migrations with Docker by using
containerization. This helps us keep our database environment separate.
We can use tools like Flyway or Liquibase to automate the migration
process. When we run these tools inside a Docker container, we make sure
everything is the same across different setups. This helps developers
work together better. For more information on Docker’s advantages in
development, check out <a
href="https://bestonlinetutorial.com/docker/what-are-the-benefits-of-using-docker-in-development.html">what
are the benefits of using Docker in development</a>.</p>
<h3
id="can-i-run-multiple-database-versions-in-docker-for-migrations">2.
Can I run multiple database versions in Docker for migrations?</h3>
<p>Yes, we can run many versions of a database at the same time with
Docker. Each container can have a different version of the database.
This lets us test migrations in different setups. This is very important
for continuous integration and deployment (CI/CD) pipelines. To learn
more about running Docker containers, refer to <a
href="https://bestonlinetutorial.com/docker/what-is-a-docker-container-and-how-does-it-operate.html">what
is a docker container and how does it operate</a>.</p>
<h3 id="how-do-i-handle-rollbacks-in-dockerized-database-migrations">3.
How do I handle rollbacks in Dockerized database migrations?</h3>
<p>We can handle rollbacks in Docker by using migration tools that
support rollbacks, like Flyway or Liquibase. By running special scripts
in our Docker containers, we can go back to previous database states
easily. This is very important when we deploy to keep our application
stable. For a detailed guide on managing Docker containers, you can read
<a
href="https://bestonlinetutorial.com/docker/how-to-stop-and-start-docker-containers.html">how
to stop and start docker containers</a>.</p>
<h3 id="what-are-the-common-tools-for-database-migrations-in-docker">4.
What are the common tools for database migrations in Docker?</h3>
<p>Common tools for database migrations in Docker are Flyway, Liquibase,
and Alembic. We can easily add these tools to our Docker setup. This
helps us manage migrations in containerized environments. They also give
us version control for our database schema. This makes it easy to track
changes and keep the database safe. For more reading on using Docker
well, check out <a
href="https://bestonlinetutorial.com/docker/how-to-use-docker-for-web-development-environments.html">how
to use Docker for web development environments</a>.</p>
<h3 id="is-it-possible-to-automate-database-migrations-in-docker">5. Is
it possible to automate database migrations in Docker?</h3>
<p>Yes, it is possible! We can automate database migrations in Docker
with CI/CD tools like Jenkins or GitLab CI. By adding migration scripts
into our pipeline, we can make sure migrations run automatically when we
deploy updates. This makes the deployment process smoother and cuts down
on mistakes. To learn more about setting up CI/CD with Docker, visit <a
href="https://bestonlinetutorial.com/docker/how-to-set-up-a-ci-cd-pipeline-with-docker-and-gitlab.html">how
to set up a CI/CD pipeline with Docker and GitLab</a>.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            