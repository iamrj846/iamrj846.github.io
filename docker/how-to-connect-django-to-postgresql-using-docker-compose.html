
    
            <!DOCTYPE html>
        <html lang="en">

        <head>
            <!-- Google tag (gtag.js) -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFCQEJR7TD"></script>
            <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-TFCQEJR7TD');
            </script>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <!-- Common CSS & Icons -->
            <link rel="icon" href="/favicon.ico" type="image/x-icon">
            <link rel="stylesheet" href="/assets/plugins/highlight/styles/monokai-sublime.css">
            <link id="theme-style" rel="stylesheet" href="/assets/css/theme-8.css">
            <link rel="stylesheet" href="/assets/css/post.css">
            <title>How to Connect Django to PostgreSQL Using Docker Compose?</title>
            <meta name="description" content="Learn how to easily connect Django to PostgreSQL using Docker Compose with our step-by-step guide for seamless development.">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	        <script src="/assets/js/blog.js"></script>
        </head>

        <body>

            <div id="header-placeholder"></div>

            <div class="main-wrapper">

                <article class="blog-post px-3 py-5 p-md-5">
                    <div class="container single-col-max-width">
                        <header class="blog-post-header">
                            <h1 class="title mb-2">How to Connect Django to PostgreSQL Using Docker Compose?</h1>
                        </header>

                        <div class="blog-post-body">
                            <p>To connect Django to PostgreSQL with Docker Compose, we need to set
up our Docker environment correctly. First, we will create a Docker
Compose file. This file will define both the Django app and the
PostgreSQL database. When we follow the right steps, we can easily
connect Django to PostgreSQL. This way, our web app can work well inside
a container.</p>
<p>In this article, we will show you the important steps to connect
Django to PostgreSQL using Docker Compose. We will explain how to create
your Docker Compose file. We will also talk about how to set up Django
settings for the PostgreSQL connection. After that, we will build and
run our Docker containers. We will check if the connection works and fix
common problems that might come up. Here is what we will talk about:</p>
<ul>
<li>Setting Up Your Docker Compose File for Django and PostgreSQL</li>
<li>Configuring Django Settings for PostgreSQL Connection</li>
<li>Building and Running Your Docker Containers</li>
<li>Verifying the Connection Between Django and PostgreSQL</li>
<li>Troubleshooting Common Connection Issues</li>
<li>Frequently Asked Questions</li>
</ul>
<h2
id="setting-up-your-docker-compose-file-for-django-and-postgresql">Setting
Up Your Docker Compose File for Django and PostgreSQL</h2>
<p>To connect Django to PostgreSQL using Docker Compose, we need to make
a <code>docker-compose.yml</code> file. This file will define our Django
app and PostgreSQL service. Below is a simple example to set up these
services.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">db</span><span class="kw">:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres:latest</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_DB</span><span class="kw">:</span><span class="at"> mydatabase</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_USER</span><span class="kw">:</span><span class="at"> myuser</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_PASSWORD</span><span class="kw">:</span><span class="at"> mypassword</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres_data:/var/lib/postgresql/data</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mynetwork</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">web</span><span class="kw">:</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> python manage.py runserver 0.0.0.0:8000</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> .:/app</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8000:8000&quot;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> db</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">DB_NAME</span><span class="kw">:</span><span class="at"> mydatabase</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">DB_USER</span><span class="kw">:</span><span class="at"> myuser</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">DB_PASSWORD</span><span class="kw">:</span><span class="at"> mypassword</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">DB_HOST</span><span class="kw">:</span><span class="at"> db</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">DB_PORT</span><span class="kw">:</span><span class="at"> </span><span class="dv">5432</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mynetwork</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres_data</span><span class="kw">:</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">mynetwork</span><span class="kw">:</span></span></code></pre></div>
<h3 id="explanation">Explanation:</h3>
<ul>
<li><p><strong>db</strong>: This service uses the official PostgreSQL
image. We set the database name, user, and password with environment
variables. Data stays safe in a Docker volume named
<code>postgres_data</code>.</p></li>
<li><p><strong>web</strong>: This service builds the Django app. It runs
the server and maps ports. It depends on the <code>db</code> service to
make sure PostgreSQL is ready before Django starts.</p></li>
<li><p><strong>Volumes</strong>: The <code>postgres_data</code> volume
is for saving the database data.</p></li>
<li><p><strong>Networks</strong>: We create a custom network called
<code>mynetwork</code> to let services talk to each other.</p></li>
</ul>
<p>We should place this <code>docker-compose.yml</code> file in the main
folder of our Django project. Then we can run
<code>docker-compose up</code> to start both services.</p>
<h2
id="configuring-django-settings-for-postgresql-connection">Configuring
Django Settings for PostgreSQL Connection</h2>
<p>We want to connect our Django app to a PostgreSQL database using
Docker. To do this, we need to change the <code>settings.py</code> file
in our Django project. We will update the <code>DATABASES</code> setting
with the PostgreSQL connection info.</p>
<ol type="1">
<li><p><strong>Install psycopg2</strong>: First, we need to have the
PostgreSQL adapter for Python. We can add it in our
<code>requirements.txt</code> or install it by hand.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install psycopg2-binary</span></code></pre></div></li>
<li><p><strong>Update settings.py</strong>: Next, we modify the
<code>DATABASES</code> setting in our Django <code>settings.py</code>
file to use PostgreSQL. We replace the placeholders with our real
database name, user, password, and host.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>DATABASES <span class="op">=</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;default&#39;</span>: {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;ENGINE&#39;</span>: <span class="st">&#39;django.db.backends.postgresql&#39;</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;NAME&#39;</span>: <span class="st">&#39;your_database_name&#39;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;USER&#39;</span>: <span class="st">&#39;your_database_user&#39;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;PASSWORD&#39;</span>: <span class="st">&#39;your_database_password&#39;</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;HOST&#39;</span>: <span class="st">&#39;db&#39;</span>,  <span class="co"># This is the Docker service name for PostgreSQL</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;PORT&#39;</span>: <span class="st">&#39;5432&#39;</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p><strong>Environment Variables (Optional)</strong>: It is good to
keep sensitive info like database passwords in environment variables. We
can use the <code>os</code> module to get these variables.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>DATABASES <span class="op">=</span> {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;default&#39;</span>: {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;ENGINE&#39;</span>: <span class="st">&#39;django.db.backends.postgresql&#39;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;NAME&#39;</span>: os.getenv(<span class="st">&#39;POSTGRES_DB&#39;</span>, <span class="st">&#39;your_database_name&#39;</span>),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;USER&#39;</span>: os.getenv(<span class="st">&#39;POSTGRES_USER&#39;</span>, <span class="st">&#39;your_database_user&#39;</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;PASSWORD&#39;</span>: os.getenv(<span class="st">&#39;POSTGRES_PASSWORD&#39;</span>, <span class="st">&#39;your_database_password&#39;</span>),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;HOST&#39;</span>: <span class="st">&#39;db&#39;</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;PORT&#39;</span>: <span class="st">&#39;5432&#39;</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p><strong>Docker Compose Configuration</strong>: Now we check our
<code>docker-compose.yml</code> file to make sure the PostgreSQL service
is set up right. Here is a small example:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">db</span><span class="kw">:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres:13</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_DB</span><span class="kw">:</span><span class="at"> your_database_name</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_USER</span><span class="kw">:</span><span class="at"> your_database_user</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_PASSWORD</span><span class="kw">:</span><span class="at"> your_database_password</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;5432:5432&quot;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres_data:/var/lib/postgresql/data</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">web</span><span class="kw">:</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> python manage.py runserver 0.0.0.0:8000</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> .:/code</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8000:8000&quot;</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> db</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres_data</span><span class="kw">:</span></span></code></pre></div></li>
</ol>
<p>By doing these steps, we can set up our Django app to connect to a
PostgreSQL database in a Docker container. Remember to change the
placeholders to real values for your setup. If we want to learn more
about connecting Docker Compose services to outside databases, we can
check this <a
href="https://bestonlinetutorial.com/docker/how-to-connect-docker-compose-services-to-external-databases.html">guide</a>.</p>
<h2 id="building-and-running-your-docker-containers">Building and
Running Your Docker Containers</h2>
<p>We will build and run Docker containers for a Django app that
connects to PostgreSQL. Just follow these steps:</p>
<ol type="1">
<li><p><strong>First, check that Docker and Docker Compose are
installed</strong> on your computer. You can look at this guide on <a
href="https://bestonlinetutorial.com/docker/how-to-install-docker-on-different-operating-systems.html">how
to install Docker on different operating systems</a>.</p></li>
<li><p><strong>Next, go to your project folder</strong> where your
<code>docker-compose.yml</code> file is.</p></li>
<li><p><strong>Now, let’s build the Docker images</strong>. Use this
command:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> build</span></code></pre></div></li>
<li><p><strong>Then, run the containers in detached mode</strong>. This
keeps them running in the background:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">-d</span></span></code></pre></div></li>
<li><p><strong>We should check the status of your containers</strong> to
make sure they are running:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> ps</span></code></pre></div></li>
<li><p><strong>Next, run database migrations</strong>. This sets up your
PostgreSQL database schema:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> run web python manage.py migrate</span></code></pre></div></li>
<li><p><strong>Finally, access your Django application</strong>. If we
mapped the ports right, we can see it at
<code>http://localhost:8000</code> or the port you used in your
<code>docker-compose.yml</code>.</p></li>
</ol>
<p>Your <code>docker-compose.yml</code> should have services for Django
and PostgreSQL. It should look like this:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">web</span><span class="kw">:</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8000:8000&quot;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> .:/code</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> db</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">db</span><span class="kw">:</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_DB</span><span class="kw">:</span><span class="at"> yourdbname</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_USER</span><span class="kw">:</span><span class="at"> yourdbuser</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_PASSWORD</span><span class="kw">:</span><span class="at"> yourdbpassword</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres_data:/var/lib/postgresql/data</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres_data</span><span class="kw">:</span></span></code></pre></div>
<p>This setup creates a simple Django app that connects to a PostgreSQL
database inside Docker containers. Don’t forget to change
<code>yourdbname</code>, <code>yourdbuser</code>, and
<code>yourdbpassword</code> to your own database info.</p>
<h2
id="verifying-the-connection-between-django-and-postgresql">Verifying
the Connection Between Django and PostgreSQL</h2>
<p>To check the connection between Django and PostgreSQL using Docker
Compose, we can follow these steps.</p>
<ol type="1">
<li><p><strong>Access Django Shell</strong>: First, we need to open the
Django shell inside the running container. Use this command to open a
shell in the Django service container:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> exec web python manage.py shell</span></code></pre></div></li>
<li><p><strong>Testing Database Connection</strong>: After we are in the
shell, we can run these commands to see if Django connects to the
PostgreSQL database:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> django.db <span class="im">import</span> connection</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>cursor <span class="op">=</span> connection.cursor()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">&quot;SELECT 1;&quot;</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cursor.fetchone())</span></code></pre></div>
<p>If we see the output <code>(1,)</code>, it means the connection works
well.</p></li>
<li><p><strong>Check Migrations</strong>: We should check if our
database migrations are applied right. Run this command to see if Django
can talk to the database:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> exec web python manage.py migrate</span></code></pre></div>
<p>This command should run without any error. If it does, it shows that
the database is connected fine.</p></li>
<li><p><strong>Django Admin</strong>: We can also check the connection
by going to the Django admin panel. We must log in as the admin user to
see the database content. If we do not have a superuser yet, we can
create one:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> exec web python manage.py createsuperuser</span></code></pre></div></li>
<li><p><strong>Check Logs</strong>: If we face any problems, we should
look at the logs of the PostgreSQL container for any connection
issues:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> logs db</span></code></pre></div></li>
<li><p><strong>Database Queries</strong>: We can run a simple query to
list our tables using Django ORM:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> myapp.models <span class="im">import</span> MyModel</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>MyModel.objects.<span class="bu">all</span>()</span></code></pre></div>
<p>Here, replace <code>MyModel</code> with any model we have.</p></li>
</ol>
<p>By following these steps, we can easily check the connection between
Django and PostgreSQL in our Docker Compose setup. This way, we make
sure our application works with the database as we expect.</p>
<h2 id="troubleshooting-common-connection-issues">Troubleshooting Common
Connection Issues</h2>
<p>When we connect Django to PostgreSQL using Docker Compose, we may
face some common connection issues. Here are some easy steps to fix
these problems.</p>
<ol type="1">
<li><p><strong>Database Service Not Running</strong><br />
First, we need to check if the PostgreSQL service is running. We can
check the status of our containers with:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> ps</span></code></pre></div>
<p>If PostgreSQL is not running, we can start it with:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">-d</span> postgres</span></code></pre></div></li>
<li><p><strong>Wrong Database Credentials</strong><br />
Next, we should check that the database name, user, and password in our
Django settings match what we have in our
<code>docker-compose.yml</code>. For example:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">POSTGRES_DB</span><span class="kw">:</span><span class="at"> mydatabase</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">POSTGRES_USER</span><span class="kw">:</span><span class="at"> myuser</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">POSTGRES_PASSWORD</span><span class="kw">:</span><span class="at"> mypassword</span></span></code></pre></div></li>
<li><p><strong>Network Issues</strong><br />
We need to make sure that both Django and PostgreSQL are on the same
Docker network. In our <code>docker-compose.yml</code>, we can define a
network like this:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">mynetwork</span><span class="kw">:</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">web</span><span class="kw">:</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mynetwork</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">db</span><span class="kw">:</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> mynetwork</span></span></code></pre></div></li>
<li><p><strong>PostgreSQL Not Accepting Connections</strong><br />
We can check the PostgreSQL logs for any connection errors. We can see
the logs with:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> logs db</span></code></pre></div>
<p>We look for lines that say there are connection problems or
authentication failures.</p></li>
<li><p><strong>Incorrect Host Configuration</strong><br />
In our Django settings, we need to make sure we use the right host for
the database connection. If our service is named <code>db</code>, it
should look like this:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>DATABASES <span class="op">=</span> {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;default&#39;</span>: {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;ENGINE&#39;</span>: <span class="st">&#39;django.db.backends.postgresql&#39;</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;NAME&#39;</span>: <span class="st">&#39;mydatabase&#39;</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;USER&#39;</span>: <span class="st">&#39;myuser&#39;</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;PASSWORD&#39;</span>: <span class="st">&#39;mypassword&#39;</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;HOST&#39;</span>: <span class="st">&#39;db&#39;</span>,  <span class="co"># Service name from docker-compose.yml</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;PORT&#39;</span>: <span class="st">&#39;5432&#39;</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p><strong>PostgreSQL Configuration</strong><br />
If we have custom settings in our PostgreSQL, we need to check that
<code>pg_hba.conf</code> allows connections from the Django container.
We may need to change it to allow connections from the Docker
network.</p></li>
<li><p><strong>Firewall or Security Groups</strong><br />
If we are using cloud providers, we must check that firewall rules or
security groups let traffic through on the PostgreSQL port. The default
port is 5432.</p></li>
<li><p><strong>Django Migrations Not Applied</strong><br />
If Django cannot find the database or its tables, we should make sure
that we have applied migrations:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> exec web python manage.py migrate</span></code></pre></div></li>
<li><p><strong>Container Health Check</strong><br />
We can add health checks in our <code>docker-compose.yml</code> for the
database service. This way, it will be ready before Django tries to
connect:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">healthcheck</span><span class="kw">:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;CMD-SHELL&quot;</span><span class="kw">,</span><span class="at"> </span><span class="st">&quot;pg_isready -U myuser&quot;</span><span class="kw">]</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> 10s</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> 5s</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">retries</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span></code></pre></div></li>
<li><p><strong>Inspecting Environment Variables</strong><br />
Finally, we need to check that our environment variables are set
correctly in the Docker containers:
<code>bash     docker-compose exec db env</code></p></li>
</ol>
<p>By following these steps, we can solve most connection issues between
Django and PostgreSQL when using Docker Compose. For more help on using
Docker well, check out <a
href="https://bestonlinetutorial.com/docker/how-to-connect-docker-compose-services-to-external-databases.html">How
to connect Docker Compose services to external databases</a>.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="how-do-we-set-up-postgresql-with-django-in-docker-compose">1.
How do we set up PostgreSQL with Django in Docker Compose?</h3>
<p>To set up PostgreSQL with Django using Docker Compose, we need to
make a <code>docker-compose.yml</code> file. This file will define our
Django and PostgreSQL services. We should include the PostgreSQL image
and set environment variables for the database name, user, and password.
Also, we need to set up a volume for saving data. For more details,
check <a
href="https://bestonlinetutorial.com/docker/how-to-write-a-simple-docker-compose-yml-file.html">How
to write a simple Docker Compose YAML file</a>.</p>
<h3
id="what-are-the-best-practices-for-connecting-django-to-postgresql-in-docker">2.
What are the best practices for connecting Django to PostgreSQL in
Docker?</h3>
<p>When we connect Django to PostgreSQL in Docker, we should use
environment variables for sensitive info like database credentials. It
is also important to set Django settings to use the
<code>django.db.backends.postgresql</code> backend. We can use a Docker
network for services to talk to each other. Make sure the database
service is running before Django starts. For more insights, see <a
href="https://bestonlinetutorial.com/docker/how-to-connect-docker-compose-services-to-external-databases.html">How
to connect Docker Compose services to external databases</a>.</p>
<h3
id="how-can-we-troubleshoot-postgresql-connection-issues-in-docker">3.
How can we troubleshoot PostgreSQL connection issues in Docker?</h3>
<p>To troubleshoot PostgreSQL connection issues in Docker, we often
check the service status. We also need to verify environment variables
and check network connection between containers. Let’s look at the logs
from both Django and PostgreSQL containers for errors. Also, make sure
the PostgreSQL service is running and can be reached on the right port.
Check <a
href="https://bestonlinetutorial.com/docker/how-to-troubleshoot-docker-networking-issues.html">how
to troubleshoot Docker networking issues</a> for more tips.</p>
<h3
id="what-should-we-do-if-our-django-application-cannot-connect-to-postgresql">4.
What should we do if our Django application cannot connect to
PostgreSQL?</h3>
<p>If our Django application cannot connect to PostgreSQL, first we
should check if the database service is running. Then we need to make
sure the connection details in our Django settings are correct. We also
need to check if the PostgreSQL container can be reached from the Django
container. Sometimes we may also need to look at firewall settings or
Docker network setups. For more help, refer to <a
href="https://bestonlinetutorial.com/docker/how-to-connect-to-postgresql-in-a-docker-container-from-outside.html">how
to connect to PostgreSQL in a Docker container from outside</a>.</p>
<h3
id="can-we-use-docker-compose-to-scale-our-django-and-postgresql-services">5.
Can we use Docker Compose to scale our Django and PostgreSQL
services?</h3>
<p>Yes, we can use Docker Compose to easily scale our Django and
PostgreSQL services. We can define many instances of our Django
application with the <code>scale</code> option in our
<code>docker-compose.yml</code> file. But we should make sure our
PostgreSQL instance can handle many connections well. For scaling
services, check out <a
href="https://bestonlinetutorial.com/docker/how-to-scale-services-with-docker-compose.html">how
to scale services with Docker Compose</a> for a complete guide.</p>

                        </div>

                    </div>
                    <!--//container-->
                </article>

            </div>
            <!--//main-wrapper-->

            <div id="footer-placeholder"></div>

            <!-- Javascript -->
            <script src="/assets/plugins/popper.min.js" defer></script>
            <script src="/assets/plugins/bootstrap/js/bootstrap.min.js" defer></script>
            <script src="/assets/fontawesome/js/all.min.js" defer></script>
        </body>

        </html>
            
            